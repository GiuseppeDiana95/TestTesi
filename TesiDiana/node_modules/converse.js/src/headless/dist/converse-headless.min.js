/*! For license information please see converse-headless.min.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.converse=t():e.converse=t()}(this,(()=>(()=>{var e,t,n,r,i={487:function(e,t,n){!function(e,t){"use strict";function n(e){return n.result?n.result:e&&"function"==typeof e.getSerializer?(n.result=e.getSerializer(),n.result):Promise.reject(new Error("localforage.getSerializer() was not available! localforage v1.4+ is required!"))}function r(e,t){return t&&e.then((function(e){t(null,e)}),(function(e){t(e)})),e}function i(e,t){var n=this.getItem(e).then((function(t){return{key:e,value:t}}));return r(n,t),n}function s(e){var t=this;return new Promise((function(n,r){for(var s=[],o=0,a=e.length;o<a;o++)s.push(i.call(t,e[o]));Promise.all(s).then((function(e){for(var t={},r=0,i=e.length;r<i;r++){var s=e[r];t[s.key]=s.value}n(t)})).catch(r)}))}function o(){var e={};return this.iterate((function(t,n){e[n]=t})).then((function(){return e}))}function a(){return"undefined"!=typeof IDBKeyRange?IDBKeyRange:"undefined"!=typeof webkitIDBKeyRange?webkitIDBKeyRange:"undefined"!=typeof mozIDBKeyRange?mozIDBKeyRange:void 0}t="default"in t?t.default:t;var c=a();function u(e){e=e.slice();var t=this;function n(e,t){return e<t?-1:e>t?1:0}return new Promise((function(r,i){t.ready().then((function(){var s,o=t._dbInfo,a=o.db.transaction(o.storeName,"readonly").objectStore(o.storeName),u=e.sort(n),d=c.bound(e[0],e[e.length-1],!1,!1);if("getAll"in a)(s=a.getAll(d)).onsuccess=function(){var e=s.result;void 0===e&&(e=null),r(e)};else{s=a.openCursor(d);var l={},h=0;s.onsuccess=function(){var e=s.result;if(e){for(var t=e.key;t>u[h];)if(++h===u.length)return void r(l);if(t===u[h]){var n=e.value;void 0===n&&(n=null),l[t]=n,e.continue()}else e.continue(u[h])}else r(l)}}s.onerror=function(){i(s.error)}})).catch(i)}))}function d(e){var t=this;return new Promise((function(r,i){t.ready().then((function(){return n(t)})).then((function(n){var s=t._dbInfo;s.db.transaction((function(t){for(var o=new Array(e.length),a=0,c=e.length;a<c;a++)o[a]="?";t.executeSql("SELECT * FROM "+s.storeName+" WHERE (key IN ("+o.join(",")+"))",e,(function(e,t){for(var i={},s=t.rows,o=0,a=s.length;o<a;o++){var c=s.item(o),u=c.value;u&&(u=n.deserialize(u)),i[c.key]=u}r(i)}),(function(e,t){i(t)}))}))})).catch(i)}))}function l(e,t){var n,i=this;if(arguments.length&&null!==e){var a=i.driver();n=a===i.INDEXEDDB?u.apply(i,arguments):a===i.WEBSQL?d.apply(i,arguments):s.apply(i,arguments)}else n=o.apply(i);return r(n,t),n}function h(e){var t=Object.getPrototypeOf(e);t&&(t.getItems=l,t.getItems.indexedDB=function(){return u.apply(this,arguments)},t.getItems.websql=function(){return d.apply(this,arguments)},t.getItems.generic=function(){return s.apply(this,arguments)})}var f=h(t);e.localforageGetItems=l,e.extendPrototype=h,e.extendPrototypeResult=f,e.getItemsGeneric=s,Object.defineProperty(e,"__esModule",{value:!0})}(t,n(513))},609:(e,t,n)=>{"use strict";const r=n(776),i=n(350);e.exports={atob:r,btoa:i}},776:e=>{"use strict";const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function n(e){const n=t.indexOf(e);return n<0?void 0:n}e.exports=function(e){if(0===arguments.length)throw new TypeError("1 argument required, but only 0 present.");if((e=(e=`${e}`).replace(/[ \t\n\f\r]/g,"")).length%4==0&&(e=e.replace(/==?$/,"")),e.length%4==1||/[^+/0-9A-Za-z]/.test(e))return null;let t="",r=0,i=0;for(let s=0;s<e.length;s++)r<<=6,r|=n(e[s]),i+=6,24===i&&(t+=String.fromCharCode((16711680&r)>>16),t+=String.fromCharCode((65280&r)>>8),t+=String.fromCharCode(255&r),r=i=0);return 12===i?(r>>=4,t+=String.fromCharCode(r)):18===i&&(r>>=2,t+=String.fromCharCode((65280&r)>>8),t+=String.fromCharCode(255&r)),t}},350:e=>{"use strict";const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function n(e){if(e>=0&&e<64)return t[e]}e.exports=function(e){if(0===arguments.length)throw new TypeError("1 argument required, but only 0 present.");let t;for(e=`${e}`,t=0;t<e.length;t++)if(e.charCodeAt(t)>255)return null;let r="";for(t=0;t<e.length;t+=3){const i=[void 0,void 0,void 0,void 0];i[0]=e.charCodeAt(t)>>2,i[1]=(3&e.charCodeAt(t))<<4,e.length>t+1&&(i[1]|=e.charCodeAt(t+1)>>4,i[2]=(15&e.charCodeAt(t+1))<<2),e.length>t+2&&(i[2]|=e.charCodeAt(t+2)>>6,i[3]=63&e.charCodeAt(t+2));for(let e=0;e<i.length;e++)void 0===i[e]?r+="=":r+=n(i[e])}return r}},76:function(e){e.exports=function(){"use strict";var e=1e3,t=6e4,n=36e5,r="millisecond",i="second",s="minute",o="hour",a="day",c="week",u="month",d="quarter",l="year",h="date",f="Invalid Date",g=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,p=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,m={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(e){var t=["th","st","nd","rd"],n=e%100;return"["+e+(t[(n-20)%10]||t[n]||t[0])+"]"}},v=function(e,t,n){var r=String(e);return!r||r.length>=t?e:""+Array(t+1-r.length).join(n)+e},_={s:v,z:function(e){var t=-e.utcOffset(),n=Math.abs(t),r=Math.floor(n/60),i=n%60;return(t<=0?"+":"-")+v(r,2,"0")+":"+v(i,2,"0")},m:function e(t,n){if(t.date()<n.date())return-e(n,t);var r=12*(n.year()-t.year())+(n.month()-t.month()),i=t.clone().add(r,u),s=n-i<0,o=t.clone().add(r+(s?-1:1),u);return+(-(r+(n-i)/(s?i-o:o-i))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(e){return{M:u,y:l,w:c,d:a,D:h,h:o,m:s,s:i,ms:r,Q:d}[e]||String(e||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},y="en",b={};b[y]=m;var w=function(e){return e instanceof x},S=function e(t,n,r){var i;if(!t)return y;if("string"==typeof t){var s=t.toLowerCase();b[s]&&(i=s),n&&(b[s]=n,i=s);var o=t.split("-");if(!i&&o.length>1)return e(o[0])}else{var a=t.name;b[a]=t,i=a}return!r&&i&&(y=i),i||!r&&y},A=function(e,t){if(w(e))return e.clone();var n="object"==typeof t?t:{};return n.date=e,n.args=arguments,new x(n)},E=_;E.l=S,E.i=w,E.w=function(e,t){return A(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var x=function(){function m(e){this.$L=S(e.locale,null,!0),this.parse(e)}var v=m.prototype;return v.parse=function(e){this.$d=function(e){var t=e.date,n=e.utc;if(null===t)return new Date(NaN);if(E.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var r=t.match(g);if(r){var i=r[2]-1||0,s=(r[7]||"0").substring(0,3);return n?new Date(Date.UTC(r[1],i,r[3]||1,r[4]||0,r[5]||0,r[6]||0,s)):new Date(r[1],i,r[3]||1,r[4]||0,r[5]||0,r[6]||0,s)}}return new Date(t)}(e),this.$x=e.x||{},this.init()},v.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},v.$utils=function(){return E},v.isValid=function(){return!(this.$d.toString()===f)},v.isSame=function(e,t){var n=A(e);return this.startOf(t)<=n&&n<=this.endOf(t)},v.isAfter=function(e,t){return A(e)<this.startOf(t)},v.isBefore=function(e,t){return this.endOf(t)<A(e)},v.$g=function(e,t,n){return E.u(e)?this[t]:this.set(n,e)},v.unix=function(){return Math.floor(this.valueOf()/1e3)},v.valueOf=function(){return this.$d.getTime()},v.startOf=function(e,t){var n=this,r=!!E.u(t)||t,d=E.p(e),f=function(e,t){var i=E.w(n.$u?Date.UTC(n.$y,t,e):new Date(n.$y,t,e),n);return r?i:i.endOf(a)},g=function(e,t){return E.w(n.toDate()[e].apply(n.toDate("s"),(r?[0,0,0,0]:[23,59,59,999]).slice(t)),n)},p=this.$W,m=this.$M,v=this.$D,_="set"+(this.$u?"UTC":"");switch(d){case l:return r?f(1,0):f(31,11);case u:return r?f(1,m):f(0,m+1);case c:var y=this.$locale().weekStart||0,b=(p<y?p+7:p)-y;return f(r?v-b:v+(6-b),m);case a:case h:return g(_+"Hours",0);case o:return g(_+"Minutes",1);case s:return g(_+"Seconds",2);case i:return g(_+"Milliseconds",3);default:return this.clone()}},v.endOf=function(e){return this.startOf(e,!1)},v.$set=function(e,t){var n,c=E.p(e),d="set"+(this.$u?"UTC":""),f=(n={},n[a]=d+"Date",n[h]=d+"Date",n[u]=d+"Month",n[l]=d+"FullYear",n[o]=d+"Hours",n[s]=d+"Minutes",n[i]=d+"Seconds",n[r]=d+"Milliseconds",n)[c],g=c===a?this.$D+(t-this.$W):t;if(c===u||c===l){var p=this.clone().set(h,1);p.$d[f](g),p.init(),this.$d=p.set(h,Math.min(this.$D,p.daysInMonth())).$d}else f&&this.$d[f](g);return this.init(),this},v.set=function(e,t){return this.clone().$set(e,t)},v.get=function(e){return this[E.p(e)]()},v.add=function(r,d){var h,f=this;r=Number(r);var g=E.p(d),p=function(e){var t=A(f);return E.w(t.date(t.date()+Math.round(e*r)),f)};if(g===u)return this.set(u,this.$M+r);if(g===l)return this.set(l,this.$y+r);if(g===a)return p(1);if(g===c)return p(7);var m=(h={},h[s]=t,h[o]=n,h[i]=e,h)[g]||1,v=this.$d.getTime()+r*m;return E.w(v,this)},v.subtract=function(e,t){return this.add(-1*e,t)},v.format=function(e){var t=this,n=this.$locale();if(!this.isValid())return n.invalidDate||f;var r=e||"YYYY-MM-DDTHH:mm:ssZ",i=E.z(this),s=this.$H,o=this.$m,a=this.$M,c=n.weekdays,u=n.months,d=function(e,n,i,s){return e&&(e[n]||e(t,r))||i[n].slice(0,s)},l=function(e){return E.s(s%12||12,e,"0")},h=n.meridiem||function(e,t,n){var r=e<12?"AM":"PM";return n?r.toLowerCase():r},g={YY:String(this.$y).slice(-2),YYYY:E.s(this.$y,4,"0"),M:a+1,MM:E.s(a+1,2,"0"),MMM:d(n.monthsShort,a,u,3),MMMM:d(u,a),D:this.$D,DD:E.s(this.$D,2,"0"),d:String(this.$W),dd:d(n.weekdaysMin,this.$W,c,2),ddd:d(n.weekdaysShort,this.$W,c,3),dddd:c[this.$W],H:String(s),HH:E.s(s,2,"0"),h:l(1),hh:l(2),a:h(s,o,!0),A:h(s,o,!1),m:String(o),mm:E.s(o,2,"0"),s:String(this.$s),ss:E.s(this.$s,2,"0"),SSS:E.s(this.$ms,3,"0"),Z:i};return r.replace(p,(function(e,t){return t||g[e]||i.replace(":","")}))},v.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},v.diff=function(r,h,f){var g,p=E.p(h),m=A(r),v=(m.utcOffset()-this.utcOffset())*t,_=this-m,y=E.m(this,m);return y=(g={},g[l]=y/12,g[u]=y,g[d]=y/3,g[c]=(_-v)/6048e5,g[a]=(_-v)/864e5,g[o]=_/n,g[s]=_/t,g[i]=_/e,g)[p]||_,f?y:E.a(y)},v.daysInMonth=function(){return this.endOf(u).$D},v.$locale=function(){return b[this.$L]},v.locale=function(e,t){if(!e)return this.$L;var n=this.clone(),r=S(e,t,!0);return r&&(n.$L=r),n},v.clone=function(){return E.w(this.$d,this)},v.toDate=function(){return new Date(this.valueOf())},v.toJSON=function(){return this.isValid()?this.toISOString():null},v.toISOString=function(){return this.$d.toISOString()},v.toString=function(){return this.$d.toUTCString()},m}(),N=x.prototype;return A.prototype=N,[["$ms",r],["$s",i],["$m",s],["$H",o],["$W",a],["$M",u],["$y",l],["$D",h]].forEach((function(e){N[e[1]]=function(t){return this.$g(t,e[0],e[1])}})),A.extend=function(e,t){return e.$i||(e(t,x,A),e.$i=!0),A},A.locale=S,A.isDayjs=w,A.unix=function(e){return A(1e3*e)},A.en=b[y],A.Ls=b,A.p={},A}()},455:function(e){e.exports=function(){"use strict";return function(e,t){var n=t.prototype,r=n.format;n.format=function(e){var t=this,n=this.$locale();if(!this.isValid())return r.bind(this)(e);var i=this.$utils(),s=(e||"YYYY-MM-DDTHH:mm:ssZ").replace(/\[([^\]]+)]|Q|wo|ww|w|WW|W|zzz|z|gggg|GGGG|Do|X|x|k{1,2}|S/g,(function(e){switch(e){case"Q":return Math.ceil((t.$M+1)/3);case"Do":return n.ordinal(t.$D);case"gggg":return t.weekYear();case"GGGG":return t.isoWeekYear();case"wo":return n.ordinal(t.week(),"W");case"w":case"ww":return i.s(t.week(),"w"===e?1:2,"0");case"W":case"WW":return i.s(t.isoWeek(),"W"===e?1:2,"0");case"k":case"kk":return i.s(String(0===t.$H?24:t.$H),"k"===e?1:2,"0");case"X":return Math.floor(t.$d.getTime()/1e3);case"x":return t.$d.getTime();case"z":return"["+t.offsetName()+"]";case"zzz":return"["+t.offsetName("long")+"]";default:return e}}));return r.bind(this)(s)}}}()},199:function(e){e.exports=function(){"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,n){return t=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},t(e,n)}function n(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function r(e,i,s){return r=n()?Reflect.construct:function(e,n,r){var i=[null];i.push.apply(i,n);var s=new(Function.bind.apply(e,i));return r&&t(s,r.prototype),s},r.apply(null,arguments)}function i(e){return s(e)||o(e)||a(e)||u()}function s(e){if(Array.isArray(e))return c(e)}function o(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function a(e,t){if(e){if("string"==typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(e,t):void 0}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function u(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var d=Object.hasOwnProperty,l=Object.setPrototypeOf,h=Object.isFrozen,f=Object.getPrototypeOf,g=Object.getOwnPropertyDescriptor,p=Object.freeze,m=Object.seal,v=Object.create,_="undefined"!=typeof Reflect&&Reflect,y=_.apply,b=_.construct;y||(y=function(e,t,n){return e.apply(t,n)}),p||(p=function(e){return e}),m||(m=function(e){return e}),b||(b=function(e,t){return r(e,i(t))});var w=k(Array.prototype.forEach),S=k(Array.prototype.pop),A=k(Array.prototype.push),E=k(String.prototype.toLowerCase),x=k(String.prototype.toString),N=k(String.prototype.match),I=k(String.prototype.replace),C=k(String.prototype.indexOf),T=k(String.prototype.trim),O=k(RegExp.prototype.test),j=R(TypeError);function k(e){return function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return y(e,t,r)}}function R(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return b(e,n)}}function M(e,t,n){n=n||E,l&&l(e,null);for(var r=t.length;r--;){var i=t[r];if("string"==typeof i){var s=n(i);s!==i&&(h(t)||(t[r]=s),i=s)}e[i]=!0}return e}function D(e){var t,n=v(null);for(t in e)!0===y(d,e,[t])&&(n[t]=e[t]);return n}function $(e,t){for(;null!==e;){var n=g(e,t);if(n){if(n.get)return k(n.get);if("function"==typeof n.value)return k(n.value)}e=f(e)}function r(e){return console.warn("fallback value for",e),null}return r}var F=p(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),P=p(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),L=p(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),z=p(["animate","color-profile","cursor","discard","fedropshadow","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),U=p(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover"]),B=p(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),H=p(["#text"]),q=p(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","xmlns","slot"]),J=p(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),W=p(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),G=p(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),Q=m(/\{\{[\w\W]*|[\w\W]*\}\}/gm),V=m(/<%[\w\W]*|[\w\W]*%>/gm),Y=m(/\${[\w\W]*}/gm),X=m(/^data-[\-\w.\u00B7-\uFFFF]/),K=m(/^aria-[\-\w]+$/),Z=m(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),ee=m(/^(?:\w+script|data):/i),te=m(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),ne=m(/^html$/i),re=function(){return"undefined"==typeof window?null:window},ie=function(t,n){if("object"!==e(t)||"function"!=typeof t.createPolicy)return null;var r=null,i="data-tt-policy-suffix";n.currentScript&&n.currentScript.hasAttribute(i)&&(r=n.currentScript.getAttribute(i));var s="dompurify"+(r?"#"+r:"");try{return t.createPolicy(s,{createHTML:function(e){return e},createScriptURL:function(e){return e}})}catch(e){return console.warn("TrustedTypes policy "+s+" could not be created."),null}};function se(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:re(),n=function(e){return se(e)};if(n.version="2.4.5",n.removed=[],!t||!t.document||9!==t.document.nodeType)return n.isSupported=!1,n;var r=t.document,s=t.document,o=t.DocumentFragment,a=t.HTMLTemplateElement,c=t.Node,u=t.Element,d=t.NodeFilter,l=t.NamedNodeMap,h=void 0===l?t.NamedNodeMap||t.MozNamedAttrMap:l,f=t.HTMLFormElement,g=t.DOMParser,m=t.trustedTypes,v=u.prototype,_=$(v,"cloneNode"),y=$(v,"nextSibling"),b=$(v,"childNodes"),k=$(v,"parentNode");if("function"==typeof a){var R=s.createElement("template");R.content&&R.content.ownerDocument&&(s=R.content.ownerDocument)}var oe=ie(m,r),ae=oe?oe.createHTML(""):"",ce=s,ue=ce.implementation,de=ce.createNodeIterator,le=ce.createDocumentFragment,he=ce.getElementsByTagName,fe=r.importNode,ge={};try{ge=D(s).documentMode?s.documentMode:{}}catch(e){}var pe={};n.isSupported="function"==typeof k&&ue&&void 0!==ue.createHTMLDocument&&9!==ge;var me,ve,_e=Q,ye=V,be=Y,we=X,Se=K,Ae=ee,Ee=te,xe=Z,Ne=null,Ie=M({},[].concat(i(F),i(P),i(L),i(U),i(H))),Ce=null,Te=M({},[].concat(i(q),i(J),i(W),i(G))),Oe=Object.seal(Object.create(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),je=null,ke=null,Re=!0,Me=!0,De=!1,$e=!0,Fe=!1,Pe=!1,Le=!1,ze=!1,Ue=!1,Be=!1,He=!1,qe=!0,Je=!1,We="user-content-",Ge=!0,Qe=!1,Ve={},Ye=null,Xe=M({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]),Ke=null,Ze=M({},["audio","video","img","source","image","track"]),et=null,tt=M({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),nt="http://www.w3.org/1998/Math/MathML",rt="http://www.w3.org/2000/svg",it="http://www.w3.org/1999/xhtml",st=it,ot=!1,at=null,ct=M({},[nt,rt,it],x),ut=["application/xhtml+xml","text/html"],dt="text/html",lt=null,ht=s.createElement("form"),ft=function(e){return e instanceof RegExp||e instanceof Function},gt=function(t){lt&&lt===t||(t&&"object"===e(t)||(t={}),t=D(t),me=me=-1===ut.indexOf(t.PARSER_MEDIA_TYPE)?dt:t.PARSER_MEDIA_TYPE,ve="application/xhtml+xml"===me?x:E,Ne="ALLOWED_TAGS"in t?M({},t.ALLOWED_TAGS,ve):Ie,Ce="ALLOWED_ATTR"in t?M({},t.ALLOWED_ATTR,ve):Te,at="ALLOWED_NAMESPACES"in t?M({},t.ALLOWED_NAMESPACES,x):ct,et="ADD_URI_SAFE_ATTR"in t?M(D(tt),t.ADD_URI_SAFE_ATTR,ve):tt,Ke="ADD_DATA_URI_TAGS"in t?M(D(Ze),t.ADD_DATA_URI_TAGS,ve):Ze,Ye="FORBID_CONTENTS"in t?M({},t.FORBID_CONTENTS,ve):Xe,je="FORBID_TAGS"in t?M({},t.FORBID_TAGS,ve):{},ke="FORBID_ATTR"in t?M({},t.FORBID_ATTR,ve):{},Ve="USE_PROFILES"in t&&t.USE_PROFILES,Re=!1!==t.ALLOW_ARIA_ATTR,Me=!1!==t.ALLOW_DATA_ATTR,De=t.ALLOW_UNKNOWN_PROTOCOLS||!1,$e=!1!==t.ALLOW_SELF_CLOSE_IN_ATTR,Fe=t.SAFE_FOR_TEMPLATES||!1,Pe=t.WHOLE_DOCUMENT||!1,Ue=t.RETURN_DOM||!1,Be=t.RETURN_DOM_FRAGMENT||!1,He=t.RETURN_TRUSTED_TYPE||!1,ze=t.FORCE_BODY||!1,qe=!1!==t.SANITIZE_DOM,Je=t.SANITIZE_NAMED_PROPS||!1,Ge=!1!==t.KEEP_CONTENT,Qe=t.IN_PLACE||!1,xe=t.ALLOWED_URI_REGEXP||xe,st=t.NAMESPACE||it,Oe=t.CUSTOM_ELEMENT_HANDLING||{},t.CUSTOM_ELEMENT_HANDLING&&ft(t.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(Oe.tagNameCheck=t.CUSTOM_ELEMENT_HANDLING.tagNameCheck),t.CUSTOM_ELEMENT_HANDLING&&ft(t.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(Oe.attributeNameCheck=t.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),t.CUSTOM_ELEMENT_HANDLING&&"boolean"==typeof t.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements&&(Oe.allowCustomizedBuiltInElements=t.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Fe&&(Me=!1),Be&&(Ue=!0),Ve&&(Ne=M({},i(H)),Ce=[],!0===Ve.html&&(M(Ne,F),M(Ce,q)),!0===Ve.svg&&(M(Ne,P),M(Ce,J),M(Ce,G)),!0===Ve.svgFilters&&(M(Ne,L),M(Ce,J),M(Ce,G)),!0===Ve.mathMl&&(M(Ne,U),M(Ce,W),M(Ce,G))),t.ADD_TAGS&&(Ne===Ie&&(Ne=D(Ne)),M(Ne,t.ADD_TAGS,ve)),t.ADD_ATTR&&(Ce===Te&&(Ce=D(Ce)),M(Ce,t.ADD_ATTR,ve)),t.ADD_URI_SAFE_ATTR&&M(et,t.ADD_URI_SAFE_ATTR,ve),t.FORBID_CONTENTS&&(Ye===Xe&&(Ye=D(Ye)),M(Ye,t.FORBID_CONTENTS,ve)),Ge&&(Ne["#text"]=!0),Pe&&M(Ne,["html","head","body"]),Ne.table&&(M(Ne,["tbody"]),delete je.tbody),p&&p(t),lt=t)},pt=M({},["mi","mo","mn","ms","mtext"]),mt=M({},["foreignobject","desc","title","annotation-xml"]),vt=M({},["title","style","font","a","script"]),_t=M({},P);M(_t,L),M(_t,z);var yt=M({},U);M(yt,B);var bt=function(e){var t=k(e);t&&t.tagName||(t={namespaceURI:st,tagName:"template"});var n=E(e.tagName),r=E(t.tagName);return!!at[e.namespaceURI]&&(e.namespaceURI===rt?t.namespaceURI===it?"svg"===n:t.namespaceURI===nt?"svg"===n&&("annotation-xml"===r||pt[r]):Boolean(_t[n]):e.namespaceURI===nt?t.namespaceURI===it?"math"===n:t.namespaceURI===rt?"math"===n&&mt[r]:Boolean(yt[n]):e.namespaceURI===it?!(t.namespaceURI===rt&&!mt[r])&&!(t.namespaceURI===nt&&!pt[r])&&!yt[n]&&(vt[n]||!_t[n]):!("application/xhtml+xml"!==me||!at[e.namespaceURI]))},wt=function(e){A(n.removed,{element:e});try{e.parentNode.removeChild(e)}catch(t){try{e.outerHTML=ae}catch(t){e.remove()}}},St=function(e,t){try{A(n.removed,{attribute:t.getAttributeNode(e),from:t})}catch(e){A(n.removed,{attribute:null,from:t})}if(t.removeAttribute(e),"is"===e&&!Ce[e])if(Ue||Be)try{wt(t)}catch(e){}else try{t.setAttribute(e,"")}catch(e){}},At=function(e){var t,n;if(ze)e="<remove></remove>"+e;else{var r=N(e,/^[\r\n\t ]+/);n=r&&r[0]}"application/xhtml+xml"===me&&st===it&&(e='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+e+"</body></html>");var i=oe?oe.createHTML(e):e;if(st===it)try{t=(new g).parseFromString(i,me)}catch(e){}if(!t||!t.documentElement){t=ue.createDocument(st,"template",null);try{t.documentElement.innerHTML=ot?ae:i}catch(e){}}var o=t.body||t.documentElement;return e&&n&&o.insertBefore(s.createTextNode(n),o.childNodes[0]||null),st===it?he.call(t,Pe?"html":"body")[0]:Pe?t.documentElement:o},Et=function(e){return de.call(e.ownerDocument||e,e,d.SHOW_ELEMENT|d.SHOW_COMMENT|d.SHOW_TEXT,null,!1)},xt=function(e){return e instanceof f&&("string"!=typeof e.nodeName||"string"!=typeof e.textContent||"function"!=typeof e.removeChild||!(e.attributes instanceof h)||"function"!=typeof e.removeAttribute||"function"!=typeof e.setAttribute||"string"!=typeof e.namespaceURI||"function"!=typeof e.insertBefore||"function"!=typeof e.hasChildNodes)},Nt=function(t){return"object"===e(c)?t instanceof c:t&&"object"===e(t)&&"number"==typeof t.nodeType&&"string"==typeof t.nodeName},It=function(e,t,r){pe[e]&&w(pe[e],(function(e){e.call(n,t,r,lt)}))},Ct=function(e){var t;if(It("beforeSanitizeElements",e,null),xt(e))return wt(e),!0;if(O(/[\u0080-\uFFFF]/,e.nodeName))return wt(e),!0;var r=ve(e.nodeName);if(It("uponSanitizeElement",e,{tagName:r,allowedTags:Ne}),e.hasChildNodes()&&!Nt(e.firstElementChild)&&(!Nt(e.content)||!Nt(e.content.firstElementChild))&&O(/<[/\w]/g,e.innerHTML)&&O(/<[/\w]/g,e.textContent))return wt(e),!0;if("select"===r&&O(/<template/i,e.innerHTML))return wt(e),!0;if(!Ne[r]||je[r]){if(!je[r]&&Ot(r)){if(Oe.tagNameCheck instanceof RegExp&&O(Oe.tagNameCheck,r))return!1;if(Oe.tagNameCheck instanceof Function&&Oe.tagNameCheck(r))return!1}if(Ge&&!Ye[r]){var i=k(e)||e.parentNode,s=b(e)||e.childNodes;if(s&&i)for(var o=s.length-1;o>=0;--o)i.insertBefore(_(s[o],!0),y(e))}return wt(e),!0}return e instanceof u&&!bt(e)?(wt(e),!0):"noscript"!==r&&"noembed"!==r||!O(/<\/no(script|embed)/i,e.innerHTML)?(Fe&&3===e.nodeType&&(t=e.textContent,t=I(t,_e," "),t=I(t,ye," "),t=I(t,be," "),e.textContent!==t&&(A(n.removed,{element:e.cloneNode()}),e.textContent=t)),It("afterSanitizeElements",e,null),!1):(wt(e),!0)},Tt=function(e,t,n){if(qe&&("id"===t||"name"===t)&&(n in s||n in ht))return!1;if(Me&&!ke[t]&&O(we,t));else if(Re&&O(Se,t));else if(!Ce[t]||ke[t]){if(!(Ot(e)&&(Oe.tagNameCheck instanceof RegExp&&O(Oe.tagNameCheck,e)||Oe.tagNameCheck instanceof Function&&Oe.tagNameCheck(e))&&(Oe.attributeNameCheck instanceof RegExp&&O(Oe.attributeNameCheck,t)||Oe.attributeNameCheck instanceof Function&&Oe.attributeNameCheck(t))||"is"===t&&Oe.allowCustomizedBuiltInElements&&(Oe.tagNameCheck instanceof RegExp&&O(Oe.tagNameCheck,n)||Oe.tagNameCheck instanceof Function&&Oe.tagNameCheck(n))))return!1}else if(et[t]);else if(O(xe,I(n,Ee,"")));else if("src"!==t&&"xlink:href"!==t&&"href"!==t||"script"===e||0!==C(n,"data:")||!Ke[e])if(De&&!O(Ae,I(n,Ee,"")));else if(n)return!1;return!0},Ot=function(e){return e.indexOf("-")>0},jt=function(t){var r,i,s,o;It("beforeSanitizeAttributes",t,null);var a=t.attributes;if(a){var c={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:Ce};for(o=a.length;o--;){var u=r=a[o],d=u.name,l=u.namespaceURI;if(i="value"===d?r.value:T(r.value),s=ve(d),c.attrName=s,c.attrValue=i,c.keepAttr=!0,c.forceKeepAttr=void 0,It("uponSanitizeAttribute",t,c),i=c.attrValue,!c.forceKeepAttr&&(St(d,t),c.keepAttr))if($e||!O(/\/>/i,i)){Fe&&(i=I(i,_e," "),i=I(i,ye," "),i=I(i,be," "));var h=ve(t.nodeName);if(Tt(h,s,i)){if(!Je||"id"!==s&&"name"!==s||(St(d,t),i=We+i),oe&&"object"===e(m)&&"function"==typeof m.getAttributeType)if(l);else switch(m.getAttributeType(h,s)){case"TrustedHTML":i=oe.createHTML(i);break;case"TrustedScriptURL":i=oe.createScriptURL(i)}try{l?t.setAttributeNS(l,d,i):t.setAttribute(d,i),S(n.removed)}catch(e){}}}else St(d,t)}It("afterSanitizeAttributes",t,null)}},kt=function e(t){var n,r=Et(t);for(It("beforeSanitizeShadowDOM",t,null);n=r.nextNode();)It("uponSanitizeShadowNode",n,null),Ct(n)||(n.content instanceof o&&e(n.content),jt(n));It("afterSanitizeShadowDOM",t,null)};return n.sanitize=function(i){var s,a,u,d,l,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if((ot=!i)&&(i="\x3c!--\x3e"),"string"!=typeof i&&!Nt(i)){if("function"!=typeof i.toString)throw j("toString is not a function");if("string"!=typeof(i=i.toString()))throw j("dirty is not a string, aborting")}if(!n.isSupported){if("object"===e(t.toStaticHTML)||"function"==typeof t.toStaticHTML){if("string"==typeof i)return t.toStaticHTML(i);if(Nt(i))return t.toStaticHTML(i.outerHTML)}return i}if(Le||gt(h),n.removed=[],"string"==typeof i&&(Qe=!1),Qe){if(i.nodeName){var f=ve(i.nodeName);if(!Ne[f]||je[f])throw j("root node is forbidden and cannot be sanitized in-place")}}else if(i instanceof c)1===(a=(s=At("\x3c!----\x3e")).ownerDocument.importNode(i,!0)).nodeType&&"BODY"===a.nodeName||"HTML"===a.nodeName?s=a:s.appendChild(a);else{if(!Ue&&!Fe&&!Pe&&-1===i.indexOf("<"))return oe&&He?oe.createHTML(i):i;if(!(s=At(i)))return Ue?null:He?ae:""}s&&ze&&wt(s.firstChild);for(var g=Et(Qe?i:s);u=g.nextNode();)3===u.nodeType&&u===d||Ct(u)||(u.content instanceof o&&kt(u.content),jt(u),d=u);if(d=null,Qe)return i;if(Ue){if(Be)for(l=le.call(s.ownerDocument);s.firstChild;)l.appendChild(s.firstChild);else l=s;return(Ce.shadowroot||Ce.shadowrootmod)&&(l=fe.call(r,l,!0)),l}var p=Pe?s.outerHTML:s.innerHTML;return Pe&&Ne["!doctype"]&&s.ownerDocument&&s.ownerDocument.doctype&&s.ownerDocument.doctype.name&&O(ne,s.ownerDocument.doctype.name)&&(p="<!DOCTYPE "+s.ownerDocument.doctype.name+">\n"+p),Fe&&(p=I(p,_e," "),p=I(p,ye," "),p=I(p,be," ")),oe&&He?oe.createHTML(p):p},n.setConfig=function(e){gt(e),Le=!0},n.clearConfig=function(){lt=null,Le=!1},n.isValidAttribute=function(e,t,n){lt||gt({});var r=ve(e),i=ve(t);return Tt(r,i,n)},n.addHook=function(e,t){"function"==typeof t&&(pe[e]=pe[e]||[],A(pe[e],t))},n.removeHook=function(e){if(pe[e])return S(pe[e])},n.removeHooks=function(e){pe[e]&&(pe[e]=[])},n.removeAllHooks=function(){pe={}},n}return se()}()},579:(e,t,n)=>{"use strict";var r,i,s=n.g.MutationObserver||n.g.WebKitMutationObserver;if(s){var o=0,a=new s(l),c=n.g.document.createTextNode("");a.observe(c,{characterData:!0}),r=function(){c.data=o=++o%2}}else if(n.g.setImmediate||void 0===n.g.MessageChannel)r="document"in n.g&&"onreadystatechange"in n.g.document.createElement("script")?function(){var e=n.g.document.createElement("script");e.onreadystatechange=function(){l(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},n.g.document.documentElement.appendChild(e)}:function(){setTimeout(l,0)};else{var u=new n.g.MessageChannel;u.port1.onmessage=l,r=function(){u.port2.postMessage(0)}}var d=[];function l(){var e,t;i=!0;for(var n=d.length;n;){for(t=d,d=[],e=-1;++e<n;)t[e]();n=d.length}i=!1}e.exports=function(e){1!==d.push(e)||i||r()}},842:(e,t,n)=>{"use strict";var r=n(579);function i(){}var s={},o=["REJECTED"],a=["FULFILLED"],c=["PENDING"];function u(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,e!==i&&f(this,e)}function d(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function l(e,t,n){r((function(){var r;try{r=t(n)}catch(t){return s.reject(e,t)}r===e?s.reject(e,new TypeError("Cannot resolve promise with itself")):s.resolve(e,r)}))}function h(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function f(e,t){var n=!1;function r(t){n||(n=!0,s.reject(e,t))}function i(t){n||(n=!0,s.resolve(e,t))}var o=g((function(){t(i,r)}));"error"===o.status&&r(o.value)}function g(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}e.exports=u,u.prototype.catch=function(e){return this.then(null,e)},u.prototype.then=function(e,t){if("function"!=typeof e&&this.state===a||"function"!=typeof t&&this.state===o)return this;var n=new this.constructor(i);this.state!==c?l(n,this.state===a?e:t,this.outcome):this.queue.push(new d(n,e,t));return n},d.prototype.callFulfilled=function(e){s.resolve(this.promise,e)},d.prototype.otherCallFulfilled=function(e){l(this.promise,this.onFulfilled,e)},d.prototype.callRejected=function(e){s.reject(this.promise,e)},d.prototype.otherCallRejected=function(e){l(this.promise,this.onRejected,e)},s.resolve=function(e,t){var n=g(h,t);if("error"===n.status)return s.reject(e,n.value);var r=n.value;if(r)f(e,r);else{e.state=a,e.outcome=t;for(var i=-1,o=e.queue.length;++i<o;)e.queue[i].callFulfilled(t)}return e},s.reject=function(e,t){e.state=o,e.outcome=t;for(var n=-1,r=e.queue.length;++n<r;)e.queue[n].callRejected(t);return e},u.resolve=function(e){if(e instanceof this)return e;return s.resolve(new this(i),e)},u.reject=function(e){var t=new this(i);return s.reject(t,e)},u.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);var o=new Array(n),a=0,c=-1,u=new this(i);for(;++c<n;)d(e[c],c);return u;function d(e,i){t.resolve(e).then((function(e){o[i]=e,++a!==n||r||(r=!0,s.resolve(u,o))}),(function(e){r||(r=!0,s.reject(u,e))}))}},u.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);var o=-1,a=new this(i);for(;++o<n;)c=e[o],t.resolve(c).then((function(e){r||(r=!0,s.resolve(a,e))}),(function(e){r||(r=!0,s.reject(a,e))}));var c;return a}},449:(e,t,n)=>{"use strict";"function"!=typeof n.g.Promise&&(n.g.Promise=n(842))},747:function(e,t){"undefined"!=typeof self&&self,function(e){"use strict";var t="localforage-driver-memory";function n(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}function r(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<e.length;r+=1)n.append(e[r]);return n.getBlob(t.type)}}var i=/^~~local_forage_type~([^~]+)~/,s=9,o=s+4,a=Object.prototype.toString;function c(e){var t=.75*e.length,n=e.length;"="===e[e.length-1]&&(t--,"="===e[e.length-2]&&t--);for(var r=new ArrayBuffer(t),i=new Uint8Array(r),s=0,o=0;s<n;s+=4){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e[s]),c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e[s+1]),u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e[s+2]),d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e[s+3]);i[o++]=a<<2|c>>4,i[o++]=(15&c)<<4|u>>2,i[o++]=(3&u)<<6|63&d}return r}function u(e){for(var t=new Uint8Array(e),n="",r=0;r<t.length;r+=3)n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[t[r]>>2],n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(3&t[r])<<4|t[r+1]>>4],n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(15&t[r+1])<<2|t[r+2]>>6],n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[63&t[r+2]];return t.length%3==2?n=n.substring(0,n.length-1)+"=":t.length%3==1&&(n=n.substring(0,n.length-2)+"=="),n}function d(e,t){var n="";if(e&&(n=a.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===a.call(e.buffer))){var r=void 0,i="__lfsc__:";e instanceof ArrayBuffer?(r=e,i+="arbf"):(r=e.buffer,"[object Int8Array]"===n?i+="si08":"[object Uint8Array]"===n?i+="ui08":"[object Uint8ClampedArray]"===n?i+="uic8":"[object Int16Array]"===n?i+="si16":"[object Uint16Array]"===n?i+="ur16":"[object Int32Array]"===n?i+="si32":"[object Uint32Array]"===n?i+="ui32":"[object Float32Array]"===n?i+="fl32":"[object Float64Array]"===n?i+="fl64":t(new Error("Failed to get type for BinaryArray"))),t(i+u(r))}else if("[object Blob]"===n){var s=new FileReader;s.onload=function(){var n="~~local_forage_type~"+e.type+"~"+u(this.result);t("__lfsc__:blob"+n)},s.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(n){console.error("Couldn't convert value into a JSON string: ",e),t(null,n)}}function l(e){if("__lfsc__:"!==e.substring(0,s))return JSON.parse(e);var t,n=e.substring(o),a=e.substring(s,o);if("blob"===a&&i.test(n)){var u=n.match(i);t=u[1],n=n.substring(u[0].length)}var d=c(n);switch(a){case"arbf":return d;case"blob":return r([d],{type:t});case"si08":return new Int8Array(d);case"ui08":return new Uint8Array(d);case"uic8":return new Uint8ClampedArray(d);case"si16":return new Int16Array(d);case"ur16":return new Uint16Array(d);case"si32":return new Int32Array(d);case"ui32":return new Uint32Array(d);case"fl32":return new Float32Array(d);case"fl64":return new Float64Array(d);default:throw new Error("Unkown type: "+a)}}function h(e){var t,r;if(null===e||"object"!=typeof e||"isActiveClone"in e)return e;var i=e instanceof Date?new Date(e):e.constructor();try{for(var s=n(Object.keys(e)),o=s.next();!o.done;o=s.next()){var a=o.value;Object.prototype.hasOwnProperty.call(e,a)&&(e.isActiveClone=null,i[a]=h(e[a]),delete e.isActiveClone)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}return i}function f(e,t){return(e.name||t.name)+"/"+(e.storeName||t.storeName)+"/"}function g(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function p(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}function m(e,t){var n=this;if(t=p.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var r=this.config();e.name=e.name||r.name,e.storeName=e.storeName||r.storeName}return{promise:e.name?new Promise((function(t){e.storeName?t(f(e,n._defaultConfig)):t(e.name+"/")})):Promise.reject("Invalid arguments"),callback:t}}function v(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}var _={bufferToString:u,deserialize:l,serialize:d,stringToBuffer:c},y={},b=function(){function e(e){this.kp=e,this.data={}}return e.resolve=function(t){return y[t]||(y[t]=new e(t)),y[t]},e.prototype.clear=function(){this.data={}},e.prototype.drop=function(){this.clear(),delete y[this.kp]},e.prototype.get=function(e){return this.data[e]},e.prototype.key=function(e){return this.keys()[e]},e.prototype.keys=function(){return Object.keys(this.data)},e.prototype.rm=function(e){delete this.data[e]},e.prototype.set=function(e,t){this.data[e]=t},e}();function w(e){var t=e?h(e):{},n=f(t,this._defaultConfig),r=b.resolve(n);return this._dbInfo=t,this._dbInfo.serializer=_,this._dbInfo.keyPrefix=n,this._dbInfo.mStore=r,Promise.resolve()}function S(e){var t=this,n=this.ready().then((function(){t._dbInfo.mStore.clear()}));return g(n,e),n}function A(e,t){var n=m.apply(this,arguments),r=n.promise,i=n.callback;return g(r.then((function(e){b.resolve(e).drop()})),i),r}function E(e,t){var n=this;e=v(e);var r=this.ready().then((function(){var t=n._dbInfo.mStore.get(e);return null==t?null:n._dbInfo.serializer.deserialize(t)}));return g(r,t),r}function x(e,t){var n=this,r=this.ready().then((function(){for(var t=n._dbInfo.mStore,r=t.keys(),i=0;i<r.length;i++){var s=t.get(r[i]);if(s&&(s=n._dbInfo.serializer.deserialize(s)),void 0!==(s=e(s,r[i],i+1)))return s}}));return g(r,t),r}function N(e,t){var n=this,r=this.ready().then((function(){var t;try{void 0===(t=n._dbInfo.mStore.key(e))&&(t=null)}catch(e){t=null}return t}));return g(r,t),r}function I(e){var t=this,n=this.ready().then((function(){return t._dbInfo.mStore.keys()}));return g(n,e),n}function C(e){var t=this.keys().then((function(e){return e.length}));return g(t,e),t}function T(e,t){var n=this;e=v(e);var r=this.ready().then((function(){n._dbInfo.mStore.rm(e)}));return g(r,t),r}function O(e,t,n){var r=this;e=v(e);var i=this.ready().then((function(){void 0===t&&(t=null);var n=t;return new Promise((function(i,s){r._dbInfo.serializer.serialize(t,(function(t,o){if(o)s(o);else try{r._dbInfo.mStore.set(e,t),i(n)}catch(e){s(e)}}))}))}));return g(i,n),i}var j=!0;e._support=j,e._driver=t,e._initStorage=w,e.clear=S,e.dropInstance=A,e.getItem=E,e.iterate=x,e.key=N,e.keys=I,e.length=C,e.removeItem=T,e.setItem=O,Object.defineProperty(e,"__esModule",{value:!0})}(t)},883:function(e,t,n){!function(e,t){"use strict";function n(e){return n.result?n.result:e&&"function"==typeof e.getSerializer?(n.result=e.getSerializer(),n.result):Promise.reject(new Error("localforage.getSerializer() was not available! localforage v1.4+ is required!"))}function r(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function i(e,t,n,r){function i(e,t){var n=e||t;return e&&"function"==typeof e||"string"!=typeof n||(e=function(e){return e[n]}),e}var s=[];if("[object Array]"===Object.prototype.toString.call(e)){t=i(t,"key"),n=i(n,"value");for(var o=0,a=e.length;o<a;o++){var c=e[o];s.push(r(t(c),n(c)))}}else for(var u in e)e.hasOwnProperty(u)&&s.push(r(u,e[u]));return s}function s(e,t,n,s){var o=this,a=o.ready().then((function(){return new Promise((function(r,s){var a,c=o._dbInfo,u=c.db.transaction(c.storeName,"readwrite"),d=u.objectStore(c.storeName);function l(e){var t=e.target||this;a=t.error||t.transaction.error,s(a)}u.oncomplete=function(){r(e)},u.onabort=u.onerror=function(e){s(a||e.target)},i(e,t,n,(function(e,t){null===t&&(t=void 0),d.put(t,e).onerror=l}))}))}));return r(a,s),a}function o(e,t,s,o){var a=this,c=new Promise((function(r,o){a.ready().then((function(){return n(a)})).then((function(n){var c=a._dbInfo;c.db.transaction((function(a){var u="INSERT OR REPLACE INTO "+c.storeName+" (key, value) VALUES (?, ?)",d=i(e,t,s,(function(e,t){return new Promise((function(r,i){n.serialize(t,(function(t,n){n?i(n):a.executeSql(u,[e,t],(function(){r()}),(function(e,t){i(t)}))}))}))}));Promise.all(d).then((function(){r(e)}),o)}),(function(e){o(e)}))})).catch(o)}));return r(c,o),c}function a(e,t,n,s){var o=this,a=i(e,t,n,(function(e,t){return o.setItem(e,t)})),c=Promise.all(a);return r(c,s),c}function c(e,t,n,r){var i=this,c=i.driver();return c===i.INDEXEDDB?s.call(i,e,t,n,r):c===i.WEBSQL?o.call(i,e,t,n,r):a.call(i,e,t,n,r)}function u(e){var t=Object.getPrototypeOf(e);t&&(t.setItems=c,t.setItems.indexedDB=function(){return s.apply(this,arguments)},t.setItems.websql=function(){return o.apply(this,arguments)},t.setItems.generic=function(){return a.apply(this,arguments)})}var d=u(t="default"in t?t.default:t);e.setItemsGeneric=a,e.localforageSetItems=c,e.extendPrototype=u,e.extendPrototypeResult=d,Object.defineProperty(e,"__esModule",{value:!0})}(t,n(513))},734:(e,t,n)=>{"use strict";var r=n(135);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=(0,a.getStorage)(),r=!(!n||!n[t]),c=r?n[t]:{clear:function(){},get:function(){},remove:function(){},set:function(){}},u=c.clear.bind(c),d=c.get.bind(c),l=c.remove.bind(c),h=c.set.bind(c);return{_driver:e,_support:r,_initStorage:function(){return Promise.resolve()},clear:function(e){return(0,o.default)(i.default.mark((function t(){return i.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:u(),e&&e();case 2:case"end":return t.stop()}}),t)})))()},iterate:function(e,t){return(0,o.default)(i.default.mark((function n(){var r;return i.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,a.usePromise)(d,null);case 2:r=n.sent,Object.keys(r).forEach((function(t,n){return e(r[t],t,n)})),t&&t();case 6:case"end":return n.stop()}}),n)})))()},getItem:function(e,t){return(0,o.default)(i.default.mark((function n(){var r;return i.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,(0,a.usePromise)(d,e);case 3:return r=n.sent,r=void 0===(r="string"==typeof e?r[e]:r)?null:r,t&&t(null,r),n.abrupt("return",r);case 10:throw n.prev=10,n.t0=n.catch(0),t&&t(n.t0),n.t0;case 14:case"end":return n.stop()}}),n,null,[[0,10]])})))()},key:function(e,t){return(0,o.default)(i.default.mark((function n(){var r,s;return i.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,a.usePromise)(d,null);case 2:return r=n.sent,s=Object.keys(r)[e],t&&t(s),n.abrupt("return",s);case 6:case"end":return n.stop()}}),n)})))()},keys:function(e){return(0,o.default)(i.default.mark((function t(){var n,r;return i.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,a.usePromise)(d,null);case 2:return n=t.sent,r=Object.keys(n),e&&e(r),t.abrupt("return",r);case 6:case"end":return t.stop()}}),t)})))()},length:function(e){return(0,o.default)(i.default.mark((function t(){var n,r,s;return i.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,a.usePromise)(d,null);case 2:return n=t.sent,r=Object.keys(n),s=r.length,e&&e(s),t.abrupt("return",s);case 6:case"end":return t.stop()}}),t)})))()},removeItem:function(e,t){return(0,o.default)(i.default.mark((function n(){return i.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,a.usePromise)(l,e);case 2:t&&t();case 3:case"end":return n.stop()}}),n)})))()},setItem:function(e,t,n){return(0,o.default)(i.default.mark((function r(){return i.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,(0,a.usePromise)(h,(0,s.default)({},e,t));case 2:n&&n();case 3:case"end":return r.stop()}}),r)})))()}}};var i=r(n(117)),s=r(n(514)),o=r(n(563)),a=n(413)},914:(e,t,n)=>{"use strict";var r=n(135);t.Z=void 0;var i=(0,r(n(734)).default)("webExtensionLocalStorage","local");t.Z=i},848:(e,t,n)=>{"use strict";var r=n(135);t.Z=void 0;var i=(0,r(n(734)).default)("webExtensionSyncStorage","sync");t.Z=i},413:(e,t)=>{"use strict";function n(){return"undefined"!=typeof browser&&browser.storage||"undefined"!=typeof chrome&&chrome.storage}Object.defineProperty(t,"__esModule",{value:!0}),t.getStorage=n,t.usePromise=function(e,t){if(function(){var e=n();try{return e&&e.local.get&&e.local.get()&&"function"==typeof e.local.get().then}catch(e){return!1}}())return e(t);return new Promise((function(n){e(t,(function(){n.apply(void 0,arguments)}))}))}},513:(e,t,n)=>{e.exports=function e(t,n,r){function i(o,a){if(!n[o]){if(!t[o]){if(s)return s(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var u=n[o]={exports:{}};t[o][0].call(u.exports,(function(e){var n=t[o][1][e];return i(n||e)}),u,u.exports,e,t,n,r)}return n[o].exports}for(var s=void 0,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(e,t,r){(function(e){"use strict";var n,r,i=e.MutationObserver||e.WebKitMutationObserver;if(i){var s=0,o=new i(d),a=e.document.createTextNode("");o.observe(a,{characterData:!0}),n=function(){a.data=s=++s%2}}else if(e.setImmediate||void 0===e.MessageChannel)n="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){d(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(d,0)};else{var c=new e.MessageChannel;c.port1.onmessage=d,n=function(){c.port2.postMessage(0)}}var u=[];function d(){var e,t;r=!0;for(var n=u.length;n;){for(t=u,u=[],e=-1;++e<n;)t[e]();n=u.length}r=!1}function l(e){1!==u.push(e)||r||n()}t.exports=l}).call(this,void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,n){"use strict";var r=e(1);function i(){}var s={},o=["REJECTED"],a=["FULFILLED"],c=["PENDING"];function u(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,e!==i&&f(this,e)}function d(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function l(e,t,n){r((function(){var r;try{r=t(n)}catch(t){return s.reject(e,t)}r===e?s.reject(e,new TypeError("Cannot resolve promise with itself")):s.resolve(e,r)}))}function h(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function f(e,t){var n=!1;function r(t){n||(n=!0,s.reject(e,t))}function i(t){n||(n=!0,s.resolve(e,t))}function o(){t(i,r)}var a=g(o);"error"===a.status&&r(a.value)}function g(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}function p(e){return e instanceof this?e:s.resolve(new this(i),e)}function m(e){var t=new this(i);return s.reject(t,e)}function v(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var o=new Array(n),a=0,c=-1,u=new this(i);++c<n;)d(e[c],c);return u;function d(e,i){function c(e){o[i]=e,++a!==n||r||(r=!0,s.resolve(u,o))}t.resolve(e).then(c,(function(e){r||(r=!0,s.reject(u,e))}))}}function _(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var o=-1,a=new this(i);++o<n;)c(e[o]);return a;function c(e){t.resolve(e).then((function(e){r||(r=!0,s.resolve(a,e))}),(function(e){r||(r=!0,s.reject(a,e))}))}}t.exports=u,u.prototype.catch=function(e){return this.then(null,e)},u.prototype.then=function(e,t){if("function"!=typeof e&&this.state===a||"function"!=typeof t&&this.state===o)return this;var n=new this.constructor(i);return this.state!==c?l(n,this.state===a?e:t,this.outcome):this.queue.push(new d(n,e,t)),n},d.prototype.callFulfilled=function(e){s.resolve(this.promise,e)},d.prototype.otherCallFulfilled=function(e){l(this.promise,this.onFulfilled,e)},d.prototype.callRejected=function(e){s.reject(this.promise,e)},d.prototype.otherCallRejected=function(e){l(this.promise,this.onRejected,e)},s.resolve=function(e,t){var n=g(h,t);if("error"===n.status)return s.reject(e,n.value);var r=n.value;if(r)f(e,r);else{e.state=a,e.outcome=t;for(var i=-1,o=e.queue.length;++i<o;)e.queue[i].callFulfilled(t)}return e},s.reject=function(e,t){e.state=o,e.outcome=t;for(var n=-1,r=e.queue.length;++n<r;)e.queue[n].callRejected(t);return e},u.resolve=p,u.reject=m,u.all=v,u.race=_},{1:1}],3:[function(e,t,r){(function(t){"use strict";"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}var o=s();function a(){try{if(!o||!o.open)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}function c(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<e.length;r+=1)n.append(e[r]);return n.getBlob(t.type)}}"undefined"==typeof Promise&&e(3);var u=Promise;function d(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function l(e,t,n){"function"==typeof t&&e.then(t),"function"==typeof n&&e.catch(n)}function h(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function f(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var g="local-forage-detect-blob-support",p=void 0,m={},v=Object.prototype.toString,_="readonly",y="readwrite";function b(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),i=0;i<t;i++)r[i]=e.charCodeAt(i);return n}function w(e){return new u((function(t){var n=e.transaction(g,y),r=c([""]);n.objectStore(g).put(r,"key"),n.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},n.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);t(n||!e||parseInt(e[1],10)>=43)}})).catch((function(){return!1}))}function S(e){return"boolean"==typeof p?u.resolve(p):w(e).then((function(e){return p=e}))}function A(e){var t=m[e.name],n={};n.promise=new u((function(e,t){n.resolve=e,n.reject=t})),t.deferredOperations.push(n),t.dbReady?t.dbReady=t.dbReady.then((function(){return n.promise})):t.dbReady=n.promise}function E(e){var t=m[e.name].deferredOperations.pop();if(t)return t.resolve(),t.promise}function x(e,t){var n=m[e.name].deferredOperations.pop();if(n)return n.reject(t),n.promise}function N(e,t){return new u((function(n,r){if(m[e.name]=m[e.name]||$(),e.db){if(!t)return n(e.db);A(e),e.db.close()}var i=[e.name];t&&i.push(e.version);var s=o.open.apply(o,i);t&&(s.onupgradeneeded=function(t){var n=s.result;try{n.createObjectStore(e.storeName),t.oldVersion<=1&&n.createObjectStore(g)}catch(n){if("ConstraintError"!==n.name)throw n;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),s.onerror=function(e){e.preventDefault(),r(s.error)},s.onsuccess=function(){var t=s.result;t.onversionchange=function(e){e.target.close()},n(t),E(e)}}))}function I(e){return N(e,!1)}function C(e){return N(e,!0)}function T(e,t){if(!e.db)return!0;var n=!e.db.objectStoreNames.contains(e.storeName),r=e.version<e.db.version,i=e.version>e.db.version;if(r&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),i||n){if(n){var s=e.db.version+1;s>e.version&&(e.version=s)}return!0}return!1}function O(e){return new u((function(t,n){var r=new FileReader;r.onerror=n,r.onloadend=function(n){var r=btoa(n.target.result||"");t({__local_forage_encoded_blob:!0,data:r,type:e.type})},r.readAsBinaryString(e)}))}function j(e){return c([b(atob(e.data))],{type:e.type})}function k(e){return e&&e.__local_forage_encoded_blob}function R(e){var t=this,n=t._initReady().then((function(){var e=m[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady}));return l(n,e,e),n}function M(e){A(e);for(var t=m[e.name],n=t.forages,r=0;r<n.length;r++){var i=n[r];i._dbInfo.db&&(i._dbInfo.db.close(),i._dbInfo.db=null)}return e.db=null,I(e).then((function(t){return e.db=t,T(e)?C(e):t})).then((function(r){e.db=t.db=r;for(var i=0;i<n.length;i++)n[i]._dbInfo.db=r})).catch((function(t){throw x(e,t),t}))}function D(e,t,n,r){void 0===r&&(r=1);try{var i=e.db.transaction(e.storeName,t);n(null,i)}catch(i){if(r>0&&(!e.db||"InvalidStateError"===i.name||"NotFoundError"===i.name))return u.resolve().then((function(){if(!e.db||"NotFoundError"===i.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),C(e)})).then((function(){return M(e).then((function(){D(e,t,n,r-1)}))})).catch(n);n(i)}}function $(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function F(e){var t=this,n={db:null};if(e)for(var r in e)n[r]=e[r];var i=m[n.name];i||(i=$(),m[n.name]=i),i.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=R);var s=[];function o(){return u.resolve()}for(var a=0;a<i.forages.length;a++){var c=i.forages[a];c!==t&&s.push(c._initReady().catch(o))}var d=i.forages.slice(0);return u.all(s).then((function(){return n.db=i.db,I(n)})).then((function(e){return n.db=e,T(n,t._defaultConfig.version)?C(n):e})).then((function(e){n.db=i.db=e,t._dbInfo=n;for(var r=0;r<d.length;r++){var s=d[r];s!==t&&(s._dbInfo.db=n.db,s._dbInfo.version=n.version)}}))}function P(e,t){var n=this;e=h(e);var r=new u((function(t,r){n.ready().then((function(){D(n._dbInfo,_,(function(i,s){if(i)return r(i);try{var o=s.objectStore(n._dbInfo.storeName).get(e);o.onsuccess=function(){var e=o.result;void 0===e&&(e=null),k(e)&&(e=j(e)),t(e)},o.onerror=function(){r(o.error)}}catch(e){r(e)}}))})).catch(r)}));return d(r,t),r}function L(e,t){var n=this,r=new u((function(t,r){n.ready().then((function(){D(n._dbInfo,_,(function(i,s){if(i)return r(i);try{var o=s.objectStore(n._dbInfo.storeName).openCursor(),a=1;o.onsuccess=function(){var n=o.result;if(n){var r=n.value;k(r)&&(r=j(r));var i=e(r,n.key,a++);void 0!==i?t(i):n.continue()}else t()},o.onerror=function(){r(o.error)}}catch(e){r(e)}}))})).catch(r)}));return d(r,t),r}function z(e,t,n){var r=this;e=h(e);var i=new u((function(n,i){var s;r.ready().then((function(){return s=r._dbInfo,"[object Blob]"===v.call(t)?S(s.db).then((function(e){return e?t:O(t)})):t})).then((function(t){D(r._dbInfo,y,(function(s,o){if(s)return i(s);try{var a=o.objectStore(r._dbInfo.storeName);null===t&&(t=void 0);var c=a.put(t,e);o.oncomplete=function(){void 0===t&&(t=null),n(t)},o.onabort=o.onerror=function(){var e=c.error?c.error:c.transaction.error;i(e)}}catch(e){i(e)}}))})).catch(i)}));return d(i,n),i}function U(e,t){var n=this;e=h(e);var r=new u((function(t,r){n.ready().then((function(){D(n._dbInfo,y,(function(i,s){if(i)return r(i);try{var o=s.objectStore(n._dbInfo.storeName).delete(e);s.oncomplete=function(){t()},s.onerror=function(){r(o.error)},s.onabort=function(){var e=o.error?o.error:o.transaction.error;r(e)}}catch(e){r(e)}}))})).catch(r)}));return d(r,t),r}function B(e){var t=this,n=new u((function(e,n){t.ready().then((function(){D(t._dbInfo,y,(function(r,i){if(r)return n(r);try{var s=i.objectStore(t._dbInfo.storeName).clear();i.oncomplete=function(){e()},i.onabort=i.onerror=function(){var e=s.error?s.error:s.transaction.error;n(e)}}catch(e){n(e)}}))})).catch(n)}));return d(n,e),n}function H(e){var t=this,n=new u((function(e,n){t.ready().then((function(){D(t._dbInfo,_,(function(r,i){if(r)return n(r);try{var s=i.objectStore(t._dbInfo.storeName).count();s.onsuccess=function(){e(s.result)},s.onerror=function(){n(s.error)}}catch(e){n(e)}}))})).catch(n)}));return d(n,e),n}function q(e,t){var n=this,r=new u((function(t,r){e<0?t(null):n.ready().then((function(){D(n._dbInfo,_,(function(i,s){if(i)return r(i);try{var o=s.objectStore(n._dbInfo.storeName),a=!1,c=o.openKeyCursor();c.onsuccess=function(){var n=c.result;n?0===e||a?t(n.key):(a=!0,n.advance(e)):t(null)},c.onerror=function(){r(c.error)}}catch(e){r(e)}}))})).catch(r)}));return d(r,t),r}function J(e){var t=this,n=new u((function(e,n){t.ready().then((function(){D(t._dbInfo,_,(function(r,i){if(r)return n(r);try{var s=i.objectStore(t._dbInfo.storeName).openKeyCursor(),o=[];s.onsuccess=function(){var t=s.result;t?(o.push(t.key),t.continue()):e(o)},s.onerror=function(){n(s.error)}}catch(e){n(e)}}))})).catch(n)}));return d(n,e),n}function W(e,t){t=f.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r,i=this;if(e.name){var s=e.name===n.name&&i._dbInfo.db?u.resolve(i._dbInfo.db):I(e).then((function(t){var n=m[e.name],r=n.forages;n.db=t;for(var i=0;i<r.length;i++)r[i]._dbInfo.db=t;return t}));r=e.storeName?s.then((function(t){if(t.objectStoreNames.contains(e.storeName)){var n=t.version+1;A(e);var r=m[e.name],i=r.forages;t.close();for(var s=0;s<i.length;s++){var a=i[s];a._dbInfo.db=null,a._dbInfo.version=n}var c=new u((function(t,r){var i=o.open(e.name,n);i.onerror=function(e){i.result.close(),r(e)},i.onupgradeneeded=function(){i.result.deleteObjectStore(e.storeName)},i.onsuccess=function(){var e=i.result;e.close(),t(e)}}));return c.then((function(e){r.db=e;for(var t=0;t<i.length;t++){var n=i[t];n._dbInfo.db=e,E(n._dbInfo)}})).catch((function(t){throw(x(e,t)||u.resolve()).catch((function(){})),t}))}})):s.then((function(t){A(e);var n=m[e.name],r=n.forages;t.close();for(var i=0;i<r.length;i++)r[i]._dbInfo.db=null;var s=new u((function(t,n){var r=o.deleteDatabase(e.name);r.onerror=function(){var e=r.result;e&&e.close(),n(r.error)},r.onblocked=function(){console.warn('dropInstance blocked for database "'+e.name+'" until all open connections are closed')},r.onsuccess=function(){var e=r.result;e&&e.close(),t(e)}}));return s.then((function(e){n.db=e;for(var t=0;t<r.length;t++)E(r[t]._dbInfo)})).catch((function(t){throw(x(e,t)||u.resolve()).catch((function(){})),t}))}))}else r=u.reject("Invalid arguments");return d(r,t),r}var G={_driver:"asyncStorage",_initStorage:F,_support:a(),iterate:L,getItem:P,setItem:z,removeItem:U,clear:B,length:H,key:q,keys:J,dropInstance:W};function Q(){return"function"==typeof openDatabase}var V="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Y="~~local_forage_type~",X=/^~~local_forage_type~([^~]+)~/,K="__lfsc__:",Z=K.length,ee="arbf",te="blob",ne="si08",re="ui08",ie="uic8",se="si16",oe="si32",ae="ur16",ce="ui32",ue="fl32",de="fl64",le=Z+ee.length,he=Object.prototype.toString;function fe(e){var t,n,r,i,s,o=.75*e.length,a=e.length,c=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);var u=new ArrayBuffer(o),d=new Uint8Array(u);for(t=0;t<a;t+=4)n=V.indexOf(e[t]),r=V.indexOf(e[t+1]),i=V.indexOf(e[t+2]),s=V.indexOf(e[t+3]),d[c++]=n<<2|r>>4,d[c++]=(15&r)<<4|i>>2,d[c++]=(3&i)<<6|63&s;return u}function ge(e){var t,n=new Uint8Array(e),r="";for(t=0;t<n.length;t+=3)r+=V[n[t]>>2],r+=V[(3&n[t])<<4|n[t+1]>>4],r+=V[(15&n[t+1])<<2|n[t+2]>>6],r+=V[63&n[t+2]];return n.length%3==2?r=r.substring(0,r.length-1)+"=":n.length%3==1&&(r=r.substring(0,r.length-2)+"=="),r}function pe(e,t){var n="";if(e&&(n=he.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===he.call(e.buffer))){var r,i=K;e instanceof ArrayBuffer?(r=e,i+=ee):(r=e.buffer,"[object Int8Array]"===n?i+=ne:"[object Uint8Array]"===n?i+=re:"[object Uint8ClampedArray]"===n?i+=ie:"[object Int16Array]"===n?i+=se:"[object Uint16Array]"===n?i+=ae:"[object Int32Array]"===n?i+=oe:"[object Uint32Array]"===n?i+=ce:"[object Float32Array]"===n?i+=ue:"[object Float64Array]"===n?i+=de:t(new Error("Failed to get type for BinaryArray"))),t(i+ge(r))}else if("[object Blob]"===n){var s=new FileReader;s.onload=function(){var n=Y+e.type+"~"+ge(this.result);t(K+te+n)},s.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(n){console.error("Couldn't convert value into a JSON string: ",e),t(null,n)}}function me(e){if(e.substring(0,Z)!==K)return JSON.parse(e);var t,n=e.substring(le),r=e.substring(Z,le);if(r===te&&X.test(n)){var i=n.match(X);t=i[1],n=n.substring(i[0].length)}var s=fe(n);switch(r){case ee:return s;case te:return c([s],{type:t});case ne:return new Int8Array(s);case re:return new Uint8Array(s);case ie:return new Uint8ClampedArray(s);case se:return new Int16Array(s);case ae:return new Uint16Array(s);case oe:return new Int32Array(s);case ce:return new Uint32Array(s);case ue:return new Float32Array(s);case de:return new Float64Array(s);default:throw new Error("Unkown type: "+r)}}var ve={serialize:pe,deserialize:me,stringToBuffer:fe,bufferToString:ge};function _e(e,t,n,r){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],n,r)}function ye(e){var t=this,n={db:null};if(e)for(var r in e)n[r]="string"!=typeof e[r]?e[r].toString():e[r];var i=new u((function(e,r){try{n.db=openDatabase(n.name,String(n.version),n.description,n.size)}catch(e){return r(e)}n.db.transaction((function(i){_e(i,n,(function(){t._dbInfo=n,e()}),(function(e,t){r(t)}))}),r)}));return n.serializer=ve,i}function be(e,t,n,r,i,s){e.executeSql(n,r,i,(function(e,o){o.code===o.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],(function(e,a){a.rows.length?s(e,o):_e(e,t,(function(){e.executeSql(n,r,i,s)}),s)}),s):s(e,o)}),s)}function we(e,t){var n=this;e=h(e);var r=new u((function(t,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){be(n,i,"SELECT * FROM "+i.storeName+" WHERE key = ? LIMIT 1",[e],(function(e,n){var r=n.rows.length?n.rows.item(0).value:null;r&&(r=i.serializer.deserialize(r)),t(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return d(r,t),r}function Se(e,t){var n=this,r=new u((function(t,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){be(n,i,"SELECT * FROM "+i.storeName,[],(function(n,r){for(var s=r.rows,o=s.length,a=0;a<o;a++){var c=s.item(a),u=c.value;if(u&&(u=i.serializer.deserialize(u)),void 0!==(u=e(u,c.key,a+1)))return void t(u)}t()}),(function(e,t){r(t)}))}))})).catch(r)}));return d(r,t),r}function Ae(e,t,n,r){var i=this;e=h(e);var s=new u((function(s,o){i.ready().then((function(){void 0===t&&(t=null);var a=t,c=i._dbInfo;c.serializer.serialize(t,(function(t,u){u?o(u):c.db.transaction((function(n){be(n,c,"INSERT OR REPLACE INTO "+c.storeName+" (key, value) VALUES (?, ?)",[e,t],(function(){s(a)}),(function(e,t){o(t)}))}),(function(t){if(t.code===t.QUOTA_ERR){if(r>0)return void s(Ae.apply(i,[e,a,n,r-1]));o(t)}}))}))})).catch(o)}));return d(s,n),s}function Ee(e,t,n){return Ae.apply(this,[e,t,n,1])}function xe(e,t){var n=this;e=h(e);var r=new u((function(t,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){be(n,i,"DELETE FROM "+i.storeName+" WHERE key = ?",[e],(function(){t()}),(function(e,t){r(t)}))}))})).catch(r)}));return d(r,t),r}function Ne(e){var t=this,n=new u((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){be(t,r,"DELETE FROM "+r.storeName,[],(function(){e()}),(function(e,t){n(t)}))}))})).catch(n)}));return d(n,e),n}function Ie(e){var t=this,n=new u((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){be(t,r,"SELECT COUNT(key) as c FROM "+r.storeName,[],(function(t,n){var r=n.rows.item(0).c;e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return d(n,e),n}function Ce(e,t){var n=this,r=new u((function(t,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){be(n,i,"SELECT key FROM "+i.storeName+" WHERE id = ? LIMIT 1",[e+1],(function(e,n){var r=n.rows.length?n.rows.item(0).key:null;t(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return d(r,t),r}function Te(e){var t=this,n=new u((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){be(t,r,"SELECT key FROM "+r.storeName,[],(function(t,n){for(var r=[],i=0;i<n.rows.length;i++)r.push(n.rows.item(i).key);e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return d(n,e),n}function Oe(e){return new u((function(t,n){e.transaction((function(r){r.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(n,r){for(var i=[],s=0;s<r.rows.length;s++)i.push(r.rows.item(s).name);t({db:e,storeNames:i})}),(function(e,t){n(t)}))}),(function(e){n(e)}))}))}function je(e,t){t=f.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r,i=this;return d(r=e.name?new u((function(t){var r;r=e.name===n.name?i._dbInfo.db:openDatabase(e.name,"","",0),e.storeName?t({db:r,storeNames:[e.storeName]}):t(Oe(r))})).then((function(e){return new u((function(t,n){e.db.transaction((function(r){function i(e){return new u((function(t,n){r.executeSql("DROP TABLE IF EXISTS "+e,[],(function(){t()}),(function(e,t){n(t)}))}))}for(var s=[],o=0,a=e.storeNames.length;o<a;o++)s.push(i(e.storeNames[o]));u.all(s).then((function(){t()})).catch((function(e){n(e)}))}),(function(e){n(e)}))}))})):u.reject("Invalid arguments"),t),r}var ke={_driver:"webSQLStorage",_initStorage:ye,_support:Q(),iterate:Se,getItem:we,setItem:Ee,removeItem:xe,clear:Ne,length:Ie,key:Ce,keys:Te,dropInstance:je};function Re(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}function Me(e,t){var n=e.name+"/";return e.storeName!==t.storeName&&(n+=e.storeName+"/"),n}function De(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch(e){return!0}}function $e(){return!De()||localStorage.length>0}function Fe(e){var t=this,n={};if(e)for(var r in e)n[r]=e[r];return n.keyPrefix=Me(e,t._defaultConfig),$e()?(t._dbInfo=n,n.serializer=ve,u.resolve()):u.reject()}function Pe(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo.keyPrefix,n=localStorage.length-1;n>=0;n--){var r=localStorage.key(n);0===r.indexOf(e)&&localStorage.removeItem(r)}}));return d(n,e),n}function Le(e,t){var n=this;e=h(e);var r=n.ready().then((function(){var t=n._dbInfo,r=localStorage.getItem(t.keyPrefix+e);return r&&(r=t.serializer.deserialize(r)),r}));return d(r,t),r}function ze(e,t){var n=this,r=n.ready().then((function(){for(var t=n._dbInfo,r=t.keyPrefix,i=r.length,s=localStorage.length,o=1,a=0;a<s;a++){var c=localStorage.key(a);if(0===c.indexOf(r)){var u=localStorage.getItem(c);if(u&&(u=t.serializer.deserialize(u)),void 0!==(u=e(u,c.substring(i),o++)))return u}}}));return d(r,t),r}function Ue(e,t){var n=this,r=n.ready().then((function(){var t,r=n._dbInfo;try{t=localStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(r.keyPrefix.length)),t}));return d(r,t),r}function Be(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo,n=localStorage.length,r=[],i=0;i<n;i++){var s=localStorage.key(i);0===s.indexOf(e.keyPrefix)&&r.push(s.substring(e.keyPrefix.length))}return r}));return d(n,e),n}function He(e){var t=this.keys().then((function(e){return e.length}));return d(t,e),t}function qe(e,t){var n=this;e=h(e);var r=n.ready().then((function(){var t=n._dbInfo;localStorage.removeItem(t.keyPrefix+e)}));return d(r,t),r}function Je(e,t,n){var r=this;e=h(e);var i=r.ready().then((function(){void 0===t&&(t=null);var n=t;return new u((function(i,s){var o=r._dbInfo;o.serializer.serialize(t,(function(t,r){if(r)s(r);else try{localStorage.setItem(o.keyPrefix+e,t),i(n)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||s(e),s(e)}}))}))}));return d(i,n),i}function We(e,t){if(t=f.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var n=this.config();e.name=e.name||n.name,e.storeName=e.storeName||n.storeName}var r,i=this;return r=e.name?new u((function(t){e.storeName?t(Me(e,i._defaultConfig)):t(e.name+"/")})).then((function(e){for(var t=localStorage.length-1;t>=0;t--){var n=localStorage.key(t);0===n.indexOf(e)&&localStorage.removeItem(n)}})):u.reject("Invalid arguments"),d(r,t),r}var Ge={_driver:"localStorageWrapper",_initStorage:Fe,_support:Re(),iterate:ze,getItem:Le,setItem:Je,removeItem:qe,clear:Pe,length:He,key:Ue,keys:Be,dropInstance:We},Qe=function(e,t){return e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t)},Ve=function(e,t){for(var n=e.length,r=0;r<n;){if(Qe(e[r],t))return!0;r++}return!1},Ye=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},Xe={},Ke={},Ze={INDEXEDDB:G,WEBSQL:ke,LOCALSTORAGE:Ge},et=[Ze.INDEXEDDB._driver,Ze.WEBSQL._driver,Ze.LOCALSTORAGE._driver],tt=["dropInstance"],nt=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(tt),rt={description:"",driver:et.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function it(e,t){e[t]=function(){var n=arguments;return e.ready().then((function(){return e[t].apply(e,n)}))}}function st(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var n in t)t.hasOwnProperty(n)&&(Ye(t[n])?arguments[0][n]=t[n].slice():arguments[0][n]=t[n])}return arguments[0]}var ot=function(){function e(t){for(var n in i(this,e),Ze)if(Ze.hasOwnProperty(n)){var r=Ze[n],s=r._driver;this[n]=s,Xe[s]||this.defineDriver(r)}this._defaultConfig=st({},rt),this._config=st({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((function(){}))}return e.prototype.config=function(e){if("object"===(void 0===e?"undefined":r(e))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e)||!e.driver||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config},e.prototype.defineDriver=function(e,t,n){var r=new u((function(t,n){try{var r=e._driver,i=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void n(i);for(var s=nt.concat("_initStorage"),o=0,a=s.length;o<a;o++){var c=s[o];if((!Ve(tt,c)||e[c])&&"function"!=typeof e[c])return void n(i)}var l=function(){for(var t=function(e){return function(){var t=new Error("Method "+e+" is not implemented by the current driver"),n=u.reject(t);return d(n,arguments[arguments.length-1]),n}},n=0,r=tt.length;n<r;n++){var i=tt[n];e[i]||(e[i]=t(i))}};l();var h=function(n){Xe[r]&&console.info("Redefining LocalForage driver: "+r),Xe[r]=e,Ke[r]=n,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(h,n):h(!!e._support):h(!0)}catch(e){n(e)}}));return l(r,t,n),r},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(e,t,n){var r=Xe[e]?u.resolve(Xe[e]):u.reject(new Error("Driver not found."));return l(r,t,n),r},e.prototype.getSerializer=function(e){var t=u.resolve(ve);return l(t,e),t},e.prototype.ready=function(e){var t=this,n=t._driverSet.then((function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready}));return l(n,e,e),n},e.prototype.setDriver=function(e,t,n){var r=this;Ye(e)||(e=[e]);var i=this._getSupportedDrivers(e);function s(){r._config.driver=r.driver()}function o(e){return r._extend(e),s(),r._ready=r._initStorage(r._config),r._ready}function a(e){return function(){var t=0;function n(){for(;t<e.length;){var i=e[t];return t++,r._dbInfo=null,r._ready=null,r.getDriver(i).then(o).catch(n)}s();var a=new Error("No available storage method found.");return r._driverSet=u.reject(a),r._driverSet}return n()}}var c=null!==this._driverSet?this._driverSet.catch((function(){return u.resolve()})):u.resolve();return this._driverSet=c.then((function(){var e=i[0];return r._dbInfo=null,r._ready=null,r.getDriver(e).then((function(e){r._driver=e._driver,s(),r._wrapLibraryMethodsWithReady(),r._initDriver=a(i)}))})).catch((function(){s();var e=new Error("No available storage method found.");return r._driverSet=u.reject(e),r._driverSet})),l(this._driverSet,t,n),this._driverSet},e.prototype.supports=function(e){return!!Ke[e]},e.prototype._extend=function(e){st(this,e)},e.prototype._getSupportedDrivers=function(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n];this.supports(i)&&t.push(i)}return t},e.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=nt.length;e<t;e++)it(this,nt[e])},e.prototype.createInstance=function(t){return new e(t)},e}(),at=new ot;t.exports=at},{3:3}]},{},[4])(4)},568:(e,t,n)=>{var r;!function(i){var s,o,a,c,u,d,l,h,f,g,p,m,v,_,y,b,w,S,A,E="sizzle"+1*new Date,x=i.document,N=0,I=0,C=he(),T=he(),O=he(),j=he(),k=function(e,t){return e===t&&(p=!0),0},R={}.hasOwnProperty,M=[],D=M.pop,$=M.push,F=M.push,P=M.slice,L=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},z="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",U="[\\x20\\t\\r\\n\\f]",B="(?:\\\\[\\da-fA-F]{1,6}"+U+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",H="\\["+U+"*("+B+")(?:"+U+"*([*^$|!~]?=)"+U+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+B+"))|)"+U+"*\\]",q=":("+B+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+H+")*)|.*)\\)|)",J=new RegExp(U+"+","g"),W=new RegExp("^"+U+"+|((?:^|[^\\\\])(?:\\\\.)*)"+U+"+$","g"),G=new RegExp("^"+U+"*,"+U+"*"),Q=new RegExp("^"+U+"*([>+~]|"+U+")"+U+"*"),V=new RegExp(U+"|>"),Y=new RegExp(q),X=new RegExp("^"+B+"$"),K={ID:new RegExp("^#("+B+")"),CLASS:new RegExp("^\\.("+B+")"),TAG:new RegExp("^("+B+"|[*])"),ATTR:new RegExp("^"+H),PSEUDO:new RegExp("^"+q),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+U+"*(even|odd|(([+-]|)(\\d*)n|)"+U+"*(?:([+-]|)"+U+"*(\\d+)|))"+U+"*\\)|)","i"),bool:new RegExp("^(?:"+z+")$","i"),needsContext:new RegExp("^"+U+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+U+"*((?:-\\d)?\\d*)"+U+"*\\)|)(?=[^-]|$)","i")},Z=/HTML$/i,ee=/^(?:input|select|textarea|button)$/i,te=/^h\d$/i,ne=/^[^{]+\{\s*\[native \w/,re=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ie=/[+~]/,se=new RegExp("\\\\[\\da-fA-F]{1,6}"+U+"?|\\\\([^\\r\\n\\f])","g"),oe=function(e,t){var n="0x"+e.slice(1)-65536;return t||(n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320))},ae=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ce=function(e,t){return t?"\0"===e?"":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},ue=function(){m()},de=Ee((function(e){return!0===e.disabled&&"fieldset"===e.nodeName.toLowerCase()}),{dir:"parentNode",next:"legend"});try{F.apply(M=P.call(x.childNodes),x.childNodes),M[x.childNodes.length].nodeType}catch(e){F={apply:M.length?function(e,t){$.apply(e,P.call(t))}:function(e,t){for(var n=e.length,r=0;e[n++]=t[r++];);e.length=n-1}}}function le(e,t,n,r){var i,s,a,c,u,l,f,g=t&&t.ownerDocument,p=t?t.nodeType:9;if(n=n||[],"string"!=typeof e||!e||1!==p&&9!==p&&11!==p)return n;if(!r&&(m(t),t=t||v,y)){if(11!==p&&(u=re.exec(e)))if(i=u[1]){if(9===p){if(!(a=t.getElementById(i)))return n;if(a.id===i)return n.push(a),n}else if(g&&(a=g.getElementById(i))&&A(t,a)&&a.id===i)return n.push(a),n}else{if(u[2])return F.apply(n,t.getElementsByTagName(e)),n;if((i=u[3])&&o.getElementsByClassName&&t.getElementsByClassName)return F.apply(n,t.getElementsByClassName(i)),n}if(o.qsa&&!j[e+" "]&&(!b||!b.test(e))&&(1!==p||"object"!==t.nodeName.toLowerCase())){if(f=e,g=t,1===p&&(V.test(e)||Q.test(e))){for((g=ie.test(e)&&we(t.parentNode)||t)===t&&o.scope||((c=t.getAttribute("id"))?c=c.replace(ae,ce):t.setAttribute("id",c=E)),s=(l=d(e)).length;s--;)l[s]=(c?"#"+c:":scope")+" "+Ae(l[s]);f=l.join(",")}try{return F.apply(n,g.querySelectorAll(f)),n}catch(t){j(e,!0)}finally{c===E&&t.removeAttribute("id")}}}return h(e.replace(W,"$1"),t,n,r)}function he(){var e=[];return function t(n,r){return e.push(n+" ")>a.cacheLength&&delete t[e.shift()],t[n+" "]=r}}function fe(e){return e[E]=!0,e}function ge(e){var t=v.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function pe(e,t){for(var n=e.split("|"),r=n.length;r--;)a.attrHandle[n[r]]=t}function me(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(r)return r;if(n)for(;n=n.nextSibling;)if(n===t)return-1;return e?1:-1}function ve(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}function _e(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function ye(e){return function(t){return"form"in t?t.parentNode&&!1===t.disabled?"label"in t?"label"in t.parentNode?t.parentNode.disabled===e:t.disabled===e:t.isDisabled===e||t.isDisabled!==!e&&de(t)===e:t.disabled===e:"label"in t&&t.disabled===e}}function be(e){return fe((function(t){return t=+t,fe((function(n,r){for(var i,s=e([],n.length,t),o=s.length;o--;)n[i=s[o]]&&(n[i]=!(r[i]=n[i]))}))}))}function we(e){return e&&void 0!==e.getElementsByTagName&&e}for(s in o=le.support={},u=le.isXML=function(e){var t=e&&e.namespaceURI,n=e&&(e.ownerDocument||e).documentElement;return!Z.test(t||n&&n.nodeName||"HTML")},m=le.setDocument=function(e){var t,n,r=e?e.ownerDocument||e:x;return r!=v&&9===r.nodeType&&r.documentElement?(_=(v=r).documentElement,y=!u(v),x!=v&&(n=v.defaultView)&&n.top!==n&&(n.addEventListener?n.addEventListener("unload",ue,!1):n.attachEvent&&n.attachEvent("onunload",ue)),o.scope=ge((function(e){return _.appendChild(e).appendChild(v.createElement("div")),void 0!==e.querySelectorAll&&!e.querySelectorAll(":scope fieldset div").length})),o.cssHas=ge((function(){try{return v.querySelector(":has(*,:jqfake)"),!1}catch(e){return!0}})),o.attributes=ge((function(e){return e.className="i",!e.getAttribute("className")})),o.getElementsByTagName=ge((function(e){return e.appendChild(v.createComment("")),!e.getElementsByTagName("*").length})),o.getElementsByClassName=ne.test(v.getElementsByClassName),o.getById=ge((function(e){return _.appendChild(e).id=E,!v.getElementsByName||!v.getElementsByName(E).length})),o.getById?(a.filter.ID=function(e){var t=e.replace(se,oe);return function(e){return e.getAttribute("id")===t}},a.find.ID=function(e,t){if(void 0!==t.getElementById&&y){var n=t.getElementById(e);return n?[n]:[]}}):(a.filter.ID=function(e){var t=e.replace(se,oe);return function(e){var n=void 0!==e.getAttributeNode&&e.getAttributeNode("id");return n&&n.value===t}},a.find.ID=function(e,t){if(void 0!==t.getElementById&&y){var n,r,i,s=t.getElementById(e);if(s){if((n=s.getAttributeNode("id"))&&n.value===e)return[s];for(i=t.getElementsByName(e),r=0;s=i[r++];)if((n=s.getAttributeNode("id"))&&n.value===e)return[s]}return[]}}),a.find.TAG=o.getElementsByTagName?function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):o.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,r=[],i=0,s=t.getElementsByTagName(e);if("*"===e){for(;n=s[i++];)1===n.nodeType&&r.push(n);return r}return s},a.find.CLASS=o.getElementsByClassName&&function(e,t){if(void 0!==t.getElementsByClassName&&y)return t.getElementsByClassName(e)},w=[],b=[],(o.qsa=ne.test(v.querySelectorAll))&&(ge((function(e){var t;_.appendChild(e).innerHTML="<a id='"+E+"'></a><select id='"+E+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&b.push("[*^$]="+U+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||b.push("\\["+U+"*(?:value|"+z+")"),e.querySelectorAll("[id~="+E+"-]").length||b.push("~="),(t=v.createElement("input")).setAttribute("name",""),e.appendChild(t),e.querySelectorAll("[name='']").length||b.push("\\["+U+"*name"+U+"*="+U+"*(?:''|\"\")"),e.querySelectorAll(":checked").length||b.push(":checked"),e.querySelectorAll("a#"+E+"+*").length||b.push(".#.+[+~]"),e.querySelectorAll("\\\f"),b.push("[\\r\\n\\f]")})),ge((function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=v.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&b.push("name"+U+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&b.push(":enabled",":disabled"),_.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&b.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),b.push(",.*:")}))),(o.matchesSelector=ne.test(S=_.matches||_.webkitMatchesSelector||_.mozMatchesSelector||_.oMatchesSelector||_.msMatchesSelector))&&ge((function(e){o.disconnectedMatch=S.call(e,"*"),S.call(e,"[s!='']:x"),w.push("!=",q)})),o.cssHas||b.push(":has"),b=b.length&&new RegExp(b.join("|")),w=w.length&&new RegExp(w.join("|")),t=ne.test(_.compareDocumentPosition),A=t||ne.test(_.contains)?function(e,t){var n=9===e.nodeType&&e.documentElement||e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},k=t?function(e,t){if(e===t)return p=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n||(1&(n=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!o.sortDetached&&t.compareDocumentPosition(e)===n?e==v||e.ownerDocument==x&&A(x,e)?-1:t==v||t.ownerDocument==x&&A(x,t)?1:g?L(g,e)-L(g,t):0:4&n?-1:1)}:function(e,t){if(e===t)return p=!0,0;var n,r=0,i=e.parentNode,s=t.parentNode,o=[e],a=[t];if(!i||!s)return e==v?-1:t==v?1:i?-1:s?1:g?L(g,e)-L(g,t):0;if(i===s)return me(e,t);for(n=e;n=n.parentNode;)o.unshift(n);for(n=t;n=n.parentNode;)a.unshift(n);for(;o[r]===a[r];)r++;return r?me(o[r],a[r]):o[r]==x?-1:a[r]==x?1:0},v):v},le.matches=function(e,t){return le(e,null,null,t)},le.matchesSelector=function(e,t){if(m(e),o.matchesSelector&&y&&!j[t+" "]&&(!w||!w.test(t))&&(!b||!b.test(t)))try{var n=S.call(e,t);if(n||o.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(e){j(t,!0)}return le(t,v,null,[e]).length>0},le.contains=function(e,t){return(e.ownerDocument||e)!=v&&m(e),A(e,t)},le.attr=function(e,t){(e.ownerDocument||e)!=v&&m(e);var n=a.attrHandle[t.toLowerCase()],r=n&&R.call(a.attrHandle,t.toLowerCase())?n(e,t,!y):void 0;return void 0!==r?r:o.attributes||!y?e.getAttribute(t):(r=e.getAttributeNode(t))&&r.specified?r.value:null},le.escape=function(e){return(e+"").replace(ae,ce)},le.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},le.uniqueSort=function(e){var t,n=[],r=0,i=0;if(p=!o.detectDuplicates,g=!o.sortStable&&e.slice(0),e.sort(k),p){for(;t=e[i++];)t===e[i]&&(r=n.push(i));for(;r--;)e.splice(n[r],1)}return g=null,e},c=le.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=c(e)}else if(3===i||4===i)return e.nodeValue}else for(;t=e[r++];)n+=c(t);return n},a=le.selectors={cacheLength:50,createPseudo:fe,match:K,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(se,oe),e[3]=(e[3]||e[4]||e[5]||"").replace(se,oe),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||le.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&le.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return K.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&Y.test(n)&&(t=d(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(se,oe).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=C[e+" "];return t||(t=new RegExp("(^|"+U+")"+e+"("+U+"|$)"))&&C(e,(function(e){return t.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")}))},ATTR:function(e,t,n){return function(r){var i=le.attr(r,e);return null==i?"!="===t:!t||(i+="","="===t?i===n:"!="===t?i!==n:"^="===t?n&&0===i.indexOf(n):"*="===t?n&&i.indexOf(n)>-1:"$="===t?n&&i.slice(-n.length)===n:"~="===t?(" "+i.replace(J," ")+" ").indexOf(n)>-1:"|="===t&&(i===n||i.slice(0,n.length+1)===n+"-"))}},CHILD:function(e,t,n,r,i){var s="nth"!==e.slice(0,3),o="last"!==e.slice(-4),a="of-type"===t;return 1===r&&0===i?function(e){return!!e.parentNode}:function(t,n,c){var u,d,l,h,f,g,p=s!==o?"nextSibling":"previousSibling",m=t.parentNode,v=a&&t.nodeName.toLowerCase(),_=!c&&!a,y=!1;if(m){if(s){for(;p;){for(h=t;h=h[p];)if(a?h.nodeName.toLowerCase()===v:1===h.nodeType)return!1;g=p="only"===e&&!g&&"nextSibling"}return!0}if(g=[o?m.firstChild:m.lastChild],o&&_){for(y=(f=(u=(d=(l=(h=m)[E]||(h[E]={}))[h.uniqueID]||(l[h.uniqueID]={}))[e]||[])[0]===N&&u[1])&&u[2],h=f&&m.childNodes[f];h=++f&&h&&h[p]||(y=f=0)||g.pop();)if(1===h.nodeType&&++y&&h===t){d[e]=[N,f,y];break}}else if(_&&(y=f=(u=(d=(l=(h=t)[E]||(h[E]={}))[h.uniqueID]||(l[h.uniqueID]={}))[e]||[])[0]===N&&u[1]),!1===y)for(;(h=++f&&h&&h[p]||(y=f=0)||g.pop())&&((a?h.nodeName.toLowerCase()!==v:1!==h.nodeType)||!++y||(_&&((d=(l=h[E]||(h[E]={}))[h.uniqueID]||(l[h.uniqueID]={}))[e]=[N,y]),h!==t)););return(y-=i)===r||y%r==0&&y/r>=0}}},PSEUDO:function(e,t){var n,r=a.pseudos[e]||a.setFilters[e.toLowerCase()]||le.error("unsupported pseudo: "+e);return r[E]?r(t):r.length>1?(n=[e,e,"",t],a.setFilters.hasOwnProperty(e.toLowerCase())?fe((function(e,n){for(var i,s=r(e,t),o=s.length;o--;)e[i=L(e,s[o])]=!(n[i]=s[o])})):function(e){return r(e,0,n)}):r}},pseudos:{not:fe((function(e){var t=[],n=[],r=l(e.replace(W,"$1"));return r[E]?fe((function(e,t,n,i){for(var s,o=r(e,null,i,[]),a=e.length;a--;)(s=o[a])&&(e[a]=!(t[a]=s))})):function(e,i,s){return t[0]=e,r(t,null,s,n),t[0]=null,!n.pop()}})),has:fe((function(e){return function(t){return le(e,t).length>0}})),contains:fe((function(e){return e=e.replace(se,oe),function(t){return(t.textContent||c(t)).indexOf(e)>-1}})),lang:fe((function(e){return X.test(e||"")||le.error("unsupported lang: "+e),e=e.replace(se,oe).toLowerCase(),function(t){var n;do{if(n=y?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(n=n.toLowerCase())===e||0===n.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}})),target:function(e){var t=i.location&&i.location.hash;return t&&t.slice(1)===e.id},root:function(e){return e===_},focus:function(e){return e===v.activeElement&&(!v.hasFocus||v.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:ye(!1),disabled:ye(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!a.pseudos.empty(e)},header:function(e){return te.test(e.nodeName)},input:function(e){return ee.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:be((function(){return[0]})),last:be((function(e,t){return[t-1]})),eq:be((function(e,t,n){return[n<0?n+t:n]})),even:be((function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e})),odd:be((function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e})),lt:be((function(e,t,n){for(var r=n<0?n+t:n>t?t:n;--r>=0;)e.push(r);return e})),gt:be((function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e}))}},a.pseudos.nth=a.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})a.pseudos[s]=ve(s);for(s in{submit:!0,reset:!0})a.pseudos[s]=_e(s);function Se(){}function Ae(e){for(var t=0,n=e.length,r="";t<n;t++)r+=e[t].value;return r}function Ee(e,t,n){var r=t.dir,i=t.next,s=i||r,o=n&&"parentNode"===s,a=I++;return t.first?function(t,n,i){for(;t=t[r];)if(1===t.nodeType||o)return e(t,n,i);return!1}:function(t,n,c){var u,d,l,h=[N,a];if(c){for(;t=t[r];)if((1===t.nodeType||o)&&e(t,n,c))return!0}else for(;t=t[r];)if(1===t.nodeType||o)if(d=(l=t[E]||(t[E]={}))[t.uniqueID]||(l[t.uniqueID]={}),i&&i===t.nodeName.toLowerCase())t=t[r]||t;else{if((u=d[s])&&u[0]===N&&u[1]===a)return h[2]=u[2];if(d[s]=h,h[2]=e(t,n,c))return!0}return!1}}function xe(e){return e.length>1?function(t,n,r){for(var i=e.length;i--;)if(!e[i](t,n,r))return!1;return!0}:e[0]}function Ne(e,t,n,r,i){for(var s,o=[],a=0,c=e.length,u=null!=t;a<c;a++)(s=e[a])&&(n&&!n(s,r,i)||(o.push(s),u&&t.push(a)));return o}function Ie(e,t,n,r,i,s){return r&&!r[E]&&(r=Ie(r)),i&&!i[E]&&(i=Ie(i,s)),fe((function(s,o,a,c){var u,d,l,h=[],f=[],g=o.length,p=s||function(e,t,n){for(var r=0,i=t.length;r<i;r++)le(e,t[r],n);return n}(t||"*",a.nodeType?[a]:a,[]),m=!e||!s&&t?p:Ne(p,h,e,a,c),v=n?i||(s?e:g||r)?[]:o:m;if(n&&n(m,v,a,c),r)for(u=Ne(v,f),r(u,[],a,c),d=u.length;d--;)(l=u[d])&&(v[f[d]]=!(m[f[d]]=l));if(s){if(i||e){if(i){for(u=[],d=v.length;d--;)(l=v[d])&&u.push(m[d]=l);i(null,v=[],u,c)}for(d=v.length;d--;)(l=v[d])&&(u=i?L(s,l):h[d])>-1&&(s[u]=!(o[u]=l))}}else v=Ne(v===o?v.splice(g,v.length):v),i?i(null,o,v,c):F.apply(o,v)}))}function Ce(e){for(var t,n,r,i=e.length,s=a.relative[e[0].type],o=s||a.relative[" "],c=s?1:0,u=Ee((function(e){return e===t}),o,!0),d=Ee((function(e){return L(t,e)>-1}),o,!0),l=[function(e,n,r){var i=!s&&(r||n!==f)||((t=n).nodeType?u(e,n,r):d(e,n,r));return t=null,i}];c<i;c++)if(n=a.relative[e[c].type])l=[Ee(xe(l),n)];else{if((n=a.filter[e[c].type].apply(null,e[c].matches))[E]){for(r=++c;r<i&&!a.relative[e[r].type];r++);return Ie(c>1&&xe(l),c>1&&Ae(e.slice(0,c-1).concat({value:" "===e[c-2].type?"*":""})).replace(W,"$1"),n,c<r&&Ce(e.slice(c,r)),r<i&&Ce(e=e.slice(r)),r<i&&Ae(e))}l.push(n)}return xe(l)}Se.prototype=a.filters=a.pseudos,a.setFilters=new Se,d=le.tokenize=function(e,t){var n,r,i,s,o,c,u,d=T[e+" "];if(d)return t?0:d.slice(0);for(o=e,c=[],u=a.preFilter;o;){for(s in n&&!(r=G.exec(o))||(r&&(o=o.slice(r[0].length)||o),c.push(i=[])),n=!1,(r=Q.exec(o))&&(n=r.shift(),i.push({value:n,type:r[0].replace(W," ")}),o=o.slice(n.length)),a.filter)!(r=K[s].exec(o))||u[s]&&!(r=u[s](r))||(n=r.shift(),i.push({value:n,type:s,matches:r}),o=o.slice(n.length));if(!n)break}return t?o.length:o?le.error(e):T(e,c).slice(0)},l=le.compile=function(e,t){var n,r=[],i=[],s=O[e+" "];if(!s){for(t||(t=d(e)),n=t.length;n--;)(s=Ce(t[n]))[E]?r.push(s):i.push(s);s=O(e,function(e,t){var n=t.length>0,r=e.length>0,i=function(i,s,o,c,u){var d,l,h,g=0,p="0",_=i&&[],b=[],w=f,S=i||r&&a.find.TAG("*",u),A=N+=null==w?1:Math.random()||.1,E=S.length;for(u&&(f=s==v||s||u);p!==E&&null!=(d=S[p]);p++){if(r&&d){for(l=0,s||d.ownerDocument==v||(m(d),o=!y);h=e[l++];)if(h(d,s||v,o)){c.push(d);break}u&&(N=A)}n&&((d=!h&&d)&&g--,i&&_.push(d))}if(g+=p,n&&p!==g){for(l=0;h=t[l++];)h(_,b,s,o);if(i){if(g>0)for(;p--;)_[p]||b[p]||(b[p]=D.call(c));b=Ne(b)}F.apply(c,b),u&&!i&&b.length>0&&g+t.length>1&&le.uniqueSort(c)}return u&&(N=A,f=w),_};return n?fe(i):i}(i,r)),s.selector=e}return s},h=le.select=function(e,t,n,r){var i,s,o,c,u,h="function"==typeof e&&e,f=!r&&d(e=h.selector||e);if(n=n||[],1===f.length){if((s=f[0]=f[0].slice(0)).length>2&&"ID"===(o=s[0]).type&&9===t.nodeType&&y&&a.relative[s[1].type]){if(!(t=(a.find.ID(o.matches[0].replace(se,oe),t)||[])[0]))return n;h&&(t=t.parentNode),e=e.slice(s.shift().value.length)}for(i=K.needsContext.test(e)?0:s.length;i--&&(o=s[i],!a.relative[c=o.type]);)if((u=a.find[c])&&(r=u(o.matches[0].replace(se,oe),ie.test(s[0].type)&&we(t.parentNode)||t))){if(s.splice(i,1),!(e=r.length&&Ae(s)))return F.apply(n,r),n;break}}return(h||l(e,f))(r,t,!y,n,!t||ie.test(e)&&we(t.parentNode)||t),n},o.sortStable=E.split("").sort(k).join("")===E,o.detectDuplicates=!!p,m(),o.sortDetached=ge((function(e){return 1&e.compareDocumentPosition(v.createElement("fieldset"))})),ge((function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")}))||pe("type|href|height|width",(function(e,t,n){if(!n)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)})),o.attributes&&ge((function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")}))||pe("value",(function(e,t,n){if(!n&&"input"===e.nodeName.toLowerCase())return e.defaultValue})),ge((function(e){return null==e.getAttribute("disabled")}))||pe(z,(function(e,t,n){var r;if(!n)return!0===e[t]?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null}));var Te=i.Sizzle;le.noConflict=function(){return i.Sizzle===le&&(i.Sizzle=Te),le},void 0===(r=function(){return le}.call(t,n,t,e))||(e.exports=r)}(window)},293:(e,t,n)=>{var r;!function(){"use strict";var i={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/};function s(e){return function(e,t){var n,r,o,a,c,u,d,l,h,f=1,g=e.length,p="";for(r=0;r<g;r++)if("string"==typeof e[r])p+=e[r];else if("object"==typeof e[r]){if((a=e[r]).keys)for(n=t[f],o=0;o<a.keys.length;o++){if(null==n)throw new Error(s('[sprintf] Cannot access property "%s" of undefined value "%s"',a.keys[o],a.keys[o-1]));n=n[a.keys[o]]}else n=a.param_no?t[a.param_no]:t[f++];if(i.not_type.test(a.type)&&i.not_primitive.test(a.type)&&n instanceof Function&&(n=n()),i.numeric_arg.test(a.type)&&"number"!=typeof n&&isNaN(n))throw new TypeError(s("[sprintf] expecting number but found %T",n));switch(i.number.test(a.type)&&(l=n>=0),a.type){case"b":n=parseInt(n,10).toString(2);break;case"c":n=String.fromCharCode(parseInt(n,10));break;case"d":case"i":n=parseInt(n,10);break;case"j":n=JSON.stringify(n,null,a.width?parseInt(a.width):0);break;case"e":n=a.precision?parseFloat(n).toExponential(a.precision):parseFloat(n).toExponential();break;case"f":n=a.precision?parseFloat(n).toFixed(a.precision):parseFloat(n);break;case"g":n=a.precision?String(Number(n.toPrecision(a.precision))):parseFloat(n);break;case"o":n=(parseInt(n,10)>>>0).toString(8);break;case"s":n=String(n),n=a.precision?n.substring(0,a.precision):n;break;case"t":n=String(!!n),n=a.precision?n.substring(0,a.precision):n;break;case"T":n=Object.prototype.toString.call(n).slice(8,-1).toLowerCase(),n=a.precision?n.substring(0,a.precision):n;break;case"u":n=parseInt(n,10)>>>0;break;case"v":n=n.valueOf(),n=a.precision?n.substring(0,a.precision):n;break;case"x":n=(parseInt(n,10)>>>0).toString(16);break;case"X":n=(parseInt(n,10)>>>0).toString(16).toUpperCase()}i.json.test(a.type)?p+=n:(!i.number.test(a.type)||l&&!a.sign?h="":(h=l?"+":"-",n=n.toString().replace(i.sign,"")),u=a.pad_char?"0"===a.pad_char?"0":a.pad_char.charAt(1):" ",d=a.width-(h+n).length,c=a.width&&d>0?u.repeat(d):"",p+=a.align?h+n+c:"0"===u?h+c+n:c+h+n)}return p}(function(e){if(a[e])return a[e];var t,n=e,r=[],s=0;for(;n;){if(null!==(t=i.text.exec(n)))r.push(t[0]);else if(null!==(t=i.modulo.exec(n)))r.push("%");else{if(null===(t=i.placeholder.exec(n)))throw new SyntaxError("[sprintf] unexpected placeholder");if(t[2]){s|=1;var o=[],c=t[2],u=[];if(null===(u=i.key.exec(c)))throw new SyntaxError("[sprintf] failed to parse named argument key");for(o.push(u[1]);""!==(c=c.substring(u[0].length));)if(null!==(u=i.key_access.exec(c)))o.push(u[1]);else{if(null===(u=i.index_access.exec(c)))throw new SyntaxError("[sprintf] failed to parse named argument key");o.push(u[1])}t[2]=o}else s|=2;if(3===s)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");r.push({placeholder:t[0],param_no:t[1],keys:t[2],sign:t[3],pad_char:t[4],align:t[5],width:t[6],precision:t[7],type:t[8]})}n=n.substring(t[0].length)}return a[e]=r}(e),arguments)}function o(e,t){return s.apply(null,[e].concat(t||[]))}var a=Object.create(null);t.sprintf=s,t.vsprintf=o,"undefined"!=typeof window&&(window.sprintf=s,window.vsprintf=o,void 0===(r=function(){return{sprintf:s,vsprintf:o}}.call(t,n,t,e))||(e.exports=r))}()},939:function(e,t,n){var r,i;!function(s,o){"use strict";e.exports?e.exports=o():void 0===(i="function"==typeof(r=o)?r.call(t,n,t,e):r)||(e.exports=i)}(0,(function(e){"use strict";var t=e&&e.IPv6;return{best:function(e){var t,n,r=e.toLowerCase().split(":"),i=r.length,s=8;for(""===r[0]&&""===r[1]&&""===r[2]?(r.shift(),r.shift()):""===r[0]&&""===r[1]?r.shift():""===r[i-1]&&""===r[i-2]&&r.pop(),-1!==r[(i=r.length)-1].indexOf(".")&&(s=7),t=0;t<i&&""!==r[t];t++);if(t<s)for(r.splice(t,1,"0000");r.length<s;)r.splice(t,0,"0000");for(var o=0;o<s;o++){n=r[o].split("");for(var a=0;a<3&&("0"===n[0]&&n.length>1);a++)n.splice(0,1);r[o]=n.join("")}var c=-1,u=0,d=0,l=-1,h=!1;for(o=0;o<s;o++)h?"0"===r[o]?d+=1:(h=!1,d>u&&(c=l,u=d)):"0"===r[o]&&(h=!0,l=o,d=1);d>u&&(c=l,u=d),u>1&&r.splice(c,u,""),i=r.length;var f="";for(""===r[0]&&(f=":"),o=0;o<i&&(f+=r[o],o!==i-1);o++)f+=":";return""===r[i-1]&&(f+=":"),f},noConflict:function(){return e.IPv6===this&&(e.IPv6=t),this}}}))},338:function(e,t,n){var r,i;!function(s,o){"use strict";e.exports?e.exports=o():void 0===(i="function"==typeof(r=o)?r.call(t,n,t,e):r)||(e.exports=i)}(0,(function(e){"use strict";var t=e&&e.SecondLevelDomains,n={list:{ac:" com gov mil net org ",ae:" ac co gov mil name net org pro sch ",af:" com edu gov net org ",al:" com edu gov mil net org ",ao:" co ed gv it og pb ",ar:" com edu gob gov int mil net org tur ",at:" ac co gv or ",au:" asn com csiro edu gov id net org ",ba:" co com edu gov mil net org rs unbi unmo unsa untz unze ",bb:" biz co com edu gov info net org store tv ",bh:" biz cc com edu gov info net org ",bn:" com edu gov net org ",bo:" com edu gob gov int mil net org tv ",br:" adm adv agr am arq art ato b bio blog bmd cim cng cnt com coop ecn edu eng esp etc eti far flog fm fnd fot fst g12 ggf gov imb ind inf jor jus lel mat med mil mus net nom not ntr odo org ppg pro psc psi qsl rec slg srv tmp trd tur tv vet vlog wiki zlg ",bs:" com edu gov net org ",bz:" du et om ov rg ",ca:" ab bc mb nb nf nl ns nt nu on pe qc sk yk ",ck:" biz co edu gen gov info net org ",cn:" ac ah bj com cq edu fj gd gov gs gx gz ha hb he hi hl hn jl js jx ln mil net nm nx org qh sc sd sh sn sx tj tw xj xz yn zj ",co:" com edu gov mil net nom org ",cr:" ac c co ed fi go or sa ",cy:" ac biz com ekloges gov ltd name net org parliament press pro tm ",do:" art com edu gob gov mil net org sld web ",dz:" art asso com edu gov net org pol ",ec:" com edu fin gov info med mil net org pro ",eg:" com edu eun gov mil name net org sci ",er:" com edu gov ind mil net org rochest w ",es:" com edu gob nom org ",et:" biz com edu gov info name net org ",fj:" ac biz com info mil name net org pro ",fk:" ac co gov net nom org ",fr:" asso com f gouv nom prd presse tm ",gg:" co net org ",gh:" com edu gov mil org ",gn:" ac com gov net org ",gr:" com edu gov mil net org ",gt:" com edu gob ind mil net org ",gu:" com edu gov net org ",hk:" com edu gov idv net org ",hu:" 2000 agrar bolt casino city co erotica erotika film forum games hotel info ingatlan jogasz konyvelo lakas media news org priv reklam sex shop sport suli szex tm tozsde utazas video ",id:" ac co go mil net or sch web ",il:" ac co gov idf k12 muni net org ",in:" ac co edu ernet firm gen gov i ind mil net nic org res ",iq:" com edu gov i mil net org ",ir:" ac co dnssec gov i id net org sch ",it:" edu gov ",je:" co net org ",jo:" com edu gov mil name net org sch ",jp:" ac ad co ed go gr lg ne or ",ke:" ac co go info me mobi ne or sc ",kh:" com edu gov mil net org per ",ki:" biz com de edu gov info mob net org tel ",km:" asso com coop edu gouv k medecin mil nom notaires pharmaciens presse tm veterinaire ",kn:" edu gov net org ",kr:" ac busan chungbuk chungnam co daegu daejeon es gangwon go gwangju gyeongbuk gyeonggi gyeongnam hs incheon jeju jeonbuk jeonnam k kg mil ms ne or pe re sc seoul ulsan ",kw:" com edu gov net org ",ky:" com edu gov net org ",kz:" com edu gov mil net org ",lb:" com edu gov net org ",lk:" assn com edu gov grp hotel int ltd net ngo org sch soc web ",lr:" com edu gov net org ",lv:" asn com conf edu gov id mil net org ",ly:" com edu gov id med net org plc sch ",ma:" ac co gov m net org press ",mc:" asso tm ",me:" ac co edu gov its net org priv ",mg:" com edu gov mil nom org prd tm ",mk:" com edu gov inf name net org pro ",ml:" com edu gov net org presse ",mn:" edu gov org ",mo:" com edu gov net org ",mt:" com edu gov net org ",mv:" aero biz com coop edu gov info int mil museum name net org pro ",mw:" ac co com coop edu gov int museum net org ",mx:" com edu gob net org ",my:" com edu gov mil name net org sch ",nf:" arts com firm info net other per rec store web ",ng:" biz com edu gov mil mobi name net org sch ",ni:" ac co com edu gob mil net nom org ",np:" com edu gov mil net org ",nr:" biz com edu gov info net org ",om:" ac biz co com edu gov med mil museum net org pro sch ",pe:" com edu gob mil net nom org sld ",ph:" com edu gov i mil net ngo org ",pk:" biz com edu fam gob gok gon gop gos gov net org web ",pl:" art bialystok biz com edu gda gdansk gorzow gov info katowice krakow lodz lublin mil net ngo olsztyn org poznan pwr radom slupsk szczecin torun warszawa waw wroc wroclaw zgora ",pr:" ac biz com edu est gov info isla name net org pro prof ",ps:" com edu gov net org plo sec ",pw:" belau co ed go ne or ",ro:" arts com firm info nom nt org rec store tm www ",rs:" ac co edu gov in org ",sb:" com edu gov net org ",sc:" com edu gov net org ",sh:" co com edu gov net nom org ",sl:" com edu gov net org ",st:" co com consulado edu embaixada gov mil net org principe saotome store ",sv:" com edu gob org red ",sz:" ac co org ",tr:" av bbs bel biz com dr edu gen gov info k12 name net org pol tel tsk tv web ",tt:" aero biz cat co com coop edu gov info int jobs mil mobi museum name net org pro tel travel ",tw:" club com ebiz edu game gov idv mil net org ",mu:" ac co com gov net or org ",mz:" ac co edu gov org ",na:" co com ",nz:" ac co cri geek gen govt health iwi maori mil net org parliament school ",pa:" abo ac com edu gob ing med net nom org sld ",pt:" com edu gov int net nome org publ ",py:" com edu gov mil net org ",qa:" com edu gov mil net org ",re:" asso com nom ",ru:" ac adygeya altai amur arkhangelsk astrakhan bashkiria belgorod bir bryansk buryatia cbg chel chelyabinsk chita chukotka chuvashia com dagestan e-burg edu gov grozny int irkutsk ivanovo izhevsk jar joshkar-ola kalmykia kaluga kamchatka karelia kazan kchr kemerovo khabarovsk khakassia khv kirov koenig komi kostroma kranoyarsk kuban kurgan kursk lipetsk magadan mari mari-el marine mil mordovia mosreg msk murmansk nalchik net nnov nov novosibirsk nsk omsk orenburg org oryol penza perm pp pskov ptz rnd ryazan sakhalin samara saratov simbirsk smolensk spb stavropol stv surgut tambov tatarstan tom tomsk tsaritsyn tsk tula tuva tver tyumen udm udmurtia ulan-ude vladikavkaz vladimir vladivostok volgograd vologda voronezh vrn vyatka yakutia yamal yekaterinburg yuzhno-sakhalinsk ",rw:" ac co com edu gouv gov int mil net ",sa:" com edu gov med net org pub sch ",sd:" com edu gov info med net org tv ",se:" a ac b bd c d e f g h i k l m n o org p parti pp press r s t tm u w x y z ",sg:" com edu gov idn net org per ",sn:" art com edu gouv org perso univ ",sy:" com edu gov mil net news org ",th:" ac co go in mi net or ",tj:" ac biz co com edu go gov info int mil name net nic org test web ",tn:" agrinet com defense edunet ens fin gov ind info intl mincom nat net org perso rnrt rns rnu tourism ",tz:" ac co go ne or ",ua:" biz cherkassy chernigov chernovtsy ck cn co com crimea cv dn dnepropetrovsk donetsk dp edu gov if in ivano-frankivsk kh kharkov kherson khmelnitskiy kiev kirovograd km kr ks kv lg lugansk lutsk lviv me mk net nikolaev od odessa org pl poltava pp rovno rv sebastopol sumy te ternopil uzhgorod vinnica vn zaporizhzhe zhitomir zp zt ",ug:" ac co go ne or org sc ",uk:" ac bl british-library co cym gov govt icnet jet lea ltd me mil mod national-library-scotland nel net nhs nic nls org orgn parliament plc police sch scot soc ",us:" dni fed isa kids nsn ",uy:" com edu gub mil net org ",ve:" co com edu gob info mil net org web ",vi:" co com k12 net org ",vn:" ac biz com edu gov health info int name net org pro ",ye:" co com gov ltd me net org plc ",yu:" ac co edu gov org ",za:" ac agric alt bourse city co cybernet db edu gov grondar iaccess imt inca landesign law mil net ngo nis nom olivetti org pix school tm web ",zm:" ac co com edu gov net org sch ",com:"ar br cn de eu gb gr hu jpn kr no qc ru sa se uk us uy za ",net:"gb jp se uk ",org:"ae",de:"com "},has:function(e){var t=e.lastIndexOf(".");if(t<=0||t>=e.length-1)return!1;var r=e.lastIndexOf(".",t-1);if(r<=0||r>=t-1)return!1;var i=n.list[e.slice(t+1)];return!!i&&i.indexOf(" "+e.slice(r+1,t)+" ")>=0},is:function(e){var t=e.lastIndexOf(".");if(t<=0||t>=e.length-1)return!1;if(e.lastIndexOf(".",t-1)>=0)return!1;var r=n.list[e.slice(t+1)];return!!r&&r.indexOf(" "+e.slice(0,t)+" ")>=0},get:function(e){var t=e.lastIndexOf(".");if(t<=0||t>=e.length-1)return null;var r=e.lastIndexOf(".",t-1);if(r<=0||r>=t-1)return null;var i=n.list[e.slice(t+1)];return i?i.indexOf(" "+e.slice(r+1,t)+" ")<0?null:e.slice(r+1):null},noConflict:function(){return e.SecondLevelDomains===this&&(e.SecondLevelDomains=t),this}};return n}))},988:function(e,t,n){var r,i,s;!function(o,a){"use strict";e.exports?e.exports=a(n(562),n(939),n(338)):(i=[n(562),n(939),n(338)],void 0===(s="function"==typeof(r=a)?r.apply(t,i):r)||(e.exports=s))}(0,(function(e,t,n,r){"use strict";var i=r&&r.URI;function s(e,t){var n=arguments.length>=1;if(!(this instanceof s))return n?arguments.length>=2?new s(e,t):new s(e):new s;if(void 0===e){if(n)throw new TypeError("undefined is not a valid argument for URI");e="undefined"!=typeof location?location.href+"":""}if(null===e&&n)throw new TypeError("null is not a valid argument for URI");return this.href(e),void 0!==t?this.absoluteTo(t):this}s.version="1.19.11";var o=s.prototype,a=Object.prototype.hasOwnProperty;function c(e){return e.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function u(e){return void 0===e?"Undefined":String(Object.prototype.toString.call(e)).slice(8,-1)}function d(e){return"Array"===u(e)}function l(e,t){var n,r,i={};if("RegExp"===u(t))i=null;else if(d(t))for(n=0,r=t.length;n<r;n++)i[t[n]]=!0;else i[t]=!0;for(n=0,r=e.length;n<r;n++){(i&&void 0!==i[e[n]]||!i&&t.test(e[n]))&&(e.splice(n,1),r--,n--)}return e}function h(e,t){var n,r;if(d(t)){for(n=0,r=t.length;n<r;n++)if(!h(e,t[n]))return!1;return!0}var i=u(t);for(n=0,r=e.length;n<r;n++)if("RegExp"===i){if("string"==typeof e[n]&&e[n].match(t))return!0}else if(e[n]===t)return!0;return!1}function f(e,t){if(!d(e)||!d(t))return!1;if(e.length!==t.length)return!1;e.sort(),t.sort();for(var n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0}function g(e){return e.replace(/^\/+|\/+$/g,"")}function p(e){return escape(e)}function m(e){return encodeURIComponent(e).replace(/[!'()*]/g,p).replace(/\*/g,"%2A")}s._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,preventInvalidHostname:s.preventInvalidHostname,duplicateQueryParameters:s.duplicateQueryParameters,escapeQuerySpace:s.escapeQuerySpace}},s.preventInvalidHostname=!1,s.duplicateQueryParameters=!1,s.escapeQuerySpace=!0,s.protocol_expression=/^[a-z][a-z0-9.+-]*$/i,s.idn_expression=/[^a-z0-9\._-]/i,s.punycode_expression=/(xn--)/i,s.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,s.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,s.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?]))/gi,s.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?]+$/,parens:/(\([^\)]*\)|\[[^\]]*\]|\{[^}]*\}|<[^>]*>)/g},s.leading_whitespace_expression=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,s.ascii_tab_whitespace=/[\u0009\u000A\u000D]+/g,s.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"},s.hostProtocols=["http","https"],s.invalid_hostname_characters=/[^a-zA-Z0-9\.\-:_]/,s.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src",audio:"src",video:"src"},s.getDomAttribute=function(e){if(e&&e.nodeName){var t=e.nodeName.toLowerCase();if("input"!==t||"image"===e.type)return s.domAttributes[t]}},s.encode=m,s.decode=decodeURIComponent,s.iso8859=function(){s.encode=escape,s.decode=unescape},s.unicode=function(){s.encode=m,s.decode=decodeURIComponent},s.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/gi,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/gi,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}},urnpath:{encode:{expression:/%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/gi,map:{"%21":"!","%24":"$","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"=","%40":"@"}},decode:{expression:/[\/\?#:]/g,map:{"/":"%2F","?":"%3F","#":"%23",":":"%3A"}}}},s.encodeQuery=function(e,t){var n=s.encode(e+"");return void 0===t&&(t=s.escapeQuerySpace),t?n.replace(/%20/g,"+"):n},s.decodeQuery=function(e,t){e+="",void 0===t&&(t=s.escapeQuerySpace);try{return s.decode(t?e.replace(/\+/g,"%20"):e)}catch(t){return e}};var v,_={encode:"encode",decode:"decode"},y=function(e,t){return function(n){try{return s[t](n+"").replace(s.characters[e][t].expression,(function(n){return s.characters[e][t].map[n]}))}catch(e){return n}}};for(v in _)s[v+"PathSegment"]=y("pathname",_[v]),s[v+"UrnPathSegment"]=y("urnpath",_[v]);var b=function(e,t,n){return function(r){var i;i=n?function(e){return s[t](s[n](e))}:s[t];for(var o=(r+"").split(e),a=0,c=o.length;a<c;a++)o[a]=i(o[a]);return o.join(e)}};function w(e){return function(t,n){return void 0===t?this._parts[e]||"":(this._parts[e]=t||null,this.build(!n),this)}}function S(e,t){return function(n,r){return void 0===n?this._parts[e]||"":(null!==n&&(n+="").charAt(0)===t&&(n=n.substring(1)),this._parts[e]=n,this.build(!r),this)}}s.decodePath=b("/","decodePathSegment"),s.decodeUrnPath=b(":","decodeUrnPathSegment"),s.recodePath=b("/","encodePathSegment","decode"),s.recodeUrnPath=b(":","encodeUrnPathSegment","decode"),s.encodeReserved=y("reserved","encode"),s.parse=function(e,t){var n;return t||(t={preventInvalidHostname:s.preventInvalidHostname}),(n=(e=(e=e.replace(s.leading_whitespace_expression,"")).replace(s.ascii_tab_whitespace,"")).indexOf("#"))>-1&&(t.fragment=e.substring(n+1)||null,e=e.substring(0,n)),(n=e.indexOf("?"))>-1&&(t.query=e.substring(n+1)||null,e=e.substring(0,n)),"//"===(e=(e=e.replace(/^(https?|ftp|wss?)?:+[/\\]*/i,"$1://")).replace(/^[/\\]{2,}/i,"//")).substring(0,2)?(t.protocol=null,e=e.substring(2),e=s.parseAuthority(e,t)):(n=e.indexOf(":"))>-1&&(t.protocol=e.substring(0,n)||null,t.protocol&&!t.protocol.match(s.protocol_expression)?t.protocol=void 0:"//"===e.substring(n+1,n+3).replace(/\\/g,"/")?(e=e.substring(n+3),e=s.parseAuthority(e,t)):(e=e.substring(n+1),t.urn=!0)),t.path=e,t},s.parseHost=function(e,t){e||(e="");var n,r,i=(e=e.replace(/\\/g,"/")).indexOf("/");if(-1===i&&(i=e.length),"["===e.charAt(0))n=e.indexOf("]"),t.hostname=e.substring(1,n)||null,t.port=e.substring(n+2,i)||null,"/"===t.port&&(t.port=null);else{var o=e.indexOf(":"),a=e.indexOf("/"),c=e.indexOf(":",o+1);-1!==c&&(-1===a||c<a)?(t.hostname=e.substring(0,i)||null,t.port=null):(r=e.substring(0,i).split(":"),t.hostname=r[0]||null,t.port=r[1]||null)}return t.hostname&&"/"!==e.substring(i).charAt(0)&&(i++,e="/"+e),t.preventInvalidHostname&&s.ensureValidHostname(t.hostname,t.protocol),t.port&&s.ensureValidPort(t.port),e.substring(i)||"/"},s.parseAuthority=function(e,t){return e=s.parseUserinfo(e,t),s.parseHost(e,t)},s.parseUserinfo=function(e,t){var n=e;-1!==e.indexOf("\\")&&(e=e.replace(/\\/g,"/"));var r,i=e.indexOf("/"),o=e.lastIndexOf("@",i>-1?i:e.length-1);return o>-1&&(-1===i||o<i)?(r=e.substring(0,o).split(":"),t.username=r[0]?s.decode(r[0]):null,r.shift(),t.password=r[0]?s.decode(r.join(":")):null,e=n.substring(o+1)):(t.username=null,t.password=null),e},s.parseQuery=function(e,t){if(!e)return{};if(!(e=e.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,"")))return{};for(var n,r,i,o={},c=e.split("&"),u=c.length,d=0;d<u;d++)n=c[d].split("="),r=s.decodeQuery(n.shift(),t),i=n.length?s.decodeQuery(n.join("="),t):null,"__proto__"!==r&&(a.call(o,r)?("string"!=typeof o[r]&&null!==o[r]||(o[r]=[o[r]]),o[r].push(i)):o[r]=i);return o},s.build=function(e){var t="",n=!1;return e.protocol&&(t+=e.protocol+":"),e.urn||!t&&!e.hostname||(t+="//",n=!0),t+=s.buildAuthority(e)||"","string"==typeof e.path&&("/"!==e.path.charAt(0)&&n&&(t+="/"),t+=e.path),"string"==typeof e.query&&e.query&&(t+="?"+e.query),"string"==typeof e.fragment&&e.fragment&&(t+="#"+e.fragment),t},s.buildHost=function(e){var t="";return e.hostname?(s.ip6_expression.test(e.hostname)?t+="["+e.hostname+"]":t+=e.hostname,e.port&&(t+=":"+e.port),t):""},s.buildAuthority=function(e){return s.buildUserinfo(e)+s.buildHost(e)},s.buildUserinfo=function(e){var t="";return e.username&&(t+=s.encode(e.username)),e.password&&(t+=":"+s.encode(e.password)),t&&(t+="@"),t},s.buildQuery=function(e,t,n){var r,i,o,c,u="";for(i in e)if("__proto__"!==i&&a.call(e,i))if(d(e[i]))for(r={},o=0,c=e[i].length;o<c;o++)void 0!==e[i][o]&&void 0===r[e[i][o]+""]&&(u+="&"+s.buildQueryParameter(i,e[i][o],n),!0!==t&&(r[e[i][o]+""]=!0));else void 0!==e[i]&&(u+="&"+s.buildQueryParameter(i,e[i],n));return u.substring(1)},s.buildQueryParameter=function(e,t,n){return s.encodeQuery(e,n)+(null!==t?"="+s.encodeQuery(t,n):"")},s.addQuery=function(e,t,n){if("object"==typeof t)for(var r in t)a.call(t,r)&&s.addQuery(e,r,t[r]);else{if("string"!=typeof t)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");if(void 0===e[t])return void(e[t]=n);"string"==typeof e[t]&&(e[t]=[e[t]]),d(n)||(n=[n]),e[t]=(e[t]||[]).concat(n)}},s.setQuery=function(e,t,n){if("object"==typeof t)for(var r in t)a.call(t,r)&&s.setQuery(e,r,t[r]);else{if("string"!=typeof t)throw new TypeError("URI.setQuery() accepts an object, string as the name parameter");e[t]=void 0===n?null:n}},s.removeQuery=function(e,t,n){var r,i,o;if(d(t))for(r=0,i=t.length;r<i;r++)e[t[r]]=void 0;else if("RegExp"===u(t))for(o in e)t.test(o)&&(e[o]=void 0);else if("object"==typeof t)for(o in t)a.call(t,o)&&s.removeQuery(e,o,t[o]);else{if("string"!=typeof t)throw new TypeError("URI.removeQuery() accepts an object, string, RegExp as the first parameter");void 0!==n?"RegExp"===u(n)?!d(e[t])&&n.test(e[t])?e[t]=void 0:e[t]=l(e[t],n):e[t]!==String(n)||d(n)&&1!==n.length?d(e[t])&&(e[t]=l(e[t],n)):e[t]=void 0:e[t]=void 0}},s.hasQuery=function(e,t,n,r){switch(u(t)){case"String":break;case"RegExp":for(var i in e)if(a.call(e,i)&&t.test(i)&&(void 0===n||s.hasQuery(e,i,n)))return!0;return!1;case"Object":for(var o in t)if(a.call(t,o)&&!s.hasQuery(e,o,t[o]))return!1;return!0;default:throw new TypeError("URI.hasQuery() accepts a string, regular expression or object as the name parameter")}switch(u(n)){case"Undefined":return t in e;case"Boolean":return n===Boolean(d(e[t])?e[t].length:e[t]);case"Function":return!!n(e[t],t,e);case"Array":return!!d(e[t])&&(r?h:f)(e[t],n);case"RegExp":return d(e[t])?!!r&&h(e[t],n):Boolean(e[t]&&e[t].match(n));case"Number":n=String(n);case"String":return d(e[t])?!!r&&h(e[t],n):e[t]===n;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}},s.joinPaths=function(){for(var e=[],t=[],n=0,r=0;r<arguments.length;r++){var i=new s(arguments[r]);e.push(i);for(var o=i.segment(),a=0;a<o.length;a++)"string"==typeof o[a]&&t.push(o[a]),o[a]&&n++}if(!t.length||!n)return new s("");var c=new s("").segment(t);return""!==e[0].path()&&"/"!==e[0].path().slice(0,1)||c.path("/"+c.path()),c.normalize()},s.commonPath=function(e,t){var n,r=Math.min(e.length,t.length);for(n=0;n<r;n++)if(e.charAt(n)!==t.charAt(n)){n--;break}return n<1?e.charAt(0)===t.charAt(0)&&"/"===e.charAt(0)?"/":"":("/"===e.charAt(n)&&"/"===t.charAt(n)||(n=e.substring(0,n).lastIndexOf("/")),e.substring(0,n+1))},s.withinString=function(e,t,n){n||(n={});var r=n.start||s.findUri.start,i=n.end||s.findUri.end,o=n.trim||s.findUri.trim,a=n.parens||s.findUri.parens,c=/[a-z0-9-]=["']?$/i;for(r.lastIndex=0;;){var u=r.exec(e);if(!u)break;var d=u.index;if(n.ignoreHtml){var l=e.slice(Math.max(d-3,0),d);if(l&&c.test(l))continue}for(var h=d+e.slice(d).search(i),f=e.slice(d,h),g=-1;;){var p=a.exec(f);if(!p)break;var m=p.index+p[0].length;g=Math.max(g,m)}if(!((f=g>-1?f.slice(0,g)+f.slice(g).replace(o,""):f.replace(o,"")).length<=u[0].length||n.ignore&&n.ignore.test(f))){var v=t(f,d,h=d+f.length,e);void 0!==v?(v=String(v),e=e.slice(0,d)+v+e.slice(h),r.lastIndex=d+v.length):r.lastIndex=h}}return r.lastIndex=0,e},s.ensureValidHostname=function(t,n){var r=!!t,i=!1;if(!!n&&(i=h(s.hostProtocols,n)),i&&!r)throw new TypeError("Hostname cannot be empty, if protocol is "+n);if(t&&t.match(s.invalid_hostname_characters)){if(!e)throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-:_] and Punycode.js is not available');if(e.toASCII(t).match(s.invalid_hostname_characters))throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-:_]')}},s.ensureValidPort=function(e){if(e){var t=Number(e);if(!(/^[0-9]+$/.test(t)&&t>0&&t<65536))throw new TypeError('Port "'+e+'" is not a valid port')}},s.noConflict=function(e){if(e){var t={URI:this.noConflict()};return r.URITemplate&&"function"==typeof r.URITemplate.noConflict&&(t.URITemplate=r.URITemplate.noConflict()),r.IPv6&&"function"==typeof r.IPv6.noConflict&&(t.IPv6=r.IPv6.noConflict()),r.SecondLevelDomains&&"function"==typeof r.SecondLevelDomains.noConflict&&(t.SecondLevelDomains=r.SecondLevelDomains.noConflict()),t}return r.URI===this&&(r.URI=i),this},o.build=function(e){return!0===e?this._deferred_build=!0:(void 0===e||this._deferred_build)&&(this._string=s.build(this._parts),this._deferred_build=!1),this},o.clone=function(){return new s(this)},o.valueOf=o.toString=function(){return this.build(!1)._string},o.protocol=w("protocol"),o.username=w("username"),o.password=w("password"),o.hostname=w("hostname"),o.port=w("port"),o.query=S("query","?"),o.fragment=S("fragment","#"),o.search=function(e,t){var n=this.query(e,t);return"string"==typeof n&&n.length?"?"+n:n},o.hash=function(e,t){var n=this.fragment(e,t);return"string"==typeof n&&n.length?"#"+n:n},o.pathname=function(e,t){if(void 0===e||!0===e){var n=this._parts.path||(this._parts.hostname?"/":"");return e?(this._parts.urn?s.decodeUrnPath:s.decodePath)(n):n}return this._parts.urn?this._parts.path=e?s.recodeUrnPath(e):"":this._parts.path=e?s.recodePath(e):"/",this.build(!t),this},o.path=o.pathname,o.href=function(e,t){var n;if(void 0===e)return this.toString();this._string="",this._parts=s._parts();var r=e instanceof s,i="object"==typeof e&&(e.hostname||e.path||e.pathname);e.nodeName&&(e=e[s.getDomAttribute(e)]||"",i=!1);if(!r&&i&&void 0!==e.pathname&&(e=e.toString()),"string"==typeof e||e instanceof String)this._parts=s.parse(String(e),this._parts);else{if(!r&&!i)throw new TypeError("invalid input");var o=r?e._parts:e;for(n in o)"query"!==n&&a.call(this._parts,n)&&(this._parts[n]=o[n]);o.query&&this.query(o.query,!1)}return this.build(!t),this},o.is=function(e){var t=!1,r=!1,i=!1,o=!1,a=!1,c=!1,u=!1,d=!this._parts.urn;switch(this._parts.hostname&&(d=!1,r=s.ip4_expression.test(this._parts.hostname),i=s.ip6_expression.test(this._parts.hostname),a=(o=!(t=r||i))&&n&&n.has(this._parts.hostname),c=o&&s.idn_expression.test(this._parts.hostname),u=o&&s.punycode_expression.test(this._parts.hostname)),e.toLowerCase()){case"relative":return d;case"absolute":return!d;case"domain":case"name":return o;case"sld":return a;case"ip":return t;case"ip4":case"ipv4":case"inet4":return r;case"ip6":case"ipv6":case"inet6":return i;case"idn":return c;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return u}return null};var A=o.protocol,E=o.port,x=o.hostname;o.protocol=function(e,t){if(e&&!(e=e.replace(/:(\/\/)?$/,"")).match(s.protocol_expression))throw new TypeError('Protocol "'+e+"\" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]");return A.call(this,e,t)},o.scheme=o.protocol,o.port=function(e,t){return this._parts.urn?void 0===e?"":this:(void 0!==e&&(0===e&&(e=null),e&&(":"===(e+="").charAt(0)&&(e=e.substring(1)),s.ensureValidPort(e))),E.call(this,e,t))},o.hostname=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0!==e){var n={preventInvalidHostname:this._parts.preventInvalidHostname};if("/"!==s.parseHost(e,n))throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-]');e=n.hostname,this._parts.preventInvalidHostname&&s.ensureValidHostname(e,this._parts.protocol)}return x.call(this,e,t)},o.origin=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e){var n=this.protocol();return this.authority()?(n?n+"://":"")+this.authority():""}var r=s(e);return this.protocol(r.protocol()).authority(r.authority()).build(!t),this},o.host=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e)return this._parts.hostname?s.buildHost(this._parts):"";if("/"!==s.parseHost(e,this._parts))throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-]');return this.build(!t),this},o.authority=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e)return this._parts.hostname?s.buildAuthority(this._parts):"";if("/"!==s.parseAuthority(e,this._parts))throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-]');return this.build(!t),this},o.userinfo=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e){var n=s.buildUserinfo(this._parts);return n?n.substring(0,n.length-1):n}return"@"!==e[e.length-1]&&(e+="@"),s.parseUserinfo(e,this._parts),this.build(!t),this},o.resource=function(e,t){var n;return void 0===e?this.path()+this.search()+this.hash():(n=s.parse(e),this._parts.path=n.path,this._parts.query=n.query,this._parts.fragment=n.fragment,this.build(!t),this)},o.subdomain=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e){if(!this._parts.hostname||this.is("IP"))return"";var n=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,n)||""}var r=this._parts.hostname.length-this.domain().length,i=this._parts.hostname.substring(0,r),o=new RegExp("^"+c(i));if(e&&"."!==e.charAt(e.length-1)&&(e+="."),-1!==e.indexOf(":"))throw new TypeError("Domains cannot contain colons");return e&&s.ensureValidHostname(e,this._parts.protocol),this._parts.hostname=this._parts.hostname.replace(o,e),this.build(!t),this},o.domain=function(e,t){if(this._parts.urn)return void 0===e?"":this;if("boolean"==typeof e&&(t=e,e=void 0),void 0===e){if(!this._parts.hostname||this.is("IP"))return"";var n=this._parts.hostname.match(/\./g);if(n&&n.length<2)return this._parts.hostname;var r=this._parts.hostname.length-this.tld(t).length-1;return r=this._parts.hostname.lastIndexOf(".",r-1)+1,this._parts.hostname.substring(r)||""}if(!e)throw new TypeError("cannot set domain empty");if(-1!==e.indexOf(":"))throw new TypeError("Domains cannot contain colons");if(s.ensureValidHostname(e,this._parts.protocol),!this._parts.hostname||this.is("IP"))this._parts.hostname=e;else{var i=new RegExp(c(this.domain())+"$");this._parts.hostname=this._parts.hostname.replace(i,e)}return this.build(!t),this},o.tld=function(e,t){if(this._parts.urn)return void 0===e?"":this;if("boolean"==typeof e&&(t=e,e=void 0),void 0===e){if(!this._parts.hostname||this.is("IP"))return"";var r=this._parts.hostname.lastIndexOf("."),i=this._parts.hostname.substring(r+1);return!0!==t&&n&&n.list[i.toLowerCase()]&&n.get(this._parts.hostname)||i}var s;if(!e)throw new TypeError("cannot set TLD empty");if(e.match(/[^a-zA-Z0-9-]/)){if(!n||!n.is(e))throw new TypeError('TLD "'+e+'" contains characters other than [A-Z0-9]');s=new RegExp(c(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(s,e)}else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");s=new RegExp(c(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(s,e)}return this.build(!t),this},o.directory=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e||!0===e){if(!this._parts.path&&!this._parts.hostname)return"";if("/"===this._parts.path)return"/";var n=this._parts.path.length-this.filename().length-1,r=this._parts.path.substring(0,n)||(this._parts.hostname?"/":"");return e?s.decodePath(r):r}var i=this._parts.path.length-this.filename().length,o=this._parts.path.substring(0,i),a=new RegExp("^"+c(o));return this.is("relative")||(e||(e="/"),"/"!==e.charAt(0)&&(e="/"+e)),e&&"/"!==e.charAt(e.length-1)&&(e+="/"),e=s.recodePath(e),this._parts.path=this._parts.path.replace(a,e),this.build(!t),this},o.filename=function(e,t){if(this._parts.urn)return void 0===e?"":this;if("string"!=typeof e){if(!this._parts.path||"/"===this._parts.path)return"";var n=this._parts.path.lastIndexOf("/"),r=this._parts.path.substring(n+1);return e?s.decodePathSegment(r):r}var i=!1;"/"===e.charAt(0)&&(e=e.substring(1)),e.match(/\.?\//)&&(i=!0);var o=new RegExp(c(this.filename())+"$");return e=s.recodePath(e),this._parts.path=this._parts.path.replace(o,e),i?this.normalizePath(t):this.build(!t),this},o.suffix=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e||!0===e){if(!this._parts.path||"/"===this._parts.path)return"";var n,r,i=this.filename(),o=i.lastIndexOf(".");return-1===o?"":(n=i.substring(o+1),r=/^[a-z0-9%]+$/i.test(n)?n:"",e?s.decodePathSegment(r):r)}"."===e.charAt(0)&&(e=e.substring(1));var a,u=this.suffix();if(u)a=e?new RegExp(c(u)+"$"):new RegExp(c("."+u)+"$");else{if(!e)return this;this._parts.path+="."+s.recodePath(e)}return a&&(e=s.recodePath(e),this._parts.path=this._parts.path.replace(a,e)),this.build(!t),this},o.segment=function(e,t,n){var r=this._parts.urn?":":"/",i=this.path(),s="/"===i.substring(0,1),o=i.split(r);if(void 0!==e&&"number"!=typeof e&&(n=t,t=e,e=void 0),void 0!==e&&"number"!=typeof e)throw new Error('Bad segment "'+e+'", must be 0-based integer');if(s&&o.shift(),e<0&&(e=Math.max(o.length+e,0)),void 0===t)return void 0===e?o:o[e];if(null===e||void 0===o[e])if(d(t)){o=[];for(var a=0,c=t.length;a<c;a++)(t[a].length||o.length&&o[o.length-1].length)&&(o.length&&!o[o.length-1].length&&o.pop(),o.push(g(t[a])))}else(t||"string"==typeof t)&&(t=g(t),""===o[o.length-1]?o[o.length-1]=t:o.push(t));else t?o[e]=g(t):o.splice(e,1);return s&&o.unshift(""),this.path(o.join(r),n)},o.segmentCoded=function(e,t,n){var r,i,o;if("number"!=typeof e&&(n=t,t=e,e=void 0),void 0===t){if(d(r=this.segment(e,t,n)))for(i=0,o=r.length;i<o;i++)r[i]=s.decode(r[i]);else r=void 0!==r?s.decode(r):void 0;return r}if(d(t))for(i=0,o=t.length;i<o;i++)t[i]=s.encode(t[i]);else t="string"==typeof t||t instanceof String?s.encode(t):t;return this.segment(e,t,n)};var N=o.query;return o.query=function(e,t){if(!0===e)return s.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("function"==typeof e){var n=s.parseQuery(this._parts.query,this._parts.escapeQuerySpace),r=e.call(this,n);return this._parts.query=s.buildQuery(r||n,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!t),this}return void 0!==e&&"string"!=typeof e?(this._parts.query=s.buildQuery(e,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!t),this):N.call(this,e,t)},o.setQuery=function(e,t,n){var r=s.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("string"==typeof e||e instanceof String)r[e]=void 0!==t?t:null;else{if("object"!=typeof e)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");for(var i in e)a.call(e,i)&&(r[i]=e[i])}return this._parts.query=s.buildQuery(r,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof e&&(n=t),this.build(!n),this},o.addQuery=function(e,t,n){var r=s.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return s.addQuery(r,e,void 0===t?null:t),this._parts.query=s.buildQuery(r,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof e&&(n=t),this.build(!n),this},o.removeQuery=function(e,t,n){var r=s.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return s.removeQuery(r,e,t),this._parts.query=s.buildQuery(r,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof e&&(n=t),this.build(!n),this},o.hasQuery=function(e,t,n){var r=s.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return s.hasQuery(r,e,t,n)},o.setSearch=o.setQuery,o.addSearch=o.addQuery,o.removeSearch=o.removeQuery,o.hasSearch=o.hasQuery,o.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},o.normalizeProtocol=function(e){return"string"==typeof this._parts.protocol&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!e)),this},o.normalizeHostname=function(n){return this._parts.hostname&&(this.is("IDN")&&e?this._parts.hostname=e.toASCII(this._parts.hostname):this.is("IPv6")&&t&&(this._parts.hostname=t.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!n)),this},o.normalizePort=function(e){return"string"==typeof this._parts.protocol&&this._parts.port===s.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!e)),this},o.normalizePath=function(e){var t,n=this._parts.path;if(!n)return this;if(this._parts.urn)return this._parts.path=s.recodeUrnPath(this._parts.path),this.build(!e),this;if("/"===this._parts.path)return this;var r,i,o="";for("/"!==(n=s.recodePath(n)).charAt(0)&&(t=!0,n="/"+n),"/.."!==n.slice(-3)&&"/."!==n.slice(-2)||(n+="/"),n=n.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/"),t&&(o=n.substring(1).match(/^(\.\.\/)+/)||"")&&(o=o[0]);-1!==(r=n.search(/\/\.\.(\/|$)/));)0!==r?(-1===(i=n.substring(0,r).lastIndexOf("/"))&&(i=r),n=n.substring(0,i)+n.substring(r+3)):n=n.substring(3);return t&&this.is("relative")&&(n=o+n.substring(1)),this._parts.path=n,this.build(!e),this},o.normalizePathname=o.normalizePath,o.normalizeQuery=function(e){return"string"==typeof this._parts.query&&(this._parts.query.length?this.query(s.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!e)),this},o.normalizeFragment=function(e){return this._parts.fragment||(this._parts.fragment=null,this.build(!e)),this},o.normalizeSearch=o.normalizeQuery,o.normalizeHash=o.normalizeFragment,o.iso8859=function(){var e=s.encode,t=s.decode;s.encode=escape,s.decode=decodeURIComponent;try{this.normalize()}finally{s.encode=e,s.decode=t}return this},o.unicode=function(){var e=s.encode,t=s.decode;s.encode=m,s.decode=unescape;try{this.normalize()}finally{s.encode=e,s.decode=t}return this},o.readable=function(){var t=this.clone();t.username("").password("").normalize();var n="";if(t._parts.protocol&&(n+=t._parts.protocol+"://"),t._parts.hostname&&(t.is("punycode")&&e?(n+=e.toUnicode(t._parts.hostname),t._parts.port&&(n+=":"+t._parts.port)):n+=t.host()),t._parts.hostname&&t._parts.path&&"/"!==t._parts.path.charAt(0)&&(n+="/"),n+=t.path(!0),t._parts.query){for(var r="",i=0,o=t._parts.query.split("&"),a=o.length;i<a;i++){var c=(o[i]||"").split("=");r+="&"+s.decodeQuery(c[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"),void 0!==c[1]&&(r+="="+s.decodeQuery(c[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"))}n+="?"+r.substring(1)}return n+=s.decodeQuery(t.hash(),!0)},o.absoluteTo=function(e){var t,n,r,i=this.clone(),o=["protocol","username","password","hostname","port"];if(this._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(e instanceof s||(e=new s(e)),i._parts.protocol)return i;if(i._parts.protocol=e._parts.protocol,this._parts.hostname)return i;for(n=0;r=o[n];n++)i._parts[r]=e._parts[r];return i._parts.path?(".."===i._parts.path.substring(-2)&&(i._parts.path+="/"),"/"!==i.path().charAt(0)&&(t=(t=e.directory())||(0===e.path().indexOf("/")?"/":""),i._parts.path=(t?t+"/":"")+i._parts.path,i.normalizePath())):(i._parts.path=e._parts.path,i._parts.query||(i._parts.query=e._parts.query)),i.build(),i},o.relativeTo=function(e){var t,n,r,i,o,a=this.clone().normalize();if(a._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(e=new s(e).normalize(),t=a._parts,n=e._parts,i=a.path(),o=e.path(),"/"!==i.charAt(0))throw new Error("URI is already relative");if("/"!==o.charAt(0))throw new Error("Cannot calculate a URI relative to another relative URI");if(t.protocol===n.protocol&&(t.protocol=null),t.username!==n.username||t.password!==n.password)return a.build();if(null!==t.protocol||null!==t.username||null!==t.password)return a.build();if(t.hostname!==n.hostname||t.port!==n.port)return a.build();if(t.hostname=null,t.port=null,i===o)return t.path="",a.build();if(!(r=s.commonPath(i,o)))return a.build();var c=n.path.substring(r.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../");return t.path=c+t.path.substring(r.length)||"./",a.build()},o.equals=function(e){var t,n,r,i,o,c=this.clone(),u=new s(e),l={};if(c.normalize(),u.normalize(),c.toString()===u.toString())return!0;if(r=c.query(),i=u.query(),c.query(""),u.query(""),c.toString()!==u.toString())return!1;if(r.length!==i.length)return!1;for(o in t=s.parseQuery(r,this._parts.escapeQuerySpace),n=s.parseQuery(i,this._parts.escapeQuerySpace),t)if(a.call(t,o)){if(d(t[o])){if(!f(t[o],n[o]))return!1}else if(t[o]!==n[o])return!1;l[o]=!0}for(o in n)if(a.call(n,o)&&!l[o])return!1;return!0},o.preventInvalidHostname=function(e){return this._parts.preventInvalidHostname=!!e,this},o.duplicateQueryParameters=function(e){return this._parts.duplicateQueryParameters=!!e,this},o.escapeQuerySpace=function(e){return this._parts.escapeQuerySpace=!!e,this},s}))},562:function(e,t,n){var r;e=n.nmd(e),function(i){t&&t.nodeType,e&&e.nodeType;var s="object"==typeof n.g&&n.g;s.global!==s&&s.window!==s&&s.self;var o,a=2147483647,c=36,u=1,d=26,l=38,h=700,f=72,g=128,p="-",m=/^xn--/,v=/[^\x20-\x7E]/,_=/[\x2E\u3002\uFF0E\uFF61]/g,y={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},b=c-u,w=Math.floor,S=String.fromCharCode;function A(e){throw new RangeError(y[e])}function E(e,t){for(var n=e.length,r=[];n--;)r[n]=t(e[n]);return r}function x(e,t){var n=e.split("@"),r="";return n.length>1&&(r=n[0]+"@",e=n[1]),r+E((e=e.replace(_,".")).split("."),t).join(".")}function N(e){for(var t,n,r=[],i=0,s=e.length;i<s;)(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<s?56320==(64512&(n=e.charCodeAt(i++)))?r.push(((1023&t)<<10)+(1023&n)+65536):(r.push(t),i--):r.push(t);return r}function I(e){return E(e,(function(e){var t="";return e>65535&&(t+=S((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=S(e)})).join("")}function C(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function T(e,t,n){var r=0;for(e=n?w(e/h):e>>1,e+=w(e/t);e>b*d>>1;r+=c)e=w(e/b);return w(r+(b+1)*e/(e+l))}function O(e){var t,n,r,i,s,o,l,h,m,v,_,y=[],b=e.length,S=0,E=g,x=f;for((n=e.lastIndexOf(p))<0&&(n=0),r=0;r<n;++r)e.charCodeAt(r)>=128&&A("not-basic"),y.push(e.charCodeAt(r));for(i=n>0?n+1:0;i<b;){for(s=S,o=1,l=c;i>=b&&A("invalid-input"),((h=(_=e.charCodeAt(i++))-48<10?_-22:_-65<26?_-65:_-97<26?_-97:c)>=c||h>w((a-S)/o))&&A("overflow"),S+=h*o,!(h<(m=l<=x?u:l>=x+d?d:l-x));l+=c)o>w(a/(v=c-m))&&A("overflow"),o*=v;x=T(S-s,t=y.length+1,0==s),w(S/t)>a-E&&A("overflow"),E+=w(S/t),S%=t,y.splice(S++,0,E)}return I(y)}function j(e){var t,n,r,i,s,o,l,h,m,v,_,y,b,E,x,I=[];for(y=(e=N(e)).length,t=g,n=0,s=f,o=0;o<y;++o)(_=e[o])<128&&I.push(S(_));for(r=i=I.length,i&&I.push(p);r<y;){for(l=a,o=0;o<y;++o)(_=e[o])>=t&&_<l&&(l=_);for(l-t>w((a-n)/(b=r+1))&&A("overflow"),n+=(l-t)*b,t=l,o=0;o<y;++o)if((_=e[o])<t&&++n>a&&A("overflow"),_==t){for(h=n,m=c;!(h<(v=m<=s?u:m>=s+d?d:m-s));m+=c)x=h-v,E=c-v,I.push(S(C(v+x%E,0))),h=w(x/E);I.push(S(C(h,0))),s=T(n,b,r==i),n=0,++r}++n,++t}return I.join("")}o={version:"1.3.2",ucs2:{decode:N,encode:I},decode:O,encode:j,toASCII:function(e){return x(e,(function(e){return v.test(e)?"xn--"+j(e):e}))},toUnicode:function(e){return x(e,(function(e){return m.test(e)?O(e.slice(4).toLowerCase()):e}))}},void 0===(r=function(){return o}.call(t,n,t,e))||(e.exports=r)}()},563:e=>{function t(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}e.exports=function(e){return function(){var n=this,r=arguments;return new Promise((function(i,s){var o=e.apply(n,r);function a(e){t(o,i,s,a,c,"next",e)}function c(e){t(o,i,s,a,c,"throw",e)}a(void 0)}))}},e.exports.__esModule=!0,e.exports.default=e.exports},514:(e,t,n)=>{var r=n(616);e.exports=function(e,t,n){return(t=r(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},e.exports.__esModule=!0,e.exports.default=e.exports},135:e=>{e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.__esModule=!0,e.exports.default=e.exports},518:(e,t,n)=>{var r=n(435).default;function i(){"use strict";e.exports=i=function(){return t},e.exports.__esModule=!0,e.exports.default=e.exports;var t={},n=Object.prototype,s=n.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},a="function"==typeof Symbol?Symbol:{},c=a.iterator||"@@iterator",u=a.asyncIterator||"@@asyncIterator",d=a.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,n){return e[t]=n}}function h(e,t,n,r){var i=t&&t.prototype instanceof p?t:p,s=Object.create(i.prototype),a=new C(r||[]);return o(s,"_invoke",{value:E(e,n,a)}),s}function f(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=h;var g={};function p(){}function m(){}function v(){}var _={};l(_,c,(function(){return this}));var y=Object.getPrototypeOf,b=y&&y(y(T([])));b&&b!==n&&s.call(b,c)&&(_=b);var w=v.prototype=p.prototype=Object.create(_);function S(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function A(e,t){function n(i,o,a,c){var u=f(e[i],e,o);if("throw"!==u.type){var d=u.arg,l=d.value;return l&&"object"==r(l)&&s.call(l,"__await")?t.resolve(l.__await).then((function(e){n("next",e,a,c)}),(function(e){n("throw",e,a,c)})):t.resolve(l).then((function(e){d.value=e,a(d)}),(function(e){return n("throw",e,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(e,r){function s(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(s,s):s()}})}function E(e,t,n){var r="suspendedStart";return function(i,s){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw s;return O()}for(n.method=i,n.arg=s;;){var o=n.delegate;if(o){var a=x(o,n);if(a){if(a===g)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=f(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===g)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}function x(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,x(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var i=f(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,g;var s=i.arg;return s?s.done?(t[e.resultName]=s.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,g):s:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,g)}function N(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function I(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(N,this),this.reset(!0)}function T(e){if(e){var t=e[c];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,r=function t(){for(;++n<e.length;)if(s.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return r.next=r}}return{next:O}}function O(){return{value:void 0,done:!0}}return m.prototype=v,o(w,"constructor",{value:v,configurable:!0}),o(v,"constructor",{value:m,configurable:!0}),m.displayName=l(v,d,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,l(e,d,"GeneratorFunction")),e.prototype=Object.create(w),e},t.awrap=function(e){return{__await:e}},S(A.prototype),l(A.prototype,u,(function(){return this})),t.AsyncIterator=A,t.async=function(e,n,r,i,s){void 0===s&&(s=Promise);var o=new A(h(e,n,r,i),s);return t.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},S(w),l(w,d,"Generator"),l(w,c,(function(){return this})),l(w,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=T,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(I),!e)for(var t in this)"t"===t.charAt(0)&&s.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,r){return o.type="throw",o.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r],o=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var a=s.call(i,"catchLoc"),c=s.call(i,"finallyLoc");if(a&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(a){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&s.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),I(n),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;I(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:T(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),g}},t}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},772:(e,t,n)=>{var r=n(435).default;e.exports=function(e,t){if("object"!==r(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)},e.exports.__esModule=!0,e.exports.default=e.exports},616:(e,t,n)=>{var r=n(435).default,i=n(772);e.exports=function(e){var t=i(e,"string");return"symbol"===r(t)?t:String(t)},e.exports.__esModule=!0,e.exports.default=e.exports},435:e=>{function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},117:(e,t,n)=>{var r=n(518)();e.exports=r;try{regeneratorRuntime=r}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}}},s={};function o(e){var t=s[e];if(void 0!==t)return t.exports;var n=s[e]={id:e,loaded:!1,exports:{}};return i[e].call(n.exports,n,n.exports,o),n.loaded=!0,n.exports}o.m=i,o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,o.t=function(n,r){if(1&r&&(n=this(n)),8&r)return n;if("object"==typeof n&&n){if(4&r&&n.__esModule)return n;if(16&r&&"function"==typeof n.then)return n}var i=Object.create(null);o.r(i);var s={};e=e||[null,t({}),t([]),t(t)];for(var a=2&r&&n;"object"==typeof a&&!~e.indexOf(a);a=t(a))Object.getOwnPropertyNames(a).forEach((e=>s[e]=()=>n[e]));return s.default=()=>n,o.d(i,s),i},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.f={},o.e=e=>Promise.all(Object.keys(o.f).reduce(((t,n)=>(o.f[n](e,t),t)),[])),o.u=e=>"emojis.js",o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n={},r="converse:",o.l=(e,t,i,s)=>{if(n[e])n[e].push(t);else{var a,c;if(void 0!==i)for(var u=document.getElementsByTagName("script"),d=0;d<u.length;d++){var l=u[d];if(l.getAttribute("src")==e||l.getAttribute("data-webpack")==r+i){a=l;break}}a||(c=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,o.nc&&a.setAttribute("nonce",o.nc),a.setAttribute("data-webpack",r+i),a.src=e),n[e]=[t];var h=(t,r)=>{a.onerror=a.onload=null,clearTimeout(f);var i=n[e];if(delete n[e],a.parentNode&&a.parentNode.removeChild(a),i&&i.forEach((e=>e(r))),t)return t(r)},f=setTimeout(h.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=h.bind(null,a.onerror),a.onload=h.bind(null,a.onload),c&&document.head.appendChild(a)}},o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),o.p="",(()=>{var e={267:0,729:0};o.f.j=(t,n)=>{var r=o.o(e,t)?e[t]:void 0;if(0!==r)if(r)n.push(r[2]);else{var i=new Promise(((n,i)=>r=e[t]=[n,i]));n.push(r[2]=i);var s=o.p+o.u(t),a=new Error;o.l(s,(n=>{if(o.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var i=n&&("load"===n.type?"missing":n.type),s=n&&n.target&&n.target.src;a.message="Loading chunk "+t+" failed.\n("+i+": "+s+")",a.name="ChunkLoadError",a.type=i,a.request=s,r[1](a)}}),"chunk-"+t,t)}};var t=(t,n)=>{var r,i,[s,a,c]=n,u=0;if(s.some((t=>0!==e[t]))){for(r in a)o.o(a,r)&&(o.m[r]=a[r]);if(c)c(o)}for(t&&t(n);u<s.length;u++)i=s[u],o.o(e,i)&&e[i]&&e[i][0](),e[i]=0},n=this.webpackChunkconverse=this.webpackChunkconverse||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var a={};return(()=>{"use strict";o.r(a),o.d(a,{default:()=>l_});var e={};o.r(e),o.d(e,{DOMParser:()=>ls,WebSocket:()=>ds,getDummyXMLDOMDocument:()=>hs});var t={};o.r(t),o.d(t,{addCookies:()=>Ss,arrayBufToBase64:()=>ys,base64ToArrayBuf:()=>bs,copyElement:()=>ks,createHtml:()=>js,default:()=>Js,escapeNode:()=>Ls,forEachChild:()=>$s,getBareJidFromJid:()=>qs,getDomainFromJid:()=>Bs,getNodeFromJid:()=>Us,getResourceFromJid:()=>Hs,getText:()=>Ps,isTagEqual:()=>Fs,serialize:()=>Ds,stringToArrayBuf:()=>ws,unescapeNode:()=>zs,utf16to8:()=>vs,validAttribute:()=>Ts,validCSS:()=>Os,validTag:()=>Cs,xmlElement:()=>Is,xmlGenerator:()=>Es,xmlHtmlNode:()=>Ns,xmlTextNode:()=>xs,xmlescape:()=>Rs,xmlunescape:()=>Ms,xorArrayBuffers:()=>_s});const n="object"==typeof global&&global&&global.Object===Object&&global;var r="object"==typeof self&&self&&self.Object===Object&&self;const i=n||r||Function("return this")();const s=i.Symbol;var c=Object.prototype,u=c.hasOwnProperty,d=c.toString,l=s?s.toStringTag:void 0;const h=function(e){var t=u.call(e,l),n=e[l];try{e[l]=void 0;var r=!0}catch(e){}var i=d.call(e);return r&&(t?e[l]=n:delete e[l]),i};var f=Object.prototype.toString;const g=function(e){return f.call(e)};var p=s?s.toStringTag:void 0;const m=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":p&&p in Object(e)?h(e):g(e)};const v=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};const _=function(e){if(!v(e))return!1;var t=m(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t};const y=i["__core-js_shared__"];var b,w=(b=/[^.]+$/.exec(y&&y.keys&&y.keys.IE_PROTO||""))?"Symbol(src)_1."+b:"";const S=function(e){return!!w&&w in e};var A=Function.prototype.toString;const E=function(e){if(null!=e){try{return A.call(e)}catch(e){}try{return e+""}catch(e){}}return""};var x=/^\[object .+?Constructor\]$/,N=Function.prototype,I=Object.prototype,C=N.toString,T=I.hasOwnProperty,O=RegExp("^"+C.call(T).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const j=function(e){return!(!v(e)||S(e))&&(_(e)?O:x).test(E(e))};const k=function(e,t){return null==e?void 0:e[t]};const R=function(e,t){var n=k(e,t);return j(n)?n:void 0};const M=function(){try{var e=R(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();const D=function(e,t,n){"__proto__"==t&&M?M(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n};const $=function(e,t){return e===t||e!=e&&t!=t};var F=Object.prototype.hasOwnProperty;const P=function(e,t,n){var r=e[t];F.call(e,t)&&$(r,n)&&(void 0!==n||t in e)||D(e,t,n)};const L=function(e,t,n,r){var i=!n;n||(n={});for(var s=-1,o=t.length;++s<o;){var a=t[s],c=r?r(n[a],e[a],a,n,e):void 0;void 0===c&&(c=e[a]),i?D(n,a,c):P(n,a,c)}return n};const z=function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r};const U=function(e){return null!=e&&"object"==typeof e};const B=function(e){return U(e)&&"[object Arguments]"==m(e)};var H=Object.prototype,q=H.hasOwnProperty,J=H.propertyIsEnumerable;const W=B(function(){return arguments}())?B:function(e){return U(e)&&q.call(e,"callee")&&!J.call(e,"callee")};const G=Array.isArray;const Q=function(){return!1};var V="object"==typeof exports&&exports&&!exports.nodeType&&exports,Y=V&&"object"==typeof module&&module&&!module.nodeType&&module,X=Y&&Y.exports===V?i.Buffer:void 0;const K=(X?X.isBuffer:void 0)||Q;var Z=/^(?:0|[1-9]\d*)$/;const ee=function(e,t){var n=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&Z.test(e))&&e>-1&&e%1==0&&e<t};const te=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991};var ne={};ne["[object Float32Array]"]=ne["[object Float64Array]"]=ne["[object Int8Array]"]=ne["[object Int16Array]"]=ne["[object Int32Array]"]=ne["[object Uint8Array]"]=ne["[object Uint8ClampedArray]"]=ne["[object Uint16Array]"]=ne["[object Uint32Array]"]=!0,ne["[object Arguments]"]=ne["[object Array]"]=ne["[object ArrayBuffer]"]=ne["[object Boolean]"]=ne["[object DataView]"]=ne["[object Date]"]=ne["[object Error]"]=ne["[object Function]"]=ne["[object Map]"]=ne["[object Number]"]=ne["[object Object]"]=ne["[object RegExp]"]=ne["[object Set]"]=ne["[object String]"]=ne["[object WeakMap]"]=!1;const re=function(e){return U(e)&&te(e.length)&&!!ne[m(e)]};const ie=function(e){return function(t){return e(t)}};var se="object"==typeof exports&&exports&&!exports.nodeType&&exports,oe=se&&"object"==typeof module&&module&&!module.nodeType&&module,ae=oe&&oe.exports===se&&n.process;const ce=function(){try{var e=oe&&oe.require&&oe.require("util").types;return e||ae&&ae.binding&&ae.binding("util")}catch(e){}}();var ue=ce&&ce.isTypedArray;const de=ue?ie(ue):re;var le=Object.prototype.hasOwnProperty;const he=function(e,t){var n=G(e),r=!n&&W(e),i=!n&&!r&&K(e),s=!n&&!r&&!i&&de(e),o=n||r||i||s,a=o?z(e.length,String):[],c=a.length;for(var u in e)!t&&!le.call(e,u)||o&&("length"==u||i&&("offset"==u||"parent"==u)||s&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||ee(u,c))||a.push(u);return a};var fe=Object.prototype;const ge=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||fe)};const pe=function(e,t){return function(n){return e(t(n))}};const me=pe(Object.keys,Object);var ve=Object.prototype.hasOwnProperty;const _e=function(e){if(!ge(e))return me(e);var t=[];for(var n in Object(e))ve.call(e,n)&&"constructor"!=n&&t.push(n);return t};const ye=function(e){return null!=e&&te(e.length)&&!_(e)};const be=function(e){return ye(e)?he(e):_e(e)};const we=function(e,t){return e&&L(t,be(t),e)};var Se=Object.create,Ae=function(){function e(){}return function(t){if(!v(t))return{};if(Se)return Se(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();const Ee=Ae;const xe=function(e,t){var n=Ee(e);return null==t?n:we(n,t)};const Ne=function(e){return e};const Ie=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)};var Ce=Math.max;const Te=function(e,t,n){return t=Ce(void 0===t?e.length-1:t,0),function(){for(var r=arguments,i=-1,s=Ce(r.length-t,0),o=Array(s);++i<s;)o[i]=r[t+i];i=-1;for(var a=Array(t+1);++i<t;)a[i]=r[i];return a[t]=n(o),Ie(e,this,a)}};const Oe=function(e){return function(){return e}};const je=M?function(e,t){return M(e,"toString",{configurable:!0,enumerable:!1,value:Oe(t),writable:!0})}:Ne;var ke=Date.now;const Re=function(e){var t=0,n=0;return function(){var r=ke(),i=16-(r-n);if(n=r,i>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}(je);const Me=function(e,t){return Re(Te(e,t,Ne),e+"")};const De=function(e,t,n){if(!v(n))return!1;var r=typeof t;return!!("number"==r?ye(n)&&ee(t,n.length):"string"==r&&t in n)&&$(n[t],e)};const $e=function(e){return Me((function(t,n){var r=-1,i=n.length,s=i>1?n[i-1]:void 0,o=i>2?n[2]:void 0;for(s=e.length>3&&"function"==typeof s?(i--,s):void 0,o&&De(n[0],n[1],o)&&(s=i<3?void 0:s,i=1),t=Object(t);++r<i;){var a=n[r];a&&e(t,a,r,s)}return t}))};const Fe=function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t};var Pe=Object.prototype.hasOwnProperty;const Le=function(e){if(!v(e))return Fe(e);var t=ge(e),n=[];for(var r in e)("constructor"!=r||!t&&Pe.call(e,r))&&n.push(r);return n};const ze=function(e){return ye(e)?he(e,!0):Le(e)};const Ue=$e((function(e,t){L(t,ze(t),e)}));var Be=Object.prototype.hasOwnProperty;const He=function(e,t){return null!=e&&Be.call(e,t)};const qe=function(e){return"symbol"==typeof e||U(e)&&"[object Symbol]"==m(e)};var Je=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,We=/^\w*$/;const Ge=function(e,t){if(G(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!qe(e))||(We.test(e)||!Je.test(e)||null!=t&&e in Object(t))};const Qe=R(Object,"create");const Ve=function(){this.__data__=Qe?Qe(null):{},this.size=0};const Ye=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t};var Xe=Object.prototype.hasOwnProperty;const Ke=function(e){var t=this.__data__;if(Qe){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return Xe.call(t,e)?t[e]:void 0};var Ze=Object.prototype.hasOwnProperty;const et=function(e){var t=this.__data__;return Qe?void 0!==t[e]:Ze.call(t,e)};const tt=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Qe&&void 0===t?"__lodash_hash_undefined__":t,this};function nt(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}nt.prototype.clear=Ve,nt.prototype.delete=Ye,nt.prototype.get=Ke,nt.prototype.has=et,nt.prototype.set=tt;const rt=nt;const it=function(){this.__data__=[],this.size=0};const st=function(e,t){for(var n=e.length;n--;)if($(e[n][0],t))return n;return-1};var ot=Array.prototype.splice;const at=function(e){var t=this.__data__,n=st(t,e);return!(n<0)&&(n==t.length-1?t.pop():ot.call(t,n,1),--this.size,!0)};const ct=function(e){var t=this.__data__,n=st(t,e);return n<0?void 0:t[n][1]};const ut=function(e){return st(this.__data__,e)>-1};const dt=function(e,t){var n=this.__data__,r=st(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this};function lt(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}lt.prototype.clear=it,lt.prototype.delete=at,lt.prototype.get=ct,lt.prototype.has=ut,lt.prototype.set=dt;const ht=lt;const ft=R(i,"Map");const gt=function(){this.size=0,this.__data__={hash:new rt,map:new(ft||ht),string:new rt}};const pt=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};const mt=function(e,t){var n=e.__data__;return pt(t)?n["string"==typeof t?"string":"hash"]:n.map};const vt=function(e){var t=mt(this,e).delete(e);return this.size-=t?1:0,t};const _t=function(e){return mt(this,e).get(e)};const yt=function(e){return mt(this,e).has(e)};const bt=function(e,t){var n=mt(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this};function wt(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}wt.prototype.clear=gt,wt.prototype.delete=vt,wt.prototype.get=_t,wt.prototype.has=yt,wt.prototype.set=bt;const St=wt;function At(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=e.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(At.Cache||St),n}At.Cache=St;const Et=At;const xt=function(e){var t=Et(e,(function(e){return 500===n.size&&n.clear(),e})),n=t.cache;return t};var Nt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,It=/\\(\\)?/g,Ct=xt((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(Nt,(function(e,n,r,i){t.push(r?i.replace(It,"$1"):n||e)})),t}));const Tt=Ct;const Ot=function(e,t){for(var n=-1,r=null==e?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i};var jt=s?s.prototype:void 0,kt=jt?jt.toString:void 0;const Rt=function e(t){if("string"==typeof t)return t;if(G(t))return Ot(t,e)+"";if(qe(t))return kt?kt.call(t):"";var n=t+"";return"0"==n&&1/t==-Infinity?"-0":n};const Mt=function(e){return null==e?"":Rt(e)};const Dt=function(e,t){return G(e)?e:Ge(e,t)?[e]:Tt(Mt(e))};const $t=function(e){if("string"==typeof e||qe(e))return e;var t=e+"";return"0"==t&&1/e==-Infinity?"-0":t};const Ft=function(e,t,n){for(var r=-1,i=(t=Dt(t,e)).length,s=!1;++r<i;){var o=$t(t[r]);if(!(s=null!=e&&n(e,o)))break;e=e[o]}return s||++r!=i?s:!!(i=null==e?0:e.length)&&te(i)&&ee(o,i)&&(G(e)||W(e))};const Pt=function(e,t){return null!=e&&Ft(e,t,He)};const Lt=function(e,t,n){var r=-1,i=(t=Dt(t,e)).length;for(i||(i=1,e=void 0);++r<i;){var s=null==e?void 0:e[$t(t[r])];void 0===s&&(r=i,s=n),e=_(s)?s.call(e):s}return e};function zt(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function Ut(e,t){const n=this;let r;return r=e&&Pt(e,"constructor")?e.constructor:function(){return n.apply(this,arguments)},Ue(r,n,t),r.prototype=xe(n.prototype,e),r.prototype.constructor=r,r.__super__=n.prototype,r}function Bt(){const e={isResolved:!1,isPending:!0,isRejected:!1},t=new Promise(((t,n)=>{e.resolve=t,e.reject=n}));return Object.assign(t,e),t.then((function(e){return t.isResolved=!0,t.isPending=!1,t.isRejected=!1,e}),(function(e){throw t.isResolved=!1,t.isPending=!1,t.isRejected=!0,e})),t}function Ht(){throw new Error('A "url" property or function must be specified')}function qt(e,t){const n=t.error;t.error=function(r){n&&n.call(t.context,e,r,t),e.trigger("error",e,r,t)}}const Jt={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};function Wt(e){const t=Lt(e,"browserStorage")||Lt(e.collection,"browserStorage");return t?t.sync():Gt}function Gt(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r={type:Jt[e],dataType:"json"};n.url||(r.url=Lt(t,"url")||Ht()),null!=n.data||!t||"create"!==e&&"update"!==e&&"patch"!==e||(r.contentType="application/json",r.data=JSON.stringify(n.attrs||t.toJSON(n))),"GET"!==r.type&&(r.processData=!1);const i=n.error;n.error=function(e,t,r){n.textStatus=t,n.errorThrown=r,i&&i.call(n.context,e,t,r)};const s=n.xhr=function(){return fetch.apply(this,arguments)}(Ue(r,n));return t.trigger("request",t,s,n),s}const Qt=R(i,"DataView");const Vt=R(i,"Promise");const Yt=R(i,"Set");const Xt=R(i,"WeakMap");var Kt="[object Map]",Zt="[object Promise]",en="[object Set]",tn="[object WeakMap]",nn="[object DataView]",rn=E(Qt),sn=E(ft),on=E(Vt),an=E(Yt),cn=E(Xt),un=m;(Qt&&un(new Qt(new ArrayBuffer(1)))!=nn||ft&&un(new ft)!=Kt||Vt&&un(Vt.resolve())!=Zt||Yt&&un(new Yt)!=en||Xt&&un(new Xt)!=tn)&&(un=function(e){var t=m(e),n="[object Object]"==t?e.constructor:void 0,r=n?E(n):"";if(r)switch(r){case rn:return nn;case sn:return Kt;case on:return Zt;case an:return en;case cn:return tn}return t});const dn=un;var ln=Object.prototype.hasOwnProperty;const hn=function(e){if(null==e)return!0;if(ye(e)&&(G(e)||"string"==typeof e||"function"==typeof e.splice||K(e)||de(e)||W(e)))return!e.length;var t=dn(e);if("[object Map]"==t||"[object Set]"==t)return!e.size;if(ge(e))return!_e(e).length;for(var n in e)if(ln.call(e,n))return!1;return!0};var fn=/\s/;const gn=function(e){for(var t=e.length;t--&&fn.test(e.charAt(t)););return t};var pn=/^\s+/;const mn=function(e){return e?e.slice(0,gn(e)+1).replace(pn,""):e};var vn=/^[-+]0x[0-9a-f]+$/i,_n=/^0b[01]+$/i,yn=/^0o[0-7]+$/i,bn=parseInt;const wn=function(e){if("number"==typeof e)return e;if(qe(e))return NaN;if(v(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=v(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=mn(e);var n=_n.test(e);return n||yn.test(e)?bn(e.slice(2),n?2:8):vn.test(e)?NaN:+e};var Sn=1/0;const An=function(e){return e?(e=wn(e))===Sn||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0};const En=function(e){var t=An(e),n=t%1;return t==t?n?t-n:t:0};const xn=function(e,t){var n;if("function"!=typeof t)throw new TypeError("Expected a function");return e=En(e),function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=void 0),n}};const Nn=function(e){return xn(2,e)};var In=0;const Cn=function(e){var t=++In;return Mt(e)+t},Tn={},On=/\s+/;let jn;const kn=function(e,t,n,r,i){let s,o=0;if(n&&"object"==typeof n){void 0!==r&&"context"in i&&void 0===i.context&&(i.context=r);for(s=be(n);o<s.length;o++)t=kn(e,t,s[o],n[s[o]],i)}else if(n&&On.test(n))for(s=n.split(On);o<s.length;o++)t=e(t,s[o],r,i);else t=e(t,n,r,i);return t};Tn.on=function(e,t,n){if(this._events=kn(Rn,this._events||{},e,t,{context:n,ctx:this,listening:jn}),jn){(this._listeners||(this._listeners={}))[jn.id]=jn,jn.interop=!1}return this},Tn.listenTo=function(e,t,n){if(!e)return this;const r=e._listenId||(e._listenId=Cn("l")),i=this._listeningTo||(this._listeningTo={});let s=jn=i[r];s||(this._listenId||(this._listenId=Cn("l")),s=jn=i[r]=new Ln(this,e));const o=Mn(e,t,n,this);if(jn=void 0,o)throw o;return s.interop&&s.on(t,n),this};const Rn=function(e,t,n,r){if(n){const i=e[t]||(e[t]=[]),s=r.context,o=r.ctx,a=r.listening;a&&a.count++,i.push({callback:n,context:s,ctx:s||o,listening:a})}return e},Mn=function(e,t,n,r){try{e.on(t,n,r)}catch(e){return e}};Tn.off=function(e,t,n){return this._events?(this._events=kn(Dn,this._events,e,t,{context:n,listeners:this._listeners}),this):this},Tn.stopListening=function(e,t,n){const r=this._listeningTo;if(!r)return this;const i=e?[e._listenId]:be(r);for(let e=0;e<i.length;e++){const s=r[i[e]];if(!s)break;s.obj.off(t,n,this),s.interop&&s.off(t,n)}return hn(r)&&(this._listeningTo=void 0),this};const Dn=function(e,t,n,r){if(!e)return;const i=r.context,s=r.listeners;let o,a=0;if(t||i||n){for(o=t?[t]:be(e);a<o.length;a++){const r=e[t=o[a]];if(!r)break;const s=[];for(let e=0;e<r.length;e++){const o=r[e];if(n&&n!==o.callback&&n!==o.callback._callback||i&&i!==o.context)s.push(o);else{const e=o.listening;e&&e.off(t,n)}}s.length?e[t]=s:delete e[t]}return e}for(o=be(s);a<o.length;a++)s[o[a]].cleanup()};Tn.once=function(e,t,n){const r=kn($n,{},e,t,this.off.bind(this));return"string"==typeof e&&null==n&&(t=void 0),this.on(r,t,n)},Tn.listenToOnce=function(e,t,n){const r=kn($n,{},t,n,this.stopListening.bind(this,e));return this.listenTo(e,r)};const $n=function(e,t,n,r){if(n){const i=e[t]=Nn((function(){r(t,i),n.apply(this,arguments)}));i._callback=n}return e};Tn.trigger=function(e){if(!this._events)return this;const t=Math.max(0,arguments.length-1),n=Array(t);for(let e=0;e<t;e++)n[e]=arguments[e+1];return kn(Fn,this._events,e,void 0,n),this};const Fn=function(e,t,n,r){if(e){const n=e[t];let i=e.all;n&&i&&(i=i.slice()),n&&Pn(n,r),i&&Pn(i,[t].concat(r))}return e},Pn=function(e,t){let n,r=-1;const i=e.length,s=t[0],o=t[1],a=t[2];switch(t.length){case 0:for(;++r<i;)(n=e[r]).callback.call(n.ctx);return;case 1:for(;++r<i;)(n=e[r]).callback.call(n.ctx,s);return;case 2:for(;++r<i;)(n=e[r]).callback.call(n.ctx,s,o);return;case 3:for(;++r<i;)(n=e[r]).callback.call(n.ctx,s,o,a);return;default:for(;++r<i;)(n=e[r]).callback.apply(n.ctx,t);return}},Ln=function(e,t){this.id=e._listenId,this.listener=e,this.obj=t,this.interop=!0,this.count=0,this._events=void 0};Ln.prototype.on=Tn.on,Ln.prototype.off=function(e,t){let n;this.interop?(this._events=kn(Dn,this._events,e,t,{context:void 0,listeners:void 0}),n=!this._events):(this.count--,n=0===this.count),n&&this.cleanup()},Ln.prototype.cleanup=function(){delete this.listener._listeningTo[this.obj._listenId],this.interop||delete this.obj._listeners[this.id]},Tn.bind=Tn.on,Tn.unbind=Tn.off;const zn=function(){this.__data__=new ht,this.size=0};const Un=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n};const Bn=function(e){return this.__data__.get(e)};const Hn=function(e){return this.__data__.has(e)};const qn=function(e,t){var n=this.__data__;if(n instanceof ht){var r=n.__data__;if(!ft||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new St(r)}return n.set(e,t),this.size=n.size,this};function Jn(e){var t=this.__data__=new ht(e);this.size=t.size}Jn.prototype.clear=zn,Jn.prototype.delete=Un,Jn.prototype.get=Bn,Jn.prototype.has=Hn,Jn.prototype.set=qn;const Wn=Jn;const Gn=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e};const Qn=function(e,t){return e&&L(t,ze(t),e)};var Vn="object"==typeof exports&&exports&&!exports.nodeType&&exports,Yn=Vn&&"object"==typeof module&&module&&!module.nodeType&&module,Xn=Yn&&Yn.exports===Vn?i.Buffer:void 0,Kn=Xn?Xn.allocUnsafe:void 0;const Zn=function(e,t){if(t)return e.slice();var n=e.length,r=Kn?Kn(n):new e.constructor(n);return e.copy(r),r};const er=function(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t};const tr=function(e,t){for(var n=-1,r=null==e?0:e.length,i=0,s=[];++n<r;){var o=e[n];t(o,n,e)&&(s[i++]=o)}return s};const nr=function(){return[]};var rr=Object.prototype.propertyIsEnumerable,ir=Object.getOwnPropertySymbols;const sr=ir?function(e){return null==e?[]:(e=Object(e),tr(ir(e),(function(t){return rr.call(e,t)})))}:nr;const or=function(e,t){return L(e,sr(e),t)};const ar=function(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e};const cr=pe(Object.getPrototypeOf,Object);var ur=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)ar(t,sr(e)),e=cr(e);return t}:nr;const dr=ur;const lr=function(e,t){return L(e,dr(e),t)};const hr=function(e,t,n){var r=t(e);return G(e)?r:ar(r,n(e))};const fr=function(e){return hr(e,be,sr)};const gr=function(e){return hr(e,ze,dr)};var pr=Object.prototype.hasOwnProperty;const mr=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&pr.call(e,"index")&&(n.index=e.index,n.input=e.input),n};const vr=i.Uint8Array;const _r=function(e){var t=new e.constructor(e.byteLength);return new vr(t).set(new vr(e)),t};const yr=function(e,t){var n=t?_r(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)};var br=/\w*$/;const wr=function(e){var t=new e.constructor(e.source,br.exec(e));return t.lastIndex=e.lastIndex,t};var Sr=s?s.prototype:void 0,Ar=Sr?Sr.valueOf:void 0;const Er=function(e){return Ar?Object(Ar.call(e)):{}};const xr=function(e,t){var n=t?_r(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)};const Nr=function(e,t,n){var r=e.constructor;switch(t){case"[object ArrayBuffer]":return _r(e);case"[object Boolean]":case"[object Date]":return new r(+e);case"[object DataView]":return yr(e,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return xr(e,n);case"[object Map]":case"[object Set]":return new r;case"[object Number]":case"[object String]":return new r(e);case"[object RegExp]":return wr(e);case"[object Symbol]":return Er(e)}};const Ir=function(e){return"function"!=typeof e.constructor||ge(e)?{}:Ee(cr(e))};const Cr=function(e){return U(e)&&"[object Map]"==dn(e)};var Tr=ce&&ce.isMap;const Or=Tr?ie(Tr):Cr;const jr=function(e){return U(e)&&"[object Set]"==dn(e)};var kr=ce&&ce.isSet;const Rr=kr?ie(kr):jr;var Mr="[object Arguments]",Dr="[object Function]",$r="[object Object]",Fr={};Fr[Mr]=Fr["[object Array]"]=Fr["[object ArrayBuffer]"]=Fr["[object DataView]"]=Fr["[object Boolean]"]=Fr["[object Date]"]=Fr["[object Float32Array]"]=Fr["[object Float64Array]"]=Fr["[object Int8Array]"]=Fr["[object Int16Array]"]=Fr["[object Int32Array]"]=Fr["[object Map]"]=Fr["[object Number]"]=Fr[$r]=Fr["[object RegExp]"]=Fr["[object Set]"]=Fr["[object String]"]=Fr["[object Symbol]"]=Fr["[object Uint8Array]"]=Fr["[object Uint8ClampedArray]"]=Fr["[object Uint16Array]"]=Fr["[object Uint32Array]"]=!0,Fr["[object Error]"]=Fr[Dr]=Fr["[object WeakMap]"]=!1;const Pr=function e(t,n,r,i,s,o){var a,c=1&n,u=2&n,d=4&n;if(r&&(a=s?r(t,i,s,o):r(t)),void 0!==a)return a;if(!v(t))return t;var l=G(t);if(l){if(a=mr(t),!c)return er(t,a)}else{var h=dn(t),f=h==Dr||"[object GeneratorFunction]"==h;if(K(t))return Zn(t,c);if(h==$r||h==Mr||f&&!s){if(a=u||f?{}:Ir(t),!c)return u?lr(t,Qn(a,t)):or(t,we(a,t))}else{if(!Fr[h])return s?t:{};a=Nr(t,h,c)}}o||(o=new Wn);var g=o.get(t);if(g)return g;o.set(t,a),Rr(t)?t.forEach((function(i){a.add(e(i,n,r,i,t,o))})):Or(t)&&t.forEach((function(i,s){a.set(s,e(i,n,r,s,t,o))}));var p=l?void 0:(d?u?gr:fr:u?ze:be)(t);return Gn(p||t,(function(i,s){p&&(i=t[s=i]),P(a,s,e(i,n,r,s,t,o))})),a};const Lr=function(e){return Pr(e,4)};var zr=Object.prototype,Ur=zr.hasOwnProperty,Br=Me((function(e,t){e=Object(e);var n=-1,r=t.length,i=r>2?t[2]:void 0;for(i&&De(t[0],t[1],i)&&(r=1);++n<r;)for(var s=t[n],o=ze(s),a=-1,c=o.length;++a<c;){var u=o[a],d=e[u];(void 0===d||$(d,zr[u])&&!Ur.call(e,u))&&(e[u]=s[u])}return e}));const Hr=Br;const qr=function(e,t,n){if("function"!=typeof e)throw new TypeError("Expected a function");return setTimeout((function(){e.apply(void 0,n)}),t)};const Jr=Me((function(e,t){return qr(e,1,t)}));const Wr=function(e){return function(t){return null==e?void 0:e[t]}};const Gr=Wr({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});var Qr=/[&<>"']/g,Vr=RegExp(Qr.source);const Yr=function(e){return(e=Mt(e))&&Vr.test(e)?e.replace(Qr,Gr):e};const Xr=function(e){return function(t,n,r){for(var i=-1,s=Object(t),o=r(t),a=o.length;a--;){var c=o[e?a:++i];if(!1===n(s[c],c,s))break}return t}};const Kr=Xr();const Zr=function(e,t){return e&&Kr(e,t,be)};const ei=function(e,t,n,r){return Zr(e,(function(e,i,s){t(r,n(e),i,s)})),r};const ti=function(e,t){return function(n,r){return ei(n,e,t(r),{})}};var ni=Object.prototype.toString,ri=ti((function(e,t,n){null!=t&&"function"!=typeof t.toString&&(t=ni.call(t)),e[t]=n}),Oe(Ne));const ii=ri;const si=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this};const oi=function(e){return this.__data__.has(e)};function ai(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new St;++t<n;)this.add(e[t])}ai.prototype.add=ai.prototype.push=si,ai.prototype.has=oi;const ci=ai;const ui=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1};const di=function(e,t){return e.has(t)};const li=function(e,t,n,r,i,s){var o=1&n,a=e.length,c=t.length;if(a!=c&&!(o&&c>a))return!1;var u=s.get(e),d=s.get(t);if(u&&d)return u==t&&d==e;var l=-1,h=!0,f=2&n?new ci:void 0;for(s.set(e,t),s.set(t,e);++l<a;){var g=e[l],p=t[l];if(r)var m=o?r(p,g,l,t,e,s):r(g,p,l,e,t,s);if(void 0!==m){if(m)continue;h=!1;break}if(f){if(!ui(t,(function(e,t){if(!di(f,t)&&(g===e||i(g,e,n,r,s)))return f.push(t)}))){h=!1;break}}else if(g!==p&&!i(g,p,n,r,s)){h=!1;break}}return s.delete(e),s.delete(t),h};const hi=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n};const fi=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n};var gi=s?s.prototype:void 0,pi=gi?gi.valueOf:void 0;const mi=function(e,t,n,r,i,s,o){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!s(new vr(e),new vr(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return $(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var a=hi;case"[object Set]":var c=1&r;if(a||(a=fi),e.size!=t.size&&!c)return!1;var u=o.get(e);if(u)return u==t;r|=2,o.set(e,t);var d=li(a(e),a(t),r,i,s,o);return o.delete(e),d;case"[object Symbol]":if(pi)return pi.call(e)==pi.call(t)}return!1};var vi=Object.prototype.hasOwnProperty;const _i=function(e,t,n,r,i,s){var o=1&n,a=fr(e),c=a.length;if(c!=fr(t).length&&!o)return!1;for(var u=c;u--;){var d=a[u];if(!(o?d in t:vi.call(t,d)))return!1}var l=s.get(e),h=s.get(t);if(l&&h)return l==t&&h==e;var f=!0;s.set(e,t),s.set(t,e);for(var g=o;++u<c;){var p=e[d=a[u]],m=t[d];if(r)var v=o?r(m,p,d,t,e,s):r(p,m,d,e,t,s);if(!(void 0===v?p===m||i(p,m,n,r,s):v)){f=!1;break}g||(g="constructor"==d)}if(f&&!g){var _=e.constructor,y=t.constructor;_==y||!("constructor"in e)||!("constructor"in t)||"function"==typeof _&&_ instanceof _&&"function"==typeof y&&y instanceof y||(f=!1)}return s.delete(e),s.delete(t),f};var yi="[object Arguments]",bi="[object Array]",wi="[object Object]",Si=Object.prototype.hasOwnProperty;const Ai=function(e,t,n,r,i,s){var o=G(e),a=G(t),c=o?bi:dn(e),u=a?bi:dn(t),d=(c=c==yi?wi:c)==wi,l=(u=u==yi?wi:u)==wi,h=c==u;if(h&&K(e)){if(!K(t))return!1;o=!0,d=!1}if(h&&!d)return s||(s=new Wn),o||de(e)?li(e,t,n,r,i,s):mi(e,t,c,n,r,i,s);if(!(1&n)){var f=d&&Si.call(e,"__wrapped__"),g=l&&Si.call(t,"__wrapped__");if(f||g){var p=f?e.value():e,m=g?t.value():t;return s||(s=new Wn),i(p,m,n,r,s)}}return!!h&&(s||(s=new Wn),_i(e,t,n,r,i,s))};const Ei=function e(t,n,r,i,s){return t===n||(null==t||null==n||!U(t)&&!U(n)?t!=t&&n!=n:Ai(t,n,r,i,e,s))};const xi=function(e,t){return Ei(e,t)};const Ni=function(e,t,n,r){var i=n.length,s=i,o=!r;if(null==e)return!s;for(e=Object(e);i--;){var a=n[i];if(o&&a[2]?a[1]!==e[a[0]]:!(a[0]in e))return!1}for(;++i<s;){var c=(a=n[i])[0],u=e[c],d=a[1];if(o&&a[2]){if(void 0===u&&!(c in e))return!1}else{var l=new Wn;if(r)var h=r(u,d,c,e,t,l);if(!(void 0===h?Ei(d,u,3,r,l):h))return!1}}return!0};const Ii=function(e){return e==e&&!v(e)};const Ci=function(e){for(var t=be(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,Ii(i)]}return t};const Ti=function(e,t){return function(n){return null!=n&&(n[e]===t&&(void 0!==t||e in Object(n)))}};const Oi=function(e){var t=Ci(e);return 1==t.length&&t[0][2]?Ti(t[0][0],t[0][1]):function(n){return n===e||Ni(n,e,t)}};const ji=function(e,t){for(var n=0,r=(t=Dt(t,e)).length;null!=e&&n<r;)e=e[$t(t[n++])];return n&&n==r?e:void 0};const ki=function(e,t,n){var r=null==e?void 0:ji(e,t);return void 0===r?n:r};const Ri=function(e,t){return null!=e&&t in Object(e)};const Mi=function(e,t){return null!=e&&Ft(e,t,Ri)};const Di=function(e,t){return Ge(e)&&Ii(t)?Ti($t(e),t):function(n){var r=ki(n,e);return void 0===r&&r===t?Mi(n,e):Ei(t,r,3)}};const $i=function(e){return function(t){return null==t?void 0:t[e]}};const Fi=function(e){return function(t){return ji(t,e)}};const Pi=function(e){return Ge(e)?$i($t(e)):Fi(e)};const Li=function(e){return"function"==typeof e?e:null==e?Ne:"object"==typeof e?G(e)?Di(e[0],e[1]):Oi(e):Pi(e)};const zi=function(e){return Li("function"==typeof e?e:Pr(e,1))};const Ui=function(e){var t=null==e?0:e.length;return t?e[t-1]:void 0};const Bi=function(e,t,n){var r=-1,i=e.length;t<0&&(t=-t>i?0:i+t),(n=n>i?i:n)<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var s=Array(i);++r<i;)s[r]=e[r+t];return s};const Hi=function(e,t){return t.length<2?e:ji(e,Bi(t,0,-1))};const qi=function(e,t){return t=Dt(t,e),null==(e=Hi(e,t))||delete e[$t(Ui(t))]};var Ji=Function.prototype,Wi=Object.prototype,Gi=Ji.toString,Qi=Wi.hasOwnProperty,Vi=Gi.call(Object);const Yi=function(e){if(!U(e)||"[object Object]"!=m(e))return!1;var t=cr(e);if(null===t)return!0;var n=Qi.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&Gi.call(n)==Vi};const Xi=function(e){return Yi(e)?void 0:e};var Ki=s?s.isConcatSpreadable:void 0;const Zi=function(e){return G(e)||W(e)||!!(Ki&&e&&e[Ki])};const es=function e(t,n,r,i,s){var o=-1,a=t.length;for(r||(r=Zi),s||(s=[]);++o<a;){var c=t[o];n>0&&r(c)?n>1?e(c,n-1,r,i,s):ar(s,c):i||(s[s.length]=c)}return s};const ts=function(e){return(null==e?0:e.length)?es(e,1):[]};const ns=function(e){return Re(Te(e,void 0,ts),e+"")};var rs=ns((function(e,t){var n={};if(null==e)return n;var r=!1;t=Ot(t,(function(t){return t=Dt(t,e),r||(r=t.length>1),t})),L(e,gr(e),n),r&&(n=Pr(n,7,Xi));for(var i=t.length;i--;)qi(n,t[i]);return n}));const is=rs;const ss=function(e,t,n,r){if(!v(e))return e;for(var i=-1,s=(t=Dt(t,e)).length,o=s-1,a=e;null!=a&&++i<s;){var c=$t(t[i]),u=n;if("__proto__"===c||"constructor"===c||"prototype"===c)return e;if(i!=o){var d=a[c];void 0===(u=r?r(d,c,a):void 0)&&(u=v(d)?d:ee(t[i+1])?[]:{})}P(a,c,u),a=a[c]}return e};const os=function(e,t,n){for(var r=-1,i=t.length,s={};++r<i;){var o=t[r],a=ji(e,o);n(a,o)&&ss(s,Dt(o,e),a)}return s};const as=function(e,t){return os(e,t,(function(t,n){return Mi(e,n)}))};const cs=ns((function(e,t){return null==e?{}:as(e,t)})),us=function(e,t){let n=e||{};t||(t={}),this.preinitialize.apply(this,arguments),this.cid=Cn(this.cidPrefix),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(n=this.parse(n,t)||{});const r=Lt(this,"defaults");n=Hr(Ue({},r,n),r),this.set(n,t),this.changed={},this.initialize.apply(this,arguments)};us.extend=Ut,Object.assign(us.prototype,Tn,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",preinitialize:function(){},initialize:function(){},toJSON:function(e){return Lr(this.attributes)},sync:function(e,t,n){return Wt(this)(e,t,n)},get:function(e){return this.attributes[e]},keys:function(){return Object.keys(this.attributes)},values:function(){return Object.values(this.attributes)},pairs:function(){return this.entries()},entries:function(){return Object.entries(this.attributes)},invert:function(){return ii(this.attributes)},pick:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return 1===t.length&&Array.isArray(t[0])&&(t=t[0]),cs(this.attributes,t)},omit:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return 1===t.length&&Array.isArray(t[0])&&(t=t[0]),is(this.attributes,t)},isEmpty:function(){return hn(this.attributes)},escape:function(e){return Yr(this.get(e))},has:function(e){return null!=this.get(e)},matches:function(e){return!!zi(e,this)(this.attributes)},set:function(e,t,n){if(null==e)return this;let r;if("object"==typeof e?(r=e,n=t):(r={})[e]=t,n||(n={}),!this._validate(r,n))return!1;const i=n.unset,s=n.silent,o=[],a=this._changing;this._changing=!0,a||(this._previousAttributes=Lr(this.attributes),this.changed={});const c=this.attributes,u=this.changed,d=this._previousAttributes;for(const e in r)t=r[e],xi(c[e],t)||o.push(e),xi(d[e],t)?delete u[e]:u[e]=t,i?delete c[e]:c[e]=t;if(this.idAttribute in r&&(this.id=this.get(this.idAttribute)),!s){o.length&&(this._pending=n);for(let e=0;e<o.length;e++)this.trigger("change:"+o[e],this,c[o[e]],n)}if(a)return this;if(!s)for(;this._pending;)n=this._pending,this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,Ue({},t,{unset:!0}))},clear:function(e){const t={};for(const e in this.attributes)t[e]=void 0;return this.set(t,Ue({},e,{unset:!0}))},hasChanged:function(e){return null==e?!hn(this.changed):Pt(this.changed,e)},changedAttributes:function(e){if(!e)return!!this.hasChanged()&&Lr(this.changed);const t=this._changing?this._previousAttributes:this.attributes,n={};let r;for(const i in e){const s=e[i];xi(t[i],s)||(n[i]=s,r=!0)}return!!r&&n},previous:function(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return Lr(this._previousAttributes)},fetch:function(e){e=Ue({parse:!0},e);const t=this,n=e.success;return e.success=function(r){const i=e.parse?t.parse(r,e):r;if(!t.set(i,e))return!1;n&&n.call(e.context,t,r,e),t.trigger("sync",t,r,e)},qt(this,e),this.sync("read",this,e)},save:function(e,t,n){let r;null==e||"object"==typeof e?(r=e,n=t):(r={})[e]=t;const i=(n=Ue({validate:!0,parse:!0},n)).wait,s=n.promise,o=s&&Bt();if(r&&!i){if(!this.set(r,n))return!1}else if(!this._validate(r,n))return!1;const a=this,c=n.success,u=n.error,d=this.attributes;n.success=function(e){a.attributes=d;let t=n.parse?a.parse(e,n):e;if(i&&(t=Ue({},r,t)),t&&!a.set(t,n))return!1;c&&c.call(n.context,a,e,n),a.trigger("sync",a,e,n),s&&o.resolve()},n.error=function(e,t,n){u&&u.call(n.context,e,t,n),s&&o.reject(t)},qt(this,n),r&&i&&(this.attributes=Ue({},d,r));const l=this.isNew()?"create":n.patch?"patch":"update";"patch"!==l||n.attrs||(n.attrs=r);const h=this.sync(l,this,n);return this.attributes=d,s?o:h},destroy:function(e){e=e?Lr(e):{};const t=this,n=e.success,r=e.wait,i=function(){t.stopListening(),t.trigger("destroy",t,t.collection,e)};e.success=function(s){r&&i(),n&&n.call(e.context,t,s,e),t.isNew()||t.trigger("sync",t,s,e)};let s=!1;return this.isNew()?Jr(e.success):(qt(this,e),s=this.sync("delete",this,e)),r||i(),s},url:function(){const e=Lt(this,"urlRoot")||Lt(this.collection,"url")||Ht();if(this.isNew())return e;const t=this.get(this.idAttribute);return e.replace(/[^\/]$/,"$&/")+encodeURIComponent(t)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(e){return this._validate({},Ue({},e,{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=Ue({},this.attributes,e);const n=this.validationError=this.validate(e,t)||null;return!n||(this.trigger("invalid",this,n,Ue(t,{validationError:n})),!1)}});const ds=window.WebSocket,ls=window.DOMParser;function hs(){return document.implementation.createDocument("jabber:client","strophe",null)}const fs={HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",FRAMING:"urn:ietf:params:xml:ns:xmpp-framing",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas",XHTML_IM:"http://jabber.org/protocol/xhtml-im",XHTML:"http://www.w3.org/1999/xhtml"},gs={tags:["a","blockquote","br","cite","em","img","li","ol","p","span","strong","ul","body"],attributes:{a:["href"],blockquote:["style"],br:[],cite:["style"],em:[],img:["src","alt","style","height","width"],li:["style"],ol:["style"],p:["style"],span:["style"],strong:[],ul:["style"],body:[]},css:["background-color","color","font-family","font-size","font-style","font-weight","margin-left","margin-right","text-align","text-decoration"]},ps={ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8,REDIRECT:9,CONNTIMEOUT:10,BINDREQUIRED:11,ATTACHFAIL:12},ms={NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11};function vs(e){let t="";const n=e.length;for(let r=0;r<n;r++){const n=e.charCodeAt(r);n>=0&&n<=127?t+=e.charAt(r):n>2047?(t+=String.fromCharCode(224|n>>12&15),t+=String.fromCharCode(128|n>>6&63),t+=String.fromCharCode(128|n>>0&63)):(t+=String.fromCharCode(192|n>>6&31),t+=String.fromCharCode(128|n>>0&63))}return t}function _s(e,t){const n=new Uint8Array(e),r=new Uint8Array(t),i=new Uint8Array(e.byteLength);for(let t=0;t<e.byteLength;t++)i[t]=n[t]^r[t];return i.buffer}function ys(e){let t="";const n=new Uint8Array(e),r=n.byteLength;for(let e=0;e<r;e++)t+=String.fromCharCode(n[e]);return btoa(t)}function bs(e){return Uint8Array.from(atob(e),(e=>e.charCodeAt(0)))?.buffer}function ws(e){return new TextEncoder("utf-8").encode(e).buffer}function Ss(e){"undefined"==typeof document&&no.log(no.LogLevel.ERROR,"addCookies: not adding any cookies, since there's no document object"),e=e||{};for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)){let n="",r="",i="";const s=e[t],o="object"==typeof s,a=escape(unescape(o?s.value:s));o&&(n=s.expires?";expires="+s.expires:"",r=s.domain?";domain="+s.domain:"",i=s.path?";path="+s.path:""),document.cookie=t+"="+a+n+r+i}}let As=null;function Es(){return As||(As=hs()),As}function xs(e){return Es().createTextNode(e)}function Ns(e){let t;if(ls){t=(new ls).parseFromString(e,"text/xml")}else t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(e);return t}function Is(e){if(!e)return null;const t=Es().createElement(e);for(let e=1;e<arguments.length;e++){const n=arguments[e];if(n)if("string"==typeof n||"number"==typeof n)t.appendChild(xs(n));else if("object"==typeof n&&"function"==typeof n.sort)for(let e=0;e<n.length;e++){const r=n[e];"object"==typeof r&&"function"==typeof r.sort&&void 0!==r[1]&&null!==r[1]&&t.setAttribute(r[0],r[1])}else if("object"==typeof n)for(const e in n)Object.prototype.hasOwnProperty.call(n,e)&&void 0!==n[e]&&null!==n[e]&&t.setAttribute(e,n[e])}return t}function Cs(e){for(let t=0;t<gs.tags.length;t++)if(e===gs.tags[t])return!0;return!1}function Ts(e,t){if(void 0!==gs.attributes[e]&&gs.attributes[e].length>0)for(let n=0;n<gs.attributes[e].length;n++)if(t===gs.attributes[e][n])return!0;return!1}function Os(e){for(let t=0;t<gs.css.length;t++)if(e===gs.css[t])return!0;return!1}function js(e){let t;if(e.nodeType===ms.NORMAL){const n=e.nodeName.toLowerCase();if(Cs(n))try{t=Is(n);for(let r=0;r<gs.attributes[n].length;r++){const i=gs.attributes[n][r];let s=e.getAttribute(i);if(null!=s&&""!==s&&!1!==s&&0!==s)if("style"===i&&"object"==typeof s&&void 0!==s.cssText&&(s=s.cssText),"style"===i){const e=[],n=s.split(";");for(let t=0;t<n.length;t++){const r=n[t].split(":"),i=r[0].replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase();if(Os(i)){const t=r[1].replace(/^\s*/,"").replace(/\s*$/,"");e.push(i+": "+t)}}e.length>0&&(s=e.join("; "),t.setAttribute(i,s))}else t.setAttribute(i,s)}for(let n=0;n<e.childNodes.length;n++)t.appendChild(js(e.childNodes[n]))}catch(e){t=xs("")}else{t=Es().createDocumentFragment();for(let n=0;n<e.childNodes.length;n++)t.appendChild(js(e.childNodes[n]))}}else if(e.nodeType===ms.FRAGMENT){t=Es().createDocumentFragment();for(let n=0;n<e.childNodes.length;n++)t.appendChild(js(e.childNodes[n]))}else e.nodeType===ms.TEXT&&(t=xs(e.nodeValue));return t}function ks(e){let t;if(e.nodeType===ms.NORMAL){t=Is(e.tagName);for(let n=0;n<e.attributes.length;n++)t.setAttribute(e.attributes[n].nodeName,e.attributes[n].value);for(let n=0;n<e.childNodes.length;n++)t.appendChild(ks(e.childNodes[n]))}else e.nodeType===ms.TEXT&&(t=Es().createTextNode(e.nodeValue));return t}function Rs(e){return e=(e=(e=(e=(e=e.replace(/\&/g,"&amp;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;")).replace(/'/g,"&apos;")).replace(/"/g,"&quot;")}function Ms(e){return e=(e=(e=(e=(e=e.replace(/\&amp;/g,"&")).replace(/&lt;/g,"<")).replace(/&gt;/g,">")).replace(/&apos;/g,"'")).replace(/&quot;/g,'"')}function Ds(e){if(!e)return null;"function"==typeof e.tree&&(e=e.tree());const t=[...Array(e.attributes.length).keys()].map((t=>e.attributes[t].nodeName));t.sort();let n=t.reduce(((t,n)=>`${t} ${n}="${Rs(e.attributes.getNamedItem(n).value)}"`),`<${e.nodeName}`);if(e.childNodes.length>0){n+=">";for(let t=0;t<e.childNodes.length;t++){const r=e.childNodes[t];switch(r.nodeType){case ms.NORMAL:n+=Ds(r);break;case ms.TEXT:n+=Rs(r.nodeValue);break;case ms.CDATA:n+="<![CDATA["+r.nodeValue+"]]>"}}n+="</"+e.nodeName+">"}else n+="/>";return n}function $s(e,t,n){for(let r=0;r<e.childNodes.length;r++){const i=e.childNodes[r];i.nodeType!==ms.NORMAL||t&&!this.isTagEqual(i,t)||n(i)}}function Fs(e,t){return e.tagName===t}function Ps(e){if(!e)return null;let t="";e.childNodes?.length||e.nodeType!==ms.TEXT||(t+=e.nodeValue);for(let n=0;n<e.childNodes?.length;n++)e.childNodes[n].nodeType===ms.TEXT&&(t+=e.childNodes[n].nodeValue);return Rs(t)}function Ls(e){return"string"!=typeof e?e:e.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")}function zs(e){return"string"!=typeof e?e:e.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")}function Us(e){return e.indexOf("@")<0?null:e.split("@")[0]}function Bs(e){const t=qs(e);if(t.indexOf("@")<0)return t;{const e=t.split("@");return e.splice(0,1),e.join("@")}}function Hs(e){if(!e)return null;const t=e.split("/");return t.length<2?null:(t.splice(0,1),t.join("/"))}function qs(e){return e?e.split("/")[0]:null}const Js={utf16to8:vs,xorArrayBuffers:_s,arrayBufToBase64:ys,base64ToArrayBuf:bs,stringToArrayBuf:ws,addCookies:Ss};function Ws(e,t){return new Ys(e,t)}function Gs(e){return new Ys("message",e)}function Qs(e){return new Ys("iq",e)}function Vs(e){return new Ys("presence",e)}class Ys{constructor(e,t){"presence"!==e&&"message"!==e&&"iq"!==e||(t&&!t.xmlns?t.xmlns=fs.CLIENT:t||(t={xmlns:fs.CLIENT})),this.nodeTree=Is(e,t),this.node=this.nodeTree}tree(){return this.nodeTree}toString(){return Ds(this.nodeTree)}up(){return this.node=this.node.parentNode,this}root(){return this.node=this.nodeTree,this}attrs(e){for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(void 0===e[t]?this.node.removeAttribute(t):this.node.setAttribute(t,e[t]));return this}c(e,t,n){const r=Is(e,t,n);return this.node.appendChild(r),"string"!=typeof n&&"number"!=typeof n&&(this.node=r),this}cnode(e){let t;const n=Es();try{t=void 0!==n.importNode}catch(e){t=!1}const r=t?n.importNode(e,!0):ks(e);return this.node.appendChild(r),this.node=r,this}t(e){const t=xs(e);return this.node.appendChild(t),this}h(e){const t=Es().createElement("body");t.innerHTML=e;const n=js(t);for(;n.childNodes.length>0;)this.node.appendChild(n.childNodes[0]);return this}}class Xs{constructor(e,t,n,r,i,s,o){this.handler=e,this.ns=t,this.name=n,this.type=r,this.id=i,this.options=o||{matchBareFromJid:!1,ignoreNamespaceFragment:!1},this.options.matchBare&&(no.warn('The "matchBare" option is deprecated, use "matchBareFromJid" instead.'),this.options.matchBareFromJid=this.options.matchBare,delete this.options.matchBare),this.options.matchBareFromJid?this.from=s?qs(s):null:this.from=s,this.user=!0}getNamespace(e){let t=e.getAttribute("xmlns");return t&&this.options.ignoreNamespaceFragment&&(t=t.split("#")[0]),t}namespaceMatch(e){let t=!1;return!this.ns||($s(e,null,(e=>{this.getNamespace(e)===this.ns&&(t=!0)})),t||this.getNamespace(e)===this.ns)}isMatch(e){let t=e.getAttribute("from");this.options.matchBareFromJid&&(t=qs(t));const n=e.getAttribute("type");return!(!this.namespaceMatch(e)||this.name&&!no.isTagEqual(e,this.name)||this.type&&(Array.isArray(this.type)?-1===this.type.indexOf(n):n!==this.type)||this.id&&e.getAttribute("id")!==this.id||this.from&&t!==this.from)}run(e){let t=null;try{t=this.handler(e)}catch(e){throw no._handleError(e),e}return t}toString(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}}class Ks{constructor(e,t){this.period=e,this.handler=t,this.lastCalled=(new Date).getTime(),this.user=!0}run(){return this.lastCalled=(new Date).getTime(),this.handler()}reset(){this.lastCalled=(new Date).getTime()}toString(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}}var Zs=o(609);class eo{constructor(e,t,n){this.mechname=e,this.isClientFirst=t,this.priority=n}test(){return!0}onStart(e){this._connection=e}onChallenge(e,t){throw new Error("You should implement challenge handling!")}clientChallenge(e){if(!this.isClientFirst)throw new Error("clientChallenge should not be called if isClientFirst is false!");return this.onChallenge(e)}onFailure(){this._connection=null}onSuccess(){this._connection=null}}const to={async scramResponse(e,t,n,r){const i=e._sasl_data.cnonce,s=function(e){let t,n,r;const i=/([a-z]+)=([^,]+)(,|$)/;for(;e.match(i);){const s=e.match(i);switch(e=e.replace(s[0],""),s[1]){case"r":t=s[2];break;case"s":n=Js.base64ToArrayBuf(s[2]);break;case"i":r=parseInt(s[2],10);break;default:return}}if(isNaN(r)||r<4096)no.warn("Failing SCRAM authentication because server supplied iteration count < 4096.");else{if(n)return{nonce:t,salt:n,iter:r};no.warn("Failing SCRAM authentication because server supplied incorrect salt.")}}(t);if(!s&&s?.nonce.slice(0,i.length)!==i)return no.warn("Failing SCRAM authentication because server supplied incorrect nonce."),e._sasl_data={},e._sasl_failure_cb();let o,a;if(e.pass?.name===n&&e.pass?.salt===Js.arrayBufToBase64(s.salt)&&e.pass?.iter===s.iter)o=Js.base64ToArrayBuf(e.pass.ck),a=Js.base64ToArrayBuf(e.pass.sk);else{if(!("string"==typeof e.pass||e.pass instanceof String))return e._sasl_failure_cb();{const t=await async function(e,t,n,r,i){const s=await crypto.subtle.deriveBits({name:"PBKDF2",salt:t,iterations:n,hash:{name:r}},await crypto.subtle.importKey("raw",Js.stringToArrayBuf(e),"PBKDF2",!1,["deriveBits"]),i),o=await crypto.subtle.importKey("raw",s,{name:"HMAC",hash:r},!1,["sign"]);return{ck:await crypto.subtle.sign("HMAC",o,Js.stringToArrayBuf("Client Key")),sk:await crypto.subtle.sign("HMAC",o,Js.stringToArrayBuf("Server Key"))}}(e.pass,s.salt,s.iter,n,r);o=t.ck,a=t.sk}}const c=e._sasl_data["client-first-message-bare"],u=t,d=`c=biws,r=${s.nonce}`,l=`${c},${u},${d}`,h=await async function(e,t,n){const r=await crypto.subtle.importKey("raw",await crypto.subtle.digest(n,t),{name:"HMAC",hash:n},!1,["sign"]),i=await crypto.subtle.sign("HMAC",r,Js.stringToArrayBuf(e));return Js.xorArrayBuffers(t,i)}(l,o,n),f=await async function(e,t,n){const r=await crypto.subtle.importKey("raw",t,{name:"HMAC",hash:n},!1,["sign"]);return crypto.subtle.sign("HMAC",r,Js.stringToArrayBuf(e))}(l,a,n);return e._sasl_data["server-signature"]=Js.arrayBufToBase64(f),e._sasl_data.keys={name:n,iter:s.iter,salt:Js.arrayBufToBase64(s.salt),ck:Js.arrayBufToBase64(o),sk:Js.arrayBufToBase64(a)},`${d},p=${Js.arrayBufToBase64(h)}`},clientChallenge(e,t){const n=t||function(){const e=new Uint8Array(16);return Js.arrayBufToBase64(crypto.getRandomValues(e).buffer)}(),r=`n=${e.authcid},r=${n}`;return e._sasl_data.cnonce=n,e._sasl_data["client-first-message-bare"]=r,`n,,${r}`}};const no={VERSION:"1.6.1",Builder:Ys,Connection:class{constructor(e,t){this.service=e,this.options=t||{},this.setProtocol(),this.jid="",this.domain=null,this.features=null,this._sasl_data={},this.do_bind=!1,this.do_session=!1,this.mechanisms={},this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.protocolErrorHandlers={HTTP:{},websocket:{}},this._idleTimeout=null,this._disconnectTimeout=null,this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.do_authentication=!0,this.paused=!1,this.restored=!1,this._data=[],this._uniqueId=0,this._sasl_success_handler=null,this._sasl_failure_handler=null,this._sasl_challenge_handler=null,this.maxRetries=5,this._idleTimeout=setTimeout((()=>this._onIdle()),100),Ss(this.options.cookies),this.registerSASLMechanisms(this.options.mechanisms),this.iqFallbackHandler=new Xs((e=>this.send(Qs({type:"error",id:e.getAttribute("id")}).c("error",{type:"cancel"}).c("service-unavailable",{xmlns:no.NS.STANZAS}))),null,"iq",["get","set"]);for(const e in no._connectionPlugins)if(Object.prototype.hasOwnProperty.call(no._connectionPlugins,e)){const t=function(){};t.prototype=no._connectionPlugins[e],this[e]=new t,this[e].init(this)}}setProtocol(){const e=this.options.protocol||"";this.options.worker?this._proto=new no.WorkerWebsocket(this):0===this.service.indexOf("ws:")||0===this.service.indexOf("wss:")||0===e.indexOf("ws")?this._proto=new no.Websocket(this):this._proto=new no.Bosh(this)}reset(){this._proto._reset(),this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.restored=!1,this._data=[],this._requests=[],this._uniqueId=0}pause(){this.paused=!0}resume(){this.paused=!1}getUniqueId(e){const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}));return"string"==typeof e||"number"==typeof e?t+":"+e:t+""}addProtocolErrorHandler(e,t,n){this.protocolErrorHandlers[e][t]=n}connect(e,t,n,r,i,s,o){let a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3e3;this.jid=e,this.authzid=no.getBareJidFromJid(this.jid),this.authcid=o||no.getNodeFromJid(this.jid),this.pass=t,this.scram_keys=null,this.connect_callback=n,this.disconnecting=!1,this.connected=!1,this.authenticated=!1,this.restored=!1,this.disconnection_timeout=a,this.domain=no.getDomainFromJid(this.jid),this._changeConnectStatus(ps.CONNECTING,null),this._proto._connect(r,i,s)}attach(e,t,n,r,i,s,o){if(this._proto._attach)return this._proto._attach(e,t,n,r,i,s,o);{const e=new Error('The "attach" method is not available for your connection protocol');throw e.name="StropheSessionError",e}}restore(e,t,n,r,i){if(!this._sessionCachingSupported()){const e=new Error('The "restore" method can only be used with a BOSH connection.');throw e.name="StropheSessionError",e}this._proto._restore(e,t,n,r,i)}_sessionCachingSupported(){if(this._proto instanceof no.Bosh){if(!JSON)return!1;try{sessionStorage.setItem("_strophe_","_strophe_"),sessionStorage.removeItem("_strophe_")}catch(e){return!1}return!0}return!1}xmlInput(e){}xmlOutput(e){}rawInput(e){}rawOutput(e){}nextValidRid(e){}send(e){if(null!==e){if("function"==typeof e.sort)for(let t=0;t<e.length;t++)this._queueData(e[t]);else"function"==typeof e.tree?this._queueData(e.tree()):this._queueData(e);this._proto._send()}}flush(){clearTimeout(this._idleTimeout),this._onIdle()}sendPresence(e,t,n,r){let i=null;"function"==typeof e.tree&&(e=e.tree());let s=e.getAttribute("id");if(s||(s=this.getUniqueId("sendPresence"),e.setAttribute("id",s)),"function"==typeof t||"function"==typeof n){const e=this.addHandler((e=>{i&&this.deleteTimedHandler(i),"error"===e.getAttribute("type")?n&&n(e):t&&t(e)}),null,"presence",null,s);r&&(i=this.addTimedHandler(r,(()=>(this.deleteHandler(e),n&&n(null),!1))))}return this.send(e),s}sendIQ(e,t,n,r){let i=null;"function"==typeof e.tree&&(e=e.tree());let s=e.getAttribute("id");if(s||(s=this.getUniqueId("sendIQ"),e.setAttribute("id",s)),"function"==typeof t||"function"==typeof n){const e=this.addHandler((e=>{i&&this.deleteTimedHandler(i);const r=e.getAttribute("type");if("result"===r)t&&t(e);else{if("error"!==r){const e=new Error(`Got bad IQ type of ${r}`);throw e.name="StropheError",e}n&&n(e)}}),null,"iq",["error","result"],s);r&&(i=this.addTimedHandler(r,(()=>(this.deleteHandler(e),n&&n(null),!1))))}return this.send(e),s}_queueData(e){if(null===e||!e.tagName||!e.childNodes){const e=new Error("Cannot queue non-DOMElement.");throw e.name="StropheError",e}this._data.push(e)}_sendRestart(){this._data.push("restart"),this._proto._sendRestart(),this._idleTimeout=setTimeout((()=>this._onIdle()),100)}addTimedHandler(e,t){const n=new no.TimedHandler(e,t);return this.addTimeds.push(n),n}deleteTimedHandler(e){this.removeTimeds.push(e)}addHandler(e,t,n,r,i,s,o){const a=new Xs(e,t,n,r,i,s,o);return this.addHandlers.push(a),a}deleteHandler(e){this.removeHandlers.push(e);const t=this.addHandlers.indexOf(e);t>=0&&this.addHandlers.splice(t,1)}registerSASLMechanisms(e){this.mechanisms={},(e=e||[no.SASLAnonymous,no.SASLExternal,no.SASLOAuthBearer,no.SASLXOAuth2,no.SASLPlain,no.SASLSHA1,no.SASLSHA256,no.SASLSHA384,no.SASLSHA512]).forEach((e=>this.registerSASLMechanism(e)))}registerSASLMechanism(e){const t=new e;this.mechanisms[t.mechname]=t}disconnect(e){if(this._changeConnectStatus(ps.DISCONNECTING,e),e?no.warn("Disconnect was called because: "+e):no.info("Disconnect was called"),this.connected){let e=!1;this.disconnecting=!0,this.authenticated&&(e=Vs({xmlns:no.NS.CLIENT,type:"unavailable"})),this._disconnectTimeout=this._addSysTimedHandler(this.disconnection_timeout,this._onDisconnectTimeout.bind(this)),this._proto._disconnect(e)}else no.warn("Disconnect was called before Strophe connected to the server"),this._proto._abortAllRequests(),this._doDisconnect()}_changeConnectStatus(e,t,n){for(const n in no._connectionPlugins)if(Object.prototype.hasOwnProperty.call(no._connectionPlugins,n)){const r=this[n];if(r.statusChanged)try{r.statusChanged(e,t)}catch(e){no.error(`${n} plugin caused an exception changing status: ${e}`)}}if(this.connect_callback)try{this.connect_callback(e,t,n)}catch(e){no._handleError(e),no.error(`User connection callback caused an exception: ${e}`)}}_doDisconnect(e){"number"==typeof this._idleTimeout&&clearTimeout(this._idleTimeout),null!==this._disconnectTimeout&&(this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null),no.debug("_doDisconnect was called"),this._proto._doDisconnect(),this.authenticated=!1,this.disconnecting=!1,this.restored=!1,this.handlers=[],this.timedHandlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._changeConnectStatus(ps.DISCONNECTED,e),this.connected=!1}_dataRecv(e,t){const n=this._proto._reqToData(e);if(null===n)return;for(this.xmlInput!==no.Connection.prototype.xmlInput&&(n.nodeName===this._proto.strip&&n.childNodes.length?this.xmlInput(n.childNodes[0]):this.xmlInput(n)),this.rawInput!==no.Connection.prototype.rawInput&&(t?this.rawInput(t):this.rawInput(no.serialize(n)));this.removeHandlers.length>0;){const e=this.removeHandlers.pop(),t=this.handlers.indexOf(e);t>=0&&this.handlers.splice(t,1)}for(;this.addHandlers.length>0;)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&this._proto._emptyQueue())return void this._doDisconnect();const r=n.getAttribute("type");if(null!==r&&"terminate"===r){if(this.disconnecting)return;let e=n.getAttribute("condition");const t=n.getElementsByTagName("conflict");return null!==e?("remote-stream-error"===e&&t.length>0&&(e="conflict"),this._changeConnectStatus(ps.CONNFAIL,e)):this._changeConnectStatus(ps.CONNFAIL,no.ErrorCondition.UNKOWN_REASON),void this._doDisconnect(e)}no.forEachChild(n,null,(e=>{const t=[];this.handlers=this.handlers.reduce(((n,r)=>{try{!r.isMatch(e)||!this.authenticated&&r.user?n.push(r):(r.run(e)&&n.push(r),t.push(r))}catch(e){no.warn("Removing Strophe handlers due to uncaught exception: "+e.message)}return n}),[]),!t.length&&this.iqFallbackHandler.isMatch(e)&&this.iqFallbackHandler.run(e)}))}_connect_cb(e,t,n){let r;no.debug("_connect_cb was called"),this.connected=!0;try{r=this._proto._reqToData(e)}catch(e){if(e.name!==no.ErrorCondition.BAD_FORMAT)throw e;this._changeConnectStatus(ps.CONNFAIL,no.ErrorCondition.BAD_FORMAT),this._doDisconnect(no.ErrorCondition.BAD_FORMAT)}if(!r)return;this.xmlInput!==no.Connection.prototype.xmlInput&&(r.nodeName===this._proto.strip&&r.childNodes.length?this.xmlInput(r.childNodes[0]):this.xmlInput(r)),this.rawInput!==no.Connection.prototype.rawInput&&(n?this.rawInput(n):this.rawInput(no.serialize(r)));if(this._proto._connect_cb(r)===ps.CONNFAIL)return;let i;if(i=r.getElementsByTagNameNS?r.getElementsByTagNameNS(no.NS.STREAM,"features").length>0:r.getElementsByTagName("stream:features").length>0||r.getElementsByTagName("features").length>0,!i)return void this._proto._no_auth_received(t);const s=Array.from(r.getElementsByTagName("mechanism")).map((e=>this.mechanisms[e.textContent])).filter((e=>e));0!==s.length||0!==r.getElementsByTagName("auth").length?!1!==this.do_authentication&&this.authenticate(s):this._proto._no_auth_received(t)}sortMechanismsByPriority(e){for(let t=0;t<e.length-1;++t){let n=t;for(let r=t+1;r<e.length;++r)e[r].priority>e[n].priority&&(n=r);if(n!==t){const r=e[t];e[t]=e[n],e[n]=r}}return e}authenticate(e){this._attemptSASLAuth(e)||this._attemptLegacyAuth()}_attemptSASLAuth(e){e=this.sortMechanismsByPriority(e||[]);let t=!1;for(let n=0;n<e.length;++n){if(!e[n].test(this))continue;this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge_cb.bind(this),null,"challenge",null,null),this._sasl_mechanism=e[n],this._sasl_mechanism.onStart(this);const r=Ws("auth",{xmlns:no.NS.SASL,mechanism:this._sasl_mechanism.mechname});if(this._sasl_mechanism.isClientFirst){const e=this._sasl_mechanism.clientChallenge(this);r.t((0,Zs.btoa)(e))}this.send(r.tree()),t=!0;break}return t}async _sasl_challenge_cb(e){const t=(0,Zs.atob)(Ps(e)),n=await this._sasl_mechanism.onChallenge(this,t),r=Ws("response",{xmlns:no.NS.SASL});return""!==n&&r.t((0,Zs.btoa)(n)),this.send(r.tree()),!0}_attemptLegacyAuth(){null===no.getNodeFromJid(this.jid)?(this._changeConnectStatus(ps.CONNFAIL,no.ErrorCondition.MISSING_JID_NODE),this.disconnect(no.ErrorCondition.MISSING_JID_NODE)):(this._changeConnectStatus(ps.AUTHENTICATING,null),this._addSysHandler(this._onLegacyAuthIQResult.bind(this),null,null,null,"_auth_1"),this.send(Qs({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:no.NS.AUTH}).c("username",{}).t(no.getNodeFromJid(this.jid)).tree()))}_onLegacyAuthIQResult(e){const t=Qs({type:"set",id:"_auth_2"}).c("query",{xmlns:no.NS.AUTH}).c("username",{}).t(no.getNodeFromJid(this.jid)).up().c("password").t(this.pass);return no.getResourceFromJid(this.jid)||(this.jid=no.getBareJidFromJid(this.jid)+"/strophe"),t.up().c("resource",{}).t(no.getResourceFromJid(this.jid)),this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2"),this.send(t.tree()),!1}_sasl_success_cb(e){if(this._sasl_data["server-signature"]){let t;const n=/([a-z]+)=([^,]+)(,|$)/,r=(0,Zs.atob)(Ps(e)).match(n);if("v"===r[1]&&(t=r[2]),t!==this._sasl_data["server-signature"])return this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_data={},this._sasl_failure_cb(null)}no.info("SASL authentication succeeded."),this._sasl_data.keys&&(this.scram_keys=this._sasl_data.keys),this._sasl_mechanism&&this._sasl_mechanism.onSuccess(),this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null);const t=[],n=(e,t)=>{for(;e.length;)this.deleteHandler(e.pop());return this._onStreamFeaturesAfterSASL(t),!1};return t.push(this._addSysHandler((e=>n(t,e)),null,"stream:features",null,null)),t.push(this._addSysHandler((e=>n(t,e)),no.NS.STREAM,"features",null,null)),this._sendRestart(),!1}_onStreamFeaturesAfterSASL(e){this.features=e;for(let t=0;t<e.childNodes.length;t++){const n=e.childNodes[t];"bind"===n.nodeName&&(this.do_bind=!0),"session"===n.nodeName&&(this.do_session=!0)}return this.do_bind?(this.options.explicitResourceBinding?this._changeConnectStatus(ps.BINDREQUIRED,null):this.bind(),!1):(this._changeConnectStatus(ps.AUTHFAIL,null),!1)}bind(){if(!this.do_bind)return void no.log(no.LogLevel.INFO,'Strophe.Connection.prototype.bind called but "do_bind" is false');this._addSysHandler(this._onResourceBindResultIQ.bind(this),null,null,null,"_bind_auth_2");const e=no.getResourceFromJid(this.jid);e?this.send(Qs({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:no.NS.BIND}).c("resource",{}).t(e).tree()):this.send(Qs({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:no.NS.BIND}).tree())}_onResourceBindResultIQ(e){if("error"===e.getAttribute("type")){no.warn("Resource binding failed.");let t;return e.getElementsByTagName("conflict").length>0&&(t=no.ErrorCondition.CONFLICT),this._changeConnectStatus(ps.AUTHFAIL,t,e),!1}const t=e.getElementsByTagName("bind");if(!(t.length>0))return no.warn("Resource binding failed."),this._changeConnectStatus(ps.AUTHFAIL,null,e),!1;{const e=t[0].getElementsByTagName("jid");e.length>0&&(this.authenticated=!0,this.jid=Ps(e[0]),this.do_session?this._establishSession():this._changeConnectStatus(ps.CONNECTED,null))}}_establishSession(){if(!this.do_session)throw new Error(`Strophe.Connection.prototype._establishSession called but apparently ${no.NS.SESSION} wasn't advertised by the server`);this._addSysHandler(this._onSessionResultIQ.bind(this),null,null,null,"_session_auth_2"),this.send(Qs({type:"set",id:"_session_auth_2"}).c("session",{xmlns:no.NS.SESSION}).tree())}_onSessionResultIQ(e){if("result"===e.getAttribute("type"))this.authenticated=!0,this._changeConnectStatus(ps.CONNECTED,null);else if("error"===e.getAttribute("type"))return this.authenticated=!1,no.warn("Session creation failed."),this._changeConnectStatus(ps.AUTHFAIL,null,e),!1;return!1}_sasl_failure_cb(e){return this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null),this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_mechanism&&this._sasl_mechanism.onFailure(),this._changeConnectStatus(ps.AUTHFAIL,null,e),!1}_auth2_cb(e){return"result"===e.getAttribute("type")?(this.authenticated=!0,this._changeConnectStatus(ps.CONNECTED,null)):"error"===e.getAttribute("type")&&(this._changeConnectStatus(ps.AUTHFAIL,null,e),this.disconnect("authentication failed")),!1}_addSysTimedHandler(e,t){const n=new Ks(e,t);return n.user=!1,this.addTimeds.push(n),n}_addSysHandler(e,t,n,r,i){const s=new Xs(e,t,n,r,i);return s.user=!1,this.addHandlers.push(s),s}_onDisconnectTimeout(){return no.debug("_onDisconnectTimeout was called"),this._changeConnectStatus(ps.CONNTIMEOUT,null),this._proto._onDisconnectTimeout(),this._doDisconnect(),!1}_onIdle(){for(;this.addTimeds.length>0;)this.timedHandlers.push(this.addTimeds.pop());for(;this.removeTimeds.length>0;){const e=this.removeTimeds.pop(),t=this.timedHandlers.indexOf(e);t>=0&&this.timedHandlers.splice(t,1)}const e=(new Date).getTime(),t=[];for(let n=0;n<this.timedHandlers.length;n++){const r=this.timedHandlers[n];if(this.authenticated||!r.user){r.lastCalled+r.period-e<=0?r.run()&&t.push(r):t.push(r)}}this.timedHandlers=t,clearTimeout(this._idleTimeout),this._proto._onIdle(),this.connected&&(this._idleTimeout=setTimeout((()=>this._onIdle()),100))}},ElementType:ms,ErrorCondition:{BAD_FORMAT:"bad-format",CONFLICT:"conflict",MISSING_JID_NODE:"x-strophe-bad-non-anon-jid",NO_AUTH_MECH:"no-auth-mech",UNKNOWN_REASON:"unknown"},Handler:Xs,LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},NS:fs,SASLMechanism:eo,Status:ps,TimedHandler:Ks,...t,XHTML:{...gs,validTag:Cs,validCSS:Os,validAttribute:Ts},addNamespace(e,t){no.NS[e]=t},_handleError(e){void 0!==e.stack&&no.fatal(e.stack),e.sourceURL?no.fatal("error: "+this.handler+" "+e.sourceURL+":"+e.line+" - "+e.name+": "+e.message):e.fileName?no.fatal("error: "+this.handler+" "+e.fileName+":"+e.lineNumber+" - "+e.name+": "+e.message):no.fatal("error: "+e.message)},log(e,t){e===this.LogLevel.FATAL&&console?.error(t)},debug(e){this.log(this.LogLevel.DEBUG,e)},info(e){this.log(this.LogLevel.INFO,e)},warn(e){this.log(this.LogLevel.WARN,e)},error(e){this.log(this.LogLevel.ERROR,e)},fatal(e){this.log(this.LogLevel.FATAL,e)},_requestId:0,_connectionPlugins:{},addConnectionPlugin(e,t){no._connectionPlugins[e]=t}};no.SASLAnonymous=class extends eo{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ANONYMOUS",arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&void 0!==arguments[2]?arguments[2]:20)}test(e){return null===e.authcid}},no.SASLPlain=class extends eo{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"PLAIN",!(arguments.length>1&&void 0!==arguments[1])||arguments[1],arguments.length>2&&void 0!==arguments[2]?arguments[2]:50)}test(e){return null!==e.authcid}onChallenge(e){const{authcid:t,authzid:n,domain:r,pass:i}=e;if(!r)throw new Error("SASLPlain onChallenge: domain is not defined!");let s=n!==`${t}@${r}`?n:"";return s+="\0",s+=t,s+="\0",s+=i,Js.utf16to8(s)}},no.SASLSHA1=class extends eo{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"SCRAM-SHA-1",!(arguments.length>1&&void 0!==arguments[1])||arguments[1],arguments.length>2&&void 0!==arguments[2]?arguments[2]:60)}test(e){return null!==e.authcid}async onChallenge(e,t){return await to.scramResponse(e,t,"SHA-1",160)}clientChallenge(e,t){return to.clientChallenge(e,t)}},no.SASLSHA256=class extends eo{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"SCRAM-SHA-256",!(arguments.length>1&&void 0!==arguments[1])||arguments[1],arguments.length>2&&void 0!==arguments[2]?arguments[2]:70)}test(e){return null!==e.authcid}async onChallenge(e,t){return await to.scramResponse(e,t,"SHA-256",256)}clientChallenge(e,t){return to.clientChallenge(e,t)}},no.SASLSHA384=class extends eo{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"SCRAM-SHA-384",!(arguments.length>1&&void 0!==arguments[1])||arguments[1],arguments.length>2&&void 0!==arguments[2]?arguments[2]:71)}test(e){return null!==e.authcid}async onChallenge(e,t){return await to.scramResponse(e,t,"SHA-384",384)}clientChallenge(e,t){return to.clientChallenge(e,t)}},no.SASLSHA512=class extends eo{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"SCRAM-SHA-512",!(arguments.length>1&&void 0!==arguments[1])||arguments[1],arguments.length>2&&void 0!==arguments[2]?arguments[2]:72)}test(e){return null!==e.authcid}async onChallenge(e,t){return await to.scramResponse(e,t,"SHA-512",512)}clientChallenge(e,t){return to.clientChallenge(e,t)}},no.SASLOAuthBearer=class extends eo{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"OAUTHBEARER",!(arguments.length>1&&void 0!==arguments[1])||arguments[1],arguments.length>2&&void 0!==arguments[2]?arguments[2]:40)}test(e){return null!==e.pass}onChallenge(e){let t="n,";return null!==e.authcid&&(t=t+"a="+e.authzid),t+=",",t+="",t+="auth=Bearer ",t+=e.pass,t+="",t+="",Js.utf16to8(t)}},no.SASLExternal=class extends eo{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"EXTERNAL",!(arguments.length>1&&void 0!==arguments[1])||arguments[1],arguments.length>2&&void 0!==arguments[2]?arguments[2]:10)}onChallenge(e){return e.authcid===e.authzid?"":e.authzid}},no.SASLXOAuth2=class extends eo{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"X-OAUTH2",!(arguments.length>1&&void 0!==arguments[1])||arguments[1],arguments.length>2&&void 0!==arguments[2]?arguments[2]:30)}test(e){return null!==e.pass}onChallenge(e){let t="\0";return null!==e.authcid&&(t+=e.authzid),t+="\0",t+=e.pass,Js.utf16to8(t)}};const ro={Strophe:no,$build:Ws,$iq:Qs,$msg:Gs,$pres:Vs};no.Request=class{constructor(e,t,n,r){this.id=++no._requestId,this.xmlData=e,this.data=no.serialize(e),this.origFunc=t,this.func=t,this.rid=n,this.date=NaN,this.sends=r||0,this.abort=!1,this.dead=null,this.age=function(){if(!this.date)return 0;return(new Date-this.date)/1e3},this.timeDead=function(){if(!this.dead)return 0;return(new Date-this.dead)/1e3},this.xhr=this._newXHR()}getResponse(){let e=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){if(e=this.xhr.responseXML.documentElement,"parsererror"===e.tagName)throw no.error("invalid response received"),no.error("responseText: "+this.xhr.responseText),no.error("responseXML: "+no.serialize(this.xhr.responseXML)),new Error("parsererror")}else if(this.xhr.responseText){no.debug("Got responseText but no responseXML; attempting to parse it with DOMParser..."),e=(new ls).parseFromString(this.xhr.responseText,"application/xml").documentElement;const t=e?.querySelector("parsererror");if(!e||t){t&&(no.error("invalid response received: "+t.textContent),no.error("responseText: "+this.xhr.responseText));const e=new Error;throw e.name=no.ErrorCondition.BAD_FORMAT,e}}return e}_newXHR(){let e=null;return globalThis.XMLHttpRequest?(e=new XMLHttpRequest,e.overrideMimeType&&e.overrideMimeType("text/xml; charset=utf-8")):globalThis.ActiveXObject&&(e=new ActiveXObject("Microsoft.XMLHTTP")),e.onreadystatechange=this.func.bind(null,this),e}},no.Bosh=class e{constructor(e){this._conn=e,this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.hold=1,this.wait=60,this.window=5,this.errors=0,this.inactivity=null,this.lastResponseHeaders=null,this._requests=[]}_buildBody(){const e=Ws("body",{rid:this.rid++,xmlns:no.NS.HTTPBIND});return null!==this.sid&&e.attrs({sid:this.sid}),this._conn.options.keepalive&&this._conn._sessionCachingSupported()&&this._cacheSession(),e}_reset(){this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.errors=0,this._conn._sessionCachingSupported()&&sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)}_connect(e,t,n){this.wait=e||this.wait,this.hold=t||this.hold,this.errors=0;const r=this._buildBody().attrs({to:this._conn.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":no.NS.BOSH});n&&r.attrs({route:n});const i=this._conn._connect_cb;this._requests.push(new no.Request(r.tree(),this._onRequestStateChange.bind(this,i.bind(this._conn)),r.tree().getAttribute("rid"))),this._throttledRequestHandler()}_attach(e,t,n,r,i,s,o){this._conn.jid=e,this.sid=t,this.rid=n,this._conn.connect_callback=r,this._conn.domain=no.getDomainFromJid(this._conn.jid),this._conn.authenticated=!0,this._conn.connected=!0,this.wait=i||this.wait,this.hold=s||this.hold,this.window=o||this.window,this._conn._changeConnectStatus(no.Status.ATTACHED,null)}_restore(e,t,n,r,i){const s=JSON.parse(sessionStorage.getItem("strophe-bosh-session"));if(!(null!=s&&s.rid&&s.sid&&s.jid&&(null==e||no.getBareJidFromJid(s.jid)===no.getBareJidFromJid(e)||null===no.getNodeFromJid(e)&&no.getDomainFromJid(s.jid)===e))){const e=new Error("_restore: no restoreable session.");throw e.name="StropheSessionError",e}this._conn.restored=!0,this._attach(s.jid,s.sid,s.rid,t,n,r,i)}_cacheSession(){this._conn.authenticated?this._conn.jid&&this.rid&&this.sid&&sessionStorage.setItem("strophe-bosh-session",JSON.stringify({jid:this._conn.jid,rid:this.rid,sid:this.sid})):sessionStorage.removeItem("strophe-bosh-session")}_connect_cb(e){const t=e.getAttribute("type");if(null!==t&&"terminate"===t){let t=e.getAttribute("condition");no.error("BOSH-Connection failed: "+t);const n=e.getElementsByTagName("conflict");return null!==t?("remote-stream-error"===t&&n.length>0&&(t="conflict"),this._conn._changeConnectStatus(no.Status.CONNFAIL,t)):this._conn._changeConnectStatus(no.Status.CONNFAIL,"unknown"),this._conn._doDisconnect(t),no.Status.CONNFAIL}this.sid||(this.sid=e.getAttribute("sid"));const n=e.getAttribute("requests");n&&(this.window=parseInt(n,10));const r=e.getAttribute("hold");r&&(this.hold=parseInt(r,10));const i=e.getAttribute("wait");i&&(this.wait=parseInt(i,10));const s=e.getAttribute("inactivity");s&&(this.inactivity=parseInt(s,10))}_disconnect(e){this._sendTerminate(e)}_doDisconnect(){this.sid=null,this.rid=Math.floor(4294967295*Math.random()),this._conn._sessionCachingSupported()&&sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)}_emptyQueue(){return 0===this._requests.length}_callProtocolErrorHandlers(t){const n=e._getRequestStatus(t),r=this._conn.protocolErrorHandlers.HTTP[n];r&&r.call(this,n)}_hitError(e){this.errors++,no.warn("request errored, status: "+e+", number of errors: "+this.errors),this.errors>4&&this._conn._onDisconnectTimeout()}_no_auth_received(e){no.warn("Server did not yet offer a supported authentication mechanism. Sending a blank poll request."),e=e?e.bind(this._conn):this._conn._connect_cb.bind(this._conn);const t=this._buildBody();this._requests.push(new no.Request(t.tree(),this._onRequestStateChange.bind(this,e),t.tree().getAttribute("rid"))),this._throttledRequestHandler()}_onDisconnectTimeout(){this._abortAllRequests()}_abortAllRequests(){for(;this._requests.length>0;){const e=this._requests.pop();e.abort=!0,e.xhr.abort(),e.xhr.onreadystatechange=function(){}}}_onIdle(){const e=this._conn._data;if(this._conn.authenticated&&0===this._requests.length&&0===e.length&&!this._conn.disconnecting&&(no.debug("no requests during idle cycle, sending blank request"),e.push(null)),!this._conn.paused){if(this._requests.length<2&&e.length>0){const t=this._buildBody();for(let n=0;n<e.length;n++)null!==e[n]&&("restart"===e[n]?t.attrs({to:this._conn.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":no.NS.BOSH}):t.cnode(e[n]).up());delete this._conn._data,this._conn._data=[],this._requests.push(new no.Request(t.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),t.tree().getAttribute("rid"))),this._throttledRequestHandler()}if(this._requests.length>0){const e=this._requests[0].age();null!==this._requests[0].dead&&this._requests[0].timeDead()>Math.floor(no.SECONDARY_TIMEOUT*this.wait)&&this._throttledRequestHandler(),e>Math.floor(no.TIMEOUT*this.wait)&&(no.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(no.TIMEOUT*this.wait)+" seconds since last activity"),this._throttledRequestHandler())}}}static _getRequestStatus(e,t){let n;if(4===e.xhr.readyState)try{n=e.xhr.status}catch(e){no.error("Caught an error while retrieving a request's status, reqStatus: "+n)}return void 0===n&&(n="number"==typeof t?t:0),n}_onRequestStateChange(t,n){if(no.debug("request id "+n.id+"."+n.sends+" state changed to "+n.xhr.readyState),n.abort)return void(n.abort=!1);if(4!==n.xhr.readyState)return;const r=e._getRequestStatus(n);if(this.lastResponseHeaders=n.xhr.getAllResponseHeaders(),this._conn.disconnecting&&r>=400)return this._hitError(r),void this._callProtocolErrorHandlers(n);const i=this._requests[0]===n,s=this._requests[1]===n,o=r>0&&r<500,a=n.sends>this._conn.maxRetries;(o||a)&&(this._removeRequest(n),no.debug("request id "+n.id+" should now be removed")),200===r?((s||i&&this._requests.length>0&&this._requests[0].age()>Math.floor(no.SECONDARY_TIMEOUT*this.wait))&&this._restartRequest(0),this._conn.nextValidRid(Number(n.rid)+1),no.debug("request id "+n.id+"."+n.sends+" got 200"),t(n),this.errors=0):0===r||r>=400&&r<600||r>=12e3?(no.error("request id "+n.id+"."+n.sends+" error "+r+" happened"),this._hitError(r),this._callProtocolErrorHandlers(n),r>=400&&r<500&&(this._conn._changeConnectStatus(no.Status.DISCONNECTING,null),this._conn._doDisconnect())):no.error("request id "+n.id+"."+n.sends+" error "+r+" happened"),o||a?a&&!this._conn.connected&&this._conn._changeConnectStatus(no.Status.CONNFAIL,"giving-up"):this._throttledRequestHandler()}_processRequest(t){let n=this._requests[t];const r=e._getRequestStatus(n,-1);if(n.sends>this._conn.maxRetries)return void this._conn._onDisconnectTimeout();const i=n.age(),s=!isNaN(i)&&i>Math.floor(no.TIMEOUT*this.wait),o=null!==n.dead&&n.timeDead()>Math.floor(no.SECONDARY_TIMEOUT*this.wait),a=4===n.xhr.readyState&&(r<1||r>=500);if((s||o||a)&&(o&&no.error(`Request ${this._requests[t].id} timed out (secondary), restarting`),n.abort=!0,n.xhr.abort(),n.xhr.onreadystatechange=function(){},this._requests[t]=new no.Request(n.xmlData,n.origFunc,n.rid,n.sends),n=this._requests[t]),0===n.xhr.readyState){no.debug("request id "+n.id+"."+n.sends+" posting");try{const e=this._conn.options.contentType||"text/xml; charset=utf-8";n.xhr.open("POST",this._conn.service,!this._conn.options.sync),void 0!==n.xhr.setRequestHeader&&n.xhr.setRequestHeader("Content-Type",e),this._conn.options.withCredentials&&(n.xhr.withCredentials=!0)}catch(e){return no.error("XHR open failed: "+e.toString()),this._conn.connected||this._conn._changeConnectStatus(no.Status.CONNFAIL,"bad-service"),void this._conn.disconnect()}const e=()=>{if(n.date=new Date,this._conn.options.customHeaders){const e=this._conn.options.customHeaders;for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.xhr.setRequestHeader(t,e[t])}n.xhr.send(n.data)};if(n.sends>1){const t=1e3*Math.min(Math.floor(no.TIMEOUT*this.wait),Math.pow(n.sends,3));setTimeout((function(){e()}),t)}else e();n.sends++,this._conn.xmlOutput!==no.Connection.prototype.xmlOutput&&(n.xmlData.nodeName===this.strip&&n.xmlData.childNodes.length?this._conn.xmlOutput(n.xmlData.childNodes[0]):this._conn.xmlOutput(n.xmlData)),this._conn.rawOutput!==no.Connection.prototype.rawOutput&&this._conn.rawOutput(n.data)}else no.debug("_processRequest: "+(0===t?"first":"second")+" request has readyState of "+n.xhr.readyState)}_removeRequest(e){no.debug("removing request");for(let t=this._requests.length-1;t>=0;t--)e===this._requests[t]&&this._requests.splice(t,1);e.xhr.onreadystatechange=function(){},this._throttledRequestHandler()}_restartRequest(e){const t=this._requests[e];null===t.dead&&(t.dead=new Date),this._processRequest(e)}_reqToData(e){try{return e.getResponse()}catch(e){if("parsererror"!==e.message)throw e;this._conn.disconnect("strophe-parsererror")}}_sendTerminate(e){no.debug("_sendTerminate was called");const t=this._buildBody().attrs({type:"terminate"});e&&t.cnode(e.tree());const n=new no.Request(t.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),t.tree().getAttribute("rid"));this._requests.push(n),this._throttledRequestHandler()}_send(){clearTimeout(this._conn._idleTimeout),this._throttledRequestHandler(),this._conn._idleTimeout=setTimeout((()=>this._conn._onIdle()),100)}_sendRestart(){this._throttledRequestHandler(),clearTimeout(this._conn._idleTimeout)}_throttledRequestHandler(){this._requests?no.debug("_throttledRequestHandler called with "+this._requests.length+" requests"):no.debug("_throttledRequestHandler called with undefined requests"),this._requests&&0!==this._requests.length&&(this._requests.length>0&&this._processRequest(0),this._requests.length>1&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1))}},no.Bosh.prototype.strip=null,no.Websocket=class{constructor(e){this._conn=e,this.strip="wrapper";const t=e.service;if(0!==t.indexOf("ws:")&&0!==t.indexOf("wss:")){let n="";"ws"===e.options.protocol&&"https:"!==location.protocol?n+="ws":n+="wss",n+="://"+location.host,0!==t.indexOf("/")?n+=location.pathname+t:n+=t,e.service=n}}_buildStream(){return Ws("open",{xmlns:no.NS.FRAMING,to:this._conn.domain,version:"1.0"})}_checkStreamError(e,t){let n;if(n=e.getElementsByTagNameNS?e.getElementsByTagNameNS(no.NS.STREAM,"error"):e.getElementsByTagName("stream:error"),0===n.length)return!1;const r=n[0];let i="",s="";for(let e=0;e<r.childNodes.length;e++){const t=r.childNodes[e];if("urn:ietf:params:xml:ns:xmpp-streams"!==t.getAttribute("xmlns"))break;"text"===t.nodeName?s=t.textContent:i=t.nodeName}let o="WebSocket stream error: ";return o+=i||"unknown",s&&(o+=" - "+s),no.error(o),this._conn._changeConnectStatus(t,i),this._conn._doDisconnect(),!0}_reset(){}_connect(){this._closeSocket(),this.socket=new ds(this._conn.service,"xmpp"),this.socket.onopen=()=>this._onOpen(),this.socket.onerror=e=>this._onError(e),this.socket.onclose=e=>this._onClose(e),this.socket.onmessage=e=>this._onInitialMessage(e)}_connect_cb(e){if(this._checkStreamError(e,no.Status.CONNFAIL))return no.Status.CONNFAIL}_handleStreamStart(e){let t=!1;const n=e.getAttribute("xmlns");"string"!=typeof n?t="Missing xmlns in <open />":n!==no.NS.FRAMING&&(t="Wrong xmlns in <open />: "+n);const r=e.getAttribute("version");return"string"!=typeof r?t="Missing version in <open />":"1.0"!==r&&(t="Wrong version in <open />: "+r),!t||(this._conn._changeConnectStatus(no.Status.CONNFAIL,t),this._conn._doDisconnect(),!1)}_onInitialMessage(e){if(0===e.data.indexOf("<open ")||0===e.data.indexOf("<?xml")){const t=e.data.replace(/^(<\?.*?\?>\s*)*/,"");if(""===t)return;const n=(new ls).parseFromString(t,"text/xml").documentElement;this._conn.xmlInput(n),this._conn.rawInput(e.data),this._handleStreamStart(n)&&this._connect_cb(n)}else if(0===e.data.indexOf("<close ")){const t=(new ls).parseFromString(e.data,"text/xml").documentElement;this._conn.xmlInput(t),this._conn.rawInput(e.data);const n=t.getAttribute("see-other-uri");if(n){const e=this._conn.service;(e.indexOf("wss:")>=0&&n.indexOf("wss:")>=0||e.indexOf("ws:")>=0)&&(this._conn._changeConnectStatus(no.Status.REDIRECT,"Received see-other-uri, resetting connection"),this._conn.reset(),this._conn.service=n,this._connect())}else this._conn._changeConnectStatus(no.Status.CONNFAIL,"Received closing stream"),this._conn._doDisconnect()}else{this._replaceMessageHandler();const t=this._streamWrap(e.data),n=(new ls).parseFromString(t,"text/xml").documentElement;this._conn._connect_cb(n,null,e.data)}}_replaceMessageHandler(){this.socket.onmessage=e=>this._onMessage(e)}_disconnect(e){if(this.socket&&this.socket.readyState!==ds.CLOSED){e&&this._conn.send(e);const t=Ws("close",{xmlns:no.NS.FRAMING});this._conn.xmlOutput(t.tree());const n=no.serialize(t);this._conn.rawOutput(n);try{this.socket.send(n)}catch(e){no.warn("Couldn't send <close /> tag.")}}setTimeout((()=>this._conn._doDisconnect()),0)}_doDisconnect(){no.debug("WebSockets _doDisconnect was called"),this._closeSocket()}_streamWrap(e){return"<wrapper>"+e+"</wrapper>"}_closeSocket(){if(this.socket)try{this.socket.onclose=null,this.socket.onerror=null,this.socket.onmessage=null,this.socket.close()}catch(e){no.debug(e.message)}this.socket=null}_emptyQueue(){return!0}_onClose(e){this._conn.connected&&!this._conn.disconnecting?(no.error("Websocket closed unexpectedly"),this._conn._doDisconnect()):e&&1006===e.code&&!this._conn.connected&&this.socket?(no.error("Websocket closed unexcectedly"),this._conn._changeConnectStatus(no.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._conn._doDisconnect()):no.debug("Websocket closed")}_no_auth_received(e){no.error("Server did not offer a supported authentication mechanism"),this._conn._changeConnectStatus(no.Status.CONNFAIL,no.ErrorCondition.NO_AUTH_MECH),e&&e.call(this._conn),this._conn._doDisconnect()}_onDisconnectTimeout(){}_abortAllRequests(){}_onError(e){no.error("Websocket error "+JSON.stringify(e)),this._conn._changeConnectStatus(no.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._disconnect()}_onIdle(){const e=this._conn._data;if(e.length>0&&!this._conn.paused){for(let t=0;t<e.length;t++)if(null!==e[t]){let n;n="restart"===e[t]?this._buildStream().tree():e[t];const r=no.serialize(n);this._conn.xmlOutput(n),this._conn.rawOutput(r),this.socket.send(r)}this._conn._data=[]}}_onMessage(e){let t;const n='<close xmlns="urn:ietf:params:xml:ns:xmpp-framing" />';if(e.data===n)return this._conn.rawInput(n),this._conn.xmlInput(e),void(this._conn.disconnecting||this._conn._doDisconnect());if(0===e.data.search("<open ")){if(t=(new ls).parseFromString(e.data,"text/xml").documentElement,!this._handleStreamStart(t))return}else{const n=this._streamWrap(e.data);t=(new ls).parseFromString(n,"text/xml").documentElement}return this._checkStreamError(t,no.Status.ERROR)?void 0:this._conn.disconnecting&&"presence"===t.firstChild.nodeName&&"unavailable"===t.firstChild.getAttribute("type")?(this._conn.xmlInput(t),void this._conn.rawInput(no.serialize(t))):void this._conn._dataRecv(t,e.data)}_onOpen(){no.debug("Websocket open");const e=this._buildStream();this._conn.xmlOutput(e.tree());const t=no.serialize(e);this._conn.rawOutput(t),this.socket.send(t)}_reqToData(e){return e}_send(){this._conn.flush()}_sendRestart(){clearTimeout(this._conn._idleTimeout),this._conn._onIdle.bind(this._conn)()}};const io={};io.debug=no.LogLevel.DEBUG,io.info=no.LogLevel.INFO,io.warn=no.LogLevel.WARN,io.error=no.LogLevel.ERROR,io.fatal=no.LogLevel.FATAL,no.WorkerWebsocket=class extends no.Websocket{constructor(e){super(e),this._conn=e,this.worker=new SharedWorker(this._conn.options.worker,"Strophe XMPP Connection"),this.worker.onerror=e=>{console?.error(e),no.log(no.LogLevel.ERROR,`Shared Worker Error: ${e}`)}}get socket(){return{send:e=>this.worker.port.postMessage(["send",e])}}_connect(){this._messageHandler=e=>this._onInitialMessage(e),this.worker.port.start(),this.worker.port.onmessage=e=>this._onWorkerMessage(e),this.worker.port.postMessage(["_connect",this._conn.service,this._conn.jid])}_attach(e){this._messageHandler=e=>this._onMessage(e),this._conn.connect_callback=e,this.worker.port.start(),this.worker.port.onmessage=e=>this._onWorkerMessage(e),this.worker.port.postMessage(["_attach",this._conn.service])}_attachCallback(e,t){e===no.Status.ATTACHED?(this._conn.jid=t,this._conn.authenticated=!0,this._conn.connected=!0,this._conn.restored=!0,this._conn._changeConnectStatus(no.Status.ATTACHED)):e===no.Status.ATTACHFAIL&&(this._conn.authenticated=!1,this._conn.connected=!1,this._conn.restored=!1,this._conn._changeConnectStatus(no.Status.ATTACHFAIL))}_disconnect(e,t){t&&this._conn.send(t);const n=Ws("close",{xmlns:no.NS.FRAMING});this._conn.xmlOutput(n.tree());const r=no.serialize(n);this._conn.rawOutput(r),this.worker.port.postMessage(["send",r]),this._conn._doDisconnect()}_onClose(e){this._conn.connected&&!this._conn.disconnecting?(no.error("Websocket closed unexpectedly"),this._conn._doDisconnect()):e&&1006===e.code&&!this._conn.connected?(no.error("Websocket closed unexcectedly"),this._conn._changeConnectStatus(no.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._conn._doDisconnect()):no.debug("Websocket closed")}_closeSocket(){this.worker.port.postMessage(["_closeSocket"])}_replaceMessageHandler(){this._messageHandler=e=>this._onMessage(e)}_onWorkerMessage(e){const{data:t}=e,n=t[0];if("_onMessage"===n)this._messageHandler(t[1]);else if(n in this)try{this[n].apply(this,e.data.slice(1))}catch(e){no.log(no.LogLevel.ERROR,e)}else if("log"===n){const e=t[1],n=t[2];no.log(io[e],n)}else no.log(no.LogLevel.ERROR,`Found unhandled service worker message: ${t}`)}},o.g.$build=ro.$build,o.g.$iq=ro.$iq,o.g.$msg=ro.$msg,o.g.$pres=ro.$pres,o.g.Strophe=ro.Strophe,o.g.Strophe.shims=e;const so="v10.1.6",oo={offline:6,unavailable:5,xa:4,away:3,dnd:2,chat:1,online:1},ao="anonymous",co="external",uo="login",lo="logout",ho="prebind",fo={};fo[no.Status.ATTACHED]="ATTACHED",fo[no.Status.AUTHENTICATING]="AUTHENTICATING",fo[no.Status.AUTHFAIL]="AUTHFAIL",fo[no.Status.CONNECTED]="CONNECTED",fo[no.Status.CONNECTING]="CONNECTING",fo[no.Status.CONNFAIL]="CONNFAIL",fo[no.Status.DISCONNECTED]="DISCONNECTED",fo[no.Status.DISCONNECTING]="DISCONNECTING",fo[no.Status.ERROR]="ERROR",fo[no.Status.RECONNECTING]="RECONNECTING",fo[no.Status.REDIRECT]="REDIRECT",no.addNamespace("ACTIVITY","http://jabber.org/protocol/activity"),no.addNamespace("CARBONS","urn:xmpp:carbons:2"),no.addNamespace("CHATSTATES","http://jabber.org/protocol/chatstates"),no.addNamespace("CSI","urn:xmpp:csi:0"),no.addNamespace("DELAY","urn:xmpp:delay"),no.addNamespace("EME","urn:xmpp:eme:0"),no.addNamespace("FASTEN","urn:xmpp:fasten:0"),no.addNamespace("FORWARD","urn:xmpp:forward:0"),no.addNamespace("HINTS","urn:xmpp:hints"),no.addNamespace("HTTPUPLOAD","urn:xmpp:http:upload:0"),no.addNamespace("MAM","urn:xmpp:mam:2"),no.addNamespace("MARKERS","urn:xmpp:chat-markers:0"),no.addNamespace("MENTIONS","urn:xmpp:mmn:0"),no.addNamespace("MESSAGE_CORRECT","urn:xmpp:message-correct:0"),no.addNamespace("MODERATE","urn:xmpp:message-moderate:0"),no.addNamespace("NICK","http://jabber.org/protocol/nick"),no.addNamespace("OCCUPANTID","urn:xmpp:occupant-id:0"),no.addNamespace("OMEMO","eu.siacs.conversations.axolotl"),no.addNamespace("OUTOFBAND","jabber:x:oob"),no.addNamespace("PUBSUB","http://jabber.org/protocol/pubsub"),no.addNamespace("RAI","urn:xmpp:rai:0"),no.addNamespace("RECEIPTS","urn:xmpp:receipts"),no.addNamespace("REFERENCE","urn:xmpp:reference:0"),no.addNamespace("REGISTER","jabber:iq:register"),no.addNamespace("RETRACT","urn:xmpp:message-retract:0"),no.addNamespace("ROSTERX","http://jabber.org/protocol/rosterx"),no.addNamespace("RSM","http://jabber.org/protocol/rsm"),no.addNamespace("SID","urn:xmpp:sid:0"),no.addNamespace("SPOILER","urn:xmpp:spoiler:0"),no.addNamespace("STANZAS","urn:ietf:params:xml:ns:xmpp-stanzas"),no.addNamespace("STYLING","urn:xmpp:styling:0"),no.addNamespace("VCARD","vcard-temp"),no.addNamespace("VCARDUPDATE","vcard-temp:x:update"),no.addNamespace("XFORM","jabber:x:data"),no.addNamespace("XHTML","http://www.w3.org/1999/xhtml");const go=["converse-adhoc","converse-bookmarks","converse-bosh","converse-caps","converse-chat","converse-chatboxes","converse-disco","converse-emoji","converse-headlines","converse-mam","converse-muc","converse-ping","converse-pubsub","converse-roster","converse-smacks","converse-status","converse-vcard"],po={start:/(\b|_)(?:([a-z][a-z0-9.+-]*:\/\/)|xmpp:|mailto:|www\.)/gi};var mo=o(293);const vo={initialize(){},__(){return(0,mo.sprintf)(...arguments)}};var _o=o(199),yo=o.n(_o);const bo=function(e){for(var t=-1,n=null==e?0:e.length,r=0,i=[];++t<n;){var s=e[t];s&&(i[r++]=s)}return i};var wo=o(568),So=o.n(wo);function Ao(){const e={isResolved:!1,isPending:!0,isRejected:!1},t=new Promise(((t,n)=>{e.resolve=t,e.reject=n}));return Object.assign(t,e),t.then((function(e){return t.isResolved=!0,t.isPending=!1,t.isRejected=!1,e}),(function(e){throw t.isResolved=!1,t.isPending=!1,t.isRejected=!0,e})),t}const Eo={allow_non_roster_messaging:!1,allow_url_history_change:!0,assets_path:"/dist",authentication:"login",auto_login:!1,reuse_scram_keys:!1,auto_reconnect:!0,blacklisted_plugins:[],clear_cache_on_logout:!1,connection_options:{},credentials_url:null,discover_connection_methods:!0,geouri_regex:/https\:\/\/www.openstreetmap.org\/.*#map=[0-9]+\/([\-0-9.]+)\/([\-0-9.]+)\S*/g,geouri_replacement:"https://www.openstreetmap.org/?mlat=$1&mlon=$2#map=18/$1/$2",i18n:void 0,jid:void 0,keepalive:!0,loglevel:"info",locales:["af","ar","bg","ca","cs","da","de","el","en","eo","es","eu","fa","fi","fr","gl","he","hi","hu","id","it","ja","lt","mr","nb","nl","oc","pl","pt","pt_BR","ro","ru","sv","th","tr","ug","uk","vi","zh_CN","zh_TW"],nickname:void 0,password:void 0,persistent_store:"IndexedDB",rid:void 0,root:window.document,sid:void 0,singleton:!1,strict_plugin_dependencies:!1,stanza_timeout:2e4,view_mode:"overlayed",websocket_url:void 0,whitelisted_plugins:[]};var xo=o(747);const No=function(e){return Pr(e,5)};const Io=function(e){return"string"==typeof e||!G(e)&&U(e)&&"[object String]"==m(e)};const Co=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}();const To=function(){try{if(!Co||!Co.open)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}};const Oo=function(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<e.length;r+=1)n.append(e[r]);return n.getBlob(t.type)}};"undefined"==typeof Promise&&o(449);const jo=Promise;const ko=function(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))};const Ro=function(e,t,n){"function"==typeof t&&e.then(t),"function"==typeof n&&e.catch(n)};function Mo(e){return"string"!=typeof e&&(console.warn(`${e} used as a key, but it is not a string.`),e=String(e)),e}function Do(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}const $o="local-forage-detect-blob-support";let Fo;const Po={},Lo=Object.prototype.toString,zo="readonly",Uo="readwrite";function Bo(e){return"boolean"==typeof Fo?jo.resolve(Fo):function(e){return new jo((function(t){var n=e.transaction($o,Uo),r=Oo([""]);n.objectStore($o).put(r,"key"),n.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},n.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);t(n||!e||parseInt(e[1],10)>=43)}})).catch((function(){return!1}))}(e).then((function(e){return Fo=e,Fo}))}function Ho(e){var t=Po[e.name],n={};n.promise=new jo((function(e,t){n.resolve=e,n.reject=t})),t.deferredOperations.push(n),t.dbReady?t.dbReady=t.dbReady.then((function(){return n.promise})):t.dbReady=n.promise}function qo(e){var t=Po[e.name].deferredOperations.pop();if(t)return t.resolve(),t.promise}function Jo(e,t){var n=Po[e.name].deferredOperations.pop();if(n)return n.reject(t),n.promise}function Wo(e,t){return new jo((function(n,r){if(Po[e.name]=Po[e.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},e.db){if(!t)return n(e.db);Ho(e),e.db.close()}var i=[e.name];t&&i.push(e.version);var s=Co.open.apply(Co,i);t&&(s.onupgradeneeded=function(t){var n=s.result;try{n.createObjectStore(e.storeName),t.oldVersion<=1&&n.createObjectStore($o)}catch(n){if("ConstraintError"!==n.name)throw n;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),s.onerror=function(e){e.preventDefault(),r(s.error)},s.onsuccess=function(){var t=s.result;t.onversionchange=function(e){e.target.close()},n(t),qo(e)}}))}function Go(e){return Wo(e,!1)}function Qo(e){return Wo(e,!0)}function Vo(e,t){if(!e.db)return!0;var n=!e.db.objectStoreNames.contains(e.storeName),r=e.version<e.db.version,i=e.version>e.db.version;if(r&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),i||n){if(n){var s=e.db.version+1;s>e.version&&(e.version=s)}return!0}return!1}function Yo(e){var t=function(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),i=0;i<t;i++)r[i]=e.charCodeAt(i);return n}(atob(e.data));return Oo([t],{type:e.type})}function Xo(e){return e&&e.__local_forage_encoded_blob}function Ko(e){var t=this,n=t._initReady().then((function(){var e=Po[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady}));return Ro(n,e,e),n}function Zo(e,t,n,r){void 0===r&&(r=1);try{var i=e.db.transaction(e.storeName,t);n(null,i)}catch(i){if(r>0&&(!e.db||"InvalidStateError"===i.name||"NotFoundError"===i.name))return jo.resolve().then((()=>{if(!e.db||"NotFoundError"===i.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),Qo(e)})).then((()=>function(e){Ho(e);for(var t=Po[e.name],n=t.forages,r=0;r<n.length;r++){const e=n[r];e._dbInfo.db&&(e._dbInfo.db.close(),e._dbInfo.db=null)}return e.db=null,Go(e).then((t=>(e.db=t,Vo(e)?Qo(e):t))).then((r=>{e.db=t.db=r;for(var i=0;i<n.length;i++)n[i]._dbInfo.db=r})).catch((t=>{throw Jo(e,t),t}))}(e).then((function(){Zo(e,t,n,r-1)})))).catch(n);n(i)}}var ea={_driver:"asyncStorage",_initStorage:function(e){var t=this,n={db:null};if(e)for(var r in e)n[r]=e[r];var i=Po[n.name];i||(i={forages:[],db:null,dbReady:null,deferredOperations:[]},Po[n.name]=i),i.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=Ko);var s=[];function o(){return jo.resolve()}for(var a=0;a<i.forages.length;a++){var c=i.forages[a];c!==t&&s.push(c._initReady().catch(o))}var u=i.forages.slice(0);return jo.all(s).then((function(){return n.db=i.db,Go(n)})).then((function(e){return n.db=e,Vo(n,t._defaultConfig.version)?Qo(n):e})).then((function(e){n.db=i.db=e,t._dbInfo=n;for(var r=0;r<u.length;r++){var s=u[r];s!==t&&(s._dbInfo.db=n.db,s._dbInfo.version=n.version)}}))},_support:To(),iterate:function(e,t){var n=this,r=new jo((function(t,r){n.ready().then((function(){Zo(n._dbInfo,zo,(function(i,s){if(i)return r(i);try{var o=s.objectStore(n._dbInfo.storeName).openCursor(),a=1;o.onsuccess=function(){var n=o.result;if(n){var r=n.value;Xo(r)&&(r=Yo(r));var i=e(r,n.key,a++);void 0!==i?t(i):n.continue()}else t()},o.onerror=function(){r(o.error)}}catch(e){r(e)}}))})).catch(r)}));return ko(r,t),r},getItem:function(e,t){var n=this;e=Mo(e);var r=new jo((function(t,r){n.ready().then((function(){Zo(n._dbInfo,zo,(function(i,s){if(i)return r(i);try{var o=s.objectStore(n._dbInfo.storeName).get(e);o.onsuccess=function(){var e=o.result;void 0===e&&(e=null),Xo(e)&&(e=Yo(e)),t(e)},o.onerror=function(){r(o.error)}}catch(e){r(e)}}))})).catch(r)}));return ko(r,t),r},setItem:function(e,t,n){var r=this;e=Mo(e);var i=new jo((function(n,i){var s;r.ready().then((function(){return s=r._dbInfo,"[object Blob]"===Lo.call(t)?Bo(s.db).then((function(e){return e?t:(n=t,new jo((function(e,t){var r=new FileReader;r.onerror=t,r.onloadend=function(t){var r=btoa(t.target.result||"");e({__local_forage_encoded_blob:!0,data:r,type:n.type})},r.readAsBinaryString(n)})));var n})):t})).then((function(t){Zo(r._dbInfo,Uo,(function(s,o){if(s)return i(s);try{var a=o.objectStore(r._dbInfo.storeName);null===t&&(t=void 0);var c=a.put(t,e);o.oncomplete=function(){void 0===t&&(t=null),n(t)},o.onabort=o.onerror=function(){var e=c.error?c.error:c.transaction.error;i(e)}}catch(e){i(e)}}))})).catch(i)}));return ko(i,n),i},removeItem:function(e,t){var n=this;e=Mo(e);var r=new jo((function(t,r){n.ready().then((function(){Zo(n._dbInfo,Uo,(function(i,s){if(i)return r(i);try{var o=s.objectStore(n._dbInfo.storeName).delete(e);s.oncomplete=function(){t()},s.onerror=function(){r(o.error)},s.onabort=function(){var e=o.error?o.error:o.transaction.error;r(e)}}catch(e){r(e)}}))})).catch(r)}));return ko(r,t),r},clear:function(e){var t=this,n=new jo((function(e,n){t.ready().then((function(){Zo(t._dbInfo,Uo,(function(r,i){if(r)return n(r);try{var s=i.objectStore(t._dbInfo.storeName).clear();i.oncomplete=function(){e()},i.onabort=i.onerror=function(){var e=s.error?s.error:s.transaction.error;n(e)}}catch(e){n(e)}}))})).catch(n)}));return ko(n,e),n},length:function(e){var t=this,n=new jo((function(e,n){t.ready().then((function(){Zo(t._dbInfo,zo,(function(r,i){if(r)return n(r);try{var s=i.objectStore(t._dbInfo.storeName).count();s.onsuccess=function(){e(s.result)},s.onerror=function(){n(s.error)}}catch(e){n(e)}}))})).catch(n)}));return ko(n,e),n},key:function(e,t){var n=this,r=new jo((function(t,r){e<0?t(null):n.ready().then((function(){Zo(n._dbInfo,zo,(function(i,s){if(i)return r(i);try{var o=s.objectStore(n._dbInfo.storeName),a=!1,c=o.openKeyCursor();c.onsuccess=function(){var n=c.result;n?0===e||a?t(n.key):(a=!0,n.advance(e)):t(null)},c.onerror=function(){r(c.error)}}catch(e){r(e)}}))})).catch(r)}));return ko(r,t),r},keys:function(e){var t=this,n=new jo((function(e,n){t.ready().then((function(){Zo(t._dbInfo,zo,(function(r,i){if(r)return n(r);try{var s=i.objectStore(t._dbInfo.storeName).openKeyCursor(),o=[];s.onsuccess=function(){var t=s.result;t?(o.push(t.key),t.continue()):e(o)},s.onerror=function(){n(s.error)}}catch(e){n(e)}}))})).catch(n)}));return ko(n,e),n},dropInstance:function(e,t){t=Do.apply(this,arguments);var n,r=this.config();if((e="function"!=typeof e&&e||{}).name||(e.name=e.name||r.name,e.storeName=e.storeName||r.storeName),e.name){const t=e.name===r.name&&this._dbInfo.db?jo.resolve(this._dbInfo.db):Go(e).then((t=>{const n=Po[e.name],r=n.forages;n.db=t;for(var i=0;i<r.length;i++)r[i]._dbInfo.db=t;return t}));n=e.storeName?t.then((t=>{if(!t.objectStoreNames.contains(e.storeName))return;const n=t.version+1;Ho(e);const r=Po[e.name],i=r.forages;t.close();for(let e=0;e<i.length;e++){const t=i[e];t._dbInfo.db=null,t._dbInfo.version=n}const s=new jo(((t,r)=>{const i=Co.open(e.name,n);i.onerror=e=>{i.result.close(),r(e)},i.onupgradeneeded=()=>{i.result.deleteObjectStore(e.storeName)},i.onsuccess=()=>{const e=i.result;e.close(),t(e)}}));return s.then((e=>{r.db=e;for(let t=0;t<i.length;t++){const n=i[t];n._dbInfo.db=e,qo(n._dbInfo)}})).catch((t=>{throw(Jo(e,t)||jo.resolve()).catch((()=>{})),t}))})):t.then((t=>{Ho(e);const n=Po[e.name],r=n.forages;t.close();for(var i=0;i<r.length;i++){r[i]._dbInfo.db=null}const s=new jo(((t,n)=>{var r=Co.deleteDatabase(e.name);r.onerror=()=>{const e=r.result;e&&e.close(),n(r.error)},r.onblocked=()=>{console.warn('dropInstance blocked for database "'+e.name+'" until all open connections are closed')},r.onsuccess=()=>{const e=r.result;e&&e.close(),t(e)}}));return s.then((e=>{n.db=e;for(var t=0;t<r.length;t++){qo(r[t]._dbInfo)}})).catch((t=>{throw(Jo(e,t)||jo.resolve()).catch((()=>{})),t}))}))}else n=jo.reject("Invalid arguments");return ko(n,t),n}};const ta=ea;const na=function(){return"function"==typeof openDatabase};var ra="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ia=/^~~local_forage_type~([^~]+)~/,sa="__lfsc__:",oa="arbf",aa="blob",ca="si08",ua="ui08",da="uic8",la="si16",ha="si32",fa="ur16",ga="ui32",pa="fl32",ma="fl64",va=Object.prototype.toString;function _a(e){var t,n,r,i,s,o=.75*e.length,a=e.length,c=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);var u=new ArrayBuffer(o),d=new Uint8Array(u);for(t=0;t<a;t+=4)n=ra.indexOf(e[t]),r=ra.indexOf(e[t+1]),i=ra.indexOf(e[t+2]),s=ra.indexOf(e[t+3]),d[c++]=n<<2|r>>4,d[c++]=(15&r)<<4|i>>2,d[c++]=(3&i)<<6|63&s;return u}function ya(e){var t,n=new Uint8Array(e),r="";for(t=0;t<n.length;t+=3)r+=ra[n[t]>>2],r+=ra[(3&n[t])<<4|n[t+1]>>4],r+=ra[(15&n[t+1])<<2|n[t+2]>>6],r+=ra[63&n[t+2]];return n.length%3==2?r=r.substring(0,r.length-1)+"=":n.length%3==1&&(r=r.substring(0,r.length-2)+"=="),r}var ba={serialize:function(e,t){var n="";if(e&&(n=va.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===va.call(e.buffer))){var r,i=sa;e instanceof ArrayBuffer?(r=e,i+=oa):(r=e.buffer,"[object Int8Array]"===n?i+=ca:"[object Uint8Array]"===n?i+=ua:"[object Uint8ClampedArray]"===n?i+=da:"[object Int16Array]"===n?i+=la:"[object Uint16Array]"===n?i+=fa:"[object Int32Array]"===n?i+=ha:"[object Uint32Array]"===n?i+=ga:"[object Float32Array]"===n?i+=pa:"[object Float64Array]"===n?i+=ma:t(new Error("Failed to get type for BinaryArray"))),t(i+ya(r))}else if("[object Blob]"===n){var s=new FileReader;s.onload=function(){var n="~~local_forage_type~"+e.type+"~"+ya(this.result);t(sa+aa+n)},s.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(n){console.error("Couldn't convert value into a JSON string: ",e),t(null,n)}},deserialize:function(e){if(e.substring(0,9)!==sa)return JSON.parse(e);var t,n=e.substring(13),r=e.substring(9,13);if(r===aa&&ia.test(n)){var i=n.match(ia);t=i[1],n=n.substring(i[0].length)}var s=_a(n);switch(r){case oa:return s;case aa:return Oo([s],{type:t});case ca:return new Int8Array(s);case ua:return new Uint8Array(s);case da:return new Uint8ClampedArray(s);case la:return new Int16Array(s);case fa:return new Uint16Array(s);case ha:return new Int32Array(s);case ga:return new Uint32Array(s);case pa:return new Float32Array(s);case ma:return new Float64Array(s);default:throw new Error("Unkown type: "+r)}},stringToBuffer:_a,bufferToString:ya};const wa=ba;function Sa(e,t,n,r){e.executeSql(`CREATE TABLE IF NOT EXISTS ${t.storeName} (id INTEGER PRIMARY KEY, key unique, value)`,[],n,r)}function Aa(e,t,n,r,i,s){e.executeSql(n,r,i,(function(e,o){o.code===o.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],(function(e,a){a.rows.length?s(e,o):Sa(e,t,(function(){e.executeSql(n,r,i,s)}),s)}),s):s(e,o)}),s)}function Ea(e,t,n,r){var i=this;e=Mo(e);var s=new jo((function(s,o){i.ready().then((function(){void 0===t&&(t=null);var a=t,c=i._dbInfo;c.serializer.serialize(t,(function(t,u){u?o(u):c.db.transaction((function(n){Aa(n,c,`INSERT OR REPLACE INTO ${c.storeName} (key, value) VALUES (?, ?)`,[e,t],(function(){s(a)}),(function(e,t){o(t)}))}),(function(t){if(t.code===t.QUOTA_ERR){if(r>0)return void s(Ea.apply(i,[e,a,n,r-1]));o(t)}}))}))})).catch(o)}));return ko(s,n),s}var xa={_driver:"webSQLStorage",_initStorage:function(e){var t=this,n={db:null};if(e)for(var r in e)n[r]="string"!=typeof e[r]?e[r].toString():e[r];var i=new jo((function(e,r){try{n.db=openDatabase(n.name,String(n.version),n.description,n.size)}catch(e){return r(e)}n.db.transaction((function(i){Sa(i,n,(function(){t._dbInfo=n,e()}),(function(e,t){r(t)}))}),r)}));return n.serializer=wa,i},_support:na(),iterate:function(e,t){var n=this,r=new jo((function(t,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){Aa(n,i,`SELECT * FROM ${i.storeName}`,[],(function(n,r){for(var s=r.rows,o=s.length,a=0;a<o;a++){var c=s.item(a),u=c.value;if(u&&(u=i.serializer.deserialize(u)),void 0!==(u=e(u,c.key,a+1)))return void t(u)}t()}),(function(e,t){r(t)}))}))})).catch(r)}));return ko(r,t),r},getItem:function(e,t){var n=this;e=Mo(e);var r=new jo((function(t,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){Aa(n,i,`SELECT * FROM ${i.storeName} WHERE key = ? LIMIT 1`,[e],(function(e,n){var r=n.rows.length?n.rows.item(0).value:null;r&&(r=i.serializer.deserialize(r)),t(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return ko(r,t),r},setItem:function(e,t,n){return Ea.apply(this,[e,t,n,1])},removeItem:function(e,t){var n=this;e=Mo(e);var r=new jo((function(t,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){Aa(n,i,`DELETE FROM ${i.storeName} WHERE key = ?`,[e],(function(){t()}),(function(e,t){r(t)}))}))})).catch(r)}));return ko(r,t),r},clear:function(e){var t=this,n=new jo((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){Aa(t,r,`DELETE FROM ${r.storeName}`,[],(function(){e()}),(function(e,t){n(t)}))}))})).catch(n)}));return ko(n,e),n},length:function(e){var t=this,n=new jo((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){Aa(t,r,`SELECT COUNT(key) as c FROM ${r.storeName}`,[],(function(t,n){var r=n.rows.item(0).c;e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return ko(n,e),n},key:function(e,t){var n=this,r=new jo((function(t,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){Aa(n,i,`SELECT key FROM ${i.storeName} WHERE id = ? LIMIT 1`,[e+1],(function(e,n){var r=n.rows.length?n.rows.item(0).key:null;t(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return ko(r,t),r},keys:function(e){var t=this,n=new jo((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){Aa(t,r,`SELECT key FROM ${r.storeName}`,[],(function(t,n){for(var r=[],i=0;i<n.rows.length;i++)r.push(n.rows.item(i).key);e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return ko(n,e),n},dropInstance:function(e,t){t=Do.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r,i=this;return r=e.name?new jo((function(t){var r;r=e.name===n.name?i._dbInfo.db:openDatabase(e.name,"","",0),e.storeName?t({db:r,storeNames:[e.storeName]}):t(function(e){return new jo((function(t,n){e.transaction((function(r){r.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(n,r){for(var i=[],s=0;s<r.rows.length;s++)i.push(r.rows.item(s).name);t({db:e,storeNames:i})}),(function(e,t){n(t)}))}),(function(e){n(e)}))}))}(r))})).then((function(e){return new jo((function(t,n){e.db.transaction((function(r){function i(e){return new jo((function(t,n){r.executeSql(`DROP TABLE IF EXISTS ${e}`,[],(function(){t()}),(function(e,t){n(t)}))}))}for(var s=[],o=0,a=e.storeNames.length;o<a;o++)s.push(i(e.storeNames[o]));jo.all(s).then((function(){t()})).catch((function(e){n(e)}))}),(function(e){n(e)}))}))})):jo.reject("Invalid arguments"),ko(r,t),r}};const Na=xa;function Ia(e,t){var n=e.name+"/";return e.storeName!==t.storeName&&(n+=e.storeName+"/"),n}function Ca(){return!function(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch(e){return!0}}()||localStorage.length>0}var Ta={_driver:"localStorageWrapper",_initStorage:function(e){var t={};if(e)for(var n in e)t[n]=e[n];return t.keyPrefix=Ia(e,this._defaultConfig),Ca()?(this._dbInfo=t,t.serializer=wa,jo.resolve()):jo.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}(),iterate:function(e,t){var n=this,r=n.ready().then((function(){for(var t=n._dbInfo,r=t.keyPrefix,i=r.length,s=localStorage.length,o=1,a=0;a<s;a++){var c=localStorage.key(a);if(0===c.indexOf(r)){var u=localStorage.getItem(c);if(u&&(u=t.serializer.deserialize(u)),void 0!==(u=e(u,c.substring(i),o++)))return u}}}));return ko(r,t),r},getItem:function(e,t){var n=this;e=Mo(e);var r=n.ready().then((function(){var t=n._dbInfo,r=localStorage.getItem(t.keyPrefix+e);return r&&(r=t.serializer.deserialize(r)),r}));return ko(r,t),r},setItem:function(e,t,n){var r=this;e=Mo(e);var i=r.ready().then((function(){void 0===t&&(t=null);var n=t;return new jo((function(i,s){var o=r._dbInfo;o.serializer.serialize(t,(function(t,r){if(r)s(r);else try{localStorage.setItem(o.keyPrefix+e,t),i(n)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||s(e),s(e)}}))}))}));return ko(i,n),i},removeItem:function(e,t){var n=this;e=Mo(e);var r=n.ready().then((function(){var t=n._dbInfo;localStorage.removeItem(t.keyPrefix+e)}));return ko(r,t),r},clear:function(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo.keyPrefix,n=localStorage.length-1;n>=0;n--){var r=localStorage.key(n);0===r.indexOf(e)&&localStorage.removeItem(r)}}));return ko(n,e),n},length:function(e){var t=this.keys().then((function(e){return e.length}));return ko(t,e),t},key:function(e,t){var n=this,r=n.ready().then((function(){var t,r=n._dbInfo;try{t=localStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(r.keyPrefix.length)),t}));return ko(r,t),r},keys:function(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo,n=localStorage.length,r=[],i=0;i<n;i++){var s=localStorage.key(i);0===s.indexOf(e.keyPrefix)&&r.push(s.substring(e.keyPrefix.length))}return r}));return ko(n,e),n},dropInstance:function(e,t){if(t=Do.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var n=this.config();e.name=e.name||n.name,e.storeName=e.storeName||n.storeName}var r,i=this;return r=e.name?new jo((function(t){e.storeName?t(Ia(e,i._defaultConfig)):t(`${e.name}/`)})).then((function(e){for(var t=localStorage.length-1;t>=0;t--){var n=localStorage.key(t);0===n.indexOf(e)&&localStorage.removeItem(n)}})):jo.reject("Invalid arguments"),ko(r,t),r}};const Oa=Ta,ja=(e,t)=>e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t),ka=(e,t)=>{const n=e.length;let r=0;for(;r<n;){if(ja(e[r],t))return!0;r++}return!1},Ra=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},Ma={},Da={},$a={INDEXEDDB:ta,WEBSQL:Na,LOCALSTORAGE:Oa},Fa=[$a.INDEXEDDB._driver,$a.WEBSQL._driver,$a.LOCALSTORAGE._driver],Pa=["dropInstance"],La=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(Pa),za={description:"",driver:Fa.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function Ua(e,t){e[t]=function(){const n=arguments;return e.ready().then((function(){return e[t].apply(e,n)}))}}function Ba(){for(let e=1;e<arguments.length;e++){const t=arguments[e];if(t)for(let e in t)t.hasOwnProperty(e)&&(Ra(t[e])?arguments[0][e]=t[e].slice():arguments[0][e]=t[e])}return arguments[0]}class Ha{constructor(e){for(let e in $a)if($a.hasOwnProperty(e)){const t=$a[e],n=t._driver;this[e]=n,Ma[n]||this.defineDriver(t)}this._defaultConfig=Ba({},za),this._config=Ba({},this._defaultConfig,e),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((()=>{}))}config(e){if("object"==typeof e){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(let t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e)||!e.driver||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config}defineDriver(e,t,n){const r=new jo((function(t,n){try{const r=e._driver,i=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void n(i);const s=La.concat("_initStorage");for(let t=0,r=s.length;t<r;t++){const r=s[t];if((!ka(Pa,r)||e[r])&&"function"!=typeof e[r])return void n(i)}const o=function(){const t=function(e){return function(){const t=new Error(`Method ${e} is not implemented by the current driver`),n=jo.reject(t);return ko(n,arguments[arguments.length-1]),n}};for(let n=0,r=Pa.length;n<r;n++){const r=Pa[n];e[r]||(e[r]=t(r))}};o();const a=function(n){Ma[r]&&console.info(`Redefining LocalForage driver: ${r}`),Ma[r]=e,Da[r]=n,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(a,n):a(!!e._support):a(!0)}catch(e){n(e)}}));return Ro(r,t,n),r}driver(){return this._driver||null}getDriver(e,t,n){const r=Ma[e]?jo.resolve(Ma[e]):jo.reject(new Error("Driver not found."));return Ro(r,t,n),r}getSerializer(e){const t=jo.resolve(wa);return Ro(t,e),t}ready(e){const t=this,n=t._driverSet.then((()=>(null===t._ready&&(t._ready=t._initDriver()),t._ready)));return Ro(n,e,e),n}setDriver(e,t,n){const r=this;Ra(e)||(e=[e]);const i=this._getSupportedDrivers(e);function s(){r._config.driver=r.driver()}function o(e){return r._extend(e),s(),r._ready=r._initStorage(r._config),r._ready}const a=null!==this._driverSet?this._driverSet.catch((()=>jo.resolve())):jo.resolve();return this._driverSet=a.then((()=>{const e=i[0];return r._dbInfo=null,r._ready=null,r.getDriver(e).then((e=>{r._driver=e._driver,s(),r._wrapLibraryMethodsWithReady(),r._initDriver=function(e){return function(){let t=0;return function n(){for(;t<e.length;){let i=e[t];return t++,r._dbInfo=null,r._ready=null,r.getDriver(i).then(o).catch(n)}s();const i=new Error("No available storage method found.");return r._driverSet=jo.reject(i),r._driverSet}()}}(i)}))})).catch((()=>{s();const e=new Error("No available storage method found.");return r._driverSet=jo.reject(e),r._driverSet})),Ro(this._driverSet,t,n),this._driverSet}supports(e){return!!Da[e]}_extend(e){Ba(this,e)}_getSupportedDrivers(e){const t=[];for(let n=0,r=e.length;n<r;n++){const r=e[n];this.supports(r)&&t.push(r)}return t}_wrapLibraryMethodsWithReady(){for(let e=0,t=La.length;e<t;e++)Ua(this,La[e])}createInstance(e){return new Ha(e)}}const qa=new Ha;const Ja=function(e,t,n){(void 0!==n&&!$(e[t],n)||void 0===n&&!(t in e))&&D(e,t,n)};const Wa=function(e){return U(e)&&ye(e)};const Ga=function(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]};const Qa=function(e){return L(e,ze(e))};const Va=function(e,t,n,r,i,s,o){var a=Ga(e,n),c=Ga(t,n),u=o.get(c);if(u)Ja(e,n,u);else{var d=s?s(a,c,n+"",e,t,o):void 0,l=void 0===d;if(l){var h=G(c),f=!h&&K(c),g=!h&&!f&&de(c);d=c,h||f||g?G(a)?d=a:Wa(a)?d=er(a):f?(l=!1,d=Zn(c,!0)):g?(l=!1,d=xr(c,!0)):d=[]:Yi(c)||W(c)?(d=a,W(a)?d=Qa(a):v(a)&&!_(a)||(d=Ir(c))):l=!1}l&&(o.set(c,d),i(d,c,r,s,o),o.delete(c)),Ja(e,n,d)}};const Ya=function e(t,n,r,i,s){t!==n&&Kr(n,(function(o,a){if(s||(s=new Wn),v(o))Va(t,n,a,r,e,i,s);else{var c=i?i(Ga(t,a),o,a+"",t,n,s):void 0;void 0===c&&(c=o),Ja(t,a,c)}}),ze)};const Xa=$e((function(e,t,n){Ya(e,t,n)}));const Ka=$e((function(e,t,n,r){Ya(e,t,n,r)}));const Za=function(){return i.Date.now()},ec=Math.max,tc=Math.min;const nc=function(e,t){let n,r,i,s,o,a,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},u=0,d=!1,l=c.promise?Ao():null;if("function"!=typeof e)throw new TypeError("Expected a function");function h(t){const i=n,o=r,a=l;return n=r=void 0,u=t,s=e.apply(o,i),c.promise&&(a.resolve(s),l=Ao()),c.promise?a:s}function f(e){const n=e-a;return void 0===a||n>=t||n<0||d&&e-u>=i}function g(){const e=Za();if(f(e))return p(e);o=setTimeout(g,function(e){const n=t-(e-a);return d?tc(n,i-(e-u)):n}(e))}function p(e){return o=void 0,n?h(e):(n=r=void 0,c.promise?l:s)}function m(e,t){if(Array.isArray(e)&&Array.isArray(t))return c?.dedupeArrays?e.concat(t.filter((t=>-1===e.indexOf(t)))):e.concat(t)}function _(){const e=Za(),i=f(e);var p;if(p=Array.from(arguments),n=n?.length?p.length?c?.concatArrays||c?.dedupeArrays?Ka(n,p,m):Xa(n,p):n:p||[],r=this,a=e,i){if(void 0===o)return function(e){return u=e,o=setTimeout(g,t),c.promise?l:s}(a);if(d)return clearTimeout(o),o=setTimeout(g,t),h(a)}return void 0===o&&(o=setTimeout(g,t)),c.promise?l:s}return t=wn(t)||0,v(c)&&(d="maxWait"in c,i=d?ec(wn(c.maxWait)||0,t):i),_.cancel=function(){void 0!==o&&clearTimeout(o),u=0,n=a=r=o=void 0},_.flush=function(){return void 0===o?s:p(Za())},_};function rc(e,t){let n=e.name+"/";return e.storeName!==t.storeName&&(n+=e.storeName+"/"),n}const ic={serializer:{serialize:wa.serialize,deserialize:wa.deserialize}};const sc={_driver:"sessionStorageWrapper",_initStorage:function(e){if(ic.keyPrefix=rc(e,this._defaultConfig),e)for(const t in e)ic[t]=e[t]},_support:function(){try{if(sessionStorage&&"setItem"in sessionStorage)return!0}catch(e){console.log(e)}return!1}(),iterate:function(e,t){const n=this.ready().then((function(){const t=ic.keyPrefix,n=t.length,r=sessionStorage.length;let i=1;for(let s=0;s<r;s++){const r=sessionStorage.key(s);if(0!==r.indexOf(t))continue;let o=sessionStorage.getItem(r);if(o&&(o=ic.serializer.deserialize(o)),o=e(o,r.substring(n),i++),void 0!==o)return o}}));return ko(n,t),n},getItem:function(e,t){e=Mo(e);const n=this.ready().then((function(){let t=sessionStorage.getItem(ic.keyPrefix+e);return t&&(t=ic.serializer.deserialize(t)),t}));return ko(n,t),n},setItem:async function(e,t,n){e=Mo(e),await this.ready();const r=t=t??null;ic.serializer.serialize(t,((t,i)=>{if(i)throw i;try{sessionStorage.setItem(ic.keyPrefix+e,t),ko(Promise.resolve(r),n)}catch(e){if("QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)throw console.error("Your sesionStorage capacity is used up."),e;throw e}}))},removeItem:function(e,t){e=Mo(e);const n=this.ready().then((function(){sessionStorage.removeItem(ic.keyPrefix+e)}));return ko(n,t),n},clear:function(e){const t=this.ready().then((function(){const e=ic.keyPrefix;for(let t=sessionStorage.length-1;t>=0;t--){const n=sessionStorage.key(t);0===n.indexOf(e)&&sessionStorage.removeItem(n)}}));return ko(t,e),t},length:function(e){const t=this.keys().then((function(e){return e.length}));return ko(t,e),t},key:function(e,t){const n=this.ready().then((function(){let t;try{t=sessionStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(ic.keyPrefix.length)),t}));return ko(n,t),n},keys:function(e){const t=this.ready().then((function(){const e=sessionStorage.length,t=[];for(let n=0;n<e;n++){const e=sessionStorage.key(n);0===e.indexOf(ic.keyPrefix)&&t.push(e.substring(ic.keyPrefix.length))}return t}));return ko(t,e),t},dropInstance:function(e,t){if(t=Do.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){const t=this.config();e.name=e.name||t.name,e.storeName=e.storeName||t.storeName}const n=this;let r;return r=e.name?new Promise((function(t){e.storeName?t(rc(e,n._defaultConfig)):t(`${e.name}/`)})).then((function(e){for(let t=sessionStorage.length-1;t>=0;t--){const n=sessionStorage.key(t);0===n.indexOf(e)&&sessionStorage.removeItem(n)}})):Promise.reject(new Error("Invalid arguments")),ko(r,t),r}},oc=sc;var ac=o(883),cc=o(487);const uc=xo._driver;qa.defineDriver(xo),(0,ac.extendPrototype)(qa),(0,cc.extendPrototype)(qa);class dc{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("local"===t&&!window.localStorage)throw new Error("Skeletor.storage: Environment does not support localStorage.");if("session"===t&&!window.sessionStorage)throw new Error("Skeletor.storage: Environment does not support sessionStorage.");Io(t)?this.storeInitialized=this.initStore(t,n):(this.store=t,n&&(this.store.debouncedSetItems=nc((e=>this.store.setItems(e)),50,{promise:!0})),this.storeInitialized=Promise.resolve()),this.name=e}async initStore(e,t){if("session"===e)qa.setDriver(oc._driver);else if("local"===e)await qa.config({driver:qa.LOCALSTORAGE});else if("in_memory"===e)qa.config({driver:uc});else if("indexed"!==e)throw new Error("Skeletor.storage: No storage type was specified");this.store=qa,t&&(this.store.debouncedSetItems=nc((e=>this.store.setItems(e)),50,{promise:!0}))}flush(){return this.store.debouncedSetItems?.flush()}async clear(){await this.store.removeItem(this.name).catch((e=>console.error(e)));const e=new RegExp(`^${this.name}-`),t=(await this.store.keys()).filter((t=>e.test(t)));await Promise.all(t.map((e=>this.store.removeItem(e).catch((e=>console.error(e))))))}sync(){const e=this;async function t(t,n,r){let i,s,o,a;const c=n.collection;["patch","update"].includes(t)&&(a=No(n.attributes)),await e.storeInitialized;try{const s=n.attributes;switch(t){case"read":i=void 0!==n.id?await e.find(n):await e.findAll();break;case"create":i=await e.create(n,r);break;case"patch":case"update":r.wait&&(n.attributes=a),o=e.update(n,r),r.wait&&(n.attributes=s),i=await o;break;case"delete":i=await e.destroy(n,c)}}catch(t){s=22===t.code&&0===e.getStorageSize()?"Private browsing is unsupported":t.message}if(i){if(r&&r.success){const e="read"===t?i:null;r.success(e,r)}}else s=s||"Record Not Found",r&&r.error&&r.error(s)}return t.__name__="localSync",t}removeCollectionReference(e,t){if(!t)return;const n=t.filter((t=>t.id!==e.id)).map((e=>this.getItemName(e.id)));return this.store.setItem(this.name,n)}addCollectionReference(e,t){if(!t)return;const n=t.map((e=>this.getItemName(e.id))),r=this.getItemName(e.id);return n.includes(r)||n.push(r),this.store.setItem(this.name,n)}getCollectionReferenceData(e){if(!e.collection)return{};const t=e.collection.map((e=>this.getItemName(e.id))),n=this.getItemName(e.id);t.includes(n)||t.push(n);const r={};return r[this.name]=t,r}async save(e){if(this.store.setItems){const t={};return t[this.getItemName(e.id)]=e.toJSON(),Object.assign(t,this.getCollectionReferenceData(e)),this.store.debouncedSetItems?this.store.debouncedSetItems(t):this.store.setItems(t)}{const t=this.getItemName(e.id),n=await this.store.setItem(t,e.toJSON());return await this.addCollectionReference(e,e.collection),n}}create(e,t){return e.id||(e.id=zt()+zt()+"-"+zt()+"-"+zt()+"-"+zt()+"-"+zt()+zt()+zt(),e.set(e.idAttribute,e.id,t)),this.save(e)}update(e){return this.save(e)}find(e){return this.store.getItem(this.getItemName(e.id))}async findAll(){const e=await this.store.getItem(this.name);if(e?.length){const t=await this.store.getItems(e);return Object.values(t)}return[]}async destroy(e,t){return await this.flush(),await this.store.removeItem(this.getItemName(e.id)),await this.removeCollectionReference(e,t),e}getStorageSize(){return this.store.length}getItemName(e){return this.name+"-"+e}}dc.sessionStorageInitialized=qa.defineDriver(oc),dc.localForage=qa;const lc=dc;function hc(){if(pu.config.get("trusted")){return"sessionStorage"===Bu.settings.get("persistent_store")?"session":"persistent"}return"session"}function fc(e){return"persistent"===e&&"IndexedDB"===Bu.settings.get("persistent_store")}function gc(e,t){const n=t||hc(),r=pu.storage[n];if(void 0===r)throw new TypeError(`createStore: Could not find store for ${e}`);return new lc(e,r,fc(t))}function pc(e,t,n){const r=n||hc();if(e.browserStorage=gc(t,r),fc(r)){const t=()=>e.browserStorage.flush();window.addEventListener(pu.unloadevent,t),e.on("destroy",(()=>window.removeEventListener(pu.unloadevent,t))),e.listenTo(pu,"beforeLogout",t)}}let mc,vc,_c={};function yc(){if(!pu.bare_jid){const e="No JID to fetch user settings for";throw Gc.error(e),Error(e)}if(!vc?.fetched){const e=`converse.user-settings.${pu.bare_jid}`;vc=new us({id:e}),pc(vc,e),vc.fetched=vc.fetch({promise:!0})}return vc.fetched}async function bc(){return await yc(),vc}async function wc(e,t){return await yc(),vc.save(e,t)}const Sc={extend:e=>function(e){qc.merge(Eo,e);const t=Object.keys(cs(e,Object.keys(Eo))),n=cs(_c,t),r=Ue(cs(e,t),n);qc.merge(mc,r)}(e),update(e){return Gc.warn("The api.settings.update method has been deprecated and will be removed. Please use api.settings.extend instead."),this.extend(e)},get:e=>function(e){if(Object.keys(Eo).includes(e))return mc[e]}(e),set(e,t){!function(e,t){if(null==e)return this;let n;v(e)?n=e:"string"==typeof e&&(n={},n[e]=t);const r=Object.keys(cs(n,Object.keys(Eo))),i={};r.forEach((e=>{const t=n[e];xi(mc[e],t)||(i[e]=t,mc[e]=t)})),Object.keys(i).forEach((e=>mc.trigger("change:"+e,i[e]))),mc.trigger("change",i)}(e,t)},listen:{on(e,t,n){!function(e,t,n){mc.on(e,t,n)}(e,t,n)},not(e,t){!function(e,t){mc.off(e,t)}(e,t)}}},Ac={getModel:()=>bc(),async get(e,t){const n=await bc();return void 0===n.get(e)?t:n.get(e)},set(e,t){if(v(e))return wc(e,{promise:!0});{const n={};return n[e]=t,wc(n,{promise:!0})}},clear:()=>async function(){return await yc(),vc.clear()}()};function Ec(e,t){const n=no.xmlHtmlNode(e);if(n.getElementsByTagNameNS("http://www.w3.org/1999/xhtml","parsererror").length)throw new Error(`Parser Error: ${e}`);const r=n.firstElementChild;if(["message","iq","presence"].includes(r.nodeName.toLowerCase())&&"jabber:client"!==r.namespaceURI&&"jabber:server"!==r.namespaceURI){const e=`Invalid namespaceURI ${r.namespaceURI}`;if(Gc.error(e),t)throw new Error(e)}return r}class xc{constructor(e,t){this.strings=e,this.values=t}toString(){return this.string=this.string||this.strings.reduce(((e,t)=>{const n=this.strings.indexOf(t);return e+t+(this.values.length>n?this.values[n].toString():"")}),""),this.string}tree(){return this.node=this.node??Ec(this.toString(),!0),this.node}}function Nc(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return new xc(e,n)}const Ic={};function Cc(e){return e instanceof Element||e instanceof HTMLDocument}function Tc(e){return e instanceof us&&(e=e.attributes),!(e.oob_url||e.file||e.is_encrypted&&e.plaintext||e.message||e.body)}function Oc(){return["mobile","fullscreen","embedded"].includes(Sc.get("view_mode"))}function jc(){const{api:e}=pu;return!pu.config.get("trusted")||e.settings.get("clear_cache_on_logout")||pu.isTestEnv()}async function kc(){const{api:e}=pu;return await e.trigger("beforeTearDown",{synchronous:!0}),window.removeEventListener("click",pu.onUserActivity),window.removeEventListener("focus",pu.onUserActivity),window.removeEventListener("keypress",pu.onUserActivity),window.removeEventListener("mousemove",pu.onUserActivity),window.removeEventListener(pu.unloadevent,pu.onUserActivity),window.clearInterval(pu.everySecondTrigger),e.trigger("afterTearDown"),pu}function Rc(){return pu.session?.destroy(),delete pu.session,jc()&&pu.api.user.settings.clear(),pu.api.trigger("clearSession",{synchronous:!0})}function Mc(e){return"string"==typeof e&&(2===bo(e.split("@")).length&&!e.startsWith("@")&&!e.endsWith("@"))}function Dc(e,t,n){Ic.isPersistableModel(e)?e.save(t,n):e.set(t,n)}function $c(e){return Math.random()*e|0}function Fc(e){const t=crypto.randomUUID?.()??"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=$c(16);return("x"===e?t:3&t|8).toString(16)}));return"string"==typeof e||"number"==typeof e?t+":"+e:t}function Pc(e,t){clearTimeout(e),clearInterval(t)}function Lc(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3;try{const t=e();if(t)return Promise.resolve(t)}catch(e){return Promise.reject(e)}const r=Ao(),i=new Error;const s=setInterval((function(){try{const t=e();t&&(Pc(o,s),r.resolve(t))}catch(e){Pc(o,s),r.reject(e)}}),n);const o=setTimeout((function(){Pc(o,s);const e=`Wait until promise timed out: \n\n${i.stack}`;console.trace(),Gc.error(e),r.reject(new Error(e))}),t);return r}function zc(e){const t=pu.promises[e];if(!t)throw new Error(`Tried to replace non-existing promise: ${e}`);if(t.replace){const n=Ao();n.replace=t.replace,pu.promises[e]=n}else Gc.debug(`Not replacing promise "${e}"`)}Ic.isTagEqual=function(e,t){if(e.tree?.())return Ic.isTagEqual(e.tree(),t);if(e instanceof Element)return no.isTagEqual(e,t);throw Error("isTagEqual called with value which isn't an element or Strophe.Builder instance")},Ic.getJIDFromURI=function(e){return e.startsWith("xmpp:")&&e.endsWith("?join")?e.replace(/^xmpp:/,"").replace(/\?join$/,""):e},Ic.getLongestSubstring=function(e,t){return t.reduce((function(t,n){return e.startsWith(n)&&n.length>t.length?n:t}),"")},Ic.isValidMUCJID=function(e){return!e.startsWith("@")&&!e.endsWith("@")},Ic.isSameBareJID=function(e,t){return"string"==typeof e&&"string"==typeof t&&no.getBareJidFromJid(e).toLowerCase()===no.getBareJidFromJid(t).toLowerCase()},Ic.isSameDomain=function(e,t){return"string"==typeof e&&"string"==typeof t&&no.getDomainFromJid(e).toLowerCase()===no.getDomainFromJid(t).toLowerCase()},Ic.isNewMessage=function(e){return e instanceof Element?!(So()(`result[xmlns="${no.NS.MAM}"]`,e).length&&So()(`delay[xmlns="${no.NS.DELAY}"]`,e).length):(e instanceof us&&(e=e.attributes),!(e.is_delayed&&e.is_archived))},Ic.shouldCreateMessage=function(e){return e.retracted||!Tc(e)},Ic.shouldCreateGroupchatMessage=function(e){return e.nick&&(Ic.shouldCreateMessage(e)||e.is_tombstone)},Ic.isChatRoom=function(e){return e&&"chatroom"===e.get("type")},Ic.isErrorStanza=function(e){return!!Cc(e)&&"error"===e.getAttribute("type")},Ic.isForbiddenError=function(e){return!!Cc(e)&&So()(`error[type="auth"] forbidden[xmlns="${no.NS.STANZAS}"]`,e).length>0},Ic.isServiceUnavailableError=function(e){return!!Cc(e)&&So()(`error[type="cancel"] service-unavailable[xmlns="${no.NS.STANZAS}"]`,e).length>0},Ic.getOuterWidth=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.offsetWidth;if(!t)return n;const r=window.getComputedStyle(e);return n+=parseInt(r.marginLeft?r.marginLeft:0,10)+parseInt(r.marginRight?r.marginRight:0,10),n},Ic.stringToElement=function(e){var t=document.createElement("div");return t.innerHTML=e,t.firstElementChild},Ic.matchesSelector=function(e,t){const n=e.matches||e.matchesSelector||e.msMatchesSelector||e.mozMatchesSelector||e.webkitMatchesSelector||e.oMatchesSelector;return!!n&&n.call(e,t)},Ic.queryChildren=function(e,t){return Array.from(e.childNodes).filter((e=>Ic.matchesSelector(e,t)))},Ic.contains=function(e,t){const n=(e,n)=>e.get(n).toLowerCase().includes(t.toLowerCase());return function(t){if("object"==typeof e)return Object.keys(e).reduce(((e,r)=>e||n(t,r)),!1);if("string"==typeof e)return n(t,e);throw new TypeError("contains: wrong attribute type. Must be string or array.")}},Ic.isOfType=function(e,t){return t.get("type")==e},Ic.isInstance=function(e,t){return t instanceof e},Ic.getAttribute=function(e,t){return t.get(e)},Ic.contains.not=function(e,t){return function(n){return!Ic.contains(e,t)(n)}},Ic.rootContains=function(e,t){return e!==document||e.contains?e.contains?e.contains(t):window.HTMLElement.prototype.contains.call(e,t):document.head.contains(t)||document.body.contains(t)},Ic.createFragmentFromText=function(e){var t,n=document.createDocumentFragment(),r=document.createElement("body");for(r.innerHTML=e;t=r.firstChild;)n.appendChild(t);return n},Ic.isPersistableModel=function(e){return e.collection&&e.collection.browserStorage},Ic.getResolveablePromise=Ao,Ic.getOpenPromise=Ao,Ic.interpolate=function(e,t){return e.replace(/{{{([^{}]*)}}}/g,((e,n)=>{var r=t[n];return"string"==typeof r||"number"==typeof r?r:e}))},Ic.onMultipleEvents=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=[];function r(r){n.push(r),e.length===n.length&&(t(n),n=[])}e.forEach((e=>e.object.on(e.event,r)))},Ic.safeSave=Dc,Ic.siblingIndex=function(e){for(var t=0;e=e.previousElementSibling;t++);return t},Ic.getCurrentWord=function(e,t,n){t||(t=e.selectionEnd||void 0);let[r]=e.value.slice(0,t).split(/\s/).slice(-1);return n&&([r]=r.split(n).slice(-1)),r},Ic.isMentionBoundary=e=>"@"!==e&&RegExp("(\\p{Z}|\\p{P})","u").test(e),Ic.replaceCurrentWord=function(e,t){const n=e.selectionEnd||void 0,r=Ui(e.value.slice(0,n).split(/\s/)),i=e.value,s=Ic.isMentionBoundary(r[0])?r[0]:"";e.value=i.slice(0,n-r.length)+s+`${t} `+i.slice(n);const o=n-r.length+t.length+1;e.selectionEnd=s?o+1:o},Ic.triggerEvent=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Event",r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const s=document.createEvent(n);s.initEvent(t,r,i),e.dispatchEvent(s)},Ic.getSelectValues=function(e){const t=[],n=e&&e.options;for(var r=0,i=n.length;r<i;r++){const e=n[r];e.selected&&t.push(e.value||e.text)}return t},Ic.placeCaretAtEnd=function(e){e!==document.activeElement&&e.focus();const t=2*e.value.length;setTimeout((()=>e.setSelectionRange(t,t)),1),this.scrollTop=999999};const Uc=document.createElement("div");function Bc(e){return e&&"string"==typeof e&&(Uc.innerHTML=yo().sanitize(e),e=Uc.textContent,Uc.textContent=""),e}function Hc(e){let t;const n={focus:"visible",focusin:"visible",pageshow:"visible",blur:"hidden",focusout:"hidden",pagehide:"hidden"};t=(e=e||document.createEvent("Events")).type in n?n[e.type]:document.hidden?"hidden":"visible",pu.windowState=t,pu.api.trigger("windowStateChanged",{state:t})}const qc=Object.assign({shouldClearCache:jc,waitUntil:Lc,isErrorObject:function(e){return e instanceof Error},getRandomInt:$c,getUniqueId:Fc,isElement:Cc,isEmptyMessage:Tc,isValidJID:Mc,merge:function e(t,n){for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&"__proto__"!==r&&"constructor"!==r&&(v(t[r])?e(t[r],n[r]):t[r]=n[r])},prefixMentions:function(e){let t=e.getMessageText();return(e.get("references")||[]).sort(((e,t)=>t.begin-e.begin)).forEach((e=>{t=`${t.slice(0,e.begin)}@${t.slice(e.begin)}`})),t},saveWindowState:Hc,stx:Nc,toStanza:Ec},Ic),Jc={debug:0,info:1,warn:2,error:3,fatal:4},Wc=Object.assign({debug:console?.log?console.log.bind(console):function(){},error:console?.log?console.log.bind(console):function(){},info:console?.log?console.log.bind(console):function(){},warn:console?.log?console.log.bind(console):function(){}},console),Gc={setLogLevel(e){if(!["debug","info","warn","error","fatal"].includes(e))throw new Error(`Invalid loglevel: ${e}`);this.loglevel=e},log(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(Jc[t]<Jc[this.loglevel])return;"error"===t||"fatal"===t?n=n||"color: maroon":"debug"===t&&(n=n||"color: green"),e instanceof Error?e=e.stack:Cc(e)&&(e=e.outerHTML);const r=n?"%c":"";"error"===t?Wc.error(`${r} ERROR: ${e}`,n):"warn"===t?Wc.warn(`${r} ${(new Date).toISOString()} WARNING: ${e}`,n):"fatal"===t?Wc.error(`${r} FATAL: ${e}`,n):"debug"===t?Wc.debug(`${r} ${(new Date).toISOString()} DEBUG: ${e}`,n):Wc.info(`${r} ${(new Date).toISOString()} INFO: ${e}`,n)},debug(e,t){this.log(e,"debug",t)},error(e,t){this.log(e,"error",t)},info(e,t){this.log(e,"info",t)},warn(e,t){this.log(e,"warn",t)},fatal(e,t){this.log(e,"fatal",t)}};function Qc(e,t,n,r){"function"==typeof n&&(void 0===this.__super__&&(this.__super__=r),this.__super__[e]=n.bind(this));for(var i=arguments.length,s=new Array(i>4?i-4:0),o=4;o<i;o++)s[o-4]=arguments[o];return t.apply(this,s)}class Vc{constructor(e,t){this.name=t,this.plugged=e,void 0===this.plugged.__super__?this.plugged.__super__={}:"string"==typeof this.plugged.__super__&&(this.plugged.__super__={__string__:this.plugged.__super__}),this.plugged.__super__[t]=this.plugged,this.plugins={},this.initialized_plugins=[]}_overrideAttribute(e,t){const n=t.overrides[e];if("function"==typeof n){const t={};t[this.name]=this.plugged;const r=this.plugged[e];this.plugged[e]=function(){for(var i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];return Qc.apply(this,[e,n,r,t,...s])}}else this.plugged[e]=n}_extendObject(e,t){e.prototype.__super__||(e.prototype.__super__={},e.prototype.__super__[this.name]=this.plugged);for(const[n,r]of Object.entries(t))if("events"===n)e.prototype[n]=Object.assign(r,e.prototype[n]);else if("function"==typeof r){const t={};t[this.name]=this.plugged;const i=e.prototype[n];e.prototype[n]=function(){for(var e=arguments.length,s=new Array(e),o=0;o<e;o++)s[o]=arguments[o];return Qc.apply(this,[n,r,i,t,...s])}}else e.prototype[n]=r}loadPluginDependencies(e){e.dependencies?.forEach((t=>{const n=this.plugins[t];if(n){if(n.dependencies?.includes(e.__name__))throw'Found a circular dependency between the plugins "'+e.__name__+'" and "'+t+'"';this.initializePlugin(n)}else this.throwUndefinedDependencyError('Could not find dependency "'+t+'" for the plugin "'+e.__name__+"\". If it's needed, make sure it's loaded by require.js")}))}throwUndefinedDependencyError(e){if(this.plugged.strict_plugin_dependencies)throw e;console.warn?console.warn(e):console.log(e)}applyOverrides(e){Object.keys(e.overrides||{}).forEach((t=>{const n=e.overrides[t];"object"==typeof n?void 0===this.plugged[t]?this.throwUndefinedDependencyError(`Plugin "${e.__name__}" tried to override "${t}" but it's not found.`):this._extendObject(this.plugged[t],n):this._overrideAttribute(t,e)}))}initializePlugin(e){Object.keys(this.allowed_plugins).includes(e.__name__)&&(this.initialized_plugins.includes(e.__name__)||("boolean"==typeof e.enabled&&e.enabled||e.enabled?.(this.plugged)||null==e.enabled)&&(Object.assign(e,this.properties),e.dependencies&&this.loadPluginDependencies(e),this.applyOverrides(e),"function"==typeof e.initialize&&e.initialize.bind(e)(this),this.initialized_plugins.push(e.__name__)))}registerPlugin(e,t){if(e in this.plugins)throw new Error("Error: Plugin name "+e+" is already taken");t.__name__=e,this.plugins[e]=t}initializePlugins(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(Object.keys(this.plugins).length){this.properties=e,this.allowed_plugins={};for(const[e,r]of Object.entries(this.plugins))t.length&&!t.includes(e)||n.includes(e)||(this.allowed_plugins[e]=r);Object.values(this.allowed_plugins).forEach((e=>this.initializePlugin(e)))}}}const Yc={enable:function(e,t,n){return void 0===n&&(n="pluginSocket"),void 0===t&&(t="plugged"),e[n]=new Vc(e,t),e}};const Xc=function(e,t){return function(n,r){if(null==n)return n;if(!ye(n))return e(n,r);for(var i=n.length,s=t?i:-1,o=Object(n);(t?s--:++s<i)&&!1!==r(o[s],s,o););return n}};const Kc=Xc(Zr);const Zc=function(e,t){var n;return Kc(e,(function(e,r,i){return!(n=t(e,r,i))})),!!n};const eu=function(e,t,n){var r=G(e)?ui:Zc;return n&&De(e,t,n)&&(t=void 0),r(e,Li(t,3))},tu=function(){this.handlers=[],this.checkUrl=this.checkUrl.bind(this),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)};tu.extend=Ut;const nu=/^[#\/]|\s+$/g,ru=/^\/+|\/+$/g,iu=/#.*$/;tu.started=!1,Object.assign(tu.prototype,Tn,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root&&!this.getSearch()},matchRoot:function(){return this.decodeFragment(this.location.pathname).slice(0,this.root.length-1)+"/"===this.root},decodeFragment:function(e){return decodeURI(e.replace(/%25/g,"%2525"))},getSearch:function(){const e=this.location.href.replace(/#.*/,"").match(/\?.+/);return e?e[0]:""},getHash:function(e){const t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getPath:function(){const e=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return"/"===e.charAt(0)?e.slice(1):e},getFragment:function(e){return null==e&&(e=this._usePushState||!this._wantsHashChange?this.getPath():this.getHash()),e.replace(nu,"")},start:function(e){if(tu.started)throw new Error("history has already been started");if(tu.started=!0,this.options=Ue({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=!1!==this.options.hashChange,this._hasHashChange="onhashchange"in window&&(void 0===document.documentMode||document.documentMode>7),this._useHashChange=this._wantsHashChange&&this._hasHashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.history||!this.history.pushState),this._usePushState=this._wantsPushState&&this._hasPushState,this.fragment=this.getFragment(),this.root=("/"+this.root+"/").replace(ru,"/"),this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){const e=this.root.slice(0,-1)||"/";return this.location.replace(e+"#"+this.getPath()),!0}this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe"),this.iframe.src="javascript:0",this.iframe.style.display="none",this.iframe.tabIndex=-1;const e=document.body,t=e.insertBefore(this.iframe,e.firstChild).contentWindow;t.document.open(),t.document.close(),t.location.hash="#"+this.fragment}if(this._usePushState?addEventListener("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe?addEventListener("hashchange",this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),!this.options.silent)return this.loadUrl()},stop:function(){this._usePushState?removeEventListener("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe&&removeEventListener("hashchange",this.checkUrl,!1),this.iframe&&(document.body.removeChild(this.iframe),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),tu.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){let t=this.getFragment();if(t===this.fragment&&this.iframe&&(t=this.getHash(this.iframe.contentWindow)),t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()},loadUrl:function(e){return!!this.matchRoot()&&(e=this.fragment=this.getFragment(e),eu(this.handlers,(function(t){if(t.route.test(e))return t.callback(e),!0})))},navigate:function(e,t){if(!tu.started)return!1;t&&!0!==t||(t={trigger:!!t}),e=this.getFragment(e||"");let n=this.root;""!==e&&"?"!==e.charAt(0)||(n=n.slice(0,-1)||"/");const r=n+e;e=e.replace(iu,"");const i=this.decodeFragment(e);if(this.fragment!==i){if(this.fragment=i,this._usePushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,r);else{if(!this._wantsHashChange)return this.location.assign(r);if(this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getHash(this.iframe.contentWindow)){const n=this.iframe.contentWindow;t.replace||(n.document.open(),n.document.close()),this._updateHash(n.location,e,t.replace)}}return t.trigger?this.loadUrl(e):void 0}},_updateHash:function(e,t,n){if(n){const n=e.href.replace(/(javascript:|#).*$/,"");e.replace(n+"#"+t)}else e.hash="#"+t}});const su=tu;const ou=function(e){return U(e)&&"[object RegExp]"==m(e)};var au=ce&&ce.isRegExp;const cu=au?ie(au):ou,uu=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.history=e.history||new su,this.preinitialize.apply(this,arguments),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)};uu.extend=Ut;const du=/\((.*?)\)/g,lu=/(\(\?)?:\w+/g,hu=/\*\w+/g,fu=/[\-{}\[\]+?.,\\\^$|#\s]/g;Object.assign(uu.prototype,Tn,{preinitialize:function(){},initialize:function(){},route:function(e,t,n){return cu(e)||(e=this._routeToRegExp(e)),_(t)&&(n=t,t=""),n||(n=this[t]),this.history.route(e,(r=>{const i=this._extractParameters(e,r);!1!==this.execute(n,i,t)&&(this.trigger.apply(this,["route:"+t].concat(i)),this.trigger("route",t,i),this.history.trigger("route",this,t,i))})),this},execute:function(e,t,n){e&&e.apply(this,t)},navigate:function(e,t){return this.history.navigate(e,t),this},_bindRoutes:function(){if(!this.routes)return;let e;this.routes=Lt(this,"routes");const t=be(this.routes);for(;null!=(e=t.pop());)this.route(e,this.routes[e])},_routeToRegExp:function(e){return e=e.replace(fu,"\\$&").replace(du,"(?:$1)?").replace(lu,(function(e,t){return t?e:"([^/?]+)"})).replace(hu,"([^?]*?)"),new RegExp("^"+e+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(e,t){const n=e.exec(t).slice(1);return n.map((function(e,t){return t===n.length-1?e||null:e?decodeURIComponent(e):null}))}});const gu={log:Gc,shouldClearCache:jc,VERSION_NAME:so,templates:{},promises:{initialized:Ao()},ANONYMOUS:ao,CLOSED:"closed",EXTERNAL:co,LOGIN:uo,LOGOUT:lo,OPENED:"opened",PREBIND:ho,SUCCESS:"success",FAILURE:"failure",DEFAULT_IMAGE_TYPE:"image/svg+xml",DEFAULT_IMAGE:"PD94bWwgdmVyc2lvbj0iMS4wIj8+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCI+CiA8cmVjdCB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgZmlsbD0iIzU1NSIvPgogPGNpcmNsZSBjeD0iNjQiIGN5PSI0MSIgcj0iMjQiIGZpbGw9IiNmZmYiLz4KIDxwYXRoIGQ9Im0yOC41IDExMiB2LTEyIGMwLTEyIDEwLTI0IDI0LTI0IGgyMyBjMTQgMCAyNCAxMiAyNCAyNCB2MTIiIGZpbGw9IiNmZmYiLz4KPC9zdmc+Cg==",INACTIVE:"inactive",ACTIVE:"active",COMPOSING:"composing",PAUSED:"paused",GONE:"gone",PRIVATE_CHAT_TYPE:"chatbox",CHATROOMS_TYPE:"chatroom",HEADLINES_TYPE:"headline",CONTROLBOX_TYPE:"controlbox",TIMEOUTS:{PAUSED:1e4,INACTIVE:9e4},default_connection_options:{explicitResourceBinding:!0},router:new uu,isTestEnv:()=>"montague.lit/http-bind"===_c.bosh_service_url,getDefaultStore:hc,createStore:gc,__:function(){return vo.__(...arguments)},___:e=>e};Object.assign(gu,Tn),Yc.enable(gu,"_converse","pluggable");const pu=gu;var mu=o(455),vu=o.n(mu);const _u={authenticated:()=>pu?.connection?.authenticated&&!0,connected:()=>pu?.connection?.connected&&!0,disconnect(){pu.connection&&pu.connection.disconnect()},reconnect(){const{__:e,connection:t}=pu;return t.setConnectionStatus(no.Status.RECONNECTING,e("The connection has dropped, attempting to reconnect.")),t?.reconnecting?t.debouncedReconnect():t.reconnect()},isType:e=>pu.connection.isType(e)},yu={async trigger(e){if(!pu._events)return;const t=Array.from(arguments),n=t.pop();if(n&&n.synchronous){const n=pu._events[e]||[],r=t.splice(1);await Promise.all(n.map((e=>e.callback.apply(e.ctx,r))))}else pu.trigger.apply(pu,arguments);const r=pu.promises[e];void 0!==r&&r.resolve()},hook(e,t,n){const r=pu._events[e]||[];return r.length?r.reduce(((e,n)=>e.then((e=>n.callback(t,e)))),Promise.resolve(n)):n},listen:{once:pu.once.bind(pu),on:pu.on.bind(pu),not:pu.off.bind(pu),stanza(e,t,n){qc(t)?(n=t,t={}):t=t||{},pu.connection.addHandler(n,t.ns,e,t.type,t.id,t.from,t)}}},bu={promises:{add(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];(e=Array.isArray(e)?e:[e]).forEach((e=>{const n=Ao();n.replace=t,pu.promises[e]=n}))}},waitUntil(e){if("function"==typeof e)return Lc(e);{const t=pu.promises[e];return void 0===t?null:t}}};class wu extends Error{}const Su={send(e){const{api:t}=pu;return t.connection.connected()?("string"==typeof e?e=Ec(e):e?.tree&&(e=e.tree()),"iq"===e.tagName?t.sendIQ(e):(pu.connection.send(e),void t.trigger("send",e))):(Gc.warn("Not sending stanza because we're not connected!"),void Gc.warn(no.serialize(e)))},sendIQ(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const{api:r,connection:i}=pu;let s;return e=e.tree?.()??e,["get","set"].includes(e.getAttribute("type"))?(t=t||r.settings.get("stanza_timeout"),n?(s=new Promise(((n,r)=>i.sendIQ(e,n,r,t))),s.catch((n=>{if(null===n)throw new wu(`Timeout error after ${t}ms for the following IQ stanza: ${no.serialize(e)}`)}))):s=new Promise((n=>i.sendIQ(e,n,n,t)))):(pu.connection.sendIQ(e),s=Promise.resolve()),r.trigger("send",e),s}},Au={presence:{async send(e,t,n,r){await Bu.waitUntil("statusInitialized"),r&&!Array.isArray(r)&&(r=[r]);const i=pu.xmppstatus,s=await i.constructPresence(e,t,n);if(r?.map((e=>e?.tree()??e)).forEach((e=>s.cnode(e).up())),Bu.send(s),["away","chat","dnd","online","xa",void 0].includes(e)){(await Bu.rooms.get()).forEach((t=>t.sendStatusPresence(e,n,r)))}}}};var Eu=Math.max,xu=Math.min;const Nu=function(e,t,n){var r,i,s,o,a,c,u=0,d=!1,l=!1,h=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function f(t){var n=r,s=i;return r=i=void 0,u=t,o=e.apply(s,n)}function g(e){var n=e-c;return void 0===c||n>=t||n<0||l&&e-u>=s}function p(){var e=Za();if(g(e))return m(e);a=setTimeout(p,function(e){var n=t-(e-c);return l?xu(n,s-(e-u)):n}(e))}function m(e){return a=void 0,h&&r?f(e):(r=i=void 0,o)}function _(){var e=Za(),n=g(e);if(r=arguments,i=this,c=e,n){if(void 0===a)return function(e){return u=e,a=setTimeout(p,t),d?f(e):o}(c);if(l)return clearTimeout(a),a=setTimeout(p,t),f(c)}return void 0===a&&(a=setTimeout(p,t)),o}return t=wn(t)||0,v(n)&&(d=!!n.leading,s=(l="maxWait"in n)?Eu(wn(n.maxWait)||0,t):s,h="trailing"in n?!!n.trailing:h),_.cancel=function(){void 0!==a&&clearTimeout(a),u=0,r=c=i=a=void 0},_.flush=function(){return void 0===a?o:m(Za())},_};var Iu=o(914),Cu=o(848);const Tu=Object.keys(no.Status).reduce(((e,t)=>Math.max(e,no.Status[t])),0);no.Status.RECONNECTING=Tu+1;class Ou extends no.Connection{constructor(e,t){super(e,t),this.debouncedReconnect=Nu(this.reconnect,3e3)}static generateResource(){return`/converse.js-${Math.floor(139749528*Math.random()).toString()}`}async bind(){await Bu.trigger("beforeResourceBinding",{synchronous:!0}),super.bind()}async onDomainDiscovered(e){const t=await e.text(),n=(new window.DOMParser).parseFromString(t,"text/xml").firstElementChild;if("XRD"!=n.nodeName||"http://docs.oasis-open.org/ns/xri/xrd-1.0"!=n.namespaceURI)return Gc.warn("Could not discover XEP-0156 connection methods");const r=So()('Link[rel="urn:xmpp:alt-connections:xbosh"]',n),i=So()('Link[rel="urn:xmpp:alt-connections:websocket"]',n),s=r.map((e=>e.getAttribute("href"))),o=i.map((e=>e.getAttribute("href")));0===s.length&&0===o.length?Gc.warn("Neither BOSH nor WebSocket connection methods have been specified with XEP-0156."):(Bu.settings.set("websocket_url",o.pop()),Bu.settings.set("bosh_service_url",s.pop()),this.service=Bu.settings.get("websocket_url")||Bu.settings.get("bosh_service_url"),this.setProtocol())}async discoverConnectionMethods(e){const t={mode:"cors",headers:{Accept:"application/xrd+xml, text/xml"}},n=`https://${e}/.well-known/host-meta`;let r;try{r=await fetch(n,t)}catch(e){return Gc.error(`Failed to discover alternative connection methods at ${n}`),void Gc.error(e)}r.status>=200&&r.status<400?await this.onDomainDiscovered(r):Gc.warn("Could not discover XEP-0156 connection methods")}async connect(e,t,n){if(Bu.settings.get("discover_connection_methods")){const t=no.getDomainFromJid(e);await this.discoverConnectionMethods(t)}if(!Bu.settings.get("bosh_service_url")&&!Bu.settings.get("websocket_url"))throw new Error("You must supply a value for either the bosh_service_url or websocket_url or both.");super.connect(e,t,n||this.onConnectStatusChanged,59)}async switchTransport(){Bu.connection.isType("websocket")&&Bu.settings.get("bosh_service_url")?(await Du(pu.bare_jid),this._proto._doDisconnect(),this._proto=new no.Bosh(this),this.service=Bu.settings.get("bosh_service_url")):Bu.connection.isType("bosh")&&Bu.settings.get("websocket_url")&&(Bu.settings.get("authentication")===ao?await Du(Bu.settings.get("jid")):await Du(pu.bare_jid),this._proto._doDisconnect(),this._proto=new no.Websocket(this),this.service=Bu.settings.get("websocket_url"))}async reconnect(){Gc.debug("RECONNECTING: the connection has dropped, attempting to reconnect."),this.reconnecting=!0,await kc();const e=pu.connfeedback.get("connection_status");return e===no.Status.CONNFAIL?this.switchTransport():e===no.Status.AUTHFAIL&&Bu.settings.get("authentication")===ao&&await Du(Bu.settings.get("jid")),Bu.trigger("will-reconnect"),Bu.settings.get("authentication")===ao&&await Rc(),Bu.user.login()}async onConnected(e){delete this.reconnecting,this.flush(),await Du(this.jid),pu.config.get("trusted")&&localStorage.setItem("conversejs-session-jid",pu.bare_jid),await Bu.trigger("afterResourceBinding",e,{synchronous:!0}),e?Bu.trigger("reconnected"):Bu.trigger("connected")}setDisconnectionCause(e,t,n){void 0===e?(delete this.disconnection_cause,delete this.disconnection_reason):(void 0===this.disconnection_cause||n)&&(this.disconnection_cause=e,this.disconnection_reason=t)}setConnectionStatus(e,t){this.status=e,pu.connfeedback.set({connection_status:e,message:t})}async finishDisconnection(){Gc.debug("DISCONNECTED"),delete this.reconnecting,this.reset(),kc(),await Rc(),delete pu.connection,Bu.trigger("disconnected")}onDisconnected(){if(!Bu.settings.get("auto_reconnect"))return this.finishDisconnection();{const e=this.disconnection_reason;if(this.disconnection_cause===no.Status.AUTHFAIL)return Bu.settings.get("credentials_url")||Bu.settings.get("authentication")===ao?Bu.connection.reconnect():this.finishDisconnection();if(this.status===no.Status.CONNECTING){const{__:e}=pu;return this.setConnectionStatus(no.Status.CONNFAIL,e("An error occurred while connecting to the chat server.")),this.finishDisconnection()}if(this.disconnection_cause===lo||e===no.ErrorCondition.NO_AUTH_MECH||"host-unknown"===e||"remote-connection-failed"===e)return this.finishDisconnection();Bu.connection.reconnect()}}onConnectStatusChanged(e,t){const{__:n}=pu;if(Gc.debug(`Status changed to: ${fo[e]}`),e===no.Status.ATTACHFAIL)this.setConnectionStatus(e),this.worker_attach_promise?.resolve(!1);else if(e===no.Status.CONNECTED||e===no.Status.ATTACHED){if(this.worker_attach_promise?.isResolved&&this.status===no.Status.ATTACHED)return;this.setConnectionStatus(e),this.worker_attach_promise?.resolve(!0),pu.send_initial_presence=!0,this.setDisconnectionCause(),this.reconnecting?(Gc.debug(e===no.Status.CONNECTED?"Reconnected":"Reattached"),this.onConnected(!0)):(Gc.debug(e===no.Status.CONNECTED?"Connected":"Attached"),this.restored&&(pu.send_initial_presence=!1),this.onConnected())}else if(e===no.Status.DISCONNECTED)this.setDisconnectionCause(e,t),this.onDisconnected();else if(e===no.Status.BINDREQUIRED)this.bind();else if(e===no.Status.ERROR)this.setConnectionStatus(e,n("An error occurred while connecting to the chat server."));else if(e===no.Status.CONNECTING)this.setConnectionStatus(e);else if(e===no.Status.AUTHENTICATING)this.setConnectionStatus(e);else if(e===no.Status.AUTHFAIL)t||(t=n("Your XMPP address and/or password is incorrect. Please try again.")),this.setConnectionStatus(e,t),this.setDisconnectionCause(e,t,!0),this.onDisconnected();else if(e===no.Status.CONNFAIL){let r=t;"host-unknown"===t||"remote-connection-failed"==t?r=n("Sorry, we could not connect to the XMPP host with domain: %1$s",`"${no.getDomainFromJid(this.jid)}"`):void 0!==t&&t===no?.ErrorCondition?.NO_AUTH_MECH&&(r=n("The XMPP server did not offer a supported authentication mechanism")),this.setConnectionStatus(e,r),this.setDisconnectionCause(e,t)}else e===no.Status.DISCONNECTING&&this.setDisconnectionCause(e,t)}isType(e){return"websocket"===e.toLowerCase()?this._proto instanceof no.Websocket:"bosh"===e.toLowerCase()?no.Bosh&&this._proto instanceof no.Bosh:void 0}hasResumed(){return Bu.settings.get("connection_options")?.worker||this.isType("bosh")?pu.connfeedback.get("connection_status")===no.Status.ATTACHED:!this.do_bind}restoreWorkerSession(){return this.attach(this.onConnectStatusChanged),this.worker_attach_promise=Ao(),this.worker_attach_promise}}class ju extends Ou{constructor(e,t){super(e,t),this.sent_stanzas=[],this.IQ_stanzas=[],this.IQ_ids=[],this.features=no.xmlHtmlNode('<stream:features xmlns:stream="http://etherx.jabber.org/streams" xmlns="jabber:client"><ver xmlns="urn:xmpp:features:rosterver"/><csi xmlns="urn:xmpp:csi:0"/><this xmlns="http://jabber.org/protocol/caps" ver="UwBpfJpEt3IoLYfWma/o/p3FFRo=" hash="sha-1" node="http://prosody.im"/><bind xmlns="urn:ietf:params:xml:ns:xmpp-bind"><required/></bind><sm xmlns=\'urn:xmpp:sm:3\'/><session xmlns="urn:ietf:params:xml:ns:xmpp-session"><optional/></session></stream:features>').firstChild,this._proto._processRequest=()=>{},this._proto._disconnect=()=>this._onDisconnectTimeout(),this._proto._onDisconnectTimeout=()=>{},this._proto._connect=()=>{this.connected=!0,this.mock=!0,this.jid="romeo@montague.lit/orchard",this._changeConnectStatus(no.Status.BINDREQUIRED)}}_processRequest(){}sendIQ(e,t,n){e=e.tree?.()??e,this.IQ_stanzas.push(e);const r=super.sendIQ(e,t,n);return this.IQ_ids.push(r),r}send(e){return e=e.tree?.()??e,this.sent_stanzas.push(e),super.send(e)}async bind(){await Bu.trigger("beforeResourceBinding",{synchronous:!0}),this.authenticated=!0,pu.no_connection_on_bind||this._changeConnectStatus(no.Status.CONNECTED)}}function ku(){const{api:e}=pu;return("WebSocket"in window||"MozWebSocket"in window)&&e.settings.get("websocket_url")?e.settings.get("websocket_url"):e.settings.get("bosh_service_url")?e.settings.get("bosh_service_url"):""}function Ru(){const e=pu.api;if(!e.settings.get("bosh_service_url")&&e.settings.get("authentication")===ho)throw new Error("authentication is set to 'prebind' but we don't have a BOSH connection");const t=pu.isTestEnv()?ju:Ou;pu.connection=new t(ku(),Object.assign(pu.default_connection_options,e.settings.get("connection_options"),{keepalive:e.settings.get("keepalive")})),function(){const e={};e[no.LogLevel.DEBUG]="debug",e[no.LogLevel.INFO]="info",e[no.LogLevel.WARN]="warn",e[no.LogLevel.ERROR]="error",e[no.LogLevel.FATAL]="fatal",no.log=(t,n)=>Gc.log(n,e[t]),no.error=e=>Gc.error(e),pu.connection.xmlInput=e=>Gc.debug(e.outerHTML,"color: darkgoldenrod"),pu.connection.xmlOutput=e=>Gc.debug(e.outerHTML,"color: darkcyan")}(),e.trigger("connectionInitialized")}function Mu(e,t){t=e.session.get("jid")||t,e.api.settings.get("authentication")===ao||no.getResourceFromJid(t)||(t=t.toLowerCase()+Ou.generateResource()),e.jid=t,e.bare_jid=no.getBareJidFromJid(t),e.resource=no.getResourceFromJid(t),e.domain=no.getDomainFromJid(t),e.session.save({jid:t,bare_jid:e.bare_jid,resource:e.resource,domain:e.domain,active:!0}),e.connection.jid=t}async function Du(e){return await async function(e,t){const n=e.api.settings.get("connection_options").worker,r=no.getBareJidFromJid(t).toLowerCase(),i=`converse.session-${r}`;e.session?.get("id")!==i?(!function(e,t){if("sessionStorage"===e.api.settings.get("persistent_store"))return;if("BrowserExtLocal"===e.api.settings.get("persistent_store"))return lc.localForage.defineDriver(Iu.Z).then((()=>lc.localForage.setDriver("webExtensionLocalStorage"))),void(e.storage.persistent=lc.localForage);if("BrowserExtSync"===e.api.settings.get("persistent_store"))return lc.localForage.defineDriver(Cu.Z).then((()=>lc.localForage.setDriver("webExtensionSyncStorage"))),void(e.storage.persistent=lc.localForage);const n={name:e.isTestEnv()?"converse-test-persistent":"converse-persistent",storeName:t};"localStorage"===e.api.settings.get("persistent_store")?(n.description="localStorage instance",n.driver=[lc.localForage.LOCALSTORAGE]):"IndexedDB"===e.api.settings.get("persistent_store")&&(n.description="indexedDB instance",n.driver=[lc.localForage.INDEXEDDB]),e.storage.persistent=lc.localForage.createInstance(n)}(e,r),e.session=new us({id:i}),pc(e.session,i,n?"persistent":"session"),await new Promise((t=>e.session.fetch({success:t,error:t}))),!n&&e.session.get("active")&&(e.session.clear(),e.session.save({id:i})),Mu(e,t),window.addEventListener(e.unloadevent,(()=>e.session?.save("active",!1))),e.api.trigger("userSessionInitialized")):Mu(e,t)}(pu,e),pu.api.trigger("setUserJID"),e}async function $u(e){const{api:t}=e;await t.trigger("cleanup",{synchronous:!0}),e.router.history.stop(),function(e){const{api:t}=e;document.removeEventListener("visibilitychange",Hc),t.trigger("unregisteredGlobalEventHandlers")}(e),e.connection?.reset(),e.stopListening(),e.off(),e.promises.initialized.isResolved&&t.promises.add("initialized")}function Fu(){return new Promise(Nu((async(e,t)=>{let n=new XMLHttpRequest;n.open("GET",pu.api.settings.get("credentials_url"),!0),n.setRequestHeader("Accept","application/json, text/javascript"),n.onload=()=>{if(n.status>=200&&n.status<400){const t=JSON.parse(n.responseText);Du(t.jid).then((()=>{e({jid:t.jid,password:t.password})}))}else t(new Error(`${n.status}: ${n.responseText}`))},n.onerror=t,n=await pu.api.hook("beforeFetchLoginCredentials",this,n),n.send()}),arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))}async function Pu(e,t){const{api:n}=pu;if(n.settings.get("authentication")===uo){if(e)return zu(e);if(n.settings.get("credentials_url"))return zu(await async function(){let e,t=0;for(;!e;){try{e=await Fu(t)}catch(e){Gc.error("Could not fetch login credentials"),Gc.error(e)}t=2e3}return e}());if(pu.jid&&(n.settings.get("password")||pu.connection.pass))return zu();if(n.settings.get("reuse_scram_keys")){const e=await async function(){const e=localStorage.getItem("conversejs-session-jid");if(!e)return null;await Du(e);const t=(await Lu(e)).get("scram_keys");return t?{jid:e,password:t}:null}();if(e)return zu(e)}if(!pu.isTestEnv()&&"credentials"in navigator){const e=await async function(){if(!localStorage.getItem("conversejs-session-jid"))return null;try{const e=await navigator.credentials.get({password:!0});if(e&&"password"==e.type&&Mc(e.id))return await Du(e.id),{jid:e.id,password:e.password}}catch(e){return Gc.error(e),null}}();if(e)return zu(e)}pu.isTestEnv()||Gc.warn("attemptNonPreboundSession: Couldn't find credentials to log in with")}else![ao,co].includes(n.settings.get("authentication"))||t&&!n.settings.get("auto_login")||zu()}async function Lu(e){const t=`converse.scram-keys-${no.getBareJidFromJid(e)}`,n=new us({id:t});return pc(n,t,"persistent"),await new Promise((e=>n.fetch({success:e,error:e}))),n}async function zu(e){const{api:t}=pu;if([ao,co].includes(t.settings.get("authentication"))){if(!pu.jid)throw new Error("Config Error: when using anonymous login you need to provide the server's domain via the 'jid' option. Either when calling converse.initialize, or when calling _converse.api.user.login.");pu.connection.reconnecting||pu.connection.reset(),pu.connection.connect(pu.jid.toLowerCase())}else if(t.settings.get("authentication")===uo){const n=e?.password??(pu.connection?.pass||t.settings.get("password"));if(!n){if(t.settings.get("auto_login"))throw new Error("autoLogin: If you use auto_login and authentication='login' then you also need to provide a password.");return pu.connection.setDisconnectionCause(no.Status.AUTHFAIL,void 0,!0),void t.connection.disconnect()}let r;if(pu.connection.reconnecting||(pu.connection.reset(),pu.connection.service=ku()),pu.config.get("trusted")&&pu.jid&&t.settings.get("reuse_scram_keys")&&!n?.ck){const e=await Lu(pu.jid);r=t=>{const{scram_keys:n}=pu.connection;n&&e.save({scram_keys:n}),pu.connection.onConnectStatusChanged(t)}}pu.connection.connect(pu.jid,n,r)}}const Uu={user:{settings:Ac,...Au,jid:()=>pu.connection.jid,async login(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{api:r}=pu;if(e=e||r.settings.get("jid"),(!pu.connection?.jid||e&&!qc.isSameDomain(pu.connection.jid,e))&&Ru(),r.settings.get("connection_options")?.worker&&await pu.connection.restoreWorkerSession())return;e&&(e=await Du(e));const i=pu.pluggable.plugins["converse-bosh"];if(i?.enabled()){if(await pu.restoreBOSHSession())return;if(r.settings.get("authentication")===ho&&(!n||r.settings.get("auto_login")))return pu.startNewPreboundBOSHSession()}t=t||r.settings.get("password");Pu(e&&t?{jid:e,password:t}:null,n)},async logout(){const{api:e}=pu;await e.trigger("beforeLogout",{synchronous:!0});const t=Ao(),n=()=>{Object.keys(pu.promises).forEach(zc),delete pu.jid,localStorage.removeItem("conversejs-session-jid"),e.trigger("logout"),t.resolve()};return pu.connection.setDisconnectionCause(lo,void 0,!0),void 0!==pu.connection?(e.listen.once("disconnected",(()=>n())),pu.connection.disconnect()):n(),t}}},Bu=pu.api={connection:_u,settings:Sc,...Su,...Uu,...yu,...bu};var Hu=o(76),qu=o.n(Hu);const Ju=us.extend({defaults:{connection_status:no.Status.DISCONNECTED,message:""},initialize(){const{api:e}=pu;this.on("change",(()=>e.trigger("connfeedback",pu.connfeedback)))}});var Wu=o(988),Gu=o.n(Wu);const Qu=function(e,t,n,r){for(var i=-1,s=null==e?0:e.length;++i<s;){var o=e[i];t(r,o,n(o),e)}return r};const Vu=function(e,t,n,r){return Kc(e,(function(e,i,s){t(r,e,n(e),s)})),r};const Yu=function(e,t){return function(n,r){var i=G(n)?Qu:Vu,s=t?t():{};return i(n,e,Li(r,2),s)}};var Xu=Object.prototype.hasOwnProperty,Ku=Yu((function(e,t,n){Xu.call(e,n)?++e[n]:D(e,n,1)}));const Zu=Ku;const ed=function(e,t,n,r){for(var i=e.length,s=n+(r?1:-1);r?s--:++s<i;)if(t(e[s],s,e))return s;return-1};const td=function(e){return e!=e};const nd=function(e,t,n){for(var r=n-1,i=e.length;++r<i;)if(e[r]===t)return r;return-1};const rd=function(e,t,n){return t==t?nd(e,t,n):ed(e,td,n)};const id=function(e,t){return!!(null==e?0:e.length)&&rd(e,t,0)>-1};const sd=function(e,t,n){for(var r=-1,i=null==e?0:e.length;++r<i;)if(n(t,e[r]))return!0;return!1};const od=function(e,t,n,r){var i=-1,s=id,o=!0,a=e.length,c=[],u=t.length;if(!a)return c;n&&(t=Ot(t,ie(n))),r?(s=sd,o=!1):t.length>=200&&(s=di,o=!1,t=new ci(t));e:for(;++i<a;){var d=e[i],l=null==n?d:n(d);if(d=r||0!==d?d:0,o&&l==l){for(var h=u;h--;)if(t[h]===l)continue e;c.push(d)}else s(t,l,r)||c.push(d)}return c};const ad=Me((function(e,t){return Wa(e)?od(e,es(t,1,Wa,!0)):[]}));const cd=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(!t(e[n],n,e))return!1;return!0};const ud=function(e,t){var n=!0;return Kc(e,(function(e,r,i){return n=!!t(e,r,i)})),n};const dd=function(e,t,n){var r=G(e)?cd:ud;return n&&De(e,t,n)&&(t=void 0),r(e,Li(t,3))};var ld=Math.max;const hd=function(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=null==n?0:En(n);return i<0&&(i=ld(r+i,0)),ed(e,Li(t,3),i)};var fd=Math.max,gd=Math.min;const pd=function(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=r-1;return void 0!==n&&(i=En(n),i=n<0?fd(r+i,0):gd(i,r-1)),ed(e,Li(t,3),i,!0)};var md=Object.prototype.hasOwnProperty,vd=Yu((function(e,t,n){md.call(e,n)?e[n].push(t):D(e,n,[t])}));const _d=vd;var yd=Math.max;const bd=function(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=null==n?0:En(n);return i<0&&(i=yd(r+i,0)),rd(e,t,i)};var wd=Yu((function(e,t,n){D(e,n,t)}));const Sd=wd;const Ad=function(e,t,n){for(var r=n+1;r--;)if(e[r]===t)return r;return r};var Ed=Math.max,xd=Math.min;const Nd=function(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=r;return void 0!==n&&(i=(i=En(n))<0?Ed(r+i,0):xd(i,r-1)),t==t?Ad(e,t,i):ed(e,td,i,!0)};const Id=function(e,t){var n=-1,r=ye(e)?Array(e.length):[];return Kc(e,(function(e,i,s){r[++n]=t(e,i,s)})),r};const Cd=function(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e};const Td=function(e,t){if(e!==t){var n=void 0!==e,r=null===e,i=e==e,s=qe(e),o=void 0!==t,a=null===t,c=t==t,u=qe(t);if(!a&&!u&&!s&&e>t||s&&o&&c&&!a&&!u||r&&o&&c||!n&&c||!i)return 1;if(!r&&!s&&!u&&e<t||u&&n&&i&&!r&&!s||a&&n&&i||!o&&i||!c)return-1}return 0};const Od=function(e,t,n){for(var r=-1,i=e.criteria,s=t.criteria,o=i.length,a=n.length;++r<o;){var c=Td(i[r],s[r]);if(c)return r>=a?c:c*("desc"==n[r]?-1:1)}return e.index-t.index};const jd=function(e,t,n){t=t.length?Ot(t,(function(e){return G(e)?function(t){return ji(t,1===e.length?e[0]:e)}:e})):[Ne];var r=-1;t=Ot(t,ie(Li));var i=Id(e,(function(e,n,i){var s=Ot(t,(function(t){return t(e)}));return{criteria:s,index:++r,value:e}}));return Cd(i,(function(e,t){return Od(e,t,n)}))};var kd=Me((function(e,t){if(null==e)return[];var n=t.length;return n>1&&De(e,t[0],t[1])?t=[]:n>2&&De(t[0],t[1],t[2])&&(t=[t[0]]),jd(e,es(t,1),[])}));const Rd=kd,Md=Array.prototype.slice,Dd=function(e,t){t||(t={}),this.preinitialize.apply(this,arguments),t.model&&(this.model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,Ue({silent:!0},t))};Dd.extend=Ut;const $d={add:!0,remove:!0,merge:!0},Fd={add:!0,remove:!1},Pd=function(e,t,n){n=Math.min(Math.max(n,0),e.length);const r=Array(e.length-n),i=t.length;let s;for(s=0;s<r.length;s++)r[s]=e[s+n];for(s=0;s<i;s++)e[s+n]=t[s];for(s=0;s<r.length;s++)e[s+i+n]=r[s]};Object.assign(Dd.prototype,Tn,{model:us,preinitialize:function(){},initialize:function(){},toJSON:function(e){return this.map((function(t){return t.toJSON(e)}))},sync:function(e,t,n){return Wt(this)(e,t,n)},add:function(e,t){return this.set(e,Ue({merge:!1},t,Fd))},remove:function(e,t){t=Ue({},t);const n=!Array.isArray(e);e=n?[e]:e.slice();const r=this._removeModels(e,t);return!t.silent&&r.length&&(t.changes={added:[],merged:[],removed:r},this.trigger("update",this,t)),n?r[0]:r},set:function(e,t){if(null==e)return;(t=Ue({},$d,t)).parse&&!this._isModel(e)&&(e=this.parse(e,t)||[]);const n=!Array.isArray(e);e=n?[e]:e.slice();let r=t.at;null!=r&&(r=+r),r>this.length&&(r=this.length),r<0&&(r+=this.length+1);const i=[],s=[],o=[],a=[],c={},u=t.add,d=t.merge,l=t.remove;let h=!1;const f=this.comparator&&null==r&&!1!==t.sort,g=Io(this.comparator)?this.comparator:null;let p,m;for(m=0;m<e.length;m++){p=e[m];const n=this.get(p);if(n){if(d&&p!==n){let e=this._isModel(p)?p.attributes:p;t.parse&&(e=n.parse(e,t)),n.set(e,t),o.push(n),f&&!h&&(h=n.hasChanged(g))}c[n.cid]||(c[n.cid]=!0,i.push(n)),e[m]=n}else u&&(p=e[m]=this._prepareModel(p,t),p&&(s.push(p),this._addReference(p,t),c[p.cid]=!0,i.push(p)))}if(l){for(m=0;m<this.length;m++)p=this.models[m],c[p.cid]||a.push(p);a.length&&this._removeModels(a,t)}let v=!1;const _=!f&&u&&l;if(i.length&&_?(v=this.length!==i.length||eu(this.models,((e,t)=>e!==i[t])),this.models.length=0,Pd(this.models,i,0),this.length=this.models.length):s.length&&(f&&(h=!0),Pd(this.models,s,null==r?this.length:r),this.length=this.models.length),h&&this.sort({silent:!0}),!t.silent){for(m=0;m<s.length;m++)null!=r&&(t.index=r+m),p=s[m],p.trigger("add",p,this,t);(h||v)&&this.trigger("sort",this,t),(s.length||a.length||o.length)&&(t.changes={added:s,removed:a,merged:o},this.trigger("update",this,t))}return n?e[0]:e},clearStore:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e=>e;await Promise.all(this.models.filter(t).map((t=>new Promise((n=>{t.destroy(Object.assign(e,{success:n,error:(e,t)=>{console.error(t),n()}}))}))))),await this.browserStorage.clear(),this.reset()},reset:function(e,t){t=t?Lr(t):{};for(let e=0;e<this.models.length;e++)this._removeReference(this.models[e],t);return t.previousModels=this.models,this._reset(),e=this.add(e,Ue({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,Ue({at:this.length},t))},pop:function(e){const t=this.at(this.length-1);return this.remove(t,e)},unshift:function(e,t){return this.add(e,Ue({at:0},t))},shift:function(e){const t=this.at(0);return this.remove(t,e)},slice:function(){return Md.apply(this.models,arguments)},filter:function(e,t){return this.models.filter(_(e)?e:t=>t.matches(e),t)},every:function(e){return dd(this.models.map((e=>e.attributes)),e)},difference:function(e){return ad(this.models,e)},max:function(){return Math.max.apply(Math,this.models)},min:function(){return Math.min.apply(Math,this.models)},drop:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.models.slice(e)},some:function(e){return eu(this.models.map((e=>e.attributes)),e)},sortBy:function(e){return Rd(this.models,_(e)?e:t=>Io(e)?t.get(e):t.matches(e))},isEmpty:function(){return hn(this.models)},keyBy:function(e){return Sd(this.models,e)},each:function(e,t){return this.forEach(e,t)},forEach:function(e,t){return this.models.forEach(e,t)},includes:function(e){return this.models.includes(e)},size:function(){return this.models.length},countBy:function(e){return Zu(this.models,_(e)?e:t=>Io(e)?t.get(e):t.matches(e))},groupBy:function(e){return _d(this.models,_(e)?e:t=>Io(e)?t.get(e):t.matches(e))},indexOf:function(e){return bd(this.models,e)},findLastIndex:function(e,t){return pd(this.models,_(e)?e:t=>Io(e)?t.get(e):t.matches(e),t)},lastIndexOf:function(e){return Nd(this.models,e)},findIndex:function(e){return hd(this.models,_(e)?e:t=>Io(e)?t.get(e):t.matches(e))},last:function(){const e=null==this.models?0:this.models.length;return e?this.models[e-1]:void 0},head:function(){return this.models[0]},first:function(){return this.head()},map:function(e,t){return this.models.map(_(e)?e:t=>Io(e)?t.get(e):t.matches(e),t)},reduce:function(e,t){return this.models.reduce(e,t||this.models[0])},reduceRight:function(e,t){return this.models.reduceRight(e,t||this.models[0])},toArray:function(){return Array.from(this.models)},get:function(e){if(null!=e)return this._byId[e]||this._byId[this.modelId(this._isModel(e)?e.attributes:e)]||e.cid&&this._byId[e.cid]},has:function(e){return null!=this.get(e)},at:function(e){return e<0&&(e+=this.length),this.models[e]},where:function(e,t){return this[t?"find":"filter"](e)},findWhere:function(e){return this.where(e,!0)},find:function(e,t){const n=_(e)?e:t=>t.matches(e);return this.models.find(n,t)},sort:function(e){let t=this.comparator;if(!t)throw new Error("Cannot sort a set without a comparator");e||(e={});const n=t.length;return _(t)&&(t=t.bind(this)),1===n||Io(t)?this.models=this.sortBy(t):this.models.sort(t),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return this.map(e+"")},fetch:function(e){const t=(e=Ue({parse:!0},e)).success,n=this,r=e.promise&&Bt();return e.success=function(i){const s=e.reset?"reset":"set";n[s](i,e),t&&t.call(e.context,n,i,e),r&&r.resolve(),n.trigger("sync",n,i,e)},qt(this,e),r||this.sync("read",this,e)},create:function(e,t){const n=(t=t?Lr(t):{}).wait,r=t.promise,i=r&&Bt();if(!(e=this._prepareModel(e,t)))return!1;n||this.add(e,t);const s=this,o=t.success,a=t.error;return t.success=function(e,t,a){n&&s.add(e,a),o&&o.call(a.context,e,t,a),r&&i.resolve(e)},t.error=function(e,t,n){a&&a.call(n.context,e,t,n),r&&i.reject(t)},e.save(null,Object.assign(t,{promise:!1})),r?i:e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(e){return e[this.model.prototype?.idAttribute||"id"]},values:function(){return new zd(this,Ud)},keys:function(){return new zd(this,Bd)},entries:function(){return new zd(this,Hd)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(this._isModel(e))return e.collection||(e.collection=this),e;(t=t?Lr(t):{}).collection=this;const n=new this.model(e,t);return n.validationError?(this.trigger("invalid",this,n.validationError,t),!1):n},_removeModels:function(e,t){const n=[];for(let r=0;r<e.length;r++){const i=this.get(e[r]);if(!i)continue;const s=this.indexOf(i);this.models.splice(s,1),this.length--,delete this._byId[i.cid];const o=this.modelId(i.attributes);null!=o&&delete this._byId[o],t.silent||(t.index=s,i.trigger("remove",i,this,t)),n.push(i),this._removeReference(i,t)}return n},_isModel:function(e){return e instanceof us},_addReference:function(e,t){this._byId[e.cid]=e;const n=this.modelId(e.attributes);null!=n&&(this._byId[n]=e),e.on("all",this._onModelEvent,this)},_removeReference:function(e,t){delete this._byId[e.cid];const n=this.modelId(e.attributes);null!=n&&delete this._byId[n],this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){if(t){if(("add"===e||"remove"===e)&&n!==this)return;if("destroy"===e&&this.remove(t,r),"change"===e){const e=this.modelId(t.previousAttributes()),n=this.modelId(t.attributes);e!==n&&(null!=e&&delete this._byId[e],null!=n&&(this._byId[n]=t))}}this.trigger.apply(this,arguments)}});const Ld="function"==typeof Symbol&&Symbol.iterator;Ld&&(Dd.prototype[Ld]=Dd.prototype.values);const zd=function(e,t){this._collection=e,this._kind=t,this._index=0},Ud=1,Bd=2,Hd=3;Ld&&(zd.prototype[Ld]=function(){return this}),zd.prototype.next=function(){if(this._collection){if(this._index<this._collection.length){const e=this._collection.at(this._index);let t;if(this._index++,this._kind===Ud)t=e;else{const n=this._collection.modelId(e.attributes);t=this._kind===Bd?n:[n,e]}return{value:t,done:!1}}this._collection=void 0}return{value:void 0,done:!0}};const qd="array",Jd="bit",Wd="bits",Gd="byte",Qd="bytes",Vd="",Yd="exponent",Xd="function",Kd="iec",Zd="Invalid number",el="Invalid rounding method",tl="jedec",nl="object",rl=".",il="round",sl="s",ol="kbit",al="kB",cl=" ",ul="string",dl="0",ll={symbol:{iec:{bits:["bit","Kibit","Mibit","Gibit","Tibit","Pibit","Eibit","Zibit","Yibit"],bytes:["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"]},jedec:{bits:["bit","Kbit","Mbit","Gbit","Tbit","Pbit","Ebit","Zbit","Ybit"],bytes:["B","KB","MB","GB","TB","PB","EB","ZB","YB"]}},fullform:{iec:["","kibi","mebi","gibi","tebi","pebi","exbi","zebi","yobi"],jedec:["","kilo","mega","giga","tera","peta","exa","zetta","yotta"]}};function hl(e){let{bits:t=!1,pad:n=!1,base:r=-1,round:i=2,locale:s=Vd,localeOptions:o={},separator:a=Vd,spacer:c=cl,symbols:u={},standard:d=Vd,output:l=ul,fullform:h=!1,fullforms:f=[],exponent:g=-1,roundingMethod:p=il,precision:m=0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},v=g,_=Number(e),y=[],b=0,w=Vd;-1===r&&0===d.length?(r=10,d=tl):-1===r&&d.length>0?(d=d===Kd?Kd:tl,r=d===Kd?2:10):(r=2===r?2:10,d=10===r||d===tl?tl:Kd);const S=10===r?1e3:1024,A=!0===h,E=_<0,x=Math[p];if("bigint"!=typeof e&&isNaN(e))throw new TypeError(Zd);if(typeof x!==Xd)throw new TypeError(el);if(E&&(_=-_),(-1===v||isNaN(v))&&(v=Math.floor(Math.log(_)/Math.log(S)),v<0&&(v=0)),v>8&&(m>0&&(m+=8-v),v=8),l===Yd)return v;if(0===_)y[0]=0,w=y[1]=ll.symbol[d][t?Wd:Qd][v];else{b=_/(2===r?Math.pow(2,10*v):Math.pow(1e3,v)),t&&(b*=8,b>=S&&v<8&&(b/=S,v++));const e=Math.pow(10,v>0?i:0);y[0]=x(b*e)/e,y[0]===S&&v<8&&-1===g&&(y[0]=1,v++),w=y[1]=10===r&&1===v?t?ol:al:ll.symbol[d][t?Wd:Qd][v]}if(E&&(y[0]=-y[0]),m>0&&(y[0]=y[0].toPrecision(m)),y[1]=u[y[1]]||y[1],!0===s?y[0]=y[0].toLocaleString():s.length>0?y[0]=y[0].toLocaleString(s,o):a.length>0&&(y[0]=y[0].toString().replace(rl,a)),n&&!1===Number.isInteger(y[0])&&i>0){const e=a||rl,t=y[0].toString().split(e),n=t[1]||Vd,r=n.length,s=i-r;y[0]=`${t[0]}${e}${n.padEnd(r+s,dl)}`}return A&&(y[1]=f[v]?f[v]:ll.fullform[d][v]+(t?Jd:Gd)+(1===y[0]?Vd:sl)),l===qd?y:l===nl?{value:y[0],symbol:y[1],exponent:v,unit:w}:y.join(c)}const fl=window,gl=fl.ShadowRoot&&(void 0===fl.ShadyCSS||fl.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,pl=Symbol(),ml=new WeakMap;class vl{constructor(e,t,n){if(this._$cssResult$=!0,n!==pl)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=t}get styleSheet(){let e=this.o;const t=this.t;if(gl&&void 0===e){const n=void 0!==t&&1===t.length;n&&(e=ml.get(t)),void 0===e&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),n&&ml.set(t,e))}return e}toString(){return this.cssText}}const _l=gl?e=>e:e=>e instanceof CSSStyleSheet?(e=>{let t="";for(const n of e.cssRules)t+=n.cssText;return(e=>new vl("string"==typeof e?e:e+"",void 0,pl))(t)})(e):e;var yl;const bl=window,wl=bl.trustedTypes,Sl=wl?wl.emptyScript:"",Al=bl.reactiveElementPolyfillSupport,El={toAttribute(e,t){switch(t){case Boolean:e=e?Sl:null;break;case Object:case Array:e=null==e?e:JSON.stringify(e)}return e},fromAttribute(e,t){let n=e;switch(t){case Boolean:n=null!==e;break;case Number:n=null===e?null:Number(e);break;case Object:case Array:try{n=JSON.parse(e)}catch(e){n=null}}return n}},xl=(e,t)=>t!==e&&(t==t||e==e),Nl={attribute:!0,type:String,converter:El,reflect:!1,hasChanged:xl},Il="finalized";class Cl extends HTMLElement{constructor(){super(),this._$Ei=new Map,this.isUpdatePending=!1,this.hasUpdated=!1,this._$El=null,this.u()}static addInitializer(e){var t;this.finalize(),(null!==(t=this.h)&&void 0!==t?t:this.h=[]).push(e)}static get observedAttributes(){this.finalize();const e=[];return this.elementProperties.forEach(((t,n)=>{const r=this._$Ep(n,t);void 0!==r&&(this._$Ev.set(r,n),e.push(r))})),e}static createProperty(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Nl;if(t.state&&(t.attribute=!1),this.finalize(),this.elementProperties.set(e,t),!t.noAccessor&&!this.prototype.hasOwnProperty(e)){const n="symbol"==typeof e?Symbol():"__"+e,r=this.getPropertyDescriptor(e,n,t);void 0!==r&&Object.defineProperty(this.prototype,e,r)}}static getPropertyDescriptor(e,t,n){return{get(){return this[t]},set(r){const i=this[e];this[t]=r,this.requestUpdate(e,i,n)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)||Nl}static finalize(){if(this.hasOwnProperty(Il))return!1;this[Il]=!0;const e=Object.getPrototypeOf(this);if(e.finalize(),void 0!==e.h&&(this.h=[...e.h]),this.elementProperties=new Map(e.elementProperties),this._$Ev=new Map,this.hasOwnProperty("properties")){const e=this.properties,t=[...Object.getOwnPropertyNames(e),...Object.getOwnPropertySymbols(e)];for(const n of t)this.createProperty(n,e[n])}return this.elementStyles=this.finalizeStyles(this.styles),!0}static finalizeStyles(e){const t=[];if(Array.isArray(e)){const n=new Set(e.flat(1/0).reverse());for(const e of n)t.unshift(_l(e))}else void 0!==e&&t.push(_l(e));return t}static _$Ep(e,t){const n=t.attribute;return!1===n?void 0:"string"==typeof n?n:"string"==typeof e?e.toLowerCase():void 0}u(){var e;this._$E_=new Promise((e=>this.enableUpdating=e)),this._$AL=new Map,this._$Eg(),this.requestUpdate(),null===(e=this.constructor.h)||void 0===e||e.forEach((e=>e(this)))}addController(e){var t,n;(null!==(t=this._$ES)&&void 0!==t?t:this._$ES=[]).push(e),void 0!==this.renderRoot&&this.isConnected&&(null===(n=e.hostConnected)||void 0===n||n.call(e))}removeController(e){var t;null===(t=this._$ES)||void 0===t||t.splice(this._$ES.indexOf(e)>>>0,1)}_$Eg(){this.constructor.elementProperties.forEach(((e,t)=>{this.hasOwnProperty(t)&&(this._$Ei.set(t,this[t]),delete this[t])}))}createRenderRoot(){var e;const t=null!==(e=this.shadowRoot)&&void 0!==e?e:this.attachShadow(this.constructor.shadowRootOptions);return((e,t)=>{gl?e.adoptedStyleSheets=t.map((e=>e instanceof CSSStyleSheet?e:e.styleSheet)):t.forEach((t=>{const n=document.createElement("style"),r=fl.litNonce;void 0!==r&&n.setAttribute("nonce",r),n.textContent=t.cssText,e.appendChild(n)}))})(t,this.constructor.elementStyles),t}connectedCallback(){var e;void 0===this.renderRoot&&(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),null===(e=this._$ES)||void 0===e||e.forEach((e=>{var t;return null===(t=e.hostConnected)||void 0===t?void 0:t.call(e)}))}enableUpdating(e){}disconnectedCallback(){var e;null===(e=this._$ES)||void 0===e||e.forEach((e=>{var t;return null===(t=e.hostDisconnected)||void 0===t?void 0:t.call(e)}))}attributeChangedCallback(e,t,n){this._$AK(e,n)}_$EO(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Nl;var r;const i=this.constructor._$Ep(e,n);if(void 0!==i&&!0===n.reflect){const s=(void 0!==(null===(r=n.converter)||void 0===r?void 0:r.toAttribute)?n.converter:El).toAttribute(t,n.type);this._$El=e,null==s?this.removeAttribute(i):this.setAttribute(i,s),this._$El=null}}_$AK(e,t){var n;const r=this.constructor,i=r._$Ev.get(e);if(void 0!==i&&this._$El!==i){const e=r.getPropertyOptions(i),s="function"==typeof e.converter?{fromAttribute:e.converter}:void 0!==(null===(n=e.converter)||void 0===n?void 0:n.fromAttribute)?e.converter:El;this._$El=i,this[i]=s.fromAttribute(t,e.type),this._$El=null}}requestUpdate(e,t,n){let r=!0;void 0!==e&&(((n=n||this.constructor.getPropertyOptions(e)).hasChanged||xl)(this[e],t)?(this._$AL.has(e)||this._$AL.set(e,t),!0===n.reflect&&this._$El!==e&&(void 0===this._$EC&&(this._$EC=new Map),this._$EC.set(e,n))):r=!1),!this.isUpdatePending&&r&&(this._$E_=this._$Ej())}async _$Ej(){this.isUpdatePending=!0;try{await this._$E_}catch(e){Promise.reject(e)}const e=this.scheduleUpdate();return null!=e&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var e;if(!this.isUpdatePending)return;this.hasUpdated,this._$Ei&&(this._$Ei.forEach(((e,t)=>this[t]=e)),this._$Ei=void 0);let t=!1;const n=this._$AL;try{t=this.shouldUpdate(n),t?(this.willUpdate(n),null===(e=this._$ES)||void 0===e||e.forEach((e=>{var t;return null===(t=e.hostUpdate)||void 0===t?void 0:t.call(e)})),this.update(n)):this._$Ek()}catch(e){throw t=!1,this._$Ek(),e}t&&this._$AE(n)}willUpdate(e){}_$AE(e){var t;null===(t=this._$ES)||void 0===t||t.forEach((e=>{var t;return null===(t=e.hostUpdated)||void 0===t?void 0:t.call(e)})),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$Ek(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$E_}shouldUpdate(e){return!0}update(e){void 0!==this._$EC&&(this._$EC.forEach(((e,t)=>this._$EO(t,this[t],e))),this._$EC=void 0),this._$Ek()}updated(e){}firstUpdated(e){}}var Tl;Cl[Il]=!0,Cl.elementProperties=new Map,Cl.elementStyles=[],Cl.shadowRootOptions={mode:"open"},null==Al||Al({ReactiveElement:Cl}),(null!==(yl=bl.reactiveElementVersions)&&void 0!==yl?yl:bl.reactiveElementVersions=[]).push("1.6.2");const Ol=window,jl=Ol.trustedTypes,kl=jl?jl.createPolicy("lit-html",{createHTML:e=>e}):void 0,Rl="$lit$",Ml=`lit$${(Math.random()+"").slice(9)}$`,Dl="?"+Ml,$l=`<${Dl}>`,Fl=document,Pl=()=>Fl.createComment(""),Ll=e=>null===e||"object"!=typeof e&&"function"!=typeof e,zl=Array.isArray,Ul=e=>zl(e)||"function"==typeof(null==e?void 0:e[Symbol.iterator]),Bl="[ \t\n\f\r]",Hl=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,ql=/-->/g,Jl=/>/g,Wl=RegExp(`>|${Bl}(?:([^\\s"'>=/]+)(${Bl}*=${Bl}*(?:[^ \t\n\f\r"'\`<>=]|("|')|))|$)`,"g"),Gl=/'/g,Ql=/"/g,Vl=/^(?:script|style|textarea|title)$/i,Yl=e=>function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return{_$litType$:e,strings:t,values:r}},Xl=Yl(1),Kl=(Yl(2),Symbol.for("lit-noChange")),Zl=Symbol.for("lit-nothing"),eh=new WeakMap,th=Fl.createTreeWalker(Fl,129,null,!1),nh=(e,t)=>{const n=e.length-1,r=[];let i,s=2===t?"<svg>":"",o=Hl;for(let t=0;t<n;t++){const n=e[t];let a,c,u=-1,d=0;for(;d<n.length&&(o.lastIndex=d,c=o.exec(n),null!==c);)d=o.lastIndex,o===Hl?"!--"===c[1]?o=ql:void 0!==c[1]?o=Jl:void 0!==c[2]?(Vl.test(c[2])&&(i=RegExp("</"+c[2],"g")),o=Wl):void 0!==c[3]&&(o=Wl):o===Wl?">"===c[0]?(o=null!=i?i:Hl,u=-1):void 0===c[1]?u=-2:(u=o.lastIndex-c[2].length,a=c[1],o=void 0===c[3]?Wl:'"'===c[3]?Ql:Gl):o===Ql||o===Gl?o=Wl:o===ql||o===Jl?o=Hl:(o=Wl,i=void 0);const l=o===Wl&&e[t+1].startsWith("/>")?" ":"";s+=o===Hl?n+$l:u>=0?(r.push(a),n.slice(0,u)+Rl+n.slice(u)+Ml+l):n+Ml+(-2===u?(r.push(void 0),t):l)}const a=s+(e[n]||"<?>")+(2===t?"</svg>":"");if(!Array.isArray(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return[void 0!==kl?kl.createHTML(a):a,r]};class rh{constructor(e,t){let n,{strings:r,_$litType$:i}=e;this.parts=[];let s=0,o=0;const a=r.length-1,c=this.parts,[u,d]=nh(r,i);if(this.el=rh.createElement(u,t),th.currentNode=this.el.content,2===i){const e=this.el.content,t=e.firstChild;t.remove(),e.append(...t.childNodes)}for(;null!==(n=th.nextNode())&&c.length<a;){if(1===n.nodeType){if(n.hasAttributes()){const e=[];for(const t of n.getAttributeNames())if(t.endsWith(Rl)||t.startsWith(Ml)){const r=d[o++];if(e.push(t),void 0!==r){const e=n.getAttribute(r.toLowerCase()+Rl).split(Ml),t=/([.?@])?(.*)/.exec(r);c.push({type:1,index:s,name:t[2],strings:e,ctor:"."===t[1]?ch:"?"===t[1]?dh:"@"===t[1]?lh:ah})}else c.push({type:6,index:s})}for(const t of e)n.removeAttribute(t)}if(Vl.test(n.tagName)){const e=n.textContent.split(Ml),t=e.length-1;if(t>0){n.textContent=jl?jl.emptyScript:"";for(let r=0;r<t;r++)n.append(e[r],Pl()),th.nextNode(),c.push({type:2,index:++s});n.append(e[t],Pl())}}}else if(8===n.nodeType)if(n.data===Dl)c.push({type:2,index:s});else{let e=-1;for(;-1!==(e=n.data.indexOf(Ml,e+1));)c.push({type:7,index:s}),e+=Ml.length-1}s++}}static createElement(e,t){const n=Fl.createElement("template");return n.innerHTML=e,n}}function ih(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,r=arguments.length>3?arguments[3]:void 0;var i,s,o,a;if(t===Kl)return t;let c=void 0!==r?null===(i=n._$Co)||void 0===i?void 0:i[r]:n._$Cl;const u=Ll(t)?void 0:t._$litDirective$;return(null==c?void 0:c.constructor)!==u&&(null===(s=null==c?void 0:c._$AO)||void 0===s||s.call(c,!1),void 0===u?c=void 0:(c=new u(e),c._$AT(e,n,r)),void 0!==r?(null!==(o=(a=n)._$Co)&&void 0!==o?o:a._$Co=[])[r]=c:n._$Cl=c),void 0!==c&&(t=ih(e,c._$AS(e,t.values),c,r)),t}class sh{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){var t;const{el:{content:n},parts:r}=this._$AD,i=(null!==(t=null==e?void 0:e.creationScope)&&void 0!==t?t:Fl).importNode(n,!0);th.currentNode=i;let s=th.nextNode(),o=0,a=0,c=r[0];for(;void 0!==c;){if(o===c.index){let t;2===c.type?t=new oh(s,s.nextSibling,this,e):1===c.type?t=new c.ctor(s,c.name,c.strings,this,e):6===c.type&&(t=new hh(s,this,e)),this._$AV.push(t),c=r[++a]}o!==(null==c?void 0:c.index)&&(s=th.nextNode(),o++)}return th.currentNode=Fl,i}v(e){let t=0;for(const n of this._$AV)void 0!==n&&(void 0!==n.strings?(n._$AI(e,n,t),t+=n.strings.length-2):n._$AI(e[t])),t++}}class oh{constructor(e,t,n,r){var i;this.type=2,this._$AH=Zl,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=n,this.options=r,this._$Cp=null===(i=null==r?void 0:r.isConnected)||void 0===i||i}get _$AU(){var e,t;return null!==(t=null===(e=this._$AM)||void 0===e?void 0:e._$AU)&&void 0!==t?t:this._$Cp}get parentNode(){let e=this._$AA.parentNode;const t=this._$AM;return void 0!==t&&11===(null==e?void 0:e.nodeType)&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e){e=ih(this,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this),Ll(e)?e===Zl||null==e||""===e?(this._$AH!==Zl&&this._$AR(),this._$AH=Zl):e!==this._$AH&&e!==Kl&&this._(e):void 0!==e._$litType$?this.g(e):void 0!==e.nodeType?this.$(e):Ul(e)?this.T(e):this._(e)}k(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}$(e){this._$AH!==e&&(this._$AR(),this._$AH=this.k(e))}_(e){this._$AH!==Zl&&Ll(this._$AH)?this._$AA.nextSibling.data=e:this.$(Fl.createTextNode(e)),this._$AH=e}g(e){var t;const{values:n,_$litType$:r}=e,i="number"==typeof r?this._$AC(e):(void 0===r.el&&(r.el=rh.createElement(r.h,this.options)),r);if((null===(t=this._$AH)||void 0===t?void 0:t._$AD)===i)this._$AH.v(n);else{const e=new sh(i,this),t=e.u(this.options);e.v(n),this.$(t),this._$AH=e}}_$AC(e){let t=eh.get(e.strings);return void 0===t&&eh.set(e.strings,t=new rh(e)),t}T(e){zl(this._$AH)||(this._$AH=[],this._$AR());const t=this._$AH;let n,r=0;for(const i of e)r===t.length?t.push(n=new oh(this.k(Pl()),this.k(Pl()),this,this.options)):n=t[r],n._$AI(i),r++;r<t.length&&(this._$AR(n&&n._$AB.nextSibling,r),t.length=r)}_$AR(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._$AA.nextSibling,t=arguments.length>1?arguments[1]:void 0;var n;for(null===(n=this._$AP)||void 0===n||n.call(this,!1,!0,t);e&&e!==this._$AB;){const t=e.nextSibling;e.remove(),e=t}}setConnected(e){var t;void 0===this._$AM&&(this._$Cp=e,null===(t=this._$AP)||void 0===t||t.call(this,e))}}class ah{constructor(e,t,n,r,i){this.type=1,this._$AH=Zl,this._$AN=void 0,this.element=e,this.name=t,this._$AM=r,this.options=i,n.length>2||""!==n[0]||""!==n[1]?(this._$AH=Array(n.length-1).fill(new String),this.strings=n):this._$AH=Zl}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;const i=this.strings;let s=!1;if(void 0===i)e=ih(this,e,t,0),s=!Ll(e)||e!==this._$AH&&e!==Kl,s&&(this._$AH=e);else{const r=e;let o,a;for(e=i[0],o=0;o<i.length-1;o++)a=ih(this,r[n+o],t,o),a===Kl&&(a=this._$AH[o]),s||(s=!Ll(a)||a!==this._$AH[o]),a===Zl?e=Zl:e!==Zl&&(e+=(null!=a?a:"")+i[o+1]),this._$AH[o]=a}s&&!r&&this.j(e)}j(e){e===Zl?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,null!=e?e:"")}}class ch extends ah{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===Zl?void 0:e}}const uh=jl?jl.emptyScript:"";class dh extends ah{constructor(){super(...arguments),this.type=4}j(e){e&&e!==Zl?this.element.setAttribute(this.name,uh):this.element.removeAttribute(this.name)}}class lh extends ah{constructor(e,t,n,r,i){super(e,t,n,r,i),this.type=5}_$AI(e){var t;if((e=null!==(t=ih(this,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this,0))&&void 0!==t?t:Zl)===Kl)return;const n=this._$AH,r=e===Zl&&n!==Zl||e.capture!==n.capture||e.once!==n.once||e.passive!==n.passive,i=e!==Zl&&(n===Zl||r);r&&this.element.removeEventListener(this.name,this,n),i&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var t,n;"function"==typeof this._$AH?this._$AH.call(null!==(n=null===(t=this.options)||void 0===t?void 0:t.host)&&void 0!==n?n:this.element,e):this._$AH.handleEvent(e)}}class hh{constructor(e,t,n){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=n}get _$AU(){return this._$AM._$AU}_$AI(e){ih(this,e)}}const fh=Ol.litHtmlPolyfillSupport;null==fh||fh(rh,oh),(null!==(Tl=Ol.litHtmlVersions)&&void 0!==Tl?Tl:Ol.litHtmlVersions=[]).push("2.7.4");var gh,ph;class mh extends Cl{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var e,t;const n=super.createRenderRoot();return null!==(e=(t=this.renderOptions).renderBefore)&&void 0!==e||(t.renderBefore=n.firstChild),n}update(e){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=((e,t,n)=>{var r,i;const s=null!==(r=null==n?void 0:n.renderBefore)&&void 0!==r?r:t;let o=s._$litPart$;if(void 0===o){const e=null!==(i=null==n?void 0:n.renderBefore)&&void 0!==i?i:null;s._$litPart$=o=new oh(t.insertBefore(Pl(),e),e,void 0,null!=n?n:{})}return o._$AI(e),o})(t,this.renderRoot,this.renderOptions)}connectedCallback(){var e;super.connectedCallback(),null===(e=this._$Do)||void 0===e||e.setConnected(!0)}disconnectedCallback(){var e;super.disconnectedCallback(),null===(e=this._$Do)||void 0===e||e.setConnected(!1)}render(){return Kl}}mh.finalized=!0,mh._$litElement$=!0,null===(gh=globalThis.litElementHydrateSupport)||void 0===gh||gh.call(globalThis,{LitElement:mh});const vh=globalThis.litElementPolyfillSupport;null==vh||vh({LitElement:mh});(null!==(ph=globalThis.litElementVersions)&&void 0!==ph?ph:globalThis.litElementVersions=[]).push("3.3.2");const _h=Object.assign(window.converse||{},{CHAT_STATES:["active","composing","gone","inactive","paused"],keycodes:{TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,ESCAPE:27,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,FORWARD_SLASH:47,AT:50,META:91,META_RIGHT:93},async initialize(e){const{api:t}=pu;if(await $u(pu),"onpagehide"in window?pu.unloadevent="pagehide":"onbeforeunload"in window?pu.unloadevent="beforeunload":"onunload"in window&&(pu.unloadevent="unload"),function(e){_c=e,mc={},Object.assign(mc,Tn);const t=cs(e,Object.keys(Eo));Ue(mc,Eo,t)}(e),pu.strict_plugin_dependencies=e.strict_plugin_dependencies,Gc.setLogLevel(t.settings.get("loglevel")),t.settings.get("authentication")===ao&&t.settings.get("auto_login")&&!t.settings.get("jid"))throw new Error("Config Error: you need to provide the server's domain via the 'jid' option when using anonymous authentication with auto_login.");pu.router.route(/^converse\?loglevel=(debug|info|warn|error|fatal)$/,"loglevel",(e=>Gc.setLogLevel(e))),pu.connfeedback=new Ju,pu.send_initial_presence=!0,await async function(e){await lc.sessionStorageInitialized,e.storage={session:lc.localForage.createInstance({name:e.isTestEnv()?"converse-test-session":"converse-session",description:"sessionStorage instance",driver:["sessionStorageWrapper"]})}}(pu),await async function(e){const t="converse.client-config";e.config=new us({id:t,trusted:!0}),e.config.browserStorage=gc(t,"session"),await new Promise((t=>e.config.fetch({success:t,error:t}))),e.api.trigger("clientConfigInitialized")}(pu),await vo.initialize(),function(e){e.pluggable.initialized_plugins=[];const t=go.concat(e.api.settings.get("whitelisted_plugins"));e.api.settings.get("singleton")&&["converse-bookmarks","converse-controlbox","converse-headline","converse-register"].forEach((t=>e.api.settings.get("blacklisted_plugins").push(t))),e.pluggable.initializePlugins({_converse:e},t,e.api.settings.get("blacklisted_plugins")),e.api.trigger("pluginsInitialized")}(pu),t.elements?.register(),function(e){document.addEventListener("visibilitychange",Hc),Hc({type:document.hidden?"blur":"focus"}),e.api.trigger("registeredGlobalEventHandlers")}(pu);try{!History.started&&pu.router.history.start()}catch(e){Gc.error(e)}const n=pu.pluggable.plugins;if((t.settings.get("auto_login")||t.settings.get("keepalive")&&n["converse-bosh"]?.enabled())&&await t.user.login(null,null,!0),t.trigger("initialized"),pu.isTestEnv())return pu},plugins:{add(e,t){if(t.__name__=e,void 0!==pu.pluggable.plugins[e])throw new TypeError(`Error: plugin with name "${e}" has already been registered!`);pu.pluggable.plugins[e]=t}},env:{$build:Ws,$iq:Qs,$msg:Gs,$pres:Vs,utils:qc,Collection:Dd,Model:us,Promise,Strophe:no,TimeoutError:wu,URI:Gu(),VERSION_NAME:so,dayjs:qu(),filesize:hl,html:Xl,log:Gc,sizzle:So(),sprintf:mo.sprintf,stx:Nc,u:qc}});qu().extend(vu());const yh=us.extend({initialize(){this.rosterContactAdded=Ao()},async setRosterContact(e){const t=await Bu.contacts.get(e);t&&(this.contact=t,this.set("nickname",t.get("nickname")),this.rosterContactAdded.resolve())}}),bh=yh;const wh=function(e,t){return e===t||Ni(e,t,Ci(t))},{u:Sh}=_h.env;async function Ah(e,t){if(!t.replace_id||!t.from)return;const n="groupchat"===t.type&&t.occupant_id?e=>{let{attributes:n}=e;return n.msgid===t.replace_id&&n.occupant_id==t.occupant_id}:e=>{let{attributes:n}=e;return n.msgid===t.replace_id&&n.from===t.from&&null==n.occupant_id},r=e.messages.models.find(n);if(!r)return t.older_versions={},await e.createMessage(t);const i=r.get("older_versions")||{};return t.time<r.get("time")&&r.get("edited")?(i[t.time]=t.message,r.save({older_versions:i})):(Object.keys(i).length?i[r.get("edited")]=r.getMessageText():i[r.get("time")]=r.getMessageText(),delete(t=Object.assign(t,{older_versions:i})).msgid,delete t.id,t.time=r.get("time"),r.save(t)),r}const Eh=Nu((function(e){const t=Bu.settings.get("prune_messages_above");if(t&&"number"==typeof t&&e.messages.length>t){const n=e.messages.filter((e=>!Sh.isEmptyMessage(e)));if(n.length>t){for(;n.length>t;)n.shift().destroy();Bu.trigger("historyPruned",e)}}}),500),xh=_h.env.utils;function Nh(e,t){Bu.send(Gs({to:e.getAttribute("from"),type:"error",id:e.getAttribute("id")}).c("error",{type:"cancel"}).c("not-allowed",{xmlns:"urn:ietf:params:xml:ns:xmpp-stanzas"}).up().c("text",{xmlns:"urn:ietf:params:xml:ns:xmpp-stanzas"}).t(t)),Gc.warn(`Rejecting message stanza with the following reason: ${t}`),Gc.warn(e)}function Ih(e,t,n,r){const i=Gs({from:pu.connection.jid,id:xh.getUniqueId(),to:e,type:r||"chat"}).c(n,{xmlns:no.NS.MARKERS,id:t});Bu.send(i)}const{u:Ch}=_h.env;function Th(e){const t=Oh(e),{protocol:n}=window.location;return!!["chrome-extension:","file:"].includes(n)||("http:"===n||"https:"===n&&["https","aesgcm"].includes(t.protocol().toLowerCase()))}function Oh(e){try{return e instanceof Gu()?e:new(Gu())(e)}catch(e){return Gc.debug(e),null}}function jh(e,t){const n=Oh(t);if(null===n)throw new Error(`checkFileTypes: could not parse url ${t}`);const r=n.filename().toLowerCase();return!!e.filter((e=>r.endsWith(e))).length}function kh(e,t){const n=Oh(t),r=n.subdomain(),i=n.domain(),s=`${r?`${r}.`:""}${i}`;return e.includes(i)||e.includes(s)}function Rh(e,t){const n=Bu.settings.get(t);if(!Array.isArray(n))return!0;try{return kh(n,e)}catch(e){return Gc.debug(e),!1}}function Mh(e){return jh([".jpg",".jpeg",".png",".gif",".bmp",".tiff",".svg"],e)}function Dh(e){return jh([".ogg",".mp3",".m4a"],e)}function $h(e){return jh([".mp4",".webm"],e)}function Fh(e){const t=Bu.settings.get("image_urls_regex");return t?.test(e)||Mh(e)}Object.assign(Ch,{isAudioURL:Dh,isGIFURL:function(e){return jh([".gif"],e)},isVideoURL:$h,isImageURL:Fh,isURLWithImageExtension:Mh,checkFileTypes:jh,getURI:Oh,shouldRenderMediaFromURL:function(e,t){if(!Th(e))return!1;const n=Bu.settings.get("render_media"),r=Rh(e,`allowed_${t}_domains`);return Array.isArray(n)?r&&kh(n,e):r&&n},isAllowedProtocolForMedia:Th});const{NS:Ph}=no;class Lh extends Error{constructor(e,t){super(e,t),this.name="StanzaParseError",this.stanza=t}}function zh(e,t){const n={},r=So()(`stanza-id[xmlns="${no.NS.SID}"]`,e).reduce(((e,t)=>(e[`stanza_id ${t.getAttribute("by")}`]=t.getAttribute("id"),e)),{});Object.assign(n,r);const i=So()(`message > result[xmlns="${no.NS.MAM}"]`,t).pop();if(i){n[`stanza_id ${t.getAttribute("from")||pu.bare_jid}`]=i.getAttribute("id")}const s=So()(`origin-id[xmlns="${no.NS.SID}"]`,e).pop();return s&&(n.origin_id=s.getAttribute("id")),n}function Uh(e){const t=So()(`encryption[xmlns="${no.NS.EME}"]`,e).pop(),n=t?.getAttribute("namespace"),r={};return n?(r.is_encrypted=!0,r.encryption_namespace=n):So()(`encrypted[xmlns="${no.NS.OMEMO}"]`,e).pop()&&(r.is_encrypted=!0,r.encryption_namespace=no.NS.OMEMO),r}function Bh(e,t){const n=So()(`> apply-to[xmlns="${no.NS.FASTEN}"]`,e).pop();if(n){const e=n.getAttribute("id");if(So()(`> retract[xmlns="${no.NS.RETRACT}"]`,n).pop()){const n=So()(`delay[xmlns="${no.NS.DELAY}"]`,t).pop();return{editable:!1,retracted:n?qu()(n.getAttribute("stamp")).toISOString():(new Date).toISOString(),retracted_id:e}}}else{const t=So()(`> retracted[xmlns="${no.NS.RETRACT}"]`,e).pop();if(t)return{editable:!1,is_tombstone:!0,retracted:t.getAttribute("stamp")}}return{}}function Hh(e,t){const n=So()(`replace[xmlns="${no.NS.MESSAGE_CORRECT}"]`,e).pop();if(n){const e=n.getAttribute("id");if(e){const n=So()(`delay[xmlns="${no.NS.DELAY}"]`,t).pop();return{replace_id:e,edited:n?qu()(n.getAttribute("stamp")).toISOString():(new Date).toISOString()}}}return{}}function qh(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=[];if(!e)return{};try{Gu().withinString(e,((e,r,i)=>(e.startsWith("_")&&(e=e.slice(1),r+=1),e.endsWith("_")&&(e=e.slice(0,e.length-1),i-=1),n.push({url:e,start:r+t,end:i+t}),e)),po)}catch(e){Gc.debug(e)}const r=n.map((e=>{return{end:e.end,is_audio:Dh(e.url),is_image:Fh(e.url),is_video:$h(e.url),is_encrypted:(t=e.url,t.startsWith("aesgcm://")),start:e.start};var t}));return r.length?{media_urls:r}:{}}function Jh(e){const t=So()(`spoiler[xmlns="${no.NS.SPOILER}"]`,e).pop();return{is_spoiler:!!t,spoiler_hint:t?.textContent}}function Wh(e){const t=So()(`x[xmlns="${no.NS.OUTOFBAND}"]`,e).pop();return t?{oob_url:t.querySelector("url")?.textContent,oob_desc:t.querySelector("desc")?.textContent}:{}}function Gh(e){if("error"===e.getAttribute("type")){const t=e.querySelector("error"),n=So()(`text[xmlns="${no.NS.STANZAS}"]`,t).pop();return{is_error:!0,error_text:n?.textContent,error_type:t.getAttribute("type"),error_condition:t.firstElementChild.nodeName}}return{}}function Qh(e){return So()(`reference[xmlns="${no.NS.REFERENCE}"]`,e).map((t=>{const n=t.getAttribute("anchor"),r=e.querySelector(n?`#${n}`:"body")?.textContent;if(!r)return Gc.warn(`Could not find referenced text for ${t}`),null;const i=t.getAttribute("begin"),s=t.getAttribute("end");return{begin:i,end:s,type:t.getAttribute("type"),value:r.slice(i,s),uri:t.getAttribute("uri")}})).filter((e=>e))}function Vh(e){const t=So()(`received[xmlns="${no.NS.RECEIPTS}"]`,e).pop();return t?.getAttribute("id")}function Yh(e){const t=no.NS.CARBONS;return So()(`message > received[xmlns="${t}"]`,e).length>0||So()(`message > sent[xmlns="${t}"]`,e).length>0}function Xh(e){return So()(`\n        composing[xmlns="${Ph.CHATSTATES}"],\n        paused[xmlns="${Ph.CHATSTATES}"],\n        inactive[xmlns="${Ph.CHATSTATES}"],\n        active[xmlns="${Ph.CHATSTATES}"],\n        gone[xmlns="${Ph.CHATSTATES}"]`,e).pop()?.nodeName}function Kh(e,t){return"me"!==t.sender&&!t.is_carbon&&!t.is_archived&&So()(`request[xmlns="${no.NS.RECEIPTS}"]`,e).length}function Zh(e){if(So()(`message > forwarded[xmlns="${no.NS.FORWARD}"]`,e).length){Nh(e,"Forwarded messages not part of an encapsulating protocol are not supported");const t=e.getAttribute("from");throw new Lh(`Ignoring unencapsulated forwarded message from ${t}`,e)}}function ef(e){return So()(`\n        acknowledged[xmlns="${no.NS.MARKERS}"],\n        displayed[xmlns="${no.NS.MARKERS}"],\n        received[xmlns="${no.NS.MARKERS}"]`,e).pop()}function tf(e){return"headline"===e.getAttribute("type")}function nf(e){if(So()(`mentions[xmlns="${no.NS.MENTIONS}"]`,e).pop())return!1;const t=e.getAttribute("from");return!("error"===e.getAttribute("type")||!t||t.includes("@"))}function rf(e){return!!So()(`message > result[xmlns="${no.NS.MAM}"]`,e).pop()}function sf(e){return e.getAttributeNames().reduce(((t,n)=>(t[n]=no.xmlunescape(e.getAttribute(n)),t)),{})}const{Strophe:of,sizzle:af}=_h.env;async function cf(e){Zh(e);let t=e.getAttribute("to");const n=of.getResourceFromJid(t);if(Bu.settings.get("filter_by_resource")&&n&&n!==pu.resource)return new Lh(`Ignoring incoming message intended for a different resource: ${t}`,e);const r=e;let i=e.getAttribute("from")||pu.bare_jid;if(Yh(e)){if(i!==pu.bare_jid)return Nh(e,"Rejecting carbon from invalid JID"),new Lh(`Rejecting carbon from invalid JID ${t}`,e);{const n=`[xmlns="${of.NS.CARBONS}"] > forwarded[xmlns="${of.NS.FORWARD}"] > message`;t=(e=af(n,e).pop()).getAttribute("to"),i=e.getAttribute("from")}}const s=rf(e);if(s){if(i!==pu.bare_jid)return new Lh(`Invalid Stanza: alleged MAM message from ${e.getAttribute("from")}`,e);{const n=`[xmlns="${of.NS.MAM}"] > forwarded[xmlns="${of.NS.FORWARD}"] > message`;t=(e=af(n,e).pop()).getAttribute("to"),i=e.getAttribute("from")}}const o=of.getBareJidFromJid(i),a=o===pu.bare_jid;if(a&&null===t)return new Lh(`Don't know how to handle message stanza without 'to' attribute. ${e.outerHTML}`,e);const c=tf(e),u=nf(e);let d,l;if(!c&&!u&&(l=a?of.getBareJidFromJid(t):o,d=await Bu.contacts.get(l),void 0===d&&!Bu.settings.get("allow_non_roster_messaging")))return Gc.error(e),new Lh("Blocking messaging with a JID not in our roster because allow_non_roster_messaging is false.",e);const h=af(`delay[xmlns="${of.NS.DELAY}"]`,r).pop(),f=ef(e),g=(new Date).toISOString();let p=Object.assign({contact_jid:l,is_archived:s,is_headline:c,is_server_message:u,body:e.querySelector("body")?.textContent?.trim(),chat_state:Xh(e),from:of.getBareJidFromJid(e.getAttribute("from")),is_carbon:Yh(r),is_delayed:!!h,is_markable:!!af(`markable[xmlns="${of.NS.MARKERS}"]`,e).length,is_marker:!!f,is_unstyled:!!af(`unstyled[xmlns="${of.NS.STYLING}"]`,e).length,marker_id:f&&f.getAttribute("id"),msgid:e.getAttribute("id")||r.getAttribute("id"),nick:d?.attributes?.nickname,receipt_id:Vh(e),received:(new Date).toISOString(),references:Qh(e),sender:a?"me":"them",subject:e.querySelector("subject")?.textContent,thread:e.querySelector("thread")?.textContent,time:h?qu()(h.getAttribute("stamp")).toISOString():g,to:e.getAttribute("to"),type:e.getAttribute("type")||"normal"},Gh(e),Wh(e),Jh(e),Hh(e,r),zh(e,r),Bh(e,r),Uh(e));if(p.is_archived){const t=r.getAttribute("from");if(t&&t!==pu.bare_jid)return new Lh(`Invalid Stanza: Forged MAM message from ${t}`,e)}return await Bu.emojis.initialize(),p=Object.assign({message:p.body||p.error,is_only_emojis:!!p.body&&qc.isOnlyEmojis(p.body),is_valid_receipt_request:Kh(e,p)},p),p.id=p.origin_id||p[`stanza_id ${p.from}`]||qc.getUniqueId(),p=await Bu.hook("parseMessage",e,p),Object.assign(p,qh(p.is_encrypted?p.plaintext:p.body))}const{Strophe:uf,$msg:df}=_h.env,lf=_h.env.utils,hf=bh.extend({defaults(){return{bookmarked:!1,chat_state:void 0,hidden:Oc()&&!Bu.settings.get("singleton"),message_type:"chat",nickname:void 0,num_unread:0,time_opened:this.get("time_opened")||(new Date).getTime(),time_sent:new Date(0).toISOString(),type:pu.PRIVATE_CHAT_TYPE,url:""}},async initialize(){this.initialized=Ao(),bh.prototype.initialize.apply(this,arguments);const e=this.get("jid");e&&(this.set({box_id:`box-${e}`}),this.initNotifications(),this.initUI(),this.initMessages(),this.get("type")===pu.PRIVATE_CHAT_TYPE&&(this.presence=pu.presences.get(e)||pu.presences.create({jid:e}),await this.setRosterContact(e),this.presence.on("change:show",(e=>this.onPresenceChanged(e)))),this.on("change:chat_state",this.sendChatState,this),this.ui.on("change:scrolled",this.onScrolledChanged,this),await this.fetchMessages(),await Bu.trigger("chatBoxInitialized",this,{Synchronous:!0}),this.initialized.resolve())},getMessagesCollection:()=>new pu.Messages,getMessagesCacheKey(){return`converse.messages-${this.get("jid")}-${pu.bare_jid}`},initMessages(){this.messages=this.getMessagesCollection(),this.messages.fetched=Ao(),this.messages.chatbox=this,pc(this.messages,this.getMessagesCacheKey()),this.listenTo(this.messages,"change:upload",this.onMessageUploadChanged,this),this.listenTo(this.messages,"add",this.onMessageAdded,this)},initUI(){this.ui=new us},initNotifications(){this.notifications=new us},getNotificationsText(){const{__:e}=pu;return this.notifications?.get("chat_state")===pu.COMPOSING?e("%1$s is typing",this.getDisplayName()):this.notifications?.get("chat_state")===pu.PAUSED?e("%1$s has stopped typing",this.getDisplayName()):this.notifications?.get("chat_state")===pu.GONE?e("%1$s has gone away",this.getDisplayName()):""},afterMessagesFetched(){this.pruneHistoryWhenScrolledDown(),Bu.trigger("afterMessagesFetched",this)},fetchMessages(){if(this.messages.fetched_flag)return void Gc.info(`Not re-fetching messages for ${this.get("jid")}`);this.messages.fetched_flag=!0;const e=this.messages.fetched.resolve;return this.messages.fetch({add:!0,success:t=>{this.afterMessagesFetched(t),e()},error:()=>{this.afterMessagesFetched(),e()}}),this.messages.fetched},async handleErrorMessageStanza(e){const{__:t}=pu,n=await cf(e);if(!await this.shouldShowErrorMessage(n))return;const r=this.getMessageReferencedByError(n);if(r){const e={error:n.error,error_condition:n.error_condition,error_text:n.error_text,error_type:n.error_type,editable:!1};n.msgid===r.get("retraction_id")?(e.retraction_id=void 0,n.error||("forbidden"===n.error_condition?e.error=t("You're not allowed to retract your message."):e.error=t("Sorry, an error occurred while trying to retract your message."))):n.error||("forbidden"===n.error_condition?e.error=t("You're not allowed to send a message."):e.error=t("Sorry, an error occurred while trying to send your message.")),r.save(e)}else this.createMessage(n)},queueMessage(e){return this.msg_chain=(this.msg_chain||this.messages.fetched).then((()=>this.onMessage(e))).catch((e=>Gc.error(e))),this.msg_chain},async onMessage(e){if(e=await e,lf.isErrorObject(e))return e.stanza&&Gc.error(e.stanza),Gc.error(e.message);const t=this.getDuplicateMessage(e);if(t)this.updateMessage(t,e);else if(!this.handleReceipt(e)&&!this.handleChatMarker(e)&&!await this.handleRetraction(e)&&(this.setEditable(e,e.time),e.chat_state&&"them"===e.sender&&this.notifications.set("chat_state",e.chat_state),lf.shouldCreateMessage(e))){const t=await Ah(this,e)||await this.createMessage(e);this.notifications.set({chat_state:null}),this.handleUnreadMessage(t)}},async onMessageUploadChanged(e){if(e.get("upload")===pu.SUCCESS){const t={body:e.get("body"),spoiler_hint:e.get("spoiler_hint"),oob_url:e.get("oob_url")};await this.sendMessage(t),e.destroy()}},onMessageAdded(e){!Bu.settings.get("prune_messages_above")||"scrolled"!==Bu.settings.get("pruning_behavior")&&this.ui.get("scrolled")||Tc(e)||Eh(this)},async clearMessages(){try{await this.messages.clearStore()}catch(e){this.messages.trigger("reset"),Gc.error(e)}finally{this.messages.fetched.resolve()}},async close(){Bu.connection.connected()&&(this.setChatState(pu.INACTIVE),this.sendChatState());try{await new Promise(((e,t)=>this.destroy({success:e,error:(e,n)=>t(n)})))}catch(e){Gc.error(e)}finally{Bu.settings.get("clear_messages_on_reconnection")&&await this.clearMessages()}Bu.trigger("chatBoxClosed",this)},announceReconnection(){Bu.trigger("chatReconnected",this)},async onReconnection(){Bu.settings.get("clear_messages_on_reconnection")&&await this.clearMessages(),this.announceReconnection()},onPresenceChanged(e){const{__:t}=pu,n=e.get("show"),r=this.getDisplayName();let i;"offline"===n?i=t("%1$s has gone offline",r):"away"===n?i=t("%1$s has gone away",r):"dnd"===n?i=t("%1$s is busy",r):"online"===n&&(i=t("%1$s is online",r)),i&&this.createMessage({message:i,type:"info"})},onScrolledChanged(){this.ui.get("scrolled")||(this.clearUnreadMsgCounter(),this.pruneHistoryWhenScrolledDown())},pruneHistoryWhenScrolledDown(){Bu.settings.get("prune_messages_above")&&"unscrolled"===Bu.settings.get("pruning_behavior")&&!this.ui.get("scrolled")&&Eh(this)},validate(e){if(!e.jid)return"Ignored ChatBox without JID";const t=Bu.settings.get("auto_join_rooms").map((e=>v(e)?e.jid:e)),n=Bu.settings.get("auto_join_private_chats").concat(t);if(Bu.settings.get("singleton")&&!n.includes(e.jid)&&!Bu.settings.get("auto_join_on_invite")){const t=`${e.jid} is not allowed because singleton is true and it's not being auto_joined`;return Gc.warn(t),t}},getDisplayName(){return this.contact?this.contact.getDisplayName():this.vcard?this.vcard.getDisplayName():this.get("jid")},async createMessageFromError(e){if(e instanceof wu){(await this.createMessage({type:"error",message:e.message,retry_event_id:e.retry_event_id,is_ephemeral:3e4})).error=e}},editEarlierMessage(){let e,t=this.messages.findLastIndex("correcting");if(t>=0)for(this.messages.at(t).save("correcting",!1);t>0;){t-=1;const n=this.messages.at(t);if(n.get("editable")){e=n;break}}e=e||this.messages.filter({sender:"me"}).reverse().find((e=>e.get("editable"))),e&&e.save("correcting",!0)},editLaterMessage(){let e,t=this.messages.findLastIndex("correcting");if(t>=0)for(this.messages.at(t).save("correcting",!1);t<this.messages.length-1;){t+=1;const n=this.messages.at(t);if(n.get("editable")){e=n,e.save("correcting",!0);break}}return e},getOldestMessage(){for(let e=0;e<this.messages.length;e++){const t=this.messages.at(e);if(t.get("type")===this.get("message_type"))return t}},getMostRecentMessage(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages.at(e);if(t.get("type")===this.get("message_type"))return t}},getUpdatedMessageAttributes:(e,t)=>t.error_type||"Decryption"!==e.get("error_type")?{is_archived:t.is_archived}:Object.assign({},t,{error_condition:void 0,error_message:void 0,error_text:void 0,error_type:void 0,is_archived:t.is_archived,is_ephemeral:!1,is_error:!1}),updateMessage(e,t){const n=this.getUpdatedMessageAttributes(e,t);n&&e.save(n)},setChatState(e,t){return void 0!==this.chat_state_timeout&&(window.clearTimeout(this.chat_state_timeout),delete this.chat_state_timeout),e===pu.COMPOSING?this.chat_state_timeout=window.setTimeout(this.setChatState.bind(this),pu.TIMEOUTS.PAUSED,pu.PAUSED):e===pu.PAUSED&&(this.chat_state_timeout=window.setTimeout(this.setChatState.bind(this),pu.TIMEOUTS.INACTIVE,pu.INACTIVE)),this.set("chat_state",e,t),this},getMessageReferencedByError(e){const t=e.msgid;return t&&this.messages.models.find((e=>[e.get("msgid"),e.get("retraction_id")].includes(t)))},shouldShowErrorMessage(e){if(this.getMessageReferencedByError(e)||!e.chat_state)return!0},isSameUser:(e,t)=>lf.isSameBareJID(e,t),findDanglingRetraction(e){if(!e.origin_id||!this.messages.length)return null;if(this.messages.last().get("time")>e.time){const t=Array.from(this.messages.models);return t.reverse(),t.find((t=>{let{attributes:n}=t;return n.retracted_id===e.origin_id&&n.from===e.from&&!n.moderated_by}))}},async handleRetraction(e){const t=["retracted","retracted_id","editable"];if(e.retracted){if(e.is_tombstone)return!1;const n=this.messages.findWhere({origin_id:e.retracted_id,from:e.from});return n?(n.save(cs(e,t)),!0):(e.dangling_retraction=!0,await this.createMessage(e),!0)}{const n=this.findDanglingRetraction(e);if(n){const r=cs(n.attributes,t),i=Object.assign({dangling_retraction:!1},e,r);return delete i.id,n.save(i),!0}}return!1},getDuplicateMessage(e){const t=[...this.getStanzaIdQueryAttrs(e),this.getOriginIdQueryAttrs(e),this.getMessageBodyQueryAttrs(e)].filter((e=>e));return this.messages.models.find((e=>t.reduce(((t,n)=>t||wh(e.attributes,n)),!1)))},getOriginIdQueryAttrs:e=>e.origin_id&&{origin_id:e.origin_id,from:e.from},getStanzaIdQueryAttrs(e){const t=Object.keys(e).filter((e=>e.startsWith("stanza_id ")));return t.map((t=>{const n={};return n[`stanza_id ${t.replace(/^stanza_id /,"")}`]=e[t],n}))},getMessageBodyQueryAttrs(e){if(e.msgid){const t={from:e.from,msgid:e.msgid};return!e.is_encrypted&&e.body&&(t.body=e.body),t}},retractOwnMessage(e){this.sendRetractionMessage(e),e.save({retracted:(new Date).toISOString(),retracted_id:e.get("origin_id"),retraction_id:e.get("id"),is_ephemeral:!0,editable:!1})},sendRetractionMessage(e){const t=e.get("origin_id");if(!t)throw new Error("Can't retract message without a XEP-0359 Origin ID");const n=df({id:lf.getUniqueId(),to:this.get("jid"),type:"chat"}).c("store",{xmlns:uf.NS.HINTS}).up().c("apply-to",{id:t,xmlns:uf.NS.FASTEN}).c("retract",{xmlns:uf.NS.RETRACT});return pu.connection.send(n)},sendMarkerForLastMessage(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"displayed",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=Array.from(this.messages.models);n.reverse();const r=n.find((e=>"them"===e.get("sender")&&(t||e.get("is_markable"))));r&&this.sendMarkerForMessage(r,e,t)},sendMarkerForMessage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"displayed",n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e&&Bu.settings.get("send_chat_markers").includes(t)&&(e?.get("is_markable")||n)){Ih(uf.getBareJidFromJid(e.get("from")),e.get("msgid"),t,e.get("type"))}},handleChatMarker(e){if(uf.getBareJidFromJid(e.to)!==pu.bare_jid)return!1;if(e.is_markable)return!this.contact||e.is_archived||e.is_carbon||Ih(e.from,e.msgid,"received"),!1;if(e.marker_id){const t=this.messages.findWhere({msgid:e.marker_id}),n=`marker_${e.marker}`;return t&&!t.get(n)&&t.save({field_name:(new Date).toISOString()}),!0}},sendReceiptStanza(e,t){const n=df({from:pu.connection.jid,id:lf.getUniqueId(),to:e,type:"chat"}).c("received",{xmlns:uf.NS.RECEIPTS,id:t}).up().c("store",{xmlns:uf.NS.HINTS}).up();Bu.send(n)},handleReceipt(e){if("them"===e.sender)if(e.is_valid_receipt_request)this.sendReceiptStanza(e.from,e.msgid);else if(e.receipt_id){const t=this.messages.findWhere({msgid:e.receipt_id});return t&&!t.get("received")&&t.save({received:(new Date).toISOString()}),!0}return!1},async createMessageStanza(e){const t=df({from:pu.connection.jid,to:this.get("jid"),type:this.get("message_type"),id:e.get("edited")&&lf.getUniqueId()||e.get("msgid")}).c("body").t(e.get("body")).up().c(pu.ACTIVE,{xmlns:uf.NS.CHATSTATES}).root();"chat"===e.get("type")&&t.c("request",{xmlns:uf.NS.RECEIPTS}).root(),e.get("is_encrypted")||(e.get("is_spoiler")&&(e.get("spoiler_hint")?t.c("spoiler",{xmlns:uf.NS.SPOILER},e.get("spoiler_hint")).root():t.c("spoiler",{xmlns:uf.NS.SPOILER}).root()),(e.get("references")||[]).forEach((e=>{const n={xmlns:uf.NS.REFERENCE,begin:e.begin,end:e.end,type:e.type};e.uri&&(n.uri=e.uri),t.c("reference",n).root()})),e.get("oob_url")&&t.c("x",{xmlns:uf.NS.OUTOFBAND}).c("url").t(e.get("oob_url")).root()),e.get("edited")&&t.c("replace",{xmlns:uf.NS.MESSAGE_CORRECT,id:e.get("msgid")}).root(),e.get("origin_id")&&t.c("origin-id",{xmlns:uf.NS.SID,id:e.get("origin_id")}).root(),t.root();return(await Bu.hook("createMessageStanza",this,{message:e,stanza:t})).stanza},async getOutgoingMessageAttributes(e){await Bu.emojis.initialize();const t=!!this.get("composing_spoiler"),n=lf.getUniqueId(),r=e?.body,i=r?lf.shortnamesToUnicode(r):void 0;return e=Object.assign({},e,{from:pu.bare_jid,fullname:pu.xmppstatus.get("fullname"),id:n,is_only_emojis:!!r&&lf.isOnlyEmojis(r),jid:this.get("jid"),message:i,msgid:n,nickname:this.get("nickname"),sender:"me",time:(new Date).toISOString(),type:this.get("message_type"),body:i,is_spoiler:t,origin_id:n},qh(r)),e=await Bu.hook("getOutgoingMessageAttributes",this,e)},setEditable(e,t){e.is_headline||Tc(e)||"me"!==e.sender||("all"===Bu.settings.get("allow_message_corrections")?e.editable=!(e.file||e.retracted||"oob_url"in e):"last"===Bu.settings.get("allow_message_corrections")&&t>this.get("time_sent")&&(this.set({time_sent:t}),this.messages.findWhere({editable:!0})?.save({editable:!1}),e.editable=!(e.file||e.retracted||"oob_url"in e)))},async createMessage(e,t){return e.time=e.time||(new Date).toISOString(),await this.messages.fetched,this.messages.create(e,t)},async sendMessage(e){e=await this.getOutgoingMessageAttributes(e);let t=this.messages.findWhere("correcting");if(t){const n=t.get("older_versions")||{};n[t.get("edited")||t.get("time")]=t.getMessageText(),t.save({...cs(e,["body","is_only_emojis","media_urls","references","is_encrypted"]),correcting:!1,edited:(new Date).toISOString(),message:e.body,ogp_metadata:[],origin_id:lf.getUniqueId(),received:void 0,older_versions:n,plaintext:e.is_encrypted?e.message:void 0})}else this.setEditable(e,(new Date).toISOString()),t=await this.createMessage(e);try{const e=await this.createMessageStanza(t);Bu.send(e)}catch(e){return t.destroy(),void Gc.error(e)}return Bu.trigger("sendMessage",{chatbox:this,message:t}),t},sendChatState(){if(Bu.settings.get("send_chat_state_notifications")&&this.get("chat_state")){const e=Bu.settings.get("send_chat_state_notifications");if(Array.isArray(e)&&!e.includes(this.get("chat_state")))return;Bu.send(df({id:lf.getUniqueId(),to:this.get("jid"),type:"chat"}).c(this.get("chat_state"),{xmlns:uf.NS.CHATSTATES}).up().c("no-store",{xmlns:uf.NS.HINTS}).up().c("no-permanent-store",{xmlns:uf.NS.HINTS}))}},async sendFiles(e){const{__:t}=pu,n=(await Bu.disco.features.get(uf.NS.HTTPUPLOAD,pu.domain)).pop();if(!n)return void this.createMessage({message:t("Sorry, looks like file upload is not supported by your server."),type:"error",is_ephemeral:!0});const r=n.dataforms.where({FORM_TYPE:{value:uf.NS.HTTPUPLOAD,type:"hidden"}}).pop(),i=window.parseInt((r?.attributes||{})["max-file-size"]?.value),s=n?.id;s?Array.from(e).forEach((async e=>{if(e=await Bu.hook("beforeFileUpload",this,e),!window.isNaN(i)&&window.parseInt(e.size)>i)return this.createMessage({message:t("The size of your file, %1$s, exceeds the maximum allowed by your server, which is %2$s.",e.name,hl(i)),type:"error",is_ephemeral:!0});{const t=await this.getOutgoingMessageAttributes(),n=Object.assign(t,{file:!0,progress:0,slot_request_url:s});this.setEditable(n,(new Date).toISOString());const r=await this.createMessage(n,{silent:!0});r.file=e,this.messages.trigger("add",r),r.getRequestSlotURL()}})):this.createMessage({message:t("Sorry, looks like file upload is not supported by your server."),type:"error",is_ephemeral:!0})},maybeShow(e){if(!Oc())return lf.safeSave(this,{hidden:!1}),this.trigger("show"),this;{const t=e=>!e.get("hidden")&&e.get("jid")!==this.get("jid")&&"controlbox"!==e.get("id"),n=pu.chatboxes.filter(t);(e||0===n.length)&&(n.forEach((e=>lf.safeSave(e,{hidden:!0}))),lf.safeSave(this,{hidden:!1}))}},isHidden(){return this.get("hidden")||this.isScrolledUp()||"hidden"===pu.windowState},handleUnreadMessage(e){e?.get("body")&&lf.isNewMessage(e)&&("me"===e.get("sender")?this.ui.set("scrolled",!1):this.isHidden()?this.incrementUnreadMsgsCounter(e):this.sendMarkerForMessage(e))},incrementUnreadMsgsCounter(e){const t={num_unread:this.get("num_unread")+1};0===this.get("num_unread")&&(t.first_unread_id=e.get("id")),this.save(t)},clearUnreadMsgCounter(){this.get("num_unread")>0&&this.sendMarkerForMessage(this.messages.last()),lf.safeSave(this,{num_unread:0})},isScrolledUp(){return this.ui.get("scrolled")}}),ff=hf,{Strophe:gf,sizzle:pf,u:mf}=_h.env,vf={defaults:()=>({msgid:mf.getUniqueId(),time:(new Date).toISOString(),is_ephemeral:!1}),async initialize(){this.checkValidity()&&(this.initialized=Ao(),this.get("file")&&this.on("change:put",(()=>this.uploadFile())),this.on("change:type",(()=>this.setContact())),this.on("change:is_ephemeral",(()=>this.setTimerForEphemeralMessage())),await this.setContact(),this.setTimerForEphemeralMessage(),await Bu.trigger("messageInitialized",this,{Synchronous:!0}),this.initialized.resolve())},setContact(){["chat","normal"].includes(this.get("type"))&&(bh.prototype.initialize.apply(this,arguments),this.setRosterContact(gf.getBareJidFromJid(this.get("from"))))},setTimerForEphemeralMessage(){this.ephemeral_timer&&clearTimeout(this.ephemeral_timer);const e=this.isEphemeral();if(e){const t="number"==typeof e?e:1e4;this.ephemeral_timer=window.setTimeout((()=>this.safeDestroy()),t)}},checkValidity(){return 3!==Object.keys(this.attributes).length||(this.validationError="Empty message",this.safeDestroy(),!1)},mayBeRetracted(){const e="me"===this.get("sender"),t="cancel"!==this.get("error_type");return e&&t&&["all","own"].includes(Bu.settings.get("allow_message_retraction"))},safeDestroy(){try{this.destroy()}catch(e){Gc.warn(`safeDestroy: ${e}`)}},isEphemeral(){return this.get("is_ephemeral")},isMeCommand(){const e=this.getMessageText();return!!e&&e.startsWith("/me ")},isFollowup(){const e=this.collection.models,t=e.indexOf(this),n=t?e[t-1]:null;if(null===n)return!1;const r=qu()(this.get("time"));return this.get("from")===n.get("from")&&!this.isMeCommand()&&!n.isMeCommand()&&!!this.get("is_encrypted")==!!n.get("is_encrypted")&&this.get("type")===n.get("type")&&"info"!==this.get("type")&&r.isBefore(qu()(n.get("time")).add(10,"minutes"))&&("groupchat"!==this.get("type")||this.get("occupant_id")===n.get("occupant_id"))},getDisplayName(){return this.contact?this.contact.getDisplayName():this.vcard?this.vcard.getDisplayName():this.get("from")},getMessageText(){if(this.get("is_encrypted")){const{__:e}=pu;return this.get("plaintext")||this.get("body")||e("Undecryptable OMEMO message")}return["groupchat","chat","normal"].includes(this.get("type"))?this.get("body"):this.get("message")},sendSlotRequestStanza(){if(!this.file)return Promise.reject(new Error("file is undefined"));const e=_h.env.$iq({from:pu.jid,to:this.get("slot_request_url"),type:"get"}).c("request",{xmlns:gf.NS.HTTPUPLOAD,filename:this.file.name,size:this.file.size,"content-type":this.file.type});return Bu.sendIQ(e)},getUploadRequestMetadata:e=>({headers:pf(`slot[xmlns="${gf.NS.HTTPUPLOAD}"] put header`,e).map((e=>({name:e.getAttribute("name"),value:e.textContent}))).filter((e=>["Authorization","Expires"].includes(e.name)))}),async getRequestSlotURL(){const{__:e}=pu;let t;try{t=await this.sendSlotRequestStanza()}catch(t){return Gc.error(t),this.save({type:"error",message:e("Sorry, could not determine upload URL."),is_ephemeral:!0})}const n=pf(`slot[xmlns="${gf.NS.HTTPUPLOAD}"]`,t).pop();if(!n)return this.save({type:"error",message:e("Sorry, could not determine file upload URL."),is_ephemeral:!0});this.upload_metadata=this.getUploadRequestMetadata(t),this.save({get:n.querySelector("get").getAttribute("url"),put:n.querySelector("put").getAttribute("url")})},uploadFile(){const e=new XMLHttpRequest;e.onreadystatechange=async()=>{if(e.readyState===XMLHttpRequest.DONE)if(Gc.info("Status: "+e.status),200===e.status||201===e.status){let e={upload:pu.SUCCESS,oob_url:this.get("get"),message:this.get("get"),body:this.get("get")};e=await Bu.hook("afterFileUploaded",this,e),this.save(e)}else e.onerror()},e.upload.addEventListener("progress",(e=>{e.lengthComputable&&this.set("progress",e.loaded/e.total)}),!1),e.onerror=()=>{const{__:t}=pu;let n;n=e.responseText?t('Sorry, could not succesfully upload your file. Your servers response: "%1$s"',e.responseText):t("Sorry, could not succesfully upload your file."),this.save({type:"error",upload:pu.FAILURE,message:n,is_ephemeral:!0})},e.open("PUT",this.get("put"),!0),e.setRequestHeader("Content-type",this.file.type),this.upload_metadata.headers?.forEach((t=>e.setRequestHeader(t.name,t.value))),e.send(this.file)}},_f=vf,yf={chats:{async create(e,t){if("string"==typeof e){if(t&&!t?.fullname){const n=await Bu.contacts.get(e);t.fullname=n?.attributes?.fullname}const n=Bu.chats.get(e,t,!0);return n||void Gc.error("Could not open chatbox for JID: "+e)}return Array.isArray(e)?Promise.all(e.forEach((async n=>{const r=await Bu.contacts.get(e);return t.fullname=r?.attributes?.fullname,Bu.chats.get(n,t,!0).maybeShow()}))):(Gc.error("chats.create: You need to provide at least one JID"),null)},async open(e,t,n){if("string"==typeof e){const r=await Bu.chats.get(e,t,!0);return r?r.maybeShow(n):r}if(Array.isArray(e))return Promise.all(e.map((e=>Bu.chats.get(e,t,!0).then((e=>e&&e.maybeShow(n))))).filter((e=>e)));const r="chats.open: You need to provide at least one JID";throw Gc.error(r),new Error(r)},async get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];async function r(e){let r=await Bu.chatboxes.get(e);return!r&&n?r=await Bu.chatboxes.create(e,t,pu.ChatBox):(r=r&&r.get("type")===pu.PRIVATE_CHAT_TYPE?r:null,r&&Object.keys(t).length&&r.save(t)),r}if(await Bu.waitUntil("chatBoxesFetched"),void 0===e){return(await Bu.chatboxes.get()).filter((e=>e.get("type")===pu.PRIVATE_CHAT_TYPE))}return"string"==typeof e?r(e):Promise.all(e.map((e=>r(e))))}}},{Strophe:bf,u:wf}=_h.env;function Sf(e){if(!wf.isValidJID(e))return Gc.warn(`Invalid JID "${e}" provided in URL fragment`);Bu.chats.open(e)}async function Af(){if(jc()){await Promise.all(pu.chatboxes.map((e=>e.messages&&e.messages.clearStore({silent:!0}))));const e=e=>e.get("type")!==pu.CONTROLBOX_TYPE;pu.chatboxes.clearStore({silent:!0},e)}}function Ef(){Bu.settings.get("auto_join_private_chats").forEach((e=>{pu.chatboxes.where({jid:e}).length||("string"==typeof e?Bu.chats.open(e):Gc.error('Invalid jid criteria specified for "auto_join_private_chats"'))})),Bu.trigger("privateChatsAutoJoined")}function xf(){pu.connection.addHandler((e=>!!(["groupchat","error"].includes(e.getAttribute("type"))||tf(e)||nf(e)||rf(e))||(pu.handleMessageStanza(e)||!0)),null,"message"),pu.connection.addHandler((e=>async function(e){const t=bf.getBareJidFromJid(e.getAttribute("from"));if(wf.isSameBareJID(t,pu.bare_jid))return;const n=await Bu.chatboxes.get(t);n?.get("type")===pu.PRIVATE_CHAT_TYPE&&n?.handleErrorMessageStanza(e)}(e)||!0),null,"message","error")}async function Nf(e){if(nf(e=e.tree?.()??e)){const t=e.getAttribute("from");return Gc.info(`handleMessageStanza: Ignoring incoming server message from JID: ${t}`)}let t;try{t=await cf(e)}catch(e){return Gc.error(e)}if(wf.isErrorObject(t))return t.stanza&&Gc.error(t.stanza),Gc.error(t.message);const n=!(!t.body&&!t.plaintext),r=await Bu.chats.get(t.contact_jid,{nickname:t.nick},n);await(r?.queueMessage(t));const i={stanza:e,attrs:t,chatbox:r};Bu.trigger("message",i)}async function If(){const e=bf.getDomainFromJid(pu.bare_jid);if(!await Bu.disco.supports(bf.NS.CARBONS,e))return void Gc.warn("Not enabling carbons because it's not supported!");const t=new bf.Builder("iq",{from:pu.connection.jid,type:"set"}).c("enable",{xmlns:bf.NS.CARBONS}),n=await Bu.sendIQ(t,null,!1);null===n?Gc.warn("A timeout occurred while trying to enable carbons"):wf.isErrorStanza(n)?(Gc.warn("An error occurred while trying to enable message carbons."),Gc.error(n)):Gc.debug("Message carbons have been enabled.")}_h.plugins.add("converse-chat",{dependencies:["converse-chatboxes","converse-disco"],initialize(){Bu.settings.extend({allow_message_corrections:"all",allow_message_retraction:"all",allow_message_styling:!0,auto_join_private_chats:[],clear_messages_on_reconnection:!1,filter_by_resource:!1,prune_messages_above:void 0,pruning_behavior:"unscrolled",send_chat_markers:["received","displayed","acknowledged"],send_chat_state_notifications:!0}),pu.Message=bh.extend(_f),pu.Messages=Dd.extend({model:pu.Message,comparator:"time"}),Object.assign(pu,{ChatBox:ff,handleMessageStanza:Nf}),Object.assign(Bu,yf),pu.router.route("converse/chat?jid=:jid",Sf),Bu.listen.on("chatBoxesFetched",Ef),Bu.listen.on("presencesInitialized",xf),Bu.listen.on("clearSession",Af),Bu.listen.on("connected",(()=>If())),Bu.listen.on("reconnected",(()=>If()))}});const{Strophe:Cf}=_h.env,Tf=us.extend({idAttribute:"jid",initialize(e,t){this.waitUntilFeaturesDiscovered=Ao(),this.dataforms=new Dd;let n=`converse.dataforms-${this.get("jid")}`;this.dataforms.browserStorage=pu.createStore(n,"session"),this.features=new Dd,n=`converse.features-${this.get("jid")}`,this.features.browserStorage=pu.createStore(n,"session"),this.listenTo(this.features,"add",this.onFeatureAdded),this.fields=new Dd,n=`converse.fields-${this.get("jid")}`,this.fields.browserStorage=pu.createStore(n,"session"),this.listenTo(this.fields,"add",this.onFieldAdded),this.identities=new Dd,n=`converse.identities-${this.get("jid")}`,this.identities.browserStorage=pu.createStore(n,"session"),this.fetchFeatures(t)},async getIdentity(e,t){return await this.waitUntilFeaturesDiscovered,this.identities.findWhere({category:e,type:t})},async getFeature(e){if(await this.waitUntilFeaturesDiscovered,this.features.findWhere({var:e}))return this},onFeatureAdded(e){e.entity=this,Bu.trigger("serviceDiscovered",e)},onFieldAdded(e){e.entity=this,Bu.trigger("discoExtensionFieldDiscovered",e)},async fetchFeatures(e){if(e.ignore_cache)this.queryInfo();else{const e=this.features.browserStorage.name,t=await this.features.browserStorage.store.getItem(e);t&&0===t.length||null===t?this.queryInfo():(this.features.fetch({add:!0,success:()=>{this.waitUntilFeaturesDiscovered.resolve(this),this.trigger("featuresDiscovered")}}),this.identities.fetch({add:!0}))}},async queryInfo(){let e;try{e=await Bu.disco.info(this.get("jid"),null)}catch(e){return null===e?Gc.error(`Timeout for disco#info query for ${this.get("jid")}`):Gc.error(e),void this.waitUntilFeaturesDiscovered.resolve(this)}this.onInfo(e)},onDiscoItems(e){So()(`query[xmlns="${Cf.NS.DISCO_ITEMS}"] item`,e).forEach((e=>{if(e.getAttribute("node"))return;const t=e.getAttribute("jid"),n=pu.disco_entities.get(t);n?n.set({parent_jids:[this.get("jid")]}):Bu.disco.entities.create({jid:t,parent_jids:[this.get("jid")],name:e.getAttribute("name")})}))},async queryForItems(){if(0===this.identities.where({category:"server"}).length)return;const e=await Bu.disco.items(this.get("jid"));this.onDiscoItems(e)},async onInfo(e){Array.from(e.querySelectorAll("identity")).forEach((e=>{this.identities.create({category:e.getAttribute("category"),type:e.getAttribute("type"),name:e.getAttribute("name")})})),So()(`x[type="result"][xmlns="${Cf.NS.XFORM}"]`,e).forEach((e=>{const t={};So()("field",e).forEach((e=>{t[e.getAttribute("var")]={value:e.querySelector("value")?.textContent,type:e.getAttribute("type")}})),this.dataforms.create(t)})),e.querySelector(`feature[var="${Cf.NS.DISCO_ITEMS}"]`)&&await this.queryForItems(),Array.from(e.querySelectorAll("feature")).forEach((t=>{this.features.create({var:t.getAttribute("var"),from:e.getAttribute("from")})})),So()('x[type="result"][xmlns="jabber:x:data"] field',e).forEach((t=>{this.fields.create({var:t.getAttribute("var"),value:t.querySelector("value")?.textContent,from:e.getAttribute("from")})})),this.waitUntilFeaturesDiscovered.resolve(this),this.trigger("featuresDiscovered")}}),Of=Tf,jf=Dd.extend({model:Of,fetchEntities(){return new Promise(((e,t)=>{this.fetch({add:!0,success:e,error(e,n){Gc.error(n),t(new Error("Could not fetch disco entities"))}})}))}}),kf=jf,{Strophe:Rf,$iq:Mf}=_h.env;async function Df(){Bu.disco.own.identities.add("client","web","Converse"),Bu.disco.own.features.add(Rf.NS.CHATSTATES),Bu.disco.own.features.add(Rf.NS.DISCO_INFO),Bu.disco.own.features.add(Rf.NS.ROSTERX),Bu.disco.own.features.add(Rf.NS.CARBONS),Bu.trigger("addClientFeatures"),pu.connection.addHandler((e=>function(e){const t=e.getElementsByTagName("query")[0].getAttribute("node"),n={xmlns:Rf.NS.DISCO_INFO};t&&(n.node=t);const r=Mf({type:"result",id:e.getAttribute("id")}),i=e.getAttribute("from");return null!==i&&r.attrs({to:i}),r.c("query",n),pu.disco._identities.forEach((e=>{const t={category:e.category,type:e.type};e.name&&(t.name=e.name),e.lang&&(t["xml:lang"]=e.lang),r.c("identity",t).up()})),pu.disco._features.forEach((e=>r.c("feature",{var:e}).up())),Bu.send(r.tree()),!0}(e)),Rf.NS.DISCO_INFO,"iq","get",null,null),pu.disco_entities=new pu.DiscoEntities;const e=`converse.disco-entities-${pu.bare_jid}`;pu.disco_entities.browserStorage=pu.createStore(e,"session");const t=await pu.disco_entities.fetchEntities();0!==t.length&&t.get(pu.domain)||Bu.disco.entities.create({jid:pu.domain},{ignore_cache:!0}),Bu.trigger("discoInitialized")}function $f(){if(!pu.stream_features){const e=`converse.stream-features-${Rf.getBareJidFromJid(pu.jid)}`;Bu.promises.add("streamFeaturesAdded"),pu.stream_features=new Dd,pu.stream_features.browserStorage=pu.createStore(e,"session")}}function Ff(){Bu.trigger("streamFeaturesAdded")}function Pf(){$f(),Array.from(pu.connection.features.childNodes).forEach((e=>{pu.stream_features.create({name:e.nodeName,xmlns:e.getAttribute("xmlns")})})),Ff()}function Lf(){pu.disco_entities?.forEach((e=>e.features.clearStore())),pu.disco_entities?.forEach((e=>e.identities.clearStore())),pu.disco_entities?.forEach((e=>e.dataforms.clearStore())),pu.disco_entities?.forEach((e=>e.fields.clearStore())),pu.disco_entities?.clearStore(),delete pu.disco_entities}const{Strophe:zf,$iq:Uf}=_h.env,Bf={disco:{stream:{async getFeature(e,t){if(await Bu.waitUntil("streamFeaturesAdded"),!e||!t)throw new Error("name and xmlns need to be provided when calling disco.stream.getFeature");if(void 0!==pu.stream_features||Bu.connection.connected())return pu.stream_features.findWhere({name:e,xmlns:t});{const n=`Tried to get feature ${e} ${t} but _converse.stream_features has been torn down`;Gc.warn(n)}}},own:{identities:{add(e,t,n,r){for(var i=0;i<pu.disco._identities.length;i++)if(pu.disco._identities[i].category==e&&pu.disco._identities[i].type==t&&pu.disco._identities[i].name==n&&pu.disco._identities[i].lang==r)return!1;pu.disco._identities.push({category:e,type:t,name:n,lang:r})},clear(){pu.disco._identities=[]},get:()=>pu.disco._identities},features:{add(e){for(var t=0;t<pu.disco._features.length;t++)if(pu.disco._features[t]==e)return!1;pu.disco._features.push(e)},clear(){pu.disco._features=[]},get:()=>pu.disco._features}},info(e,t){const n={xmlns:zf.NS.DISCO_INFO};t&&(n.node=t);const r=Uf({from:pu.connection.jid,to:e,type:"get"}).c("query",n);return Bu.sendIQ(r)},items(e,t){const n={xmlns:zf.NS.DISCO_ITEMS};return t&&(n.node=t),Bu.sendIQ(Uf({from:pu.connection.jid,to:e,type:"get"}).c("query",n))},entities:{async get(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(await Bu.waitUntil("discoInitialized"),!e)return pu.disco_entities;if(void 0===pu.disco_entities)return void Gc.warn(`Tried to look up entity ${e} but _converse.disco_entities has been torn down`);const n=pu.disco_entities.get(e);return n||!t?n:Bu.disco.entities.create({jid:e})},items:e=>pu.disco_entities.filter((t=>t.get("parent_jids")?.includes(e))),create:(e,t)=>pu.disco_entities.create(e,t)},features:{async get(e,t){if(!t)throw new TypeError("You need to provide an entity JID");const n=await Bu.disco.entities.get(t,!0);if(void 0===pu.disco_entities&&!Bu.connection.connected())return Gc.warn(`Tried to get feature ${e} for ${t} but _converse.disco_entities has been torn down`),[];const r=[n.getFeature(e),...Bu.disco.entities.items(t).map((t=>t.getFeature(e)))];return(await Promise.all(r)).filter(v)},async has(e,t){if(!t)throw new TypeError("You need to provide an entity JID");const n=await Bu.disco.entities.get(t,!0);if(void 0===pu.disco_entities&&!Bu.connection.connected())return Gc.warn(`Tried to check if ${t} supports feature ${e}`),!1;if(await n.getFeature(e))return!0;const r=await Promise.all(Bu.disco.entities.items(t).map((t=>t.getFeature(e))));return r.map(v).includes(!0)}},supports:(e,t)=>Bu.disco.features.has(e,t),async refresh(e){if(!e)throw new TypeError("api.disco.refresh: You need to provide an entity JID");await Bu.waitUntil("discoInitialized");let t=await Bu.disco.entities.get(e);return t?(t.features.reset(),t.fields.reset(),t.identities.reset(),t.waitUntilFeaturesDiscovered.isPending||(t.waitUntilFeaturesDiscovered=Ao()),t.queryInfo()):t=await Bu.disco.entities.create({jid:e},{ignore_cache:!0}),t.waitUntilFeaturesDiscovered},refreshFeatures:e=>Bu.refresh(e),async getFeatures(e){if(!e)throw new TypeError("api.disco.getFeatures: You need to provide an entity JID");await Bu.waitUntil("discoInitialized");let t=await Bu.disco.entities.get(e,!0);return t=await t.waitUntilFeaturesDiscovered,t.features},async getFields(e){if(!e)throw new TypeError("api.disco.getFields: You need to provide an entity JID");await Bu.waitUntil("discoInitialized");let t=await Bu.disco.entities.get(e,!0);return t=await t.waitUntilFeaturesDiscovered,t.fields},async getIdentity(e,t,n){const r=await Bu.disco.entities.get(n,!0);if(void 0!==r||Bu.connection.connected())return r.getIdentity(e,t);{const t=`Tried to look up category ${e} for ${n} but _converse.disco_entities has been torn down`;Gc.warn(t)}}}},{Strophe:Hf}=_h.env;_h.plugins.add("converse-disco",{initialize(){Object.assign(Bu,Bf),Bu.promises.add("discoInitialized"),Bu.promises.add("streamFeaturesAdded"),pu.DiscoEntity=Of,pu.DiscoEntities=kf,pu.disco={_identities:[],_features:[]},Bu.listen.on("userSessionInitialized",(async()=>{$f(),pu.connfeedback.get("connection_status")===Hf.Status.ATTACHED&&(await new Promise(((e,t)=>pu.stream_features.fetch({success:e,error:t}))),Ff())})),Bu.listen.on("beforeResourceBinding",Pf),Bu.listen.on("reconnected",Df),Bu.listen.on("connected",Df),Bu.listen.on("beforeTearDown",(async()=>{Bu.promises.add("streamFeaturesAdded"),pu.stream_features&&(await pu.stream_features.clearStore(),delete pu.stream_features)})),Bu.listen.on("will-reconnect",Lf),Bu.listen.on("clearSession",Lf)}});const qf=new RegExp("<object[^>]*>.*?</object>|<span[^>]*>.*?</span>|<(?:object|embed|svg|img|div|span|p|a)[^>]*>|((\\s|^)(\\*\\\\0\\/\\*|\\*\\\\O\\/\\*|\\-___\\-|\\:'\\-\\)|'\\:\\-\\)|'\\:\\-D|\\>\\:\\-\\)|>\\:\\-\\)|'\\:\\-\\(|\\>\\:\\-\\(|>\\:\\-\\(|\\:'\\-\\(|O\\:\\-\\)|0\\:\\-3|0\\:\\-\\)|0;\\^\\)|O;\\-\\)|0;\\-\\)|O\\:\\-3|\\-__\\-|\\:\\-|\\:\\-|\\<\\/3|<\\/3|\\:'\\)|\\:\\-D|'\\:\\)|'\\=\\)|'\\:D|'\\=D|\\>\\:\\)|>\\:\\)|\\>;\\)|>;\\)|\\>\\=\\)|>\\=\\)|;\\-\\)|\\*\\-\\)|;\\-\\]|;\\^\\)|'\\:\\(|'\\=\\(|\\:\\-\\*|\\:\\^\\*|\\>\\:P|>\\:P|X\\-P|\\>\\:\\[|>\\:\\[|\\:\\-\\(|\\:\\-\\[|\\>\\:\\(|>\\:\\(|\\:'\\(|;\\-\\(|\\>\\.\\<|>\\.<|#\\-\\)|%\\-\\)|X\\-\\)|\\\\0\\/|\\\\O\\/|0\\:3|0\\:\\)|O\\:\\)|O\\=\\)|O\\:3|B\\-\\)|8\\-\\)|B\\-D|8\\-D|\\-_\\-|\\>\\:\\\\|>\\:\\\\|\\>\\:\\/|>\\:\\/|\\:\\-\\/|\\:\\-\\.|\\:\\-P|\\:|\\:|\\:\\-b|\\:\\-O|O_O|\\>\\:O|>\\:O|\\:\\-X|\\:\\-#|\\:\\-\\)|\\(y\\)|\\<3|<3|\\:D|\\=D|;\\)|\\*\\)|;\\]|;D|\\:\\*|\\=\\*|\\:\\(|\\:\\[|\\=\\(|\\:@|;\\(|D\\:|\\:\\$|\\=\\$|#\\)|%\\)|X\\)|B\\)|8\\)|\\:\\/|\\:\\\\|\\=\\/|\\=\\\\|\\:L|\\=L|\\:P|\\=P|\\:b|\\:O|\\:X|\\:#|\\=X|\\=#|\\:\\)|\\=\\]|\\=\\)|\\:\\])(?=\\s|$|[!,.?]))","gi"),Jf=/(?:\ud83d\udc68\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffc-\udfff]|\ud83d\udc68\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffd-\udfff]|\ud83d\udc68\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffc\udffe\udfff]|\ud83d\udc68\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffd\udfff]|\ud83d\udc68\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffe]|\ud83d\udc69\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffc-\udfff]|\ud83d\udc69\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffc-\udfff]|\ud83d\udc69\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffd-\udfff]|\ud83d\udc69\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb\udffd-\udfff]|\ud83d\udc69\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffc\udffe\udfff]|\ud83d\udc69\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb\udffc\udffe\udfff]|\ud83d\udc69\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffd\udfff]|\ud83d\udc69\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb-\udffd\udfff]|\ud83d\udc69\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffe]|\ud83d\udc69\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb-\udffe]|\ud83e\uddd1\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\u200d\ud83e\udd1d\u200d\ud83e\uddd1|\ud83d\udc6b\ud83c[\udffb-\udfff]|\ud83d\udc6c\ud83c[\udffb-\udfff]|\ud83d\udc6d\ud83c[\udffb-\udfff]|\ud83d[\udc6b-\udc6d])|(?:\ud83d[\udc68\udc69]|\ud83e\uddd1)(?:\ud83c[\udffb-\udfff])?\u200d(?:\u2695\ufe0f|\u2696\ufe0f|\u2708\ufe0f|\ud83c[\udf3e\udf73\udf93\udfa4\udfa8\udfeb\udfed]|\ud83d[\udcbb\udcbc\udd27\udd2c\ude80\ude92]|\ud83e[\uddaf-\uddb3\uddbc\uddbd])|(?:\ud83c[\udfcb\udfcc]|\ud83d[\udd74\udd75]|\u26f9)((?:\ud83c[\udffb-\udfff]|\ufe0f)\u200d[\u2640\u2642]\ufe0f)|(?:\ud83c[\udfc3\udfc4\udfca]|\ud83d[\udc6e\udc71\udc73\udc77\udc81\udc82\udc86\udc87\ude45-\ude47\ude4b\ude4d\ude4e\udea3\udeb4-\udeb6]|\ud83e[\udd26\udd35\udd37-\udd39\udd3d\udd3e\uddb8\uddb9\uddcd-\uddcf\uddd6-\udddd])(?:\ud83c[\udffb-\udfff])?\u200d[\u2640\u2642]\ufe0f|(?:\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d[\udc68\udc69]|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc68|\ud83d\udc68\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d[\udc68\udc69]|\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83c\udff3\ufe0f\u200d\u26a7\ufe0f|\ud83c\udff3\ufe0f\u200d\ud83c\udf08|\ud83c\udff4\u200d\u2620\ufe0f|\ud83d\udc15\u200d\ud83e\uddba|\ud83d\udc41\u200d\ud83d\udde8|\ud83d\udc68\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83d\udc6f\u200d\u2640\ufe0f|\ud83d\udc6f\u200d\u2642\ufe0f|\ud83e\udd3c\u200d\u2640\ufe0f|\ud83e\udd3c\u200d\u2642\ufe0f|\ud83e\uddde\u200d\u2640\ufe0f|\ud83e\uddde\u200d\u2642\ufe0f|\ud83e\udddf\u200d\u2640\ufe0f|\ud83e\udddf\u200d\u2642\ufe0f)|[#*0-9]\ufe0f?\u20e3|(?:[\u2122\u265f]\ufe0f)|(?:\ud83c[\udc04\udd70\udd71\udd7e\udd7f\ude02\ude1a\ude2f\ude37\udf21\udf24-\udf2c\udf36\udf7d\udf96\udf97\udf99-\udf9b\udf9e\udf9f\udfcd\udfce\udfd4-\udfdf\udff3\udff5\udff7]|\ud83d[\udc3f\udc41\udcfd\udd49\udd4a\udd6f\udd70\udd73\udd76-\udd79\udd87\udd8a-\udd8d\udda5\udda8\uddb1\uddb2\uddbc\uddc2-\uddc4\uddd1-\uddd3\udddc-\uddde\udde1\udde3\udde8\uddef\uddf3\uddfa\udecb\udecd-\udecf\udee0-\udee5\udee9\udef0\udef3]|[\u203c\u2049\u2139\u2194-\u2199\u21a9\u21aa\u231a\u231b\u2328\u23cf\u23ed-\u23ef\u23f1\u23f2\u23f8-\u23fa\u24c2\u25aa\u25ab\u25b6\u25c0\u25fb-\u25fe\u2600-\u2604\u260e\u2611\u2614\u2615\u2618\u2620\u2622\u2623\u2626\u262a\u262e\u262f\u2638-\u263a\u2640\u2642\u2648-\u2653\u2660\u2663\u2665\u2666\u2668\u267b\u267f\u2692-\u2697\u2699\u269b\u269c\u26a0\u26a1\u26a7\u26aa\u26ab\u26b0\u26b1\u26bd\u26be\u26c4\u26c5\u26c8\u26cf\u26d1\u26d3\u26d4\u26e9\u26ea\u26f0-\u26f5\u26f8\u26fa\u26fd\u2702\u2708\u2709\u270f\u2712\u2714\u2716\u271d\u2721\u2733\u2734\u2744\u2747\u2757\u2763\u2764\u27a1\u2934\u2935\u2b05-\u2b07\u2b1b\u2b1c\u2b50\u2b55\u3030\u303d\u3297\u3299])(?:\ufe0f|(?!\ufe0e))|(?:(?:\ud83c[\udfcb\udfcc]|\ud83d[\udd74\udd75\udd90]|[\u261d\u26f7\u26f9\u270c\u270d])(?:\ufe0f|(?!\ufe0e))|(?:\ud83c[\udf85\udfc2-\udfc4\udfc7\udfca]|\ud83d[\udc42\udc43\udc46-\udc50\udc66-\udc69\udc6e\udc70-\udc78\udc7c\udc81-\udc83\udc85-\udc87\udcaa\udd7a\udd95\udd96\ude45-\ude47\ude4b-\ude4f\udea3\udeb4-\udeb6\udec0\udecc]|\ud83e[\udd0f\udd18-\udd1c\udd1e\udd1f\udd26\udd30-\udd39\udd3d\udd3e\uddb5\uddb6\uddb8\uddb9\uddbb\uddcd-\uddcf\uddd1-\udddd]|[\u270a\u270b]))(?:\ud83c[\udffb-\udfff])?|(?:\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc65\udb40\udc6e\udb40\udc67\udb40\udc7f|\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc73\udb40\udc63\udb40\udc74\udb40\udc7f|\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc77\udb40\udc6c\udb40\udc73\udb40\udc7f|\ud83c\udde6\ud83c[\udde8-\uddec\uddee\uddf1\uddf2\uddf4\uddf6-\uddfa\uddfc\uddfd\uddff]|\ud83c\udde7\ud83c[\udde6\udde7\udde9-\uddef\uddf1-\uddf4\uddf6-\uddf9\uddfb\uddfc\uddfe\uddff]|\ud83c\udde8\ud83c[\udde6\udde8\udde9\uddeb-\uddee\uddf0-\uddf5\uddf7\uddfa-\uddff]|\ud83c\udde9\ud83c[\uddea\uddec\uddef\uddf0\uddf2\uddf4\uddff]|\ud83c\uddea\ud83c[\udde6\udde8\uddea\uddec\udded\uddf7-\uddfa]|\ud83c\uddeb\ud83c[\uddee-\uddf0\uddf2\uddf4\uddf7]|\ud83c\uddec\ud83c[\udde6\udde7\udde9-\uddee\uddf1-\uddf3\uddf5-\uddfa\uddfc\uddfe]|\ud83c\udded\ud83c[\uddf0\uddf2\uddf3\uddf7\uddf9\uddfa]|\ud83c\uddee\ud83c[\udde8-\uddea\uddf1-\uddf4\uddf6-\uddf9]|\ud83c\uddef\ud83c[\uddea\uddf2\uddf4\uddf5]|\ud83c\uddf0\ud83c[\uddea\uddec-\uddee\uddf2\uddf3\uddf5\uddf7\uddfc\uddfe\uddff]|\ud83c\uddf1\ud83c[\udde6-\udde8\uddee\uddf0\uddf7-\uddfb\uddfe]|\ud83c\uddf2\ud83c[\udde6\udde8-\udded\uddf0-\uddff]|\ud83c\uddf3\ud83c[\udde6\udde8\uddea-\uddec\uddee\uddf1\uddf4\uddf5\uddf7\uddfa\uddff]|\ud83c\uddf4\ud83c\uddf2|\ud83c\uddf5\ud83c[\udde6\uddea-\udded\uddf0-\uddf3\uddf7-\uddf9\uddfc\uddfe]|\ud83c\uddf6\ud83c\udde6|\ud83c\uddf7\ud83c[\uddea\uddf4\uddf8\uddfa\uddfc]|\ud83c\uddf8\ud83c[\udde6-\uddea\uddec-\uddf4\uddf7-\uddf9\uddfb\uddfd-\uddff]|\ud83c\uddf9\ud83c[\udde6\udde8\udde9\uddeb-\udded\uddef-\uddf4\uddf7\uddf9\uddfb\uddfc\uddff]|\ud83c\uddfa\ud83c[\udde6\uddec\uddf2\uddf3\uddf8\uddfe\uddff]|\ud83c\uddfb\ud83c[\udde6\udde8\uddea\uddec\uddee\uddf3\uddfa]|\ud83c\uddfc\ud83c[\uddeb\uddf8]|\ud83c\uddfd\ud83c\uddf0|\ud83c\uddfe\ud83c[\uddea\uddf9]|\ud83c\uddff\ud83c[\udde6\uddf2\uddfc]|\ud83c[\udccf\udd8e\udd91-\udd9a\udde6-\uddff\ude01\ude32-\ude36\ude38-\ude3a\ude50\ude51\udf00-\udf20\udf2d-\udf35\udf37-\udf7c\udf7e-\udf84\udf86-\udf93\udfa0-\udfc1\udfc5\udfc6\udfc8\udfc9\udfcf-\udfd3\udfe0-\udff0\udff4\udff8-\udfff]|\ud83d[\udc00-\udc3e\udc40\udc44\udc45\udc51-\udc65\udc6a\udc6f\udc79-\udc7b\udc7d-\udc80\udc84\udc88-\udca9\udcab-\udcfc\udcff-\udd3d\udd4b-\udd4e\udd50-\udd67\udda4\uddfb-\ude44\ude48-\ude4a\ude80-\udea2\udea4-\udeb3\udeb7-\udebf\udec1-\udec5\uded0-\uded2\uded5\udeeb\udeec\udef4-\udefa\udfe0-\udfeb]|\ud83e[\udd0d\udd0e\udd10-\udd17\udd1d\udd20-\udd25\udd27-\udd2f\udd3a\udd3c\udd3f-\udd45\udd47-\udd71\udd73-\udd76\udd7a-\udda2\udda5-\uddaa\uddae-\uddb4\uddb7\uddba\uddbc-\uddca\uddd0\uddde-\uddff\ude70-\ude73\ude78-\ude7a\ude80-\ude82\ude90-\ude95]|[\u23e9-\u23ec\u23f0\u23f3\u267e\u26ce\u2705\u2728\u274c\u274e\u2753-\u2755\u2795-\u2797\u27b0\u27bf\ue50a])|\ufe0f/g,{u:Wf}=_h.env,Gf={},Qf={"*\\0/*":"1f646","*\\O/*":"1f646","-___-":"1f611",":'-)":"1f602","':-)":"1f605","':-D":"1f605",">:-)":"1f606","':-(":"1f613",">:-(":"1f620",":'-(":"1f622","O:-)":"1f607","0:-3":"1f607","0:-)":"1f607","0;^)":"1f607","O;-)":"1f607","0;-)":"1f607","O:-3":"1f607","-__-":"1f611",":-":"1f61b","</3":"1f494",":')":"1f602",":-D":"1f603","':)":"1f605","'=)":"1f605","':D":"1f605","'=D":"1f605",">:)":"1f606",">;)":"1f606",">=)":"1f606",";-)":"1f609","*-)":"1f609",";-]":"1f609",";^)":"1f609","':(":"1f613","'=(":"1f613",":-*":"1f618",":^*":"1f618",">:P":"1f61c","X-P":"1f61c",">:[":"1f61e",":-(":"1f61e",":-[":"1f61e",">:(":"1f620",":'(":"1f622",";-(":"1f622",">.<":"1f623","#-)":"1f635","%-)":"1f635","X-)":"1f635","\\0/":"1f646","\\O/":"1f646","0:3":"1f607","0:)":"1f607","O:)":"1f607","O=)":"1f607","O:3":"1f607","B-)":"1f60e","8-)":"1f60e","B-D":"1f60e","8-D":"1f60e","-_-":"1f611",">:\\":"1f615",">:/":"1f615",":-/":"1f615",":-.":"1f615",":-P":"1f61b",":":"1f61b",":-b":"1f61b",":-O":"1f62e",O_O:"1f62e",">:O":"1f62e",":-X":"1f636",":-#":"1f636",":-)":"1f642","(y)":"1f44d","<3":"2764",":D":"1f603","=D":"1f603",";)":"1f609","*)":"1f609",";]":"1f609",";D":"1f609",":*":"1f618","=*":"1f618",":(":"1f61e",":[":"1f61e","=(":"1f61e",":@":"1f620",";(":"1f622","D:":"1f628",":$":"1f633","=$":"1f633","#)":"1f635","%)":"1f635","X)":"1f635","B)":"1f60e","8)":"1f60e",":/":"1f615",":\\":"1f615","=/":"1f615","=\\":"1f615",":L":"1f615","=L":"1f615",":P":"1f61b","=P":"1f61b",":b":"1f61b",":O":"1f62e",":X":"1f636",":#":"1f636","=X":"1f636","=#":"1f636",":)":"1f642","=]":"1f642","=)":"1f642",":]":"1f642"};function Vf(e){if(e.indexOf("-")>-1){const t=[],n=e.split("-");for(let e=0;e<n.length;e++){let r=parseInt(n[e],16);if(r>=65536&&r<=1114111){const e=Math.floor((r-65536)/1024)+55296,t=(r-65536)%1024+56320;r=String.fromCharCode(e)+String.fromCharCode(t)}else r=String.fromCharCode(r);t.push(r)}return t.join("")}return function(e){let t="string"==typeof e?parseInt(e,16):e;return t<65536?String.fromCharCode(t):(t-=65536,String.fromCharCode(55296+(t>>10),56320+(1023&t)))}(e)}function Yf(e){if(!_h.emojis.initialized)throw new Error("getShortnameReferences called before emojis are initialized. To avoid this problem, first await the converse.emojis.initialized_promise");return[...e.matchAll(_h.emojis.shortnames_regex)].filter((e=>e[0].length>0)).map((e=>{const t=_h.emojis.by_sn[e[0]].cp;return{cp:t,begin:e.index,end:e.index+e[0].length,shortname:e[0],emoji:t?Vf(t):null}}))}function Xf(e){const t=[];return function(e,t){const n=/\uFE0F/g,r=String.fromCharCode(8205);String(e).replace(Jf,((e,i,s)=>{const o=function(e){const t=[];let n=0,r=0;for(;r<e.length;){const i=e.charCodeAt(r++);n?(t.push((65536+(n-55296<<10)+(i-56320)).toString(16)),n=0):55296<=i&&i<=56319?n=i:t.push(i.toString(16))}return t.join("-")}(e.indexOf(r)<0?e.replace(n,""):e);o&&t(o,e,s)}))}(e,((e,n,r)=>{t.push({begin:r,cp:e,emoji:n,end:r+n.length,shortname:Kf("cp")[e]?.sn||""})})),t}function Kf(e){if(Gf[e])return Gf[e];if("category"===e)return _h.emojis.json;const t=_h.emojis.list.map((t=>t[e])).filter(((e,t,n)=>n.indexOf(e)==t));return Gf[e]={},t.forEach((t=>Gf[e][t]=_h.emojis.list.find((n=>n[e]===t)))),Gf[e]}Object.assign(Wf,{getEmojisByAtrribute:Kf,isOnlyEmojis:function(e){const t=e.trim().split(/\s+/);if(0===t.length||t.length>3)return!1;return t.filter((e=>{const t=Xf(Wf.shortnamesToUnicode(e));return 1===t.length&&(e===t[0].shortname||e===t[0].emoji)})).length===t.length},shortnamesToUnicode:function(e){return function(e){let t=[e];return[...Yf(e),...Xf(e)].sort(((e,t)=>t.begin-e.begin)).forEach((e=>{const n=t.shift(),r=e.emoji||e.shortname;t=[n.slice(0,e.begin)+r+n.slice(e.end),...t]})),t}(function(e){return e.replace(qf,((e,t,n,r)=>void 0!==r&&""!==r&&Wf.unescapeHTML(r)in Qf?(r=Wf.unescapeHTML(r),n+Vf(Qf[r].toUpperCase())):e))}(e)).pop()}}),_h.emojis={initialized:!1,initialized_promise:Ao()},_h.plugins.add("converse-emoji",{initialize(){const{___:e}=pu;Bu.settings.extend({emoji_image_path:"https://twemoji.maxcdn.com/v/12.1.6/",emoji_categories:{smileys:":grinning:",people:":thumbsup:",activity:":soccer:",travel:":motorcycle:",objects:":bomb:",nature:":rainbow:",food:":hotdog:",symbols:":musical_note:",flags:":flag_ac:",custom:null},emoji_category_labels:{smileys:e("Smileys and emotions"),people:e("People"),activity:e("Activities"),travel:e("Travel"),objects:e("Objects"),nature:e("Animals and nature"),food:e("Food and drink"),symbols:e("Symbols"),flags:e("Flags"),custom:e("Stickers")}}),pu.EmojiPicker=us.extend({defaults:{current_category:"smileys",current_skintone:"",scroll_position:0}}),Object.assign(Bu,{emojis:{async initialize(){if(!_h.emojis.initialized){_h.emojis.initialized=!0;const e=await o.e(610).then(o.t.bind(o,175,19)),t=_h.emojis.json=e.default;_h.emojis.by_sn=Object.keys(t).reduce(((e,n)=>Object.assign(e,t[n])),{}),_h.emojis.list=Object.values(_h.emojis.by_sn),_h.emojis.list.sort(((e,t)=>e.sn<t.sn?-1:e.sn>t.sn?1:0)),_h.emojis.shortnames=_h.emojis.list.map((e=>e.sn));const n=()=>_h.emojis.shortnames.map((e=>e.replace(/[+]/g,"\\$&"))).join("|");_h.emojis.shortnames_regex=new RegExp(n(),"gi"),_h.emojis.initialized_promise.resolve()}return _h.emojis.initialized_promise}}})}});const Zf={initialize(){this.checkValidity()&&(this.get("file")&&this.on("change:put",(()=>this.uploadFile())),this.on("change:type",(()=>this.setOccupant())),this.on("change:is_ephemeral",(()=>this.setTimerForEphemeralMessage())),this.chatbox=this.collection?.chatbox,this.setTimerForEphemeralMessage(),this.setOccupant(),Bu.trigger("chatRoomMessageInitialized",this))},getDisplayName(){return this.occupant?.getDisplayName()||this.get("nick")},mayBeModerated(){if(void 0!==this.get("from_muc"))return["all","moderator"].includes(Bu.settings.get("allow_message_retraction"))&&this.get(`stanza_id ${this.get("from_muc")}`)&&this.chatbox.canModerateMessages()},checkValidity(){const e=pu.Message.prototype.checkValidity.call(this);return!e&&this.chatbox.debouncedRejoin(),e},onOccupantRemoved(){this.stopListening(this.occupant),delete this.occupant,this.listenTo(this.chatbox.occupants,"add",this.onOccupantAdded)},onOccupantAdded(e){if(this.get("occupant_id")){if(e.get("occupant_id")!==this.get("occupant_id"))return}else if(e.get("nick")!==no.getResourceFromJid(this.get("from")))return;this.occupant=e,e.get("jid")&&this.save("from_real_jid",e.get("jid")),this.trigger("occupantAdded"),this.listenTo(this.occupant,"destroy",this.onOccupantRemoved),this.stopListening(this.chatbox.occupants,"add",this.onOccupantAdded)},getOccupant(){return this.occupant||this.setOccupant(),this.occupant},setOccupant(){if("groupchat"!==this.get("type")||this.isEphemeral()||this.occupant)return;const e=no.getResourceFromJid(this.get("from")),t=this.get("occupant_id");if(this.occupant=this.chatbox.occupants.findOccupant({nick:e,occupant_id:t}),!this.occupant&&(this.occupant=this.chatbox.occupants.create({nick:e,occupant_id:t,jid:this.get("from_real_jid")}),Bu.settings.get("muc_send_probes"))){const t=`${this.chatbox.get("jid")}/${e}`;Bu.user.presence.send("probe",t)}this.listenTo(this.occupant,"destroy",this.onOccupantRemoved)}},eg=Zf;const tg=function(e){return U(e)&&1===e.nodeType&&!Yi(e)},ng={},rg=(e,t)=>e.replace(RegExp("\\"+t,"ig"),"\\"+t);ng.escapeCharacters=e=>t=>e.split("").reduce(rg,t),ng.escapeRegexString=ng.escapeCharacters("[\\^$.?*+(){}|"),ng.findFirstMatchInArray=e=>t=>{for(let n=0;n<e.length;n++)if(0===t.localeCompare(e[n],void 0,{sensitivity:"base"}))return e[n];return null};const ig=(e,t,n)=>{let[r,i]=e,s=r,{begin:o,end:a}=t;const{value:c}=t;return o-=n,a=a-n-1,s=`${s.slice(0,o)}${c}${s.slice(a+1)}`,[s,[...i,{...t,begin:o,end:a}]]};ng.reduceTextFromReferences=(e,t)=>t.reduce(ig,[e,[]]);const sg=ng,og=["moderator","participant","visitor"],ag={moderator:1,participant:2,visitor:3,none:2},cg={OWNER:"owner",ADMIN:"admin",MEMBER:"member",EXADMIN:"exadmin",EXOWNER:"exowner",EXOUTCAST:"exoutcast",EXMEMBER:"exmember"},ug=Object.values(cg),dg={ENTERED:"entered",EXITED:"exited"},lg=Object.values(dg),hg={OP:"op",DEOP:"deop",VOICE:"voice",MUTE:"mute"},fg=Object.values(hg),gg={visibility_changes:["100","102","103","172","173","174"],self:["110"],non_privacy_changes:["104","201"],muc_logging_changes:["170","171"],nickname_changes:["210","303"],disconnected:["301","307","321","322","332","333"],affiliation_changes:[...ug],join_leave_events:[...lg],role_changes:[...fg]},pg={CONNECTED:0,CONNECTING:1,NICKNAME_REQUIRED:2,PASSWORD_REQUIRED:3,DISCONNECTED:4,ENTERED:5,DESTROYED:6,BANNED:7,CLOSING:8},{Strophe:mg,sizzle:vg,u:_g}=_h.env,{NS:yg}=mg;function bg(e){const t=vg(`items[node="${mg.NS.CONFINFO}"]`,e).pop();if(!t)return null;const n=e.getAttribute("from"),r=e.getAttribute("id"),i=`item conference-info[xmlns="${mg.NS.CONFINFO}"] activity[xmlns="${mg.NS.ACTIVITY}"]`;return vg(i,t).map((t=>{const i=t.querySelector("text")?.textContent;if(i){const s=Qh(e),o=t.querySelector("reason")?.textContent;return{from:n,msgid:r,message:i,reason:o,references:s,type:"mep"}}return{}}))}function wg(e,t){if(t.features.get(mg.NS.OCCUPANTID))return vg(`occupant-id[xmlns="${mg.NS.OCCUPANTID}"]`,e).pop()?.getAttribute("id")}function Sg(e,t){let n;const r=t.get("occupant_id");return n=r?e.occupant_id===r:e.from_real_jid?mg.getBareJidFromJid(e.from_real_jid)===pu.bare_jid:e.nick===t.get("nick"),n?"me":"them"}async function Ag(e,t){Zh(e);const n=`[xmlns="${yg.MAM}"] > forwarded[xmlns="${yg.FORWARD}"] > message`,r=e;if(e=vg(n,e).pop()||e,vg(`message > forwarded[xmlns="${mg.NS.FORWARD}"]`,e).length)return new Lh(`Invalid Stanza: Forged MAM groupchat message from ${e.getAttribute("from")}`,e);const i=vg(`delay[xmlns="${mg.NS.DELAY}"]`,r).pop(),s=e.getAttribute("from"),o=ef(e);let a=Object.assign({from:s,activities:bg(e),body:e.querySelector(":scope > body")?.textContent?.trim(),chat_state:Xh(e),from_muc:mg.getBareJidFromJid(s),is_archived:rf(r),is_carbon:Yh(r),is_delayed:!!i,is_forwarded:!!e.querySelector("forwarded"),is_headline:tf(e),is_markable:!!vg(`markable[xmlns="${mg.NS.MARKERS}"]`,e).length,is_marker:!!o,is_unstyled:!!vg(`unstyled[xmlns="${mg.NS.STYLING}"]`,e).length,marker_id:o&&o.getAttribute("id"),msgid:e.getAttribute("id")||r.getAttribute("id"),nick:mg.unescapeNode(mg.getResourceFromJid(s)),occupant_id:wg(e,t),receipt_id:Vh(e),received:(new Date).toISOString(),references:Qh(e),subject:e.querySelector("subject")?.textContent,thread:e.querySelector("thread")?.textContent,time:i?qu()(i.getAttribute("stamp")).toISOString():(new Date).toISOString(),to:e.getAttribute("to"),type:e.getAttribute("type")},Gh(e),Wh(e),Jh(e),Hh(e,r),zh(e,r),function(e){const t=So()(`> apply-to[xmlns="${no.NS.FASTEN}"]`,e).pop();if(t){const e=t.getAttribute("id"),n=So()(`> meta[xmlns="${no.NS.XHTML}"]`,t);if(n.length){const t=Bu.settings.get("message_limit"),r=n.reduce(((e,n)=>{const r=n.getAttribute("property");if(r){let i=Bc(n.getAttribute("content")||"");t&&"og:description"===r&&i.length>=t&&(i=`${i.slice(0,t)}${Bc("&#8230;")}`),e[r]=i}return e}),{ogp_for_id:e});if("og:description"in r||"og:title"in r||"og:image"in r)return r}}return{}}(e),Bh(e,r),function(e){const t=vg(`apply-to[xmlns="${mg.NS.FASTEN}"]`,e).pop();if(t){const e=t.getAttribute("id"),n=vg(`moderated[xmlns="${mg.NS.MODERATE}"]`,t).pop();if(n&&vg(`retract[xmlns="${mg.NS.RETRACT}"]`,n).pop())return{editable:!1,moderated:"retracted",moderated_by:n.getAttribute("by"),moderated_id:e,moderation_reason:n.querySelector("reason")?.textContent}}else{const t=vg(`> moderated[xmlns="${mg.NS.MODERATE}"]`,e).pop();if(t&&vg(`retracted[xmlns="${mg.NS.RETRACT}"]`,t).pop())return{editable:!1,is_tombstone:!0,moderated_by:t.getAttribute("by"),retracted:t.getAttribute("stamp"),moderation_reason:t.querySelector("reason")?.textContent}}return{}}(e),Uh(e));return await Bu.emojis.initialize(),a.from_real_jid=a.is_archived&&function(e){const t=vg(`x[xmlns="${mg.NS.MUC_USER}"] item`,e).pop();return t?.getAttribute("jid")}(e)||t.occupants.findOccupant(a)?.get("jid"),a=Object.assign({is_only_emojis:!!a.body&&_g.isOnlyEmojis(a.body),is_valid_receipt_request:Kh(e,a),message:a.body||a.error,sender:Sg(a,t)},a),a.is_archived&&r.getAttribute("from")!==a.from_muc?new Lh(`Invalid Stanza: Forged MAM message from ${r.getAttribute("from")}`,e):a.is_archived&&r.getAttribute("from")!==t.get("jid")?new Lh(`Invalid Stanza: Forged MAM groupchat message from ${e.getAttribute("from")}`,e):a.is_carbon?new Lh("Invalid Stanza: MUC messages SHOULD NOT be XEP-0280 carbon copied",e):(a.id=a.origin_id||a[`stanza_id ${a.from_muc||a.from}`]||_g.getUniqueId(),a=await Bu.hook("parseMUCMessage",e,a),Object.assign(a,qh(a.is_encrypted?a.plaintext:a.body)))}const{Strophe:Eg,$iq:xg,u:Ng}=_h.env;async function Ig(e,t){const{__:n}=pu,r=xg({to:t,type:"get"}).c("query",{xmlns:Eg.NS.MUC_ADMIN}).c("item",{affiliation:e}),i=await Bu.sendIQ(r,null,!1);if(null===i){const r=n("Error: timeout while fetching %1s list for MUC %2s",e,t),i=new Error(r);return Gc.warn(r),i}if(Ng.isErrorStanza(i)){const r=n("Error: not allowed to fetch %1s list for MUC %2s",e,t),s=new Error(r);return Gc.warn(r),Gc.warn(i),s}return function(e){return vg(`query[xmlns="${mg.NS.MUC_ADMIN}"] item`,e).map((e=>{const t={affiliation:e.getAttribute("affiliation")},n=e.getAttribute("jid");_g.isValidJID(n)?t.jid=n:t.nick=n;const r=e.getAttribute("nick");return r&&(t.nick=r),e.getAttribute("role")&&(t.role=r),t}))}(i).filter((e=>e)).sort(((e,t)=>e.nick<t.nick?-1:e.nick>t.nick?1:0))}function Cg(e,t){const n=[...new Set(t.map((e=>e.affiliation)))];return Promise.all(n.map((n=>function(e,t,n){Array.isArray(t)||(t=[t]);return n=n.filter((t=>[void 0,e].includes(t.affiliation))),Promise.all(t.reduce(((t,r)=>[...t,...n.map((t=>function(e,t,n){const r=xg({to:t,type:"set"}).c("query",{xmlns:Eg.NS.MUC_ADMIN}).c("item",{affiliation:n.affiliation||e,nick:n.nick,jid:n.jid});void 0!==n.reason&&r.c("reason",n.reason);return Bu.sendIQ(r)}(e,r,t)))]),[]))}(n,e,t))))}function Tg(e,t,n,r){const i=n.map((e=>e.jid)),s=r.map((e=>e.jid));let o=ad(i,s).map((e=>n[bd(i,e)]));return e||(o=o.concat(n.filter((e=>{const t=bd(s,e.jid);return t>=0&&e.affiliation!==r[t].affiliation})))),t&&(o=o.concat(ad(s,i).map((e=>({jid:e,affiliation:"none"}))))),o}pu.getAssignableAffiliations=function(e){let t=Bu.settings.get("modtools_disable_assign");return Array.isArray(t)||(t=t?ap:[]),"owner"===e?.get("affiliation")?ap.filter((e=>!t.includes(e))):"admin"===e?.get("affiliation")?ap.filter((e=>!["owner","admin",...t].includes(e))):[]};const{u:Og}=_h.env,jg=["owner"],kg=["admin","ban","deop","destroy","member","op","revoke"],Rg=["kick","mute","voice","modtools"],Mg=["nick"],Dg=["og:article:author","og:article:published_time","og:description","og:image","og:image:height","og:image:width","og:site_name","og:title","og:type","og:url","og:video:height","og:video:secure_url","og:video:tag","og:video:type","og:video:url","og:video:width"],$g=["301","303","333","307","321","322"],Fg=us.extend({defaults:()=>({connection_status:pg.DISCONNECTED})}),Pg={defaults(){return{bookmarked:!1,chat_state:void 0,has_activity:!1,hidden:Oc()&&!Bu.settings.get("singleton"),hidden_occupants:!!Bu.settings.get("hide_muc_participants"),message_type:"groupchat",name:"",num_unread_general:0,num_unread:0,roomconfig:{},time_opened:this.get("time_opened")||(new Date).getTime(),time_sent:new Date(0).toISOString(),type:pu.CHATROOMS_TYPE}},async initialize(){this.initialized=Ao(),this.debouncedRejoin=Nu(this.rejoin,250),this.set("box_id",`box-${this.get("jid")}`),this.initNotifications(),this.initMessages(),this.initUI(),this.initOccupants(),this.initDiscoModels(),this.registerHandlers(),this.on("change:chat_state",this.sendChatState,this),this.on("change:hidden",this.onHiddenChange,this),this.on("destroy",this.removeHandlers,this),this.ui.on("change:scrolled",this.onScrolledChanged,this),await this.restoreSession(),this.session.on("change:connection_status",this.onConnectionStatusChanged,this),this.listenTo(this.occupants,"add",this.onOccupantAdded),this.listenTo(this.occupants,"remove",this.onOccupantRemoved),this.listenTo(this.occupants,"change:show",this.onOccupantShowChanged),this.listenTo(this.occupants,"change:affiliation",this.createAffiliationChangeMessage),this.listenTo(this.occupants,"change:role",this.createRoleChangeMessage);await this.restoreFromCache()||this.join(),await Bu.trigger("chatRoomInitialized",this,{Synchronous:!0}),this.initialized.resolve()},isEntered(){return this.session.get("connection_status")===pg.ENTERED},isRAICandidate(){return this.get("hidden")&&Bu.settings.get("muc_subscribe_to_rai")&&"none"!==this.getOwnAffiliation()},async restoreFromCache(){if(this.isEntered()){if(await this.fetchOccupants().catch((e=>Gc.error(e))),this.isRAICandidate())return this.session.save("connection_status",pg.DISCONNECTED),this.enableRAI(),!0;if(await this.isJoined())return await new Promise((e=>this.config.fetch({success:e,error:e}))),await new Promise((e=>this.features.fetch({success:e,error:e}))),await this.fetchMessages().catch((e=>Gc.error(e))),!0}return this.session.save("connection_status",pg.DISCONNECTED),this.clearOccupantsCache(),!1},async join(e,t){return this.isEntered()?this:(this.session.save("connection_status",pg.CONNECTING),await this.refreshDiscoInfo(),(e=await this.getAndPersistNickname(e))?(Bu.send(await this.constructJoinPresence(t)),this):(Dc(this.session,{connection_status:pg.NICKNAME_REQUIRED}),Bu.settings.get("muc_show_logs_before_join")&&await this.fetchMessages(),this))},rejoin(){return this.session.save("connection_status",pg.DISCONNECTED),this.registerHandlers(),this.clearOccupantsCache(),this.join()},async constructJoinPresence(e){let t=Vs({id:Fc(),from:pu.connection.jid,to:this.getRoomJIDAndNick()}).c("x",{xmlns:no.NS.MUC}).c("history",{maxstanzas:this.features.get("mam_enabled")?0:Bu.settings.get("muc_history_max_stanzas")}).up();return(e=e||this.get("password"))&&t.cnode(no.xmlElement("password",[],e)),t.up(),t=await Bu.hook("constructedMUCPresence",this,t),t},clearOccupantsCache(){this.occupants.length?this.occupants.filter((e=>!e.isMember())).forEach((e=>e.destroy())):this.occupants.clearStore()},sendMarkerForMessage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"displayed",n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e&&Bu.settings.get("send_chat_markers").includes(t)&&"groupchat"===e?.get("type")&&(e?.get("is_markable")||n)){const n=`stanza_id ${this.get("jid")}`,r=e.get(n);if(!r)return void Gc.error(`Can't send marker for message without stanza ID: ${n}`);Ih(no.getBareJidFromJid(e.get("from")),r,t,e.get("type"))}},enableRAI(){if(Bu.settings.get("muc_subscribe_to_rai")){const e=no.getDomainFromJid(this.get("jid"));Bu.user.presence.send(null,e,null,Ws("rai",{xmlns:no.NS.RAI}))}},async onHiddenChange(){const e=pg,t=this.session.get("connection_status");this.get("hidden")?t===e.ENTERED&&this.isRAICandidate()&&(this.sendMarkerForLastMessage("received",!0),await this.leave(),this.enableRAI()):(t===e.DISCONNECTED&&this.rejoin(),this.clearUnreadMsgCounter())},onOccupantAdded(e){pu.isInfoVisible(_h.MUC_TRAFFIC_STATES.ENTERED)&&this.session.get("connection_status")===pg.ENTERED&&"online"===e.get("show")&&this.updateNotifications(e.get("nick"),_h.MUC_TRAFFIC_STATES.ENTERED)},onOccupantRemoved(e){pu.isInfoVisible(_h.MUC_TRAFFIC_STATES.EXITED)&&this.isEntered()&&"online"===e.get("show")&&this.updateNotifications(e.get("nick"),_h.MUC_TRAFFIC_STATES.EXITED)},onOccupantShowChanged(e){e.get("states").includes("303")||("offline"===e.get("show")&&pu.isInfoVisible(_h.MUC_TRAFFIC_STATES.EXITED)?this.updateNotifications(e.get("nick"),_h.MUC_TRAFFIC_STATES.EXITED):"online"===e.get("show")&&pu.isInfoVisible(_h.MUC_TRAFFIC_STATES.ENTERED)&&this.updateNotifications(e.get("nick"),_h.MUC_TRAFFIC_STATES.ENTERED))},async onRoomEntered(){await this.occupants.fetchMembers(),Bu.settings.get("clear_messages_on_reconnection")?await this.clearMessages():await this.fetchMessages(),Bu.trigger("enteredNewRoom",this),Bu.settings.get("auto_register_muc_nickname")&&await Bu.disco.supports(no.NS.MUC_REGISTER,this.get("jid"))&&this.registerNickname()},async onConnectionStatusChanged(){if(this.isEntered())if(this.isRAICandidate()){try{await this.leave()}catch(e){Gc.error(e)}this.enableRAI()}else await this.onRoomEntered()},async onReconnection(){await this.rejoin(),this.announceReconnection()},getMessagesCollection:()=>new pu.ChatRoomMessages,restoreSession(){const e=`muc.session-${pu.bare_jid}-${this.get("jid")}`;return this.session=new Fg({id:e}),pc(this.session,e,"session"),new Promise((e=>this.session.fetch({success:e,error:e})))},initDiscoModels(){let e=`converse.muc-features-${pu.bare_jid}-${this.get("jid")}`;this.features=new us(Object.assign({id:e},_h.ROOM_FEATURES.reduce(((e,t)=>(e[t]=!1,e)),{}))),this.features.browserStorage=pu.createStore(e,"session"),this.features.listenTo(pu,"beforeLogout",(()=>this.features.browserStorage.flush())),e=`converse.muc-config-${pu.bare_jid}-${this.get("jid")}`,this.config=new us({id:e}),this.config.browserStorage=pu.createStore(e,"session"),this.config.listenTo(pu,"beforeLogout",(()=>this.config.browserStorage.flush()))},initOccupants(){this.occupants=new pu.ChatRoomOccupants;const e=`converse.occupants-${pu.bare_jid}${this.get("jid")}`;this.occupants.browserStorage=pu.createStore(e,"session"),this.occupants.chatroom=this,this.occupants.listenTo(pu,"beforeLogout",(()=>this.occupants.browserStorage.flush()))},fetchOccupants(){return this.occupants.fetched=new Promise((e=>{this.occupants.fetch({add:!0,silent:!0,success:e,error:e})})),this.occupants.fetched},handleAffiliationChangedMessage(e){const t=So()(`x[xmlns="${no.NS.MUC_USER}"] item`,e).pop();if(t){const n=e.getAttribute("from"),r=e.getAttribute("type"),i=t.getAttribute("affiliation"),s=t.getAttribute("jid"),o={from:n,type:r,affiliation:i,states:[],show:"unavailable"==r?"offline":"online",role:t.getAttribute("role"),jid:no.getBareJidFromJid(s),resource:no.getResourceFromJid(s)},a=this.occupants.findOccupant({jid:o.jid});a?a.save(o):this.occupants.create(o)}},async handleErrorMessageStanza(e){const{__:t}=pu,n=await Ag(e,this);if(!await this.shouldShowErrorMessage(n))return;const r=this.getMessageReferencedByError(n);if(r){const e={error:n.error,error_condition:n.error_condition,error_text:n.error_text,error_type:n.error_type,editable:!1};n.msgid===r.get("retraction_id")?(e.retracted=void 0,e.retraction_id=void 0,e.retracted_id=void 0,n.error||("forbidden"===n.error_condition?e.error=t("You're not allowed to retract your message."):"not-acceptable"===n.error_condition?e.error=t("Your retraction was not delivered because you're not present in the groupchat."):e.error=t("Sorry, an error occurred while trying to retract your message."))):n.error||("forbidden"===n.error_condition?e.error=t("Your message was not delivered because you weren't allowed to send it."):"not-acceptable"===n.error_condition?e.error=t("Your message was not delivered because you're not present in the groupchat."):e.error=t("Sorry, an error occurred while trying to send your message.")),r.save(e)}else this.createMessage(n)},handleMessageFromMUCHost(e){if(this.isEntered())return;const t=So()(`rai[xmlns="${no.NS.RAI}"]`,e).pop(),n=Array.from(t?.querySelectorAll("activity")||[]).map((e=>e.textContent));n.includes(this.get("jid"))&&this.save({has_activity:!0,num_unread_general:0})},handleForwardedMentions(e){if(this.isEntered())return;const t=So()(`mentions[xmlns="${no.NS.MENTIONS}"] forwarded[xmlns="${no.NS.FORWARD}"] message[type="groupchat"]`,e),n=this.get("jid"),r=t.filter((e=>no.getBareJidFromJid(e.getAttribute("from"))===n));r.length&&(this.save({has_activity:!0,num_unread:this.get("num_unread")+r.length}),r.forEach((async e=>{const t={stanza:e,attrs:await Ag(e,this),chatbox:this};Bu.trigger("message",t)})))},async handleMessageStanza(e){const t=(e=e.tree?.()??e).getAttribute("type");if("error"===t)return this.handleErrorMessageStanza(e);if("groupchat"===t){if(rf(e))return Gc.warn('Received a MAM message with type "groupchat"');this.createInfoMessages(e),this.fetchFeaturesIfConfigurationChanged(e)}else if(!t)return this.handleForwardedMentions(e);let n;try{n=await Ag(e,this)}catch(e){return Gc.error(e)}const r={stanza:e,attrs:n,chatbox:this};return Bu.trigger("message",r),n&&this.queueMessage(n)},registerHandlers(){const e=this.get("jid"),t=no.getDomainFromJid(e);this.removeHandlers(),this.presence_handler=pu.connection.addHandler((e=>this.onPresence(e)||!0),null,"presence",null,null,e,{ignoreNamespaceFragment:!0,matchBareFromJid:!0}),this.domain_presence_handler=pu.connection.addHandler((e=>this.onPresenceFromMUCHost(e)||!0),null,"presence",null,null,t),this.message_handler=pu.connection.addHandler((e=>!!this.handleMessageStanza(e)||!0),null,"message",null,null,e,{matchBareFromJid:!0}),this.domain_message_handler=pu.connection.addHandler((e=>this.handleMessageFromMUCHost(e)||!0),null,"message",null,null,t),this.affiliation_message_handler=pu.connection.addHandler((e=>this.handleAffiliationChangedMessage(e)||!0),no.NS.MUC_USER,"message",null,null,e)},removeHandlers(){return this.message_handler&&(pu.connection&&pu.connection.deleteHandler(this.message_handler),delete this.message_handler),this.domain_message_handler&&(pu.connection&&pu.connection.deleteHandler(this.domain_message_handler),delete this.domain_message_handler),this.presence_handler&&(pu.connection&&pu.connection.deleteHandler(this.presence_handler),delete this.presence_handler),this.domain_presence_handler&&(pu.connection&&pu.connection.deleteHandler(this.domain_presence_handler),delete this.domain_presence_handler),this.affiliation_message_handler&&(pu.connection&&pu.connection.deleteHandler(this.affiliation_message_handler),delete this.affiliation_message_handler),this},invitesAllowed(){return Bu.settings.get("allow_muc_invitations")&&(this.features.get("open")||"owner"===this.getOwnAffiliation())},getDisplayName(){const e=this.get("name");return e||("hidden"===Bu.settings.get("locked_muc_domain")?no.getNodeFromJid(this.get("jid")):this.get("jid"))},sendTimedMessage(e){"function"==typeof e.tree&&(e=e.tree());let t=e.getAttribute("id");t||(t=this.getUniqueId("sendIQ"),e.setAttribute("id",t));const n=Ao(),r=Bu.settings.get("stanza_timeout"),i=pu.connection.addTimedHandler(r,(()=>{pu.connection.deleteHandler(s);const e=new wu("Timeout Error: No response from server");return n.resolve(e),!1})),s=pu.connection.addHandler((e=>{i&&pu.connection.deleteTimedHandler(i),n.resolve(e)}),null,"message",["error","groupchat"],t);return Bu.send(e),n},async retractOwnMessage(e){const t=pu.__,n=e.get("origin_id");if(!n)throw new Error("Can't retract message without a XEP-0359 Origin ID");const r=e.get("editable"),i=Gs({id:Fc(),to:this.get("jid"),type:"groupchat"}).c("store",{xmlns:no.NS.HINTS}).up().c("apply-to",{id:n,xmlns:no.NS.FASTEN}).c("retract",{xmlns:no.NS.RETRACT});e.set({retracted:(new Date).toISOString(),retracted_id:n,retraction_id:i.tree().getAttribute("id"),editable:!1});const s=await this.sendTimedMessage(i);Og.isErrorStanza(s)?Gc.error(s):s instanceof wu&&(Gc.error(s),e.save({editable:r,error_type:"timeout",error:t("A timeout happened while while trying to retract your message."),retracted:void 0,retracted_id:void 0,retraction_id:void 0}))},async retractOtherMessage(e,t){const n=e.get("editable");e.save({moderated:"retracted",moderated_by:pu.bare_jid,moderated_id:e.get("msgid"),moderation_reason:t,editable:!1});const r=await this.sendRetractionIQ(e,t);return(null===r||Og.isErrorStanza(r))&&e.save({editable:n,moderated:void 0,moderated_by:void 0,moderated_id:void 0,moderation_reason:void 0}),r},sendRetractionIQ(e,t){const n=Qs({to:this.get("jid"),type:"set"}).c("apply-to",{id:e.get(`stanza_id ${this.get("jid")}`),xmlns:no.NS.FASTEN}).c("moderate",{xmlns:no.NS.MODERATE}).c("retract",{xmlns:no.NS.RETRACT}).up().c("reason").t(t||"");return Bu.sendIQ(n,null,!1)},sendDestroyIQ(e,t){const n=Ws("destroy");t&&n.attrs({jid:t});const r=Qs({to:this.get("jid"),type:"set"}).c("query",{xmlns:no.NS.MUC_OWNER}).cnode(n.node);return e&&e.length>0&&r.c("reason",e),Bu.sendIQ(r)},async leave(e){Bu.connection.connected()&&Bu.user.presence.send("unavailable",this.getRoomJIDAndNick(),e),this.features&&await new Promise((e=>this.features.destroy({success:e,error:(t,n)=>{Gc.error(n),e()}})));const t=pu.disco_entities?.get(this.get("jid"));t&&await new Promise((e=>t.destroy({success:e,error:(t,n)=>{Gc.error(n),e()}}))),Dc(this.session,{connection_status:pg.DISCONNECTED})},async close(e){const{ENTERED:t,CLOSING:n}=pg,r=this.session.get("connection_status")===t;return Dc(this.session,{connection_status:n}),r&&this.sendMarkerForLastMessage("received",!0),await this.unregisterNickname(),await this.leave(),this.occupants.clearStore(),"closeAllChatBoxes"!==e?.name&&Bu.settings.get("muc_clear_messages_on_leave")&&this.clearMessages(),await new Promise((e=>this.session.destroy({success:e,error:(t,n)=>{Gc.error(n),e()}}))),pu.ChatBox.prototype.close.call(this)},canModerateMessages(){const e=this.getOwnOccupant();return e&&e.isModerator()&&Bu.disco.supports(no.NS.MODERATE,this.get("jid"))},getAllKnownNicknames(){return[...new Set([...this.occupants.map((e=>e.get("nick"))),...this.messages.map((e=>e.get("nick")))])].filter((e=>e))},getAllKnownNicknamesRegex(){const e=this.getAllKnownNicknames().map((e=>sg.escapeRegexString(e))).join("|");return RegExp(`(?:\\p{P}|\\p{Z}|^)@(${e})(?![\\w@-])`,"uig")},getOccupantByJID(e){return this.occupants.findOccupant({jid:e})},getOccupantByNickname(e){return this.occupants.findOccupant({nick:e})},getReferenceURIFromNickname(e){const t=this.get("jid"),n=this.getOccupant(e),r=this.features.get("nonanonymous")&&n?.get("jid")||`${t}/${e}`;return encodeURI(`xmpp:${r}`)},parseTextForReferences(e){if(!e||!/(\p{P}|\p{Z}|^)([@][\w_-]+(?:\.\w+)*)/giu.test(e))return[e,[]];const t=sg.findFirstMatchInArray(this.getAllKnownNicknames()),n=this.getAllKnownNicknamesRegex(),r=[...e.matchAll(n)].filter((e=>!e[0].startsWith("/"))),i=r.map((e=>{let n=e[0].indexOf("@");"@"===e[0][n+1]&&(n+=1);const r=e.index+n,i=r+e[0].length-n,s=t(e[1]);return{begin:r,end:i,value:s,type:"mention",uri:this.getReferenceURIFromNickname(s)}})),[s,o]=sg.reduceTextFromReferences(e,i);return[s,o]},async getOutgoingMessageAttributes(e){await Bu.emojis.initialize();const t=this.get("composing_spoiler");let n,r="";e?.body&&([r,n]=this.parseTextForReferences(e.body));const i=Fc(),s=r?Og.shortnamesToUnicode(r):void 0;return e=Object.assign({},e,{body:s,is_spoiler:t,origin_id:i,references:n,id:i,msgid:i,from:`${this.get("jid")}/${this.get("nick")}`,fullname:this.get("nick"),is_only_emojis:!!r&&Og.isOnlyEmojis(r),message:s,nick:this.get("nick"),sender:"me",type:"groupchat"},qh(r)),e=await Bu.hook("getOutgoingMessageAttributes",this,e)},getRoomJIDAndNick(){const e=this.get("nick");return no.getBareJidFromJid(this.get("jid"))+(null!==e?`/${e}`:"")},sendChatState(){if(!Bu.settings.get("send_chat_state_notifications")||!this.get("chat_state")||!this.isEntered()||this.features.get("moderated")&&"visitor"===this.getOwnRole())return;const e=Bu.settings.get("send_chat_state_notifications");if(Array.isArray(e)&&!e.includes(this.get("chat_state")))return;const t=this.get("chat_state");t!==pu.GONE&&Bu.send(Gs({to:this.get("jid"),type:"groupchat"}).c(t,{xmlns:no.NS.CHATSTATES}).up().c("no-store",{xmlns:no.NS.HINTS}).up().c("no-permanent-store",{xmlns:no.NS.HINTS}))},directInvite(e,t){this.features.get("membersonly")&&this.updateMemberLists([{jid:e,affiliation:"member",reason:t}]);const n={xmlns:"jabber:x:conference",jid:this.get("jid")};null!==t&&(n.reason=t),this.get("password")&&(n.password=this.get("password"));const r=Gs({from:pu.connection.jid,to:e,id:Fc()}).c("x",n);Bu.send(r),Bu.trigger("roomInviteSent",{room:this,recipient:e,reason:t})},refreshDiscoInfo(){return Bu.disco.refresh(this.get("jid")).then((()=>this.getDiscoInfo())).catch((e=>Gc.error(e)))},getDiscoInfo(){return Bu.disco.getIdentity("conference","text",this.get("jid")).then((e=>this.save({name:e?.get("name")}))).then((()=>this.getDiscoInfoFields())).then((()=>this.getDiscoInfoFeatures())).catch((e=>Gc.error(e)))},async getDiscoInfoFields(){const e=(await Bu.disco.getFields(this.get("jid"))).reduce(((e,t)=>{const n=t.get("var");return n?.startsWith("muc#roominfo_")&&(e[n.replace("muc#roominfo_","")]=t.get("value")),e}),{});this.config.save(e)},async getDiscoInfoFeatures(){const e=await Bu.disco.getFeatures(this.get("jid")),t=_h.ROOM_FEATURES.reduce(((e,t)=>(e[t]=!1,e)),{fetched:(new Date).toISOString()});e.each((e=>{const n=e.get("var");n.startsWith("muc_")?t[n.replace("muc_","")]=!0:n===no.NS.MAM?t.mam_enabled=!0:t[n]=!0})),this.features.save(t)},addFieldValue(e){const t=e.getAttribute("type");if("fixed"===t)return e;const n=e.getAttribute("var").replace("muc#roomconfig_",""),r=this.get("roomconfig");if(n in r){let i;switch(t){case"boolean":i=[r[n]?1:0];break;case"list-multi":i=r[n];break;default:i=[r[n]]}e.innerHTML=i.map((e=>Ws("value").t(e))).join("")}return e},async autoConfigureChatRoom(){const e=await this.fetchRoomConfiguration(),t=So()("field",e).map((e=>this.addFieldValue(e)));if(t.length)return this.sendConfiguration(t)},fetchRoomConfiguration(){return Bu.sendIQ(Qs({to:this.get("jid"),type:"get"}).c("query",{xmlns:no.NS.MUC_OWNER}))},sendConfiguration(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=Qs({to:this.get("jid"),type:"set"}).c("query",{xmlns:no.NS.MUC_OWNER}).c("x",{xmlns:no.NS.XFORM,type:"submit"});return e.forEach((e=>t.cnode(e).up())),Bu.sendIQ(t)},onCommandError(e){const{__:t}=pu;Gc.fatal(e);const n=t("Sorry, an error happened while running the command.")+" "+t("Check your browser's developer console for details.");this.createMessage({message:n,type:"error"})},getNickOrJIDFromCommandArgs(e){const{__:t}=pu;if(Og.isValidJID(e.trim()))return e.trim();e.startsWith("@")||(e="@"+e);const[n,r]=this.parseTextForReferences(e);if(!r.length){const e=t("Error: couldn't find a groupchat participant based on your arguments");return void this.createMessage({message:e,type:"error"})}if(r.length>1){const e=t("Error: found multiple groupchat participant based on your arguments");return void this.createMessage({message:e,type:"error"})}const i=r.pop().value,s=e.split(i,2)[1];if(!s||s.startsWith(" "))return i;{const e=t("Error: couldn't find a groupchat participant based on your arguments");this.createMessage({message:e,type:"error"})}},validateRoleOrAffiliationChangeArgs(e,t){const{__:n}=pu;if(!t){const t=n('Error: the "%1$s" command takes two arguments, the user\'s nickname and optionally a reason.',e);return this.createMessage({message:t,type:"error"}),!1}return!0},getAllowedCommands(){let e=["clear","help","me","nick","register"];(this.config.get("changesubject")||["owner","admin"].includes(this.getOwnAffiliation()))&&(e=[...e,"subject","topic"]);const t=this.occupants.findWhere({jid:pu.bare_jid});return this.verifyAffiliations(["owner"],t,!1)?e=e.concat(jg).concat(kg):this.verifyAffiliations(["admin"],t,!1)&&(e=e.concat(kg)),this.verifyRoles(["moderator"],t,!1)?e=e.concat(Rg).concat(Mg):this.verifyRoles(["visitor","participant","moderator"],t,!1)||(e=e.concat(Mg)),e.sort(),Array.isArray(Bu.settings.get("muc_disable_slash_commands"))?e.filter((e=>!Bu.settings.get("muc_disable_slash_commands").includes(e))):e},verifyAffiliations(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const{__:r}=pu;if(!Array.isArray(e))throw new TypeError("affiliations must be an Array");if(!e.length)return!0;if(t=t||this.occupants.findWhere({jid:pu.bare_jid})){const n=t.get("affiliation");if(e.includes(n))return!0}if(n){const e=r("Forbidden: you do not have the necessary affiliation in order to do that.");this.createMessage({message:e,type:"error"})}return!1},verifyRoles(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const{__:r}=pu;if(!Array.isArray(e))throw new TypeError("roles must be an Array");if(!e.length)return!0;if(t=t||this.occupants.findWhere({jid:pu.bare_jid})){const n=t.get("role");if(e.includes(n))return!0}if(n){const e=r("Forbidden: you do not have the necessary role in order to do that.");this.createMessage({message:e,type:"error",is_ephemeral:2e4})}return!1},getOwnRole(){return this.getOwnOccupant()?.attributes?.role},getOwnAffiliation(){return this.getOwnOccupant()?.attributes?.affiliation||"none"},getOwnOccupant(){return this.occupants.getOwnOccupant()},async setNickname(e){if(Bu.settings.get("auto_register_muc_nickname")&&await Bu.disco.supports(no.NS.MUC_REGISTER,this.get("jid"))){const t=this.get("nick");this.set({nick:e});try{await this.registerNickname()}catch(e){const{__:n}=pu;Gc.error(e);const r=n("Error: couldn't register new nickname in members only room");return this.createMessage({message:r,type:"error",is_ephemeral:!0}),void this.set({nick:t})}}const t=no.getBareJidFromJid(this.get("jid"));Bu.send(Vs({from:pu.connection.jid,to:`${t}/${e}`,id:Fc()}).tree())},setRole(e,t,n,r,i){const s=Ws("item",{nick:e.get("nick"),role:t}),o=Qs({to:this.get("jid"),type:"set"}).c("query",{xmlns:no.NS.MUC_ADMIN}).cnode(s.node);return null!==n&&o.c("reason",n),Bu.sendIQ(o).then(r).catch(i)},getOccupant(e){return Og.isValidJID(e)?this.getOccupantByJID(e):this.getOccupantByNickname(e)},getOccupantsWithRole(e){return this.getOccupantsSortedBy("nick").filter((t=>t.get("role")===e)).map((e=>({jid:e.get("jid"),nick:e.get("nick"),role:e.get("role")})))},getOccupantsWithAffiliation(e){return this.getOccupantsSortedBy("nick").filter((t=>t.get("affiliation")===e)).map((e=>({jid:e.get("jid"),nick:e.get("nick"),affiliation:e.get("affiliation")})))},getOccupantsSortedBy(e){return Array.from(this.occupants.models).sort(((t,n)=>t.get(e)<n.get(e)?-1:t.get(e)>n.get(e)?1:0))},async updateMemberLists(e){const t=this.get("jid"),n=await Promise.all(["member","admin","owner"].map((e=>Ig(e,t)))),r=n.reduce(((e,t)=>Og.isErrorObject(t)?e:[...t,...e]),[]);await Cg(t,Tg(!0,!1,e,r)),await this.occupants.fetchMembers()},async getAndPersistNickname(e){return(e=e||this.get("nick")||await this.getReservedNick()||pu.getDefaultMUCNickname())&&Dc(this,{nick:e},{silent:!0}),e},async getReservedNick(){const e=Qs({to:this.get("jid"),from:pu.connection.jid,type:"get"}).c("query",{xmlns:no.NS.DISCO_INFO,node:"x-roomuser-item"}),t=await Bu.sendIQ(e,null,!1);if(Og.isErrorObject(t))throw t;const n=t?.querySelector('query[node="x-roomuser-item"] identity');return n?n.getAttribute("name"):null},async registerNickname(){const{__:e}=pu,t=this.get("nick"),n=this.get("jid");let r,i;try{r=await Bu.sendIQ(Qs({to:n,type:"get"}).c("query",{xmlns:no.NS.MUC_REGISTER}))}catch(t){return So()(`not-allowed[xmlns="${no.NS.STANZAS}"]`,t).length?i=e("You're not allowed to register yourself in this groupchat."):So()(`registration-required[xmlns="${no.NS.STANZAS}"]`,t).length&&(i=e("You're not allowed to register in this groupchat because it's members-only.")),Gc.error(t),i}const s=So()("field required",r).map((e=>e.parentElement));if(s.length>1&&"muc#register_roomnick"!==s[0].getAttribute("var"))return Gc.error(`Can't register the user register in the groupchat ${n} due to the required fields`);try{await Bu.sendIQ(Qs({to:n,type:"set"}).c("query",{xmlns:no.NS.MUC_REGISTER}).c("x",{xmlns:no.NS.XFORM,type:"submit"}).c("field",{var:"FORM_TYPE"}).c("value").t("http://jabber.org/protocol/muc#register").up().up().c("field",{var:"muc#register_roomnick"}).c("value").t(t))}catch(t){return So()(`service-unavailable[xmlns="${no.NS.STANZAS}"]`,t).length?i=e("Can't register your nickname in this groupchat, it doesn't support registration."):So()(`bad-request[xmlns="${no.NS.STANZAS}"]`,t).length&&(i=e("Can't register your nickname in this groupchat, invalid data form supplied.")),Gc.error(i),Gc.error(t),i}},async unregisterNickname(){if("unregister"===Bu.settings.get("auto_register_muc_nickname"))try{await Bu.disco.supports(no.NS.MUC_REGISTER,this.get("jid"))&&await this.sendUnregistrationIQ()}catch(e){Gc.error(e)}},sendUnregistrationIQ(){const e=Qs({to:this.get("jid"),type:"set"}).c("query",{xmlns:no.NS.MUC_REGISTER}).c("remove");return Bu.sendIQ(e).catch((e=>Gc.error(e)))},updateOccupantsOnPresence(e){const t=function(e,t){const n=e.getAttribute("from"),r=e.getAttribute("type"),i={is_me:!!e.querySelector("status[code='110']"),from:n,occupant_id:wg(e,t),nick:mg.getResourceFromJid(n),type:r,states:[],hats:[],show:"unavailable"!==r?"online":"offline"};return Array.from(e.children).forEach((e=>{e.matches("status")?i.status=e.textContent||null:e.matches("show")?i.show=e.textContent||"online":e.matches("x")&&e.getAttribute("xmlns")===mg.NS.MUC_USER?Array.from(e.children).forEach((e=>{"item"===e.nodeName?(i.affiliation=e.getAttribute("affiliation"),i.role=e.getAttribute("role"),i.jid=e.getAttribute("jid"),i.nick=e.getAttribute("nick")||i.nick):"status"==e.nodeName&&e.getAttribute("code")&&i.states.push(e.getAttribute("code"))})):e.matches("x")&&e.getAttribute("xmlns")===mg.NS.VCARDUPDATE?i.image_hash=e.querySelector("photo")?.textContent:e.matches("hats")&&e.getAttribute("xmlns")===mg.NS.MUC_HATS&&(i.hats=Array.from(e.children).map((e=>e.matches("hat")&&{title:e.getAttribute("title"),uri:e.getAttribute("uri")})))})),i}(e,this);if("error"===t.type||!t.jid&&!t.nick&&!t.occupant_id)return!0;const n=this.occupants.findOccupant(t);if("unavailable"===t.type&&n&&!t.states.includes(_h.MUC_NICK_CHANGED_CODE)&&!["admin","owner","member"].includes(t.affiliation))return n.set(t),void n.destroy();const r=t.jid||"",i={...t,jid:no.getBareJidFromJid(r)||n?.attributes?.jid,resource:no.getResourceFromJid(r)||n?.attributes?.resource};if(t.is_me){let e=!1;t.states.includes(_h.MUC_NICK_CHANGED_CODE)&&(e=!0,this.set("nick",t.nick)),this.features.get(no.NS.OCCUPANTID)&&this.get("occupant-id")!==t.occupant_id&&(e=!0,this.set("occupant_id",t.occupant_id)),e&&this.save()}n?n.save(i):this.occupants.create(i)},fetchFeaturesIfConfigurationChanged(e){const t=["104","170","171","172","173","174"];So()("status",e).filter((e=>t.includes(e.getAttribute("status")))).length&&this.refreshDiscoInfo()},isSameUser(e,t){const n=no.getBareJidFromJid(e),r=no.getBareJidFromJid(t),i=no.getResourceFromJid(e),s=no.getResourceFromJid(t);if(Og.isSameBareJID(e,t))return n!==this.get("jid")||i===s;return(n===this.get("jid")?this.occupants.findOccupant({nick:i}):this.occupants.findOccupant({jid:n}))===(r===this.get("jid")?this.occupants.findOccupant({nick:s}):this.occupants.findOccupant({jid:r}))},async isSubjectHidden(){return(await Bu.user.settings.get("mucs_with_hidden_subject",[])).includes(this.get("jid"))},async toggleSubjectHiddenState(){const e=this.get("jid"),t=await Bu.user.settings.get("mucs_with_hidden_subject",[]);t.includes(this.get("jid"))?Bu.user.settings.set("mucs_with_hidden_subject",t.filter((t=>t!==e))):Bu.user.settings.set("mucs_with_hidden_subject",[...t,e])},async handleSubjectChange(e){const t=pu.__;if("string"==typeof e.subject&&!e.thread&&!e.message){const n=e.subject,r=e.nick;if(Dc(this,{subject:{author:r,text:e.subject||""}}),!e.is_delayed&&r){const i=t(n?"Topic set by %1$s":"Topic cleared by %1$s",r),s=this.messages.last();s?.get("nick")===e.nick&&"info"===s?.get("type")&&s?.get("message")===i||this.createMessage({message:i,nick:e.nick,type:"info",is_ephemeral:!0}),await this.isSubjectHidden()&&this.toggleSubjectHiddenState()}return!0}return!1},setSubject(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";Bu.send(Gs({to:this.get("jid"),from:pu.connection.jid,type:"groupchat"}).c("subject",{xmlns:"jabber:client"}).t(e).tree())},ignorableCSN(e){return e.chat_state&&!e.body&&(e.is_delayed||this.isOwnMessage(e))},isOwnMessage(e){let t;return t=tg(e)?e.getAttribute("from"):e instanceof pu.Message?e.get("from"):e.from,no.getResourceFromJid(t)==this.get("nick")},getUpdatedMessageAttributes(e,t){const n={...pu.ChatBox.prototype.getUpdatedMessageAttributes.call(this,e,t),...cs(t,["from_muc","occupant_id"])};if(this.isOwnMessage(t)){const r=Object.keys(t).filter((e=>e.startsWith("stanza_id")));Object.assign(n,cs(t,r)),e.get("received")||(n.received=(new Date).toISOString())}return n},async isJoined(){return this.isEntered()?(Bu.connection.connected()||await new Promise((e=>Bu.listen.once("reconnected",e))),Bu.ping(`${this.get("jid")}/${this.get("nick")}`)):(Gc.info(`isJoined: not pinging MUC ${this.get("jid")} since we're not entered`),!1)},async sendStatusPresence(e,t,n){if(this.session.get("connection_status")===pg.ENTERED){const r=await pu.xmppstatus.constructPresence(e,this.getRoomJIDAndNick(),t);n?.map((e=>e?.tree()??e)).forEach((e=>r.cnode(e).up())),Bu.send(r)}},async rejoinIfNecessary(){return this.isRAICandidate()?(Gc.debug(`rejoinIfNecessary: not rejoining hidden MUC "${this.get("jid")}" since we're using RAI`),!0):await this.isJoined()?void 0:(this.rejoin(),!0)},async shouldShowErrorMessage(e){if("Decryption"===e.error_type){if("Message key not found. The counter was repeated or the key was not filled."===e.error_message)return!1;if("not-encrypted-for-this-device"===e.error_condition)return!1}else if("not-acceptable"===e.error_condition&&await this.rejoinIfNecessary())return!1;return pu.ChatBox.prototype.shouldShowErrorMessage.call(this,e)},findDanglingModeration(e){if(!this.messages.length)return null;if(this.messages.last().get("time")>e.time){const t=Array.from(this.messages.models),n=e[`stanza_id ${this.get("jid")}`];return n?(t.reverse(),t.find((e=>{let{attributes:t}=e;return"retracted"===t.moderated&&t.moderated_id===n&&t.moderated_by}))):null}},async handleModeration(e){const t=["editable","moderated","moderated_by","moderated_id","moderation_reason"];if("retracted"===e.moderated){const n={};n[`stanza_id ${this.get("jid")}`]=e.moderated_id;const r=this.messages.findWhere(n);return r?(r.save(cs(e,t)),!0):(e.dangling_moderation=!0,await this.createMessage(e),!0)}{const n=this.findDanglingModeration(e);if(n){const r=cs(n.attributes,t),i=Object.assign({dangling_moderation:!1},e,r);return delete i.id,n.save(i),!0}}return!1},getNotificationsText(){const{__:e}=pu,t=this.notifications.toJSON(),n=Bu.settings.get("muc_show_info_messages").filter((e=>_h.MUC_ROLE_CHANGES_LIST.includes(e))),r=Bu.settings.get("muc_show_info_messages").filter((e=>_h.MUC_TRAFFIC_STATES_LIST.includes(e)));return[..._h.CHAT_STATES,...r,...n].reduce(((n,r)=>{const i=t[r];if(!i?.length)return n;const s=i.map((e=>this.getOccupant(e)?.getDisplayName()||e));if(1===s.length){if("composing"===r)return`${n}${e("%1$s is typing",s[0])}\n`;if("paused"===r)return`${n}${e("%1$s has stopped typing",s[0])}\n`;if(r===pu.GONE)return`${n}${e("%1$s has gone away",s[0])}\n`;if("entered"===r)return`${n}${e("%1$s has entered the groupchat",s[0])}\n`;if("exited"===r)return`${n}${e("%1$s has left the groupchat",s[0])}\n`;if("op"===r)return`${n}${e("%1$s is now a moderator",s[0])}\n`;if("deop"===r)return`${n}${e("%1$s is no longer a moderator",s[0])}\n`;if("voice"===r)return`${n}${e("%1$s has been given a voice",s[0])}\n`;if("mute"===r)return`${n}${e("%1$s has been muted",s[0])}\n`}else if(s.length>1){let t;if(s.length>3)t=`${Array.from(s).slice(0,2).join(", ")} and others`;else{const n=s.pop();t=e("%1$s and %2$s",s.join(", "),n)}if("composing"===r)return`${n}${e("%1$s are typing",t)}\n`;if("paused"===r)return`${n}${e("%1$s have stopped typing",t)}\n`;if(r===pu.GONE)return`${n}${e("%1$s have gone away",t)}\n`;if("entered"===r)return`${n}${e("%1$s have entered the groupchat",t)}\n`;if("exited"===r)return`${n}${e("%1$s have left the groupchat",t)}\n`;if("op"===r)return`${n}${e("%1$s are now moderators",s[0])}\n`;if("deop"===r)return`${n}${e("%1$s are no longer moderators",s[0])}\n`;if("voice"===r)return`${n}${e("%1$s have been given voices",s[0])}\n`;if("mute"===r)return`${n}${e("%1$s have been muted",s[0])}\n`}return n}),"")},removeNotification(e,t){const n=this.notifications.toJSON();(t=Array.isArray(t)?t:[t]).forEach((t=>{const r=Array.from(n[t]||[]);if(r.includes(e)){const n=r.indexOf(e);r.splice(n,1),this.notifications.set(t,Array.from(r))}}))},updateNotifications(e,t){const n=this.notifications.toJSON(),r=n[t]||[];if(r.includes(e))return;const i=(i,s)=>(i[s]=s===t?[...r,e]:(n[s]||[]).filter((t=>t!==e)),i),s=_h.CHAT_STATES.reduce(i,{}),o=_h.MUC_TRAFFIC_STATES_LIST.reduce(i,{}),a=_h.MUC_ROLE_CHANGES_LIST.reduce(i,{});this.notifications.set(Object.assign(s,o,a)),window.setTimeout((()=>this.removeNotification(e,t)),1e4)},handleMetadataFastening(e){if(e.ogp_for_id){if(e.from!==this.get("jid"))return!1;const t=this.messages.findWhere({origin_id:e.ogp_for_id});if(t){const n=t.get("ogp_metadata")||[];if(n.filter((t=>t["og:url"]===e["og:url"])).length)return!1;const r=[...n,cs(e,Dg)];return t.save("ogp_metadata",r),!0}}return!1},handleMEPNotification(e){return!(e.from!==this.get("jid")||!e.activities)&&(e.activities?.forEach((t=>{const n=Object.assign(e,t);this.createMessage(n),Bu.trigger("message",{attrs:n,chatbox:this})})),!!e.activities.length)},getDuplicateMessage(e){return e.activities?.length?this.messages.findWhere({type:"mep",msgid:e.msgid}):pu.ChatBox.prototype.getDuplicateMessage.call(this,e)},async onMessage(e){if(e=await e,Og.isErrorObject(e))return e.stanza&&Gc.error(e.stanza),Gc.error(e.message);if("error"===e.type&&!await this.shouldShowErrorMessage(e))return;const t=this.getDuplicateMessage(e);if(t)"groupchat"===t.get("type")&&this.updateMessage(t,e);else if(!(e.receipt_id||e.is_marker||this.ignorableCSN(e)))if(this.handleMetadataFastening(e)||this.handleMEPNotification(e)||await this.handleRetraction(e)||await this.handleModeration(e)||await this.handleSubjectChange(e))e.nick&&this.removeNotification(e.nick,["composing","paused"]);else if(this.setEditable(e,e.time),e.chat_state&&this.updateNotifications(e.nick,e.chat_state),Og.shouldCreateGroupchatMessage(e)){const t=await Ah(this,e)||await this.createMessage(e);this.removeNotification(e.nick,["composing","paused"]),this.handleUnreadMessage(t)}},handleModifyError(e){const t=e.querySelector("error text")?.textContent;if(t)if(this.session.get("connection_status")===pg.CONNECTING)this.setDisconnectionState(t);else{const e={type:"error",message:t,is_ephemeral:!0};this.createMessage(e)}},handleDisconnection(e){const t=null!==e.querySelector("status[code='110']"),n=So()(`x[xmlns="${no.NS.MUC_USER}"]`,e).pop();if(!n)return;const r=Object.keys(pu.muc.disconnect_messages),i=So()("status",n).map((e=>e.getAttribute("code"))).filter((e=>r.includes(e)));if(!(t&&i.length>0))return;const s=n.querySelector("item"),o=s?s.querySelector("reason")?.textContent:void 0,a=s?s.querySelector("actor")?.getAttribute("nick"):void 0,c=pu.muc.disconnect_messages[i[0]],u=i.includes("301")?pg.BANNED:pg.DISCONNECTED;this.setDisconnectionState(c,o,a,u)},getActionInfoMessage(e,t,n){const r=pu.__;return"301"===e?n?r("%1$s has been banned by %2$s",t,n):r("%1$s has been banned",t):"303"===e?r("%1$s's nickname has changed",t):"307"===e?n?r("%1$s has been kicked out by %2$s",t,n):r("%1$s has been kicked out",t):"321"===e?r("%1$s has been removed because of an affiliation change",t):"322"===e?r("%1$s has been removed for not being a member",t):void 0},createAffiliationChangeMessage(e){const t=pu.__,n=e._previousAttributes.affiliation;if(!n)return;const r=e.get("affiliation");"admin"===n&&pu.isInfoVisible(_h.AFFILIATION_CHANGES.EXADMIN)?this.createMessage({type:"info",message:t("%1$s is no longer an admin of this groupchat",e.get("nick"))}):"owner"===n&&pu.isInfoVisible(_h.AFFILIATION_CHANGES.EXOWNER)?this.createMessage({type:"info",message:t("%1$s is no longer an owner of this groupchat",e.get("nick"))}):"outcast"===n&&pu.isInfoVisible(_h.AFFILIATION_CHANGES.EXOUTCAST)&&this.createMessage({type:"info",message:t("%1$s is no longer banned from this groupchat",e.get("nick"))}),"none"===r&&"member"===n&&pu.isInfoVisible(_h.AFFILIATION_CHANGES.EXMEMBER)&&this.createMessage({type:"info",message:t("%1$s is no longer a member of this groupchat",e.get("nick"))}),"member"===r&&pu.isInfoVisible(_h.AFFILIATION_CHANGES.MEMBER)?this.createMessage({type:"info",message:t("%1$s is now a member of this groupchat",e.get("nick"))}):("admin"===r&&pu.isInfoVisible(_h.AFFILIATION_CHANGES.ADMIN)||"owner"==r&&pu.isInfoVisible(_h.AFFILIATION_CHANGES.OWNER))&&this.createMessage({type:"info",message:t("%1$s is now an %2$s of this groupchat",e.get("nick"),r)})},createRoleChangeMessage(e,t){if("none"===t||e.changed.affiliation)return;const n=e._previousAttributes.role;"moderator"===n&&pu.isInfoVisible(_h.MUC_ROLE_CHANGES.DEOP)?this.updateNotifications(e.get("nick"),_h.MUC_ROLE_CHANGES.DEOP):"visitor"===n&&pu.isInfoVisible(_h.MUC_ROLE_CHANGES.VOICE)&&this.updateNotifications(e.get("nick"),_h.MUC_ROLE_CHANGES.VOICE),"visitor"===e.get("role")&&pu.isInfoVisible(_h.MUC_ROLE_CHANGES.MUTE)?this.updateNotifications(e.get("nick"),_h.MUC_ROLE_CHANGES.MUTE):"moderator"===e.get("role")&&!["owner","admin"].includes(e.get("affiliation"))&&pu.isInfoVisible(_h.MUC_ROLE_CHANGES.OP)&&this.updateNotifications(e.get("nick"),_h.MUC_ROLE_CHANGES.OP)},createInfoMessage(e,t,n){const r=pu.__,i={type:"info",is_ephemeral:!0};if(pu.isInfoVisible(e)&&"110"!==e&&("100"!==e||n)){if(e in pu.muc.info_messages)i.message=pu.muc.info_messages[e];else if(!n&&$g.includes(e)){const n=no.getResourceFromJid(t.getAttribute("from")),r=So()(`x[xmlns="${no.NS.MUC_USER}"] item`,t).pop();i.actor=r?r.querySelector("actor")?.getAttribute("nick"):void 0,i.reason=r?r.querySelector("reason")?.textContent:void 0,i.message=this.getActionInfoMessage(e,n,i.actor)}else if(n&&e in pu.muc.new_nickname_messages){let n;"210"===e?n=no.getResourceFromJid(t.getAttribute("from")):"303"===e&&(n=So()(`x[xmlns="${no.NS.MUC_USER}"] item`,t).pop().getAttribute("nick")),this.save("nick",n),i.message=r(pu.muc.new_nickname_messages[e],n)}if(i.message){if("201"===e&&this.messages.findWhere(i))return;this.createMessage(i)}}},createInfoMessages(e){const t=So()(`x[xmlns="${no.NS.MUC_USER}"] status`,e).map((e=>e.getAttribute("code")));t.includes("333")&&t.includes("307")&&t.splice(t.indexOf("307"),1);const n=t.includes("110");t.forEach((t=>this.createInfoMessage(t,e,n)))},setDisconnectionState(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:pg.DISCONNECTED;this.session.save({connection_status:r,disconnection_actor:n,disconnection_message:e,disconnection_reason:t})},onNicknameClash(e){const t=pu.__;if(Bu.settings.get("muc_nickname_from_jid")){const t=e.getAttribute("from").split("/")[1];if(t===pu.getDefaultMUCNickname())this.join(t+"-2");else{const e=t.lastIndexOf("-"),n=t.substring(e+1,t.length);this.join(t.substring(0,e+1)+String(Number(n)+1))}}else this.save({nickname_validation_message:t("The nickname you chose is reserved or currently in use, please choose a different one.")}),this.session.save({connection_status:pg.NICKNAME_REQUIRED})},onErrorPresence(e){const t=pu.__,n=e.querySelector("error"),r=n.getAttribute("type"),i=So()(`text[xmlns="${no.NS.STANZAS}"]`,n).pop()?.textContent;if("modify"===r)this.handleModifyError(e);else if("auth"===r)if(So()(`not-authorized[xmlns="${no.NS.STANZAS}"]`,n).length&&(this.save({password_validation_message:i||t("Password incorrect")}),this.session.save({connection_status:pg.PASSWORD_REQUIRED})),n.querySelector("registration-required")){const e=t("You are not on the member list of this groupchat.");this.setDisconnectionState(e,i)}else n.querySelector("forbidden")&&this.setDisconnectionState(pu.muc.disconnect_messages[301],i,null,pg.BANNED);else if("cancel"===r)if(n.querySelector("not-allowed")){const e=t("You are not allowed to create new groupchats.");this.setDisconnectionState(e,i)}else if(n.querySelector("not-acceptable")){const e=t("Your nickname doesn't conform to this groupchat's policies.");this.setDisconnectionState(e,i)}else if(So()(`gone[xmlns="${no.NS.STANZAS}"]`,n).length){const e=So()(`gone[xmlns="${no.NS.STANZAS}"]`,n).pop()?.textContent.replace(/^xmpp:/,"").replace(/\?join$/,"");this.save({moved_jid:e,destroyed_reason:i}),this.session.save({connection_status:pg.DESTROYED})}else if(n.querySelector("conflict"))this.onNicknameClash(e);else if(n.querySelector("item-not-found")){const e=t("This groupchat does not (yet) exist.");this.setDisconnectionState(e,i)}else if(n.querySelector("service-unavailable")){const e=t("This groupchat has reached its maximum number of participants.");this.setDisconnectionState(e,i)}else if(n.querySelector("remote-server-not-found")){const e=t("Remote server not found");this.setDisconnectionState(e,i)}else if(n.querySelector("forbidden")){const e=t("You're not allowed to enter this groupchat");this.setDisconnectionState(e,i)}else{const e=t("An error happened while trying to enter this groupchat");this.setDisconnectionState(e,i)}},onPresenceFromMUCHost(e){if("error"===e.getAttribute("type")){const t=e.querySelector("error");"wait"===t?.getAttribute("type")&&t?.querySelector("resource-constraint")&&this.session.get("connection_status")===pg.DISCONNECTED&&this.rejoin()}},onPresence(e){if("error"===e.getAttribute("type"))return this.onErrorPresence(e);this.createInfoMessages(e),e.querySelector("status[code='110']")?(this.onOwnPresence(e),"none"!==this.getOwnRole()&&this.session.get("connection_status")===pg.CONNECTING&&this.session.save("connection_status",pg.CONNECTED)):this.updateOccupantsOnPresence(e)},async onOwnPresence(e){if(await this.occupants.fetched,"unavailable"===e.getAttribute("type"))return void this.handleDisconnection(e);const t=this.session.get("connection_status");t!==pg.ENTERED&&t!==pg.CLOSING?(this.session.save("connection_status",pg.ENTERED,{silent:!0}),this.updateOccupantsOnPresence(e),this.session.trigger("change:connection_status",this.session,t)):this.updateOccupantsOnPresence(e);e.querySelector("status[code='201']")&&(this.get("auto_configure")?await this.autoConfigureChatRoom().then((()=>this.refreshDiscoInfo())):Bu.settings.get("muc_instant_rooms")?await this.sendConfiguration().then((()=>this.refreshDiscoInfo())):this.session.save({view:_h.MUC.VIEWS.CONFIG}))},isUserMentioned(e){const t=this.get("nick");if(e.get("references").length){return e.get("references").filter((e=>"mention"===e.type)).map((e=>e.value)).includes(t)}return new RegExp(`\\b${t}\\b`).test(e.get("body"))},incrementUnreadMsgsCounter(e){const t={num_unread_general:this.get("num_unread_general")+1};0===this.get("num_unread_general")&&(t.first_unread_id=e.get("id")),this.isUserMentioned(e)&&(t.num_unread=this.get("num_unread")+1),this.save(t)},clearUnreadMsgCounter(){(this.get("num_unread_general")>0||this.get("num_unread")>0||this.get("has_activity"))&&this.sendMarkerForMessage(this.messages.last()),Dc(this,{has_activity:!1,num_unread:0,num_unread_general:0})}},Lg=Pg;const zg=class extends us{defaults(){return{hats:[],show:"offline",states:[]}}save(e,t,n){let r;return null==e?super.save(e,t,n):("object"==typeof e?(r=e,n=t):(r={})[e]=t,r.occupant_id&&(r.id=r.occupant_id),super.save(r,n))}getDisplayName(){return this.get("nick")||this.get("jid")}isMember(){return["admin","owner","member"].includes(this.get("affiliation"))}isModerator(){return["admin","owner"].includes(this.get("affiliation"))||"moderator"===this.get("role")}isSelf(){return this.get("states").includes("110")}},{Strophe:Ug,sizzle:Bg,u:Hg}=_h.env;function qg(){pu.connection.addHandler((e=>(pu.onDirectMUCInvitation(e),!0)),"jabber:x:conference","message")}function Jg(){return pu.chatboxes.filter((e=>e.get("type")===pu.CHATROOMS_TYPE)).forEach((e=>e.session.save({connection_status:_h.ROOMSTATUS.DISCONNECTED})))}async function Wg(e){if("visible"===e.state&&Bu.connection.connected()){(await Bu.rooms.get()).forEach((e=>e.rejoinIfNecessary()))}}async function Gg(e){if(!Hg.isValidMUCJID(e))return Gc.warn(`invalid jid "${e}" provided in url fragment`);await Bu.waitUntil("roomsAutoJoined"),Bu.settings.get("allow_bookmarks")&&await Bu.waitUntil("bookmarksInitialized"),Bu.rooms.open(e)}async function Qg(e){const t=Bg('x[xmlns="jabber:x:conference"]',e).pop(),n=Ug.getBareJidFromJid(e.getAttribute("from")),r=t.getAttribute("jid"),i=t.getAttribute("reason");let s;if(Bu.settings.get("auto_join_on_invite"))s=!0;else{const e=pu.roster.get(n)?.getDisplayName()??n;s=await Bu.hook("confirmDirectMUCInvitation",{contact:e,reason:i,jid:r},!1)}if(s){(await async function(e,t){t.type=pu.CHATROOMS_TYPE,t.id=e;const n=await Bu.rooms.get(e,t,!0);return n.maybeShow(!0),n}(r,{password:t.getAttribute("password")})).session.get("connection_status")===_h.ROOMSTATUS.DISCONNECTED&&pu.chatboxes.get(r).rejoin()}}function Vg(){if(!pu.xmppstatus)throw new Error("Can't call _converse.getDefaultMUCNickname before the statusInitialized has been fired.");const e=pu.xmppstatus.getNickname();return e||(Bu.settings.get("muc_nickname_from_jid")?Ug.unescapeNode(Ug.getNodeFromJid(pu.bare_jid)):void 0)}function Yg(e){return!!Bu.settings.get("muc_show_info_messages").includes(e)}async function Xg(){await Promise.all(Bu.settings.get("auto_join_rooms").map((e=>"string"==typeof e?pu.chatboxes.where({jid:e}).length?Promise.resolve():Bu.rooms.open(e):v(e)?Bu.rooms.open(e.jid,{...e}):(Gc.error('Invalid muc criteria specified for "auto_join_rooms"'),Promise.resolve())))),Bu.trigger("roomsAutoJoined")}function Kg(){Bu.disco.own.features.add(Ug.NS.MUC),Bu.settings.get("allow_muc_invitations")&&Bu.disco.own.features.add("jabber:x:conference")}function Zg(){pu.chatboxes.where({type:pu.CHATROOMS_TYPE}).forEach((e=>Dc(e.session,{connection_status:_h.ROOMSTATUS.DISCONNECTED})))}function ep(){window.addEventListener(pu.unloadevent,(()=>{!Bu.connection.isType("websocket")||Bu.settings.get("enable_smacks")&&pu.session.get("smacks_stream_id")||Jg()}))}function tp(){pu.connection.addHandler((e=>{const t=Ug.getBareJidFromJid(e.getAttribute("from"));return pu.chatboxes.get(t)||Bu.waitUntil("chatBoxesFetched").then((async()=>{const n=pu.chatboxes.get(t);n&&(await n.initialized,n.message_handler.run(e))})),!0}),null,"message","groupchat")}Object.assign(pu,{getAssignableRoles:function(e){let t=Bu.settings.get("modtools_disable_assign");return Array.isArray(t)||(t=t?og:[]),"moderator"===e.get("role")?og.filter((e=>!t.includes(e))):[]}});const{u:np}=_h.env;const rp=class extends Dd{model=zg;comparator(e,t){const n=e.get("role")||"none",r=t.get("role")||"none";if(ag[n]===ag[r]){const n=e.getDisplayName().toLowerCase(),r=t.getDisplayName().toLowerCase();return n<r?-1:n>r?1:0}return ag[n]<ag[r]?-1:1}create(e,t){return e.id||e instanceof us||(e.id=e.occupant_id||Fc()),super.create(e,t)}async fetchMembers(){if(!["member","admin","owner"].includes(this.getOwnOccupant()?.get("affiliation")))return;const e=function(){const e=Bu.settings.get("muc_fetch_members");return Array.isArray(e)?e:e?["member","admin","owner"]:[]}();if(0===e.length)return;const t=this.chatroom.get("jid"),n=await Promise.all(e.map((e=>Ig(e,t)))),r=n.reduce(((e,t)=>np.isErrorObject(t)?e:[...t,...e]),[]),i=e.filter((t=>!np.isErrorObject(n[e.indexOf(t)]))),s=r.map((e=>e.jid)).filter((e=>void 0!==e)),o=r.map((e=>!e.jid&&e.nick||void 0)).filter((e=>void 0!==e)),a=this.filter((e=>i.includes(e.get("affiliation"))&&!o.includes(e.get("nick"))&&!s.includes(e.get("jid"))));a.forEach((e=>{e.get("jid")!==pu.bare_jid&&("offline"===e.get("show")?e.destroy():e.save("affiliation",null))})),r.forEach((e=>{const t=this.findOccupant(e);t?t.save(e):this.create(e)})),Bu.trigger("membersFetched")}findOccupant(e){if(e.occupant_id)return this.get(e.occupant_id);const t=e.jid&&no.getBareJidFromJid(e.jid);return t&&this.findWhere({jid:t})||e.nick&&this.findWhere({nick:e.nick})}getOwnOccupant(){return this.findOccupant({jid:pu.bare_jid,occupant_id:this.chatroom.get("occupant_id")})}},ip={affiliations:{set:(e,t)=>(t=Array.isArray(t)?t:[t],Cg(e=Array.isArray(e)?e:[e],t))}},{u:sp}=_h.env,op={rooms:{create(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t="string"==typeof t?{nick:t}:t||{},!t.nick&&Bu.settings.get("muc_nickname_from_jid")&&(t.nick=no.getNodeFromJid(pu.bare_jid)),void 0===e)throw new TypeError("rooms.create: You need to provide at least one JID");return"string"==typeof e?Bu.rooms.get(sp.getJIDFromURI(e),t,!0):e.map((e=>Bu.rooms.get(sp.getJIDFromURI(e),t,!0)))},async open(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(await Bu.waitUntil("chatBoxesFetched"),void 0===e){const e="rooms.open: You need to provide at least one JID";throw Gc.error(e),new TypeError(e)}if("string"==typeof e){const r=await Bu.rooms.get(e,t,!0);return!t.hidden&&r?.maybeShow(n),r}{const r=await Promise.all(e.map((e=>Bu.rooms.get(e,t,!0))));return r.forEach((e=>!t.hidden&&e.maybeShow(n))),r}},async get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];async function r(e){e=sp.getJIDFromURI(e);let r=await Bu.chatboxes.get(e);return!r&&n?r=await Bu.chatboxes.create(e,t,pu.ChatRoom):(r=r&&r.get("type")===pu.CHATROOMS_TYPE?r:null,r&&Object.keys(t).length&&r.save(t)),r}if(await Bu.waitUntil("chatBoxesFetched"),void 0===e){return(await Bu.chatboxes.get()).filter((e=>e.get("type")===pu.CHATROOMS_TYPE))}return"string"==typeof e?r(e):Promise.all(e.map((e=>r(e))))}}},ap=["owner","admin","member","outcast","none"];_h.AFFILIATION_CHANGES=cg,_h.AFFILIATION_CHANGES_LIST=ug,_h.MUC_TRAFFIC_STATES=dg,_h.MUC_TRAFFIC_STATES_LIST=lg,_h.MUC_ROLE_CHANGES=hg,_h.MUC_ROLE_CHANGES_LIST=fg,_h.MUC={INFO_CODES:gg},_h.MUC_NICK_CHANGED_CODE="303",_h.ROOM_FEATURES=["passwordprotected","unsecured","hidden","publicroom","membersonly","open","persistent","temporary","nonanonymous","semianonymous","moderated","unmoderated","mam_enabled"],_h.ROOMSTATUS=pg;const{Strophe:cp}=_h.env;cp.addNamespace("MUC_ADMIN",cp.NS.MUC+"#admin"),cp.addNamespace("MUC_OWNER",cp.NS.MUC+"#owner"),cp.addNamespace("MUC_REGISTER","jabber:iq:register"),cp.addNamespace("MUC_ROOMCONF",cp.NS.MUC+"#roomconfig"),cp.addNamespace("MUC_USER",cp.NS.MUC+"#user"),cp.addNamespace("MUC_HATS","xmpp:prosody.im/protocol/hats:1"),cp.addNamespace("CONFINFO","urn:ietf:params:xml:ns:conference-info"),_h.plugins.add("converse-muc",{dependencies:["converse-chatboxes","converse-chat","converse-disco"],overrides:{ChatBoxes:{model(e,t){const{_converse:n}=this.__super__;return e&&e.type==n.CHATROOMS_TYPE?new n.ChatRoom(e,t):this.__super__.model.apply(this,arguments)}}},initialize(){const{__:e,___:t}=pu;if(Bu.settings.extend({allow_muc_invitations:!0,auto_join_on_invite:!1,auto_join_rooms:[],auto_register_muc_nickname:!1,hide_muc_participants:!1,locked_muc_domain:!1,modtools_disable_assign:!1,muc_clear_messages_on_leave:!0,muc_domain:void 0,muc_fetch_members:!0,muc_history_max_stanzas:void 0,muc_instant_rooms:!0,muc_nickname_from_jid:!1,muc_send_probes:!1,muc_show_info_messages:[..._h.MUC.INFO_CODES.visibility_changes,..._h.MUC.INFO_CODES.self,..._h.MUC.INFO_CODES.non_privacy_changes,..._h.MUC.INFO_CODES.muc_logging_changes,..._h.MUC.INFO_CODES.nickname_changes,..._h.MUC.INFO_CODES.disconnected,..._h.MUC.INFO_CODES.affiliation_changes,..._h.MUC.INFO_CODES.join_leave_events,..._h.MUC.INFO_CODES.role_changes],muc_show_logs_before_join:!1,muc_subscribe_to_rai:!1}),Bu.promises.add(["roomsAutoJoined"]),Bu.settings.get("locked_muc_domain")&&"string"!=typeof Bu.settings.get("muc_domain"))throw new Error("Config Error: it makes no sense to set locked_muc_domain to true when muc_domain is not set");_h.env.muc_utils={computeAffiliationsDelta:Tg},Object.assign(Bu,op),Object.assign(Bu.rooms,ip),pu.muc={info_messages:{100:e("This groupchat is not anonymous"),102:e("This groupchat now shows unavailable members"),103:e("This groupchat does not show unavailable members"),104:e("The groupchat configuration has changed"),170:e("Groupchat logging is now enabled"),171:e("Groupchat logging is now disabled"),172:e("This groupchat is now no longer anonymous"),173:e("This groupchat is now semi-anonymous"),174:e("This groupchat is now fully-anonymous"),201:e("A new groupchat has been created")},new_nickname_messages:{210:t("Your nickname has been automatically set to %1$s"),303:t("Your nickname has been changed to %1$s")},disconnect_messages:{301:e("You have been banned from this groupchat"),333:e("You have exited this groupchat due to a technical problem"),307:e("You have been kicked from this groupchat"),321:e("You have been removed from this groupchat because of an affiliation change"),322:e("You have been removed from this groupchat because the groupchat has changed to members-only and you're not a member"),332:e("You have been removed from this groupchat because the service hosting it is being shut down")}},pu.router.route("converse/room?jid=:jid",Gg),pu.ChatRoom=pu.ChatBox.extend(Lg),pu.ChatRoomMessage=pu.Message.extend(eg),pu.ChatRoomOccupants=rp,pu.ChatRoomOccupant=zg,pu.ChatRoomMessages=Dd.extend({model:pu.ChatRoomMessage,comparator:"time"}),Object.assign(pu,{getDefaultMUCNickname:Vg,isInfoVisible:Yg,onDirectMUCInvitation:Qg}),Bu.settings.get("allow_muc_invitations")&&(Bu.listen.on("connected",qg),Bu.listen.on("reconnected",qg)),Bu.listen.on("addClientFeatures",(()=>Bu.disco.own.features.add(`${cp.NS.CONFINFO}+notify`))),Bu.listen.on("addClientFeatures",Kg),Bu.listen.on("beforeResourceBinding",tp),Bu.listen.on("beforeTearDown",Zg),Bu.listen.on("chatBoxesFetched",Xg),Bu.listen.on("disconnected",Jg),Bu.listen.on("statusInitialized",ep),Bu.listen.on("windowStateChanged",Wg)}});const{Strophe:up}=_h.env,dp=us.extend({idAttribute:"jid",getDisplayName(){return up.xmlunescape(this.get("name"))}}),{Strophe:lp,$iq:hp,sizzle:fp}=_h.env,gp={model:dp,comparator:e=>e.get("name").toLowerCase(),async initialize(){this.on("add",(e=>this.openBookmarkedRoom(e).then((e=>this.markRoomAsBookmarked(e))).catch((e=>Gc.fatal(e))))),this.on("remove",this.markRoomAsUnbookmarked,this),this.on("remove",this.sendBookmarkStanza,this);const e=`converse.room-bookmarks${pu.bare_jid}`;this.fetched_flag=e+"fetched",pc(this,e),await this.fetchBookmarks(),Bu.trigger("bookmarksInitialized",this)},async openBookmarkedRoom(e){if(Bu.settings.get("muc_respect_autojoin")&&e.get("autojoin")){(await Bu.rooms.create(e.get("jid"),{nick:e.get("nick")})).maybeShow()}return e},fetchBookmarks(){const e=Ao();return window.sessionStorage.getItem(this.fetched_flag)?this.fetch({success:()=>e.resolve(),error:()=>e.resolve()}):this.fetchBookmarksFromServer(e),e},createBookmark(e){this.create(e),this.sendBookmarkStanza().catch((t=>this.onBookmarkError(t,e)))},sendBookmarkStanza(){const e=hp({type:"set",from:pu.connection.jid}).c("pubsub",{xmlns:lp.NS.PUBSUB}).c("publish",{node:lp.NS.BOOKMARKS}).c("item",{id:"current"}).c("storage",{xmlns:lp.NS.BOOKMARKS});return this.forEach((t=>{e.c("conference",{name:t.get("name"),autojoin:t.get("autojoin"),jid:t.get("jid")}).c("nick").t(t.get("nick")).up().up()})),e.up().up().up(),e.c("publish-options").c("x",{xmlns:lp.NS.XFORM,type:"submit"}).c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t("http://jabber.org/protocol/pubsub#publish-options").up().up().c("field",{var:"pubsub#persist_items"}).c("value").t("true").up().up().c("field",{var:"pubsub#access_model"}).c("value").t("whitelist"),Bu.sendIQ(e)},onBookmarkError(e,t){const{__:n}=pu;Gc.error("Error while trying to add bookmark"),Gc.error(e),Bu.alert("error",n("Error"),[n("Sorry, something went wrong while trying to save your bookmark.")]),this.get(t.jid)?.destroy()},fetchBookmarksFromServer(e){const t=hp({from:pu.connection.jid,type:"get"}).c("pubsub",{xmlns:lp.NS.PUBSUB}).c("items",{node:lp.NS.BOOKMARKS});Bu.sendIQ(t).then((t=>this.onBookmarksReceived(e,t))).catch((t=>this.onBookmarksReceivedError(e,t)))},markRoomAsBookmarked(e){const t=pu.chatboxes.get(e.get("jid"));t?.save("bookmarked",!0)},markRoomAsUnbookmarked(e){const t=pu.chatboxes.get(e.get("jid"));t?.save("bookmarked",!1)},createBookmarksFromStanza(e){const t=lp.NS.BOOKMARKS;fp(`items[node="${t}"] item storage[xmlns="${t}"] conference`,e).forEach((e=>{const t=e.getAttribute("jid"),n=this.get(t),r={jid:t,name:e.getAttribute("name")||t,autojoin:"true"===e.getAttribute("autojoin"),nick:e.querySelector("nick")?.textContent||""};n?n.save(r):this.create(r)}))},onBookmarksReceived(e,t){if(this.createBookmarksFromStanza(t),window.sessionStorage.setItem(this.fetched_flag,!0),void 0!==e)return e.resolve()},onBookmarksReceivedError(e,t){const{__:n}=pu;if(null===t)Gc.error("Error: timeout while fetching bookmarks"),Bu.alert("error",n("Timeout Error"),[n("The server did not return your bookmarks within the allowed time. You can reload the page to request them again.")]);else{if(e)return t.querySelector('error[type="cancel"] item-not-found')?(window.sessionStorage.setItem(this.fetched_flag,!0),e.resolve()):(Gc.error("Error while fetching bookmarks"),Gc.error(t),e.reject(new Error("Could not fetch bookmarks")));Gc.error("Error while fetching bookmarks"),Gc.error(t)}},async getUnopenedBookmarks(){return await Bu.waitUntil("bookmarksInitialized"),await Bu.waitUntil("chatBoxesFetched"),this.filter((e=>!pu.chatboxes.get(e.get("jid"))))}},pp=gp,{Strophe:mp,sizzle:vp}=_h.env;async function _p(){Bu.settings.get("allow_bookmarks")&&await async function(){const e=await Bu.disco.getIdentity("pubsub","pep",pu.bare_jid);return Bu.settings.get("allow_public_bookmarks")?!!e:Bu.disco.supports(mp.NS.PUBSUB+"#publish-options",pu.bare_jid)}()&&(pu.bookmarks=new pu.Bookmarks)}function yp(e){return vp(`event[xmlns="${mp.NS.PUBSUB}#event"] items[node="${mp.NS.BOOKMARKS}"]`,e).length&&Bu.waitUntil("bookmarksInitialized").then((()=>pu.bookmarks.createBookmarksFromStanza(e))).catch((e=>Gc.fatal(e))),!0}const{Strophe:bp}=_h.env;bp.addNamespace("BOOKMARKS","storage:bookmarks"),_h.plugins.add("converse-bookmarks",{dependencies:["converse-chatboxes","converse-muc"],overrides:{ChatRoom:{getDisplayName(){const{_converse:e,getDisplayName:t}=this.__super__,n=this.get("bookmarked")?e.bookmarks?.get(this.get("jid")):null;return n?.get("name")||t.apply(this,arguments)},getAndPersistNickname(e){var t;return e=e||(t=this.get("jid"),Bu.settings.get("allow_bookmarks")?pu.bookmarks?.get(t)?.get("nick"):null),this.__super__.getAndPersistNickname.call(this,e)}}},initialize(){Bu.settings.extend({allow_bookmarks:!0,allow_public_bookmarks:!1,muc_respect_autojoin:!0}),Bu.promises.add("bookmarksInitialized"),pu.Bookmark=dp,pu.Bookmarks=Dd.extend(pp),Bu.listen.on("addClientFeatures",(()=>{Bu.settings.get("allow_bookmarks")&&Bu.disco.own.features.add(bp.NS.BOOKMARKS+"+notify")})),Bu.listen.on("clearSession",(()=>{pu.bookmarks&&(pu.bookmarks.clearStore({silent:!0}),window.sessionStorage.removeItem(pu.bookmarks.fetched_flag),delete pu.bookmarks)})),Bu.listen.on("connected",(async()=>{const{connection:e}=pu;e.addHandler(yp,null,"message","headline",null,pu.bare_jid),await Promise.all([Bu.waitUntil("chatBoxesFetched")]),_p()}))}});const{Strophe:wp}=_h.env,Sp="converse.bosh-session";_h.plugins.add("converse-bosh",{enabled:()=>!pu.api.settings.get("blacklisted_plugins").includes("converse-bosh"),initialize(){Bu.settings.extend({bosh_service_url:void 0,prebind_url:null}),pu.startNewPreboundBOSHSession=function(){if(!Bu.settings.get("prebind_url"))throw new Error("startNewPreboundBOSHSession: If you use prebind then you MUST supply a prebind_url");const e=new XMLHttpRequest;e.open("GET",Bu.settings.get("prebind_url"),!0),e.setRequestHeader("Accept","application/json, text/javascript"),e.onload=async function(){if(e.status>=200&&e.status<400){const t=JSON.parse(e.responseText),n=await Du(t.jid);pu.connection.attach(n,t.sid,t.rid,pu.connection.onConnectStatusChanged,59)}else e.onerror()},e.onerror=function(){delete pu.connection,Bu.trigger("noResumeableBOSHSession",pu)},e.send()},pu.restoreBOSHSession=async function(){const e=(await async function(){const e=Sp;if(pu.bosh_session||(pu.bosh_session=new us({id:e}),pu.bosh_session.browserStorage=pu.createStore(e,"session"),await new Promise((e=>pu.bosh_session.fetch({success:e,error:e})))),pu.jid){if(pu.bosh_session.get("jid")!==pu.jid){const e=await Du(pu.jid);pu.bosh_session.clear({silent:!0}),pu.bosh_session.save({jid:e})}}else{const e=pu.bosh_session.get("jid");e&&await Du(e)}return pu.bosh_session}()).get("jid");if(e&&pu.connection._proto instanceof wp.Bosh)try{return pu.connection.restore(e,pu.connection.onConnectStatusChanged),!0}catch(t){return!pu.isTestEnv()&&Gc.warn("Could not restore session for jid: "+e+" Error message: "+t.message),!1}return!1},Bu.listen.on("clearSession",(()=>{if(void 0===pu.bosh_session){const e=Sp;sessionStorage.removeItem(e),sessionStorage.removeItem(`${e}-${e}`)}else pu.bosh_session.destroy(),delete pu.bosh_session})),Bu.listen.on("setUserJID",(()=>{void 0!==pu.bosh_session&&pu.bosh_session.save({jid:pu.jid})})),Bu.listen.on("addClientFeatures",(()=>Bu.disco.own.features.add(wp.NS.BOSH))),Object.assign(Bu,{tokens:{get:e=>void 0===pu.connection?null:"rid"===e.toLowerCase()?pu.connection.rid||pu.connection._proto.rid:"sid"===e.toLowerCase()?pu.connection.sid||pu.connection._proto.sid:void 0}})}});const{u:Ap}=_h.env;function Ep(e){return new TextEncoder("utf-8").encode(e).buffer}function xp(e){return btoa(new Uint8Array(e).reduce(((e,t)=>e+String.fromCharCode(t)),""))}Object.assign(Ap,{arrayBufferToHex:function(e){return Array.prototype.map.call(new Uint8Array(e),(e=>("00"+e.toString(16)).slice(-2))).join("")},arrayBufferToString:function(e){return new TextDecoder("utf-8").decode(e)},stringToArrayBuffer:Ep,arrayBufferToBase64:xp,base64ToArrayBuffer:function(e){const t=window.atob(e),n=t.length,r=new Uint8Array(n);for(let e=0;e<n;e++)r[e]=t.charCodeAt(e);return r.buffer}});const{Strophe:Np,$build:Ip}=_h.env;function Cp(e,t){return e.sort(((e,n)=>e[t]>n[t]?-1:1))}async function Tp(){const e=pu.api.disco.own.identities.get(),t=pu.api.disco.own.features.get();e.length>1&&(Cp(e,"category"),Cp(e,"type"),Cp(e,"lang"));let n=e.reduce(((e,t)=>`${e}${t.category}/${t.type}/${t?.lang??""}/${t.name}<`),"");t.sort(),n=t.reduce(((e,t)=>`${e}${t}<`),n);return xp(await crypto.subtle.digest("SHA-1",Ep(n)))}async function Op(e){const t=await async function(){return Ip("c",{xmlns:Np.NS.CAPS,hash:"sha-1",node:"https://conversejs.org",ver:await Tp()}).tree()}();return e.root().cnode(t).up(),e}const{Strophe:jp}=_h.env;jp.addNamespace("CAPS","http://jabber.org/protocol/caps"),_h.plugins.add("converse-caps",{dependencies:["converse-status"],initialize(){Bu.listen.on("constructedPresence",((e,t)=>Op(t))),Bu.listen.on("constructedMUCPresence",((e,t)=>Op(t)))}});const kp=Dd.extend({comparator:"time_opened",model:(e,t)=>new pu.ChatBox(e,t),onChatBoxesFetched(e){e.filter((e=>!e.isValid())).forEach((e=>e.destroy())),Bu.trigger("chatBoxesFetched")},onConnected(e){e||(pc(this,`converse.chatboxes-${pu.bare_jid}`),this.fetch({add:!0,success:e=>this.onChatBoxesFetched(e)}))}}),Rp=kp,{Strophe:Mp}=_h.env;async function Dp(e,t,n){let r;e=Mp.getBareJidFromJid(e.toLowerCase()),Object.assign(t,{jid:e,id:e});try{r=new n(t,{collection:pu.chatboxes})}catch(e){return Gc.error(e),null}return await r.initialized,r.isValid()?(pu.chatboxes.add(r),r):(r.destroy(),null)}const $p={async create(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return await Bu.waitUntil("chatBoxesFetched"),"string"==typeof e?Dp(e,t,n):Promise.all(e.map((e=>Dp(e,t,n))))},get:async e=>(await Bu.waitUntil("chatBoxesFetched"),void 0===e?pu.chatboxes.models:"string"==typeof e?pu.chatboxes.get(e.toLowerCase()):(e=e.map((e=>e.toLowerCase())),pu.chatboxes.models.filter((t=>e.includes(t.get("jid"))))))},{Strophe:Fp}=_h.env;_h.plugins.add("converse-chatboxes",{dependencies:["converse-emoji","converse-roster","converse-vcard"],initialize(){Bu.promises.add(["chatBoxesFetched","chatBoxesInitialized","privateChatsAutoJoined"]),Object.assign(Bu,{chatboxes:$p}),pu.ChatBoxes=Rp,Bu.listen.on("addClientFeatures",(()=>{Bu.disco.own.features.add(Fp.NS.MESSAGE_CORRECT),Bu.disco.own.features.add(Fp.NS.HTTPUPLOAD),Bu.disco.own.features.add(Fp.NS.OUTOFBAND)})),Bu.listen.on("pluginsInitialized",(()=>{pu.chatboxes=new pu.ChatBoxes,Bu.trigger("chatBoxesInitialized")})),Bu.listen.on("presencesInitialized",(e=>pu.chatboxes.onConnected(e))),Bu.listen.on("reconnected",(()=>pu.chatboxes.forEach((e=>e.onReconnection()))))}});const{Strophe:Pp,u:Lp}=_h.env;function zp(e,t){const n=So()(`command[xmlns="${Pp.NS.ADHOC}"]`,e).pop(),r={sessionid:n.getAttribute("sessionid"),instructions:So()('x[type="form"][xmlns="jabber:x:data"] instructions',n).pop()?.textContent,fields:So()('x[type="form"][xmlns="jabber:x:data"] field',n).map((e=>Lp.xForm2TemplateResult(e,n,{domain:t}))),actions:Array.from(n.querySelector("actions")?.children).map((e=>e.nodeName.toLowerCase()))??[]};return r}const{Strophe:Up,$iq:Bp,u:Hp,stx:qp}=_h.env,Jp={adhoc:{async getCommands(e){try{return t=await Bu.disco.items(e,Up.NS.ADHOC),So()(`query[xmlns="${Pp.NS.DISCO_ITEMS}"][node="${Pp.NS.ADHOC}"] item`,t).map(sf)}catch(t){return null===t?Gc.error(`Error: timeout while fetching ad-hoc commands for ${e}`):(Gc.error(`Error while fetching ad-hoc commands for ${e}`),Gc.error(t)),[]}var t},async fetchCommandForm(e){const t=e.node,n=e.jid,r=Bp({type:"set",to:n}).c("command",{xmlns:Up.NS.ADHOC,node:t,action:"execute"});try{return zp(await Bu.sendIQ(r),n)}catch(e){null===e?Gc.error(`Error: timeout while trying to execute command for ${n}`):(Gc.error(`Error while trying to execute command for ${n}`),Gc.error(e));const{__:t}=pu;return{instructions:t("An error occurred while trying to fetch the command form"),fields:[]}}},async runCommand(e,t,n,r,i){const s=qp`<iq type="set" to="${e}" xmlns="jabber:client">
                    <command sessionid="${t}" node="${n}" action="${r}" xmlns="${Up.NS.ADHOC}">
                        ${["cancel","prev"].includes(r)?"":qp`
                            <x xmlns="${Up.NS.XFORM}" type="submit">
                                ${i.reduce(((e,t)=>{let{name:n,value:r}=t;return e+`<field var="${n}"><value>${r}</value></field>`}),"")}
                            </x>`}
                    </command>
                </iq>`,o=await Bu.sendIQ(s,null,!1);if(null===o){Gc.warn("A timeout occurred while trying to run an ad-hoc command");const{__:e}=pu;return{status:"error",note:e("A timeout occurred")}}Hp.isErrorStanza(o)&&(Gc.error("Error while trying to execute an ad-hoc command"),Gc.error(o));const a=o.querySelector("command"),c=a?.getAttribute("status");return{status:c,..."executing"===c?zp(o):{},note:o.querySelector("note")?.textContent}}}},{Strophe:Wp}=_h.env;Wp.addNamespace("ADHOC","http://jabber.org/protocol/commands"),_h.plugins.add("converse-adhoc",{dependencies:["converse-disco"],initialize(){Object.assign(this._converse.api,Jp)}});class Gp extends ff{defaults(){return{bookmarked:!1,hidden:["mobile","fullscreen"].includes(Bu.settings.get("view_mode")),message_type:"headline",num_unread:0,time_opened:this.get("time_opened")||(new Date).getTime(),type:pu.HEADLINES_TYPE}}async initialize(){this.set({box_id:`box-${this.get("jid")}`}),this.initUI(),this.initMessages(),await this.fetchMessages(),Bu.trigger("headlinesFeedInitialized",this)}}const Qp={headlines:{async get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];async function r(e){let r=await Bu.chatboxes.get(e);return!r&&n?r=await Bu.chatboxes.create(e,t,pu.HeadlinesFeed):(r=r&&r.get("type")===pu.HEADLINES_TYPE?r:null,r&&Object.keys(t).length&&r.save(t)),r}if(void 0===e){return(await Bu.chatboxes.get()).filter((e=>e.get("type")===pu.HEADLINES_TYPE))}return"string"==typeof e?r(e):Promise.all(e.map((e=>r(e))))}}};_h.plugins.add("converse-headlines",{dependencies:["converse-chat"],overrides:{ChatBoxes:{model(e,t){const{_converse:n}=this.__super__;return e.type==n.HEADLINES_TYPE?new n.HeadlinesFeed(e,t):this.__super__.model.apply(this,arguments)}}},initialize(){function e(){pu.connection.addHandler((e=>async function(e){if(tf(e)||nf(e)){const t=e.getAttribute("from");if(await Bu.waitUntil("rosterInitialized"),t.includes("@")&&!pu.roster.get(t)&&!Bu.settings.get("allow_non_roster_messaging"))return;if(null===e.querySelector("body"))return;const n=pu.chatboxes.create({id:t,jid:t,type:pu.HEADLINES_TYPE,from:t}),r=await cf(e);await n.createMessage(r),Bu.trigger("message",{chatbox:n,stanza:e,attrs:r})}}(e)||!0),null,"message")}pu.HeadlinesFeed=Gp,Bu.listen.on("connected",e),Bu.listen.on("reconnected",e),Object.assign(Bu,Qp)}});const Vp=_h.env.utils;class Yp extends us{defaults(){return{msgid:Vp.getUniqueId(),is_ephemeral:!1}}}const{Strophe:Xp,$build:Kp}=_h.env;Xp.addNamespace("RSM","http://jabber.org/protocol/rsm");const Zp=["after","before","index","max"],em=e=>Number(e),tm=e=>e.toString(),nm={after:tm,before:tm,count:em,first:tm,index:em,last:tm,max:em},rm=e=>void 0===e,im=Object.keys(nm);class sm{static getQueryParameters(){return cs(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},Zp)}static parseXMLResult(e){const t={};for(var n=0;n<im.length;n++){const r=im[n],i=e.getElementsByTagName(r)[0];rm(i)||null===i||(t[r]=nm[r](Xp.getText(i)),"first"==r&&(t.index=nm.index(i.getAttribute("index"))))}return t}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.query=sm.getQueryParameters(e),this.result=e.xml?sm.parseXMLResult(e.xml):{}}toXML(){const e=Kp("set",{xmlns:Xp.NS.RSM});return Zp.reduce(((e,t)=>rm(this.query[t])?e:e.c(t).t((this.query[t]||"").toString()).up()),e).tree()}next(e,t){const n=Object.assign({},this.query,{after:this.result.last,before:t,max:e});return new sm(n)}previous(e,t){const n=Object.assign({},this.query,{after:t,before:this.result.first,max:e});return new sm(n)}}pu.RSM_ATTRIBUTES=im,pu.RSM=sm;const{Strophe:om,$iq:am,dayjs:cm}=_h.env,{NS:um}=om,dm=_h.env.utils,lm={archive:{async query(e){if(!Bu.connection.connected())throw new Error("Can't call `api.archive.query` before having established an XMPP session");const t={type:"set"};if(e&&e.groupchat){if(!e.with)throw new Error('You need to specify a "with" value containing the chat room JID, when querying groupchat messages.');t.to=e.with}const n=t.to||pu.bare_jid;if(!await Bu.disco.supports(um.MAM,n))return Gc.warn(`Did not fetch MAM archive for ${n} because it doesn't support ${um.MAM}`),{messages:[]};const r=dm.getUniqueId(),i=am(t).c("query",{xmlns:um.MAM,queryid:r});if(e){i.c("x",{xmlns:um.XFORM,type:"submit"}).c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t(um.MAM).up().up(),e.with&&!e.groupchat&&i.c("field",{var:"with"}).c("value").t(e.with).up().up(),["start","end"].forEach((t=>{if(e[t]){const n=cm(e[t]);if(!n.isValid())throw new TypeError(`archive.query: invalid date provided for: ${t}`);i.c("field",{var:t}).c("value").t(n.toISOString()).up().up()}})),i.up();const t=new sm(e);Object.keys(t.query).length&&i.cnode(t.toXML())}const s=[],o=pu.connection.addHandler((t=>{const n=So()(`message > result[xmlns="${um.MAM}"]`,t).pop();if(void 0===n||n.getAttribute("queryid")!==r)return!0;const i=t.getAttribute("from")||pu.bare_jid;if(e.groupchat){if(i!==e.with)return Gc.warn(`Ignoring alleged groupchat MAM message from ${t.getAttribute("from")}`),!0}else if(i!==pu.bare_jid)return Gc.warn(`Ignoring alleged MAM message from ${t.getAttribute("from")}`),!0;return s.push(t),!0}),um.MAM);let a;const c=Bu.settings.get("message_archiving_timeout"),u=await Bu.sendIQ(i,c,!1);if(null===u){const{__:e}=pu,t=e("Timeout while trying to fetch archived messages.");return Gc.error(t),a=new wu(t),{messages:s,error:a}}if(dm.isErrorStanza(u)){const{__:e}=pu,t=e("An error occurred while querying for archived messages.");return Gc.error(t),Gc.error(u),a=new Error(t),{messages:s,error:a}}let d;pu.connection.deleteHandler(o);const l=u&&So()(`fin[xmlns="${um.MAM}"]`,u).pop(),h="true"===l?.getAttribute("complete"),f=So()(`set[xmlns="${um.RSM}"]`,l).pop();return f&&(d=new sm({...e,xml:f})),{messages:s,rsm:d,complete:h}}}},{Strophe:hm,$iq:fm}=_h.env,{NS:gm}=hm,pm=_h.env.utils;function mm(e){e?.querySelectorAll("feature-not-implemented").length?Gc.warn(`Message Archive Management (XEP-0313) not supported by ${e.getAttribute("from")}`):(Gc.error(`Error while trying to set archiving preferences for ${e.getAttribute("from")}.`),Gc.error(e))}function vm(e,t){const n=So()(`prefs[xmlns="${gm.MAM}"]`,e).pop();if(n.getAttribute("default")!==Bu.settings.get("message_archiving")){const e=fm({type:"set"}).c("prefs",{xmlns:gm.MAM,default:Bu.settings.get("message_archiving")});Array.from(n.children).forEach((t=>e.cnode(t).up())),Bu.sendIQ(e).then((()=>t.save({preferences:{default:Bu.settings.get("message_archiving")}}))).catch(pu.onMAMError)}else t.save({preferences:{default:Bu.settings.get("message_archiving")}})}function _m(e){const t=e.get("preferences")||{};e.get("var")===gm.MAM&&void 0!==Bu.settings.get("message_archiving")&&t.default!==Bu.settings.get("message_archiving")&&Bu.sendIQ(fm({type:"get"}).c("prefs",{xmlns:gm.MAM})).then((t=>pu.onMAMPreferences(t,e))).catch(pu.onMAMError)}function ym(e){Bu.settings.get("muc_show_logs_before_join")&&e.features.get("mam_enabled")&&!e.get("prejoin_mam_fetched")&&(Sm(e),e.save({prejoin_mam_fetched:!0}))}async function bm(e,t,n,r,i){await Bu.emojis.initialize();const s=e.get("type")===pu.CHATROOMS_TYPE,o=await Promise.all(t.messages.map((t=>s?Ag(t,e):cf(t))));t.messages=o;const a={query:n,chatbox:e,messages:o};if(await Bu.trigger("MAMResult",a,{synchronous:!0}),o.forEach((t=>e.queueMessage(t))),t.error){const n=t.error.retry_event_id=pm.getUniqueId();Bu.listen.once(n,(()=>wm(e,r,i))),e.createMessageFromError(t.error)}}async function wm(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(e.disable_mam)return;const r=e.get("type")===pu.CHATROOMS_TYPE,i=r?e.get("jid"):pu.bare_jid;if(!await Bu.disco.supports(gm.MAM,i))return;const s=Bu.settings.get("archived_messages_page_size"),o=Object.assign({groupchat:r,max:s,with:e.get("jid")},t),a=await Bu.archive.query(o);if(await bm(e,a,o,t,n),a.rsm&&!a.complete){if(n)return"forwards"===n?t=a.rsm.next(s,t.before).query:"backwards"===n&&(t=a.rsm.previous(s,t.after).query),wm(e,t,n);!async function(e,t,n){if(""==t.before&&(0===e.messages.length||!t.start))return;if(t.before&&!t.start)return;if(null==t.before)return;const r=await Promise.all(n.messages),{rsm:i}=n,s=`stanza_id ${e.get("jid")}`,o=r.find((e=>e[s]===i.result.first)),a={template_hook:"getMessageTemplate",time:new Date(new Date(o.time)-1).toISOString(),before:i.result.first,start:t.start};e.messages.add(new Yp(a))}(e,t,a)}}function Sm(e){if(e.disable_mam)return;const t=e.getMostRecentMessage();if(t&&!Bu.settings.get("clear_messages_on_reconnection")){if(Bu.settings.get("mam_request_all_pages")){const n=t.get(`stanza_id ${e.get("jid")}`);wm(e,n?{after:n}:{start:t.get("time")},"forwards")}else wm(e,{before:"",start:t.get("time")})}else wm(e,{before:""})}const{Strophe:Am}=_h.env,{NS:Em}=Am;_h.plugins.add("converse-mam",{dependencies:["converse-disco","converse-muc"],initialize(){Bu.settings.extend({archived_messages_page_size:"50",mam_request_all_pages:!0,message_archiving:void 0,message_archiving_timeout:2e4}),Object.assign(Bu,lm),Object.assign(pu,{onMAMError:mm,onMAMPreferences:vm,handleMAMResult:bm,MAMPlaceholderMessage:Yp}),Bu.listen.on("addClientFeatures",(()=>Bu.disco.own.features.add(Em.MAM))),Bu.listen.on("serviceDiscovered",_m),Bu.listen.on("chatRoomViewInitialized",(e=>{Bu.settings.get("muc_show_logs_before_join")&&(ym(e.model),e.model.features.on("change:mam_enabled",(()=>ym(e.model))))})),Bu.listen.on("enteredNewRoom",(e=>e.features.get("mam_enabled")&&Sm(e))),Bu.listen.on("chatReconnected",(e=>{e.get("type")===pu.PRIVATE_CHAT_TYPE&&Sm(e)})),Bu.listen.on("afterMessagesFetched",(e=>{e.get("type")===pu.PRIVATE_CHAT_TYPE&&Sm(e)}))}});const{Strophe:xm,$iq:Nm}=_h.env;let Im,Cm;function Tm(e){"visible"===e.state&&Bu.ping(null,5e3)}function Om(e){Im=new Date;const t=e.getAttribute("from"),n=e.getAttribute("id"),r=Nm({type:"result",to:t,id:n});return pu.connection.sendIQ(r),!0}function jm(){!function(){const{connection:e}=pu;e.disco&&Bu.disco.own.features.add(xm.NS.PING),e.addHandler(Om,xm.NS.PING,"iq","get")}(),pu.connection.addHandler((()=>{if(Bu.settings.get("ping_interval")>0)return Im=new Date,!0})),clearInterval(Cm),Cm=setInterval(Rm,1e3)}function km(){clearInterval(Cm)}function Rm(){if(pu.isTestEnv()||!Bu.connection.authenticated())return;const e=Bu.settings.get("ping_interval");if(e>0){const t=new Date;Im=Im??t,(t-Im)/1e3>e&&Bu.ping()}}const{Strophe:Mm,$iq:Dm,u:$m}=_h.env,Fm={async ping(e,t){if(!Bu.connection.authenticated())return Gc.warn("Not pinging when we know we're not authenticated"),null;var n;n=new Date,Im=n,e=e||Mm.getDomainFromJid(pu.bare_jid);const r=Dm({type:"get",to:e,id:$m.getUniqueId("ping")}).c("ping",{xmlns:Mm.NS.PING}),i=await Bu.sendIQ(r,t||1e4,!1);return null===i?(Gc.warn(`Timeout while pinging ${e}`),e===Mm.getDomainFromJid(pu.bare_jid)&&Bu.connection.reconnect(),!1):!$m.isErrorStanza(i)||(Gc.error(`Error while pinging ${e}`),Gc.error(i),!1)}},{Strophe:Pm}=_h.env;Pm.addNamespace("PING","urn:xmpp:ping"),_h.plugins.add("converse-ping",{initialize(){Bu.settings.extend({ping_interval:60}),Object.assign(Bu,Fm),Bu.listen.on("connected",jm),Bu.listen.on("reconnected",jm),Bu.listen.on("disconnected",km),Bu.listen.on("windowStateChanged",Tm)}});const{Strophe:Lm,$iq:zm}=_h.env;Lm.addNamespace("PUBSUB_ERROR",Lm.NS.PUBSUB+"#errors"),_h.plugins.add("converse-pubsub",{dependencies:["converse-disco"],initialize(){Object.assign(pu.api,{pubsub:{async publish(e,t,n,r){let i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const s=zm({from:pu.bare_jid,type:"set",to:e}).c("pubsub",{xmlns:Lm.NS.PUBSUB}).c("publish",{node:t}).cnode(n.tree()).up().up();r&&(e=e||pu.bare_jid,await Bu.disco.supports(Lm.NS.PUBSUB+"#publish-options",e)?(s.c("publish-options").c("x",{xmlns:Lm.NS.XFORM,type:"submit"}).c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t(`${Lm.NS.PUBSUB}#publish-options`).up().up(),Object.keys(r).forEach((e=>s.c("field",{var:e}).c("value").t(r[e]).up().up()))):Gc.warn(`_converse.api.publish: ${e} does not support #publish-options, so we didn't set them even though they were provided.`));try{await Bu.sendIQ(s)}catch(e){if(!(e instanceof Element&&i&&e.querySelector(`precondition-not-met[xmlns="${Lm.NS.PUBSUB_ERROR}"]`)))throw e;{const e=s.tree();e.querySelector("publish-options").outerHTML="",Gc.warn(`PubSub: Republishing without publish options. ${e.outerHTML}`),await Bu.sendIQ(e)}}}}})}});const Um=function(e){return"number"==typeof e||U(e)&&"[object Number]"==m(e)};const Bm=function(e){return Um(e)&&e!=+e},{Strophe:Hm,$pres:qm}=_h.env;class Jm extends us{defaults(){return{status:Bu.settings.get("default_state")}}initialize(){this.on("change",(e=>{v(e.changed)&&("status"in e.changed||"status_message"in e.changed)&&Bu.user.presence.send(this.get("status"),null,this.get("status_message"))}))}getDisplayName(){return this.getFullname()||this.getNickname()||pu.bare_jid}getNickname(){return Bu.settings.get("nickname")}getFullname(){return""}async constructPresence(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2?arguments[2]:void 0;if(e="string"==typeof e?e:this.get("status")||Bu.settings.get("default_state"),r="string"==typeof r?r:this.get("status_message"),"subscribe"===e){t=qm({to:n,type:e});const{xmppstatus:r}=pu,i=r.getNickname();i&&t.c("nick",{xmlns:Hm.NS.NICK}).t(i).up()}else t="unavailable"===e||"probe"===e||"error"===e||"unsubscribe"===e||"unsubscribed"===e||"subscribed"===e?qm({to:n,type:e}):"offline"===e?qm({to:n,type:"unavailable"}):"online"===e?qm({to:n}):qm({to:n}).c("show").t(e).up();r&&t.c("status").t(r).up();const i=Bu.settings.get("priority");t.c("priority").t(Bm(Number(i))?0:i).up();const{idle:s,idle_seconds:o}=pu;if(s){const e=new Date;e.setSeconds(e.getSeconds()-o),t.c("idle",{xmlns:Hm.NS.IDLE,since:e.toISOString()})}return t=await Bu.hook("constructedPresence",null,t),t}}const Wm={status:{get:async()=>(await Bu.waitUntil("statusInitialized"),pu.xmppstatus.get("status")),async set(e,t){const n={status:e};if(!Object.keys(oo).includes(e))throw new Error("Invalid availability value. See https://xmpp.org/rfcs/rfc3921.html#rfc.section.2.2.2.1");"string"==typeof t&&(n.status_message=t),await Bu.waitUntil("statusInitialized"),pu.xmppstatus.save(n)},message:{get:async()=>(await Bu.waitUntil("statusInitialized"),pu.xmppstatus.get("status_message")),async set(e){await Bu.waitUntil("statusInitialized"),pu.xmppstatus.save({status_message:e})}}}},{Strophe:Gm,$build:Qm}=_h.env;function Vm(e){Bu.trigger("statusInitialized",e)}function Ym(e){if(e=void 0!==pu.xmppstatus&&e)Vm(e);else{const t=`converse.xmppstatus-${pu.bare_jid}`;pu.xmppstatus=new pu.XMPPStatus({id:t}),pc(pu.xmppstatus,t,"session"),pu.xmppstatus.fetch({success:()=>Vm(e),error:()=>Vm(e),silent:!0})}}function Xm(){pu.idle_seconds>0&&(pu.idle_seconds=0),pu.connection?.authenticated&&(pu.inactive&&pu.sendCSI(pu.ACTIVE),pu.idle&&(pu.idle=!1,Bu.user.presence.send()),!0===pu.auto_changed_status&&(pu.auto_changed_status=!1,pu.xmppstatus.set("status",Bu.settings.get("default_state"))))}function Km(){if(!pu.connection?.authenticated)return;const e=pu.xmppstatus.get("status");pu.idle_seconds++,Bu.settings.get("csi_waiting_time")>0&&pu.idle_seconds>Bu.settings.get("csi_waiting_time")&&!pu.inactive&&pu.sendCSI(pu.INACTIVE),Bu.settings.get("idle_presence_timeout")>0&&pu.idle_seconds>Bu.settings.get("idle_presence_timeout")&&!pu.idle&&(pu.idle=!0,Bu.user.presence.send()),Bu.settings.get("auto_away")>0&&pu.idle_seconds>Bu.settings.get("auto_away")&&"away"!==e&&"xa"!==e&&"dnd"!==e?(pu.auto_changed_status=!0,pu.xmppstatus.set("status","away")):Bu.settings.get("auto_xa")>0&&pu.idle_seconds>Bu.settings.get("auto_xa")&&"xa"!==e&&"dnd"!==e&&(pu.auto_changed_status=!0,pu.xmppstatus.set("status","xa"))}function Zm(e){Bu.send(Qm(e,{xmlns:Gm.NS.CSI})),pu.inactive=e===pu.INACTIVE}function ev(){if(Bu.settings.get("auto_away")<1&&Bu.settings.get("auto_xa")<1&&Bu.settings.get("csi_waiting_time")<1&&Bu.settings.get("idle_presence_timeout")<1)return;pu.idle_seconds=0,pu.auto_changed_status=!1;const{unloadevent:e}=pu;window.addEventListener("click",pu.onUserActivity),window.addEventListener("focus",pu.onUserActivity),window.addEventListener("keypress",pu.onUserActivity),window.addEventListener("mousemove",pu.onUserActivity),window.addEventListener(e,pu.onUserActivity,{once:!0,passive:!0}),pu.everySecondTrigger=window.setInterval(pu.onEverySecond,1e3)}function tv(e,t){const{xmppstatus:n}=pu,r=n.get("status");["away","chat","dnd","xa"].includes(r)&&t.c("show").t(r).up();const i=n.get("status_message");return i&&t.c("status").t(i).up(),t}const{Strophe:nv}=_h.env;nv.addNamespace("IDLE","urn:xmpp:idle:1"),_h.plugins.add("converse-status",{initialize(){Bu.settings.extend({auto_away:0,auto_xa:0,csi_waiting_time:0,default_state:"online",idle_presence_timeout:300,priority:0}),Bu.promises.add(["statusInitialized"]),pu.XMPPStatus=Jm,pu.onUserActivity=Xm,pu.onEverySecond=Km,pu.sendCSI=Zm,pu.registerIntervalHandler=ev,Object.assign(pu.api.user,Wm),Bu.settings.get("idle_presence_timeout")>0&&Bu.listen.on("addClientFeatures",(()=>Bu.disco.own.features.add(nv.NS.IDLE))),Bu.listen.on("presencesInitialized",(e=>{e||pu.registerIntervalHandler()})),Bu.listen.on("clearSession",(()=>{jc()&&pu.xmppstatus&&(pu.xmppstatus.destroy(),delete pu.xmppstatus,Bu.promises.add(["statusInitialized"]))})),Bu.listen.on("connected",(()=>Ym(!1))),Bu.listen.on("reconnected",(()=>Ym(!0))),Bu.listen.on("constructedMUCPresence",tv)}});const rv=us.extend({initialize(){this.set({filter_text:"",filter_type:"contacts",chat_state:"online"})}}),{$pres:iv}=_h.env;function sv(e){const t=pu.roster?.get(e.get("jid"));t?.save({num_unread:e.get("num_unread")})}function ov(){void 0!==pu.presence_ref&&(pu.connection.deleteHandler(pu.presence_ref),delete pu.presence_ref)}async function av(){await(pu.presences?.clearStore())}async function cv(){await av(),jc()&&(pu.rostergroups&&(await pu.rostergroups.clearStore(),delete pu.rostergroups),pu.roster&&(pu.roster.data?.destroy(),await pu.roster.clearStore(),delete pu.roster))}function uv(e){e?Bu.trigger("rosterReadyAfterReconnection"):function(){const e=pu.roster=new pu.RosterContacts;let t=`converse.contacts-${pu.bare_jid}`;pc(e,t);const n=pu.roster_filter=new rv;n.id=`_converse.rosterfilter-${pu.bare_jid}`,pc(n,n.id),n.fetch(),t=`converse-roster-model-${pu.bare_jid}`,e.data=new us,e.data.id=t,pc(e.data,t),e.data.fetch(),Bu.trigger("rosterInitialized")}(),pu.roster.onConnected(),ov(),pu.presence_ref=pu.connection.addHandler((e=>(pu.roster.presenceHandler(e),!0)),null,"presence",null),async function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&(pu.send_initial_presence=!0);try{await pu.roster.fetchRosterContacts(),Bu.trigger("rosterContactsFetched")}catch(e){Gc.error(e)}finally{pu.send_initial_presence&&Bu.user.presence.send()}}(!pu.connection.restored)}async function dv(e){if(e)!pu.connection.hasResumed()&&await av();else{pu.presences=new pu.Presences;const e=`converse.presences-${pu.bare_jid}`;pc(pu.presences,e,"session"),pu.presences.fetch()}Bu.trigger("presencesInitialized",e)}function lv(){pu.chatboxes.on("change:num_unread",sv),pu.chatboxes.on("add",(e=>{e.get("type")===pu.PRIVATE_CHAT_TYPE&&e.setRosterContact(e.get("jid"))}))}function hv(){pu.roster.on("add",(e=>{const t=pu.chatboxes.findWhere({jid:e.get("jid")});t?.setRosterContact(e.get("jid"))}))}function fv(e,t){const n=iv({to:e,type:"unsubscribed"});t&&""!==t&&n.c("status").t(t),Bu.send(n)}const{Strophe:gv,$iq:pv,$pres:mv}=_h.env,vv=us.extend({idAttribute:"jid",defaults:{chat_state:void 0,groups:[],image:pu.DEFAULT_IMAGE,image_type:pu.DEFAULT_IMAGE_TYPE,num_unread:0,status:void 0},async initialize(e){this.initialized=Ao(),this.setPresence();const{jid:t}=e;this.set({...e,jid:gv.getBareJidFromJid(t).toLowerCase(),user_id:gv.getNodeFromJid(t)}),this.listenTo(this.presence,"change:show",(()=>Bu.trigger("contactPresenceChanged",this))),this.listenTo(this.presence,"change:show",(()=>this.trigger("presenceChanged"))),await Bu.trigger("rosterContactInitialized",this,{Synchronous:!0}),this.initialized.resolve()},setPresence(){const e=this.get("jid");this.presence=pu.presences.findWhere(e)||pu.presences.create({jid:e})},openChat(){const e=this.attributes;Bu.chats.open(e.jid,e,!0)},getFilterCriteria(){const e=this.get("nickname"),t=this.get("jid");let n=this.getDisplayName();return n=n.includes(t)?n:n.concat(`   ${t}`),n=n.includes(e)?n:n.concat(`   ${e}`),n.toLowerCase()},getDisplayName(){return this.get("nickname")?this.get("nickname"):this.get("jid")},getFullname(){return this.get("jid")},subscribe(e){return Bu.user.presence.send("subscribe",this.get("jid"),e),this.save("ask","subscribe"),this},ackSubscribe(){Bu.send(mv({type:"subscribe",to:this.get("jid")}))},ackUnsubscribe(){Bu.send(mv({type:"unsubscribe",to:this.get("jid")})),this.removeFromRoster(),this.destroy()},unauthorize(e){return fv(this.get("jid"),e),this},authorize(e){const t=mv({to:this.get("jid"),type:"subscribed"});return e&&""!==e&&t.c("status").t(e),Bu.send(t),this},removeFromRoster(){const e=pv({type:"set"}).c("query",{xmlns:gv.NS.ROSTER}).c("item",{jid:this.get("jid"),subscription:"remove"});return Bu.sendIQ(e)}}),_v=vv,{Strophe:yv,$iq:bv,sizzle:wv,u:Sv}=_h.env,Av=Dd.extend({model:_v,initialize(){const e=`roster.state-${pu.bare_jid}-${this.get("jid")}`;this.state=new us({id:e,collapsed_groups:[]}),pc(this.state,e),this.state.fetch()},onConnected(){this.registerRosterHandler(),this.registerRosterXHandler()},registerRosterHandler(){pu.connection.addHandler((e=>(pu.roster.onRosterPush(e),!0)),yv.NS.ROSTER,"iq","set")},registerRosterXHandler(){let e=0;pu.connection.addHandler((function(t){return window.setTimeout((function(){pu.connection.flush(),pu.roster.subscribeToSuggestedItems.bind(pu.roster)(t)}),e),e+=250*t.querySelectorAll("item").length,!0}),yv.NS.ROSTERX,"message",null)},async fetchRosterContacts(){const e=await new Promise(((e,t)=>{this.fetch({add:!0,silent:!0,success:e,error:(e,n)=>t(n)})}));if(Sv.isErrorObject(e)&&(Gc.error(e),pu.session.save("roster_cached",!1),this.data.save("version",void 0)),!pu.session.get("roster_cached"))return pu.send_initial_presence=!0,pu.roster.fetchFromServer();Bu.trigger("cachedRoster",e)},subscribeToSuggestedItems:e=>(Array.from(e.querySelectorAll("item")).forEach((e=>{"add"===e.getAttribute("action")&&pu.roster.addAndSubscribe(e.getAttribute("jid"),pu.xmppstatus.getNickname()||pu.xmppstatus.getFullname())})),!0),isSelf:e=>Sv.isSameBareJID(e,pu.connection.jid),async addAndSubscribe(e,t,n,r,i){const s=await this.addContactToRoster(e,t,n,i);s instanceof pu.RosterContact&&s.subscribe(r)},sendContactAddIQ(e,t,n){t=t||null;const r=bv({type:"set"}).c("query",{xmlns:yv.NS.ROSTER}).c("item",{jid:e,name:t});return n.forEach((e=>r.c("group").t(e).up())),Bu.sendIQ(r)},async addContactToRoster(e,t,n,r){await Bu.waitUntil("rosterContactsFetched"),n=n||[];try{await this.sendContactAddIQ(e,t,n)}catch(n){const{__:r}=pu;return Gc.error(n),alert(r("Sorry, there was an error while trying to add %1$s as a contact.",t||e)),n}return this.create(Object.assign({ask:void 0,nickname:t,groups:n,jid:e,requesting:!1,subscription:"none"},r),{sort:!1})},async subscribeBack(e,t){const n=this.get(e);if(n instanceof pu.RosterContact)n.authorize().subscribe();else{const n=wv(`nick[xmlns="${yv.NS.NICK}"]`,t).pop()?.textContent||null,r=await this.addContactToRoster(e,n,[],{subscription:"from"});r instanceof pu.RosterContact&&r.authorize().subscribe()}},onRosterPush(e){const t=e.getAttribute("id"),n=e.getAttribute("from");if(n&&n!==pu.bare_jid)return void Gc.warn(`Ignoring roster illegitimate roster push message from ${e.getAttribute("from")}`);Bu.send(bv({type:"result",id:t,from:pu.connection.jid}));const r=wv(`query[xmlns="${yv.NS.ROSTER}"]`,e).pop();this.data.save("version",r.getAttribute("ver"));const i=wv("item",r);if(i.length>1)throw Gc.error(e),new Error('Roster push query may not contain more than one "item" element.');if(0===i.length)return Gc.warn(e),void Gc.warn('Received a roster push stanza without an "item" element.');this.updateContact(i.pop()),Bu.trigger("rosterPush",e)},rosterVersioningSupported(){return Bu.disco.stream.getFeature("ver","urn:xmpp:features:rosterver")&&this.data.get("version")},async fetchFromServer(){const e=bv({type:"get",id:Sv.getUniqueId("roster")}).c("query",{xmlns:yv.NS.ROSTER});this.rosterVersioningSupported()&&e.attrs({ver:this.data.get("version")});const t=await Bu.sendIQ(e,null,!1);if("result"===t.getAttribute("type")){const e=wv(`query[xmlns="${yv.NS.ROSTER}"]`,t).pop();if(e){const t=wv("item",e);if(!this.data.get("version")&&this.models.length){const e=t.map((e=>e.getAttribute("jid")));this.forEach((t=>!t.get("requesting")&&!e.includes(t.get("jid"))&&t.destroy()))}t.forEach((e=>this.updateContact(e))),this.data.save("version",e.getAttribute("ver"))}}else if(!Sv.isServiceUnavailableError(t))return Gc.error(t),void Gc.error("Error while trying to fetch roster from the server");pu.session.save("roster_cached",!0),Bu.trigger("roster",t)},updateContact(e){const t=e.getAttribute("jid"),n=this.get(t),r=e.getAttribute("subscription");if("remove"===r)return n?.destroy();const i=e.getAttribute("ask"),s=e.getAttribute("name"),o=[...new Set(wv("group",e).map((e=>e.textContent)))];n?n.save({subscription:r,ask:i,nickname:s,groups:o,requesting:null}):this.create({nickname:s,ask:i,groups:o,jid:t,subscription:r},{sort:!1})},createRequestingContact(e){const t={jid:yv.getBareJidFromJid(e.getAttribute("from")),subscription:"none",ask:null,requesting:!0,nickname:wv(`nick[xmlns="${yv.NS.NICK}"]`,e).pop()?.textContent||null};Bu.trigger("contactRequest",this.create(t))},handleIncomingSubscription(e){const t=e.getAttribute("from"),n=yv.getBareJidFromJid(t),r=this.get(n);if(!Bu.settings.get("allow_contact_requests")){const{__:e}=pu;fv(t,e("This client does not allow presence subscriptions"))}Bu.settings.get("auto_subscribe")?r&&"to"===r.get("subscription")?r.authorize():this.subscribeBack(n,e):r?("none"!==r.get("subscription")||"subscribe"===r.get("ask"))&&r.authorize():this.createRequestingContact(e)},handleOwnPresence(e){const t=e.getAttribute("from"),n=yv.getResourceFromJid(t),r=e.getAttribute("type");if(pu.connection.jid!==t&&"unavailable"!==r&&(!0===Bu.settings.get("synchronize_availability")||Bu.settings.get("synchronize_availability")===n)){const t=e.querySelector("show")?.textContent||"online";pu.xmppstatus.save({status:t},{silent:!0});const n=e.querySelector("status")?.textContent;n&&pu.xmppstatus.save({status_message:n})}pu.jid===t&&"unavailable"===r&&Bu.user.presence.send()},presenceHandler(e){const t=e.getAttribute("type");if("error"===t)return!0;const n=e.getAttribute("from"),r=yv.getBareJidFromJid(n);if(this.isSelf(r))return this.handleOwnPresence(e);if(wv(`query[xmlns="${yv.NS.MUC}"]`,e).length)return;const i=this.get(r);if(i){const t=e.querySelector("status")?.textContent;i.get("status")!==t&&i.save({status:t})}if("subscribed"===t&&i)i.ackSubscribe();else if("unsubscribed"===t&&i)i.ackUnsubscribe();else{if("unsubscribe"===t)return;if("subscribe"===t)this.handleIncomingSubscription(e);else if("unavailable"===t&&i){const e=yv.getResourceFromJid(n);i.presence.removeResource(e)}else i&&i.presence.addResource(e)}}}),Ev=Av,{Strophe:xv}=_h.env,Nv={contacts:{async get(e){await Bu.waitUntil("rosterContactsFetched");const t=e=>pu.roster.get(xv.getBareJidFromJid(e));if(void 0===e)e=pu.roster.pluck("jid");else if("string"==typeof e)return t(e);return e.map(t)},async add(e,t){if(await Bu.waitUntil("rosterContactsFetched"),"string"!=typeof e||!e.includes("@"))throw new TypeError("contacts.add: invalid jid");return pu.roster.addAndSubscribe(e,t)}}},{Strophe:Iv,dayjs:Cv,sizzle:Tv}=_h.env,Ov=us.extend({idAttribute:"name"}),jv=Dd.extend({model:Ov}),kv=us.extend({idAttribute:"jid",defaults:{show:"offline"},initialize(){this.resources=new jv;const e=`converse.identities-${this.get("jid")}`;pc(this.resources,e,"session"),this.listenTo(this.resources,"update",this.onResourcesChanged),this.listenTo(this.resources,"change",this.onResourcesChanged)},onResourcesChanged(){const e=this.getHighestPriorityResource(),t=e?.attributes?.show||"offline";this.get("show")!==t&&this.save({show:t})},getHighestPriorityResource(){return this.resources.sortBy((e=>`${e.get("priority")}-${e.get("timestamp")}`)).reverse()[0]},addResource(e){const t=e.getAttribute("from"),n=Iv.getResourceFromJid(t),r=Tv(`delay[xmlns="${Iv.NS.DELAY}"]`,e).pop(),i=e.querySelector("priority")?.textContent,s=this.resources.get(n),o={name:n,priority:Bm(parseInt(i,10))?0:parseInt(i,10),show:e.querySelector("show")?.textContent??"online",timestamp:r?Cv(r.getAttribute("stamp")).toISOString():(new Date).toISOString()};s?s.save(o):this.resources.create(o)},removeResource(e){const t=this.resources.get(e);t?.destroy()}}),Rv=Dd.extend({model:kv});_h.plugins.add("converse-roster",{dependencies:["converse-status"],initialize(){Bu.settings.extend({allow_contact_requests:!0,auto_subscribe:!1,synchronize_availability:!0}),Bu.promises.add(["cachedRoster","roster","rosterContactsFetched","rosterInitialized"]),Object.assign(pu.api,Nv);const{__:e}=pu;pu.HEADER_CURRENT_CONTACTS=e("My contacts"),pu.HEADER_PENDING_CONTACTS=e("Pending contacts"),pu.HEADER_REQUESTING_CONTACTS=e("Contact requests"),pu.HEADER_UNGROUPED=e("Ungrouped"),pu.HEADER_UNREAD=e("New messages"),pu.Presence=kv,pu.Presences=Rv,pu.RosterContact=_v,pu.RosterContacts=Ev,Bu.listen.on("beforeTearDown",(()=>ov())),Bu.listen.on("chatBoxesInitialized",lv),Bu.listen.on("clearSession",cv),Bu.listen.on("presencesInitialized",uv),Bu.listen.on("statusInitialized",dv),Bu.listen.on("streamResumptionFailed",(()=>pu.session.set("roster_cached",!1))),Bu.waitUntil("rosterContactsFetched").then(hv)}});const{Strophe:Mv}=_h.env,Dv=_h.env.utils;function $v(){return!(Bu.connection.isType("bosh")&&!pu.isTestEnv())&&Bu.disco.stream.getFeature("sm",Mv.NS.SM)}function Fv(e){if(!pu.session.get("smacks_enabled"))return!0;const t=parseInt(e.getAttribute("h"),10),n=pu.session.get("num_stanzas_handled_by_server"),r=t-n;if(r<0){const e=`New reported stanza count lower than previous. New: ${t} - Previous: ${n}`;Gc.error(e)}const i=pu.session.get("unacked_stanzas");if(r>i.length){const e=`Higher reported acknowledge count than unacknowledged stanzas. Reported Acknowledged Count: ${r} -Unacknowledged Stanza Count: ${i.length} -New: ${t} - Previous: ${n}`;Gc.error(e)}return pu.session.save({num_stanzas_handled_by_server:t,num_stanzas_since_last_ack:0,unacked_stanzas:i.slice(r)}),!0}function Pv(){if(pu.session.get("smacks_enabled")){const e=pu.session.get("num_stanzas_handled"),t=Dv.toStanza(`<a xmlns="${Mv.NS.SM}" h="${e}"/>`);Bu.send(t)}return!0}function Lv(e){if(pu.session.get("smacks_enabled")&&(Dv.isTagEqual(e,"iq")||Dv.isTagEqual(e,"presence")||Dv.isTagEqual(e,"message"))){const e=pu.session.get("num_stanzas_handled");pu.session.save("num_stanzas_handled",e+1)}return!0}function zv(){pu.session.save({smacks_enabled:pu.session.get("smacks_enabled")||!1,num_stanzas_handled:pu.session.get("num_stanzas_handled")||0,num_stanzas_handled_by_server:pu.session.get("num_stanzas_handled_by_server")||0,num_stanzas_since_last_ack:pu.session.get("num_stanzas_since_last_ack")||0,unacked_stanzas:pu.session.get("unacked_stanzas")||[]})}function Uv(){pu.session?.save({smacks_enabled:!1,num_stanzas_handled:0,num_stanzas_handled_by_server:0,num_stanzas_since_last_ack:0,unacked_stanzas:[]})}function Bv(e){const t={smacks_enabled:!0};return["1","true"].includes(e.getAttribute("resume"))&&(t.smacks_stream_id=e.getAttribute("id")),pu.session.save(t),!0}function Hv(e){return e.querySelector("item-not-found")?Gc.warn("Could not resume previous SMACKS session, session id not found. A new session will be established."):(Gc.error("Failed to enable stream management"),Gc.error(e.outerHTML)),Uv(),Bu.trigger("streamResumptionFailed"),!0}function qv(e){Bv(e),Fv(e),function(){const e=pu.session.get("unacked_stanzas");pu.session.save("unacked_stanzas",[]),e.forEach((e=>Bu.send(e)))}(),pu.connection.do_bind=!1,pu.connection.authenticated=!0,pu.connection.restored=!0,pu.connection._changeConnectStatus(Mv.Status.CONNECTED,null)}async function Jv(){if(Bu.settings.get("enable_smacks")&&!pu.session.get("smacks_enabled")&&await $v()){const e=Ao();pu.connection._addSysHandler((t=>e.resolve(Bv(t))),Mv.NS.SM,"enabled"),pu.connection._addSysHandler((t=>e.resolve(Hv(t))),Mv.NS.SM,"failed");const t=Bu.connection.isType("websocket")||pu.isTestEnv(),n=Dv.toStanza(`<enable xmlns="${Mv.NS.SM}" resume="${t}"/>`);Bu.send(n),pu.connection.flush(),await e}}const Wv=[];async function Gv(){if(!Bu.settings.get("enable_smacks"))return;if(!await $v())return;const e=pu.connection;for(;Wv.length;)e.deleteHandler(Wv.pop());Wv.push(e.addHandler(Lv)),Wv.push(e.addHandler(Pv,Mv.NS.SM,"r")),Wv.push(e.addHandler(Fv,Mv.NS.SM,"a")),pu.session?.get("smacks_stream_id")?await async function(){const e=Ao();pu.connection._addSysHandler((t=>e.resolve(qv(t))),Mv.NS.SM,"resumed"),pu.connection._addSysHandler((t=>e.resolve(Hv(t))),Mv.NS.SM,"failed");const t=pu.session.get("smacks_stream_id"),n=pu.session.get("num_stanzas_handled"),r=Dv.toStanza(`<resume xmlns="${Mv.NS.SM}" h="${n}" previd="${t}"/>`);Bu.send(r),pu.connection.flush(),await e}():Uv()}function Qv(e){if(pu.session){if(pu.session.get("smacks_enabled")&&(Dv.isTagEqual(e,"iq")||Dv.isTagEqual(e,"presence")||Dv.isTagEqual(e,"message"))){const t=Mv.serialize(e);pu.session.save("unacked_stanzas",(pu.session.get("unacked_stanzas")||[]).concat([t]));const n=Bu.settings.get("smacks_max_unacked_stanzas");if(n>0){const e=pu.session.get("num_stanzas_since_last_ack")+1;e%n==0&&Bu.send(Dv.toStanza(`<r xmlns="${Mv.NS.SM}"/>`)),pu.session.save({num_stanzas_since_last_ack:e})}}}else Gc.warn("No _converse.session!")}const{Strophe:Vv}=_h.env;Vv.addNamespace("SM","urn:xmpp:sm:3"),_h.plugins.add("converse-smacks",{initialize(){Bu.settings.extend({enable_smacks:!0,smacks_max_unacked_stanzas:5}),Bu.listen.on("afterResourceBinding",Jv),Bu.listen.on("beforeResourceBinding",Gv),Bu.listen.on("send",Qv),Bu.listen.on("userSessionInitialized",zv)}});const Yv=us.extend({idAttribute:"jid",defaults:{image:pu.DEFAULT_IMAGE,image_type:pu.DEFAULT_IMAGE_TYPE},set(e,t,n){let r;return"object"==typeof e?(r=e,n=t):(r={})[e]=t,"image"in r&&!r.image?(r.image=pu.DEFAULT_IMAGE,r.image_type=pu.DEFAULT_IMAGE_TYPE,us.prototype.set.call(this,r,n)):us.prototype.set.apply(this,arguments)},getDisplayName(){return this.get("nickname")||this.get("fullname")||this.get("jid")}}),Xv=Yv,{Strophe:Kv,$iq:Zv,u:e_}=_h.env;function t_(e,t,n){const r=Zv(t?{type:e,to:t}:{type:e});return n?r.cnode(n):r.c("vCard",{xmlns:Kv.NS.VCARD}),r}async function n_(e){let t;if(e instanceof pu.Message){if(["error","info"].includes(e.get("type")))return;t=e.get("from")}else t=e.get("jid");t?(await Bu.waitUntil("VCardsInitialized"),e.vcard=pu.vcards.get(t)||pu.vcards.create({jid:t}),e.vcard.on("change",(()=>e.trigger("vcard:change"))),e.trigger("vcard:add")):Gc.warn("Could not set VCard on model because no JID found!")}async function r_(e){await Bu.waitUntil("VCardsInitialized"),e.vcard=function(e){const t=e?.collection?.chatroom,n=e.get("nick");if(n&&t?.get("nick")===n)return pu.xmppstatus.vcard;{const t=e.get("jid")||e.get("from");return t?pu.vcards.get(t)||pu.vcards.create({jid:t}):void Gc.warn("Could not get VCard for occupant because no JID found!")}}(e),e.vcard&&(e.vcard.on("change",(()=>e.trigger("vcard:change"))),e.trigger("vcard:add"))}async function i_(e){["error","info"].includes(e.get("type"))||(await Bu.waitUntil("VCardsInitialized"),e.vcard=function(e){const t=e?.collection?.chatbox,n=Kv.getResourceFromJid(e.get("from"));if(n&&t?.get("nick")===n)return pu.xmppstatus.vcard;{const t=e.occupant?.get("jid")||e.get("from");return t?pu.vcards.get(t)||pu.vcards.create({jid:t}):void Gc.warn(`Could not get VCard for message because no JID found! msgid: ${e.get("msgid")}`)}}(e),e.vcard&&(e.vcard.on("change",(()=>e.trigger("vcard:change"))),e.trigger("vcard:add")))}async function s_(){pu.vcards=new pu.VCards;const e=`${pu.bare_jid}-converse.vcards`;pc(pu.vcards,e),await new Promise((e=>{pu.vcards.fetch({success:e,error:e},{silent:!0})}));const t=pu.vcards;if(pu.session){const e=pu.session.get("bare_jid"),n=pu.xmppstatus;n.vcard=t.get(e)||t.create({jid:e}),n.vcard&&(n.vcard.on("change",(()=>n.trigger("vcard:change"))),n.trigger("vcard:add"))}Bu.trigger("VCardsInitialized")}async function o_(e){const t=Kv.getBareJidFromJid(e)===pu.bare_jid?null:e;let n;try{n=await Bu.sendIQ(t_("get",t))}catch(n){return{jid:e,stanza:n,vcard_error:(new Date).toISOString()}}return async function(e,t){const n=t.querySelector("vCard");let r={};if(null!==n&&(r={stanza:t,fullname:n.querySelector("FN")?.textContent,nickname:n.querySelector("NICKNAME")?.textContent,image:n.querySelector("PHOTO BINVAL")?.textContent,image_type:n.querySelector("PHOTO TYPE")?.textContent,url:n.querySelector("URL")?.textContent,role:n.querySelector("ROLE")?.textContent,email:n.querySelector("EMAIL USERID")?.textContent,vcard_updated:(new Date).toISOString(),vcard_error:void 0}),r.image){const e=e_.base64ToArrayBuffer(r.image),t=await crypto.subtle.digest("SHA-1",e);r.image_hash=e_.arrayBufferToHex(t)}return r}(0,n)}const{dayjs:a_,u:c_}=_h.env,u_={vcard:{async set(e,t){if(!e)throw Error("No jid provided for the VCard data");const n=document.createElement("div"),r=c_.toStanza(`\n                <vCard xmlns="vcard-temp">\n                    <FN>${t.fn}</FN>\n                    <NICKNAME>${t.nickname}</NICKNAME>\n                    <URL>${t.url}</URL>\n                    <ROLE>${t.role}</ROLE>\n                    <EMAIL><INTERNET/><PREF/><USERID>${t.email}</USERID></EMAIL>\n                    <PHOTO>\n                        <TYPE>${t.image_type}</TYPE>\n                        <BINVAL>${t.image}</BINVAL>\n                    </PHOTO>\n                </vCard>`,n);let i;try{i=await Bu.sendIQ(t_("set",e,r))}catch(e){throw e}return await Bu.vcard.update(e,!0),i},get(e,t){if("string"==typeof e)return o_(e);const n=e.get("vcard_error"),r=n&&a_(n).isSame(new Date,"day");if(t||!e.get("vcard_updated")&&!r){const t=e.get("jid");return t||Gc.error("No JID to get vcard for"),o_(t)}return Promise.resolve({})},async update(e,t){const n=await this.get(e,t);(e="string"==typeof e?pu.vcards.get(e):e)?Object.keys(n).length&&(delete n.stanza,e.save(n)):Gc.error(`Could not find a VCard model for ${e}`)}}},{Strophe:d_}=_h.env;_h.plugins.add("converse-vcard",{dependencies:["converse-status","converse-roster"],overrides:{XMPPStatus:{getNickname(){const{_converse:e}=this.__super__,t=this.__super__.getNickname.apply(this);return!t&&e.xmppstatus.vcard?e.xmppstatus.vcard.get("nickname"):t},getFullname(){const{_converse:e}=this.__super__,t=this.__super__.getFullname.apply(this);return!t&&e.xmppstatus.vcard?e.xmppstatus.vcard.get("fullname"):t}},RosterContact:{getDisplayName(){return!this.get("nickname")&&this.vcard?this.vcard.getDisplayName():this.__super__.getDisplayName.apply(this)},getFullname(){return this.vcard?this.vcard.get("fullname"):this.__super__.getFullname.apply(this)}}},initialize(){Bu.promises.add("VCardsInitialized"),pu.VCard=Xv,pu.VCards=Dd.extend({model:pu.VCard,initialize(){this.on("add",(e=>e.get("jid")&&Bu.vcard.update(e)))}}),Bu.listen.on("chatRoomInitialized",(e=>{n_(e),e.occupants.forEach(r_),e.listenTo(e.occupants,"add",r_),e.listenTo(e.occupants,"change:image_hash",(e=>function(e){const t=e.get("image_hash"),n=[];e.get("jid")&&n.push(pu.vcards.get(e.get("jid"))),n.push(pu.vcards.get(e.get("from"))),n.forEach((e=>t&&e?.get("image_hash")!==t&&Bu.vcard.update(e,!0)))}(e)))})),Bu.listen.on("chatBoxInitialized",(e=>n_(e))),Bu.listen.on("chatRoomMessageInitialized",(e=>i_(e))),Bu.listen.on("addClientFeatures",(()=>Bu.disco.own.features.add(d_.NS.VCARD))),Bu.listen.on("clearSession",(()=>{jc()&&(Bu.promises.add("VCardsInitialized"),pu.vcards&&(pu.vcards.clearStore(),delete pu.vcards))})),Bu.listen.on("messageInitialized",(e=>n_(e))),Bu.listen.on("rosterContactInitialized",(e=>n_(e))),Bu.listen.on("statusInitialized",s_),Object.assign(pu.api,u_)}});const l_=_h})(),a})()));
//# sourceMappingURL=converse-headless.min.js.map